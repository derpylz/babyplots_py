define('Baby', [], function() {

var Baby=function(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=i,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=63)}([function(e,t,i){"use strict";i.d(t,"d",function(){return a}),i.d(t,"e",function(){return d}),i.d(t,"f",function(){return h}),i.d(t,"b",function(){return p}),i.d(t,"a",function(){return c}),i.d(t,"c",function(){return v});var o=i(16),r=i(15),n=i(30),s=i(10),a=(u.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},u.prototype.getClassName=function(){return"Vector2"},u.prototype.getHashCode=function(){var e=0|this.x;return e=397*e^(0|this.y)},u.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},u.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},u.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},u.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},u.prototype.set=function(e,t){return this.copyFromFloats(e,t)},u.prototype.add=function(e){return new u(this.x+e.x,this.y+e.y)},u.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},u.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},u.prototype.addVector3=function(e){return new u(this.x+e.x,this.y+e.y)},u.prototype.subtract=function(e){return new u(this.x-e.x,this.y-e.y)},u.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},u.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},u.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},u.prototype.multiply=function(e){return new u(this.x*e.x,this.y*e.y)},u.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},u.prototype.multiplyByFloats=function(e,t){return new u(this.x*e,this.y*t)},u.prototype.divide=function(e){return new u(this.x/e.x,this.y/e.y)},u.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},u.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},u.prototype.negate=function(){return new u(-this.x,-this.y)},u.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},u.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y)},u.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},u.prototype.scale=function(e){var t=new u(0,0);return this.scaleToRef(e,t),t},u.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},u.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},u.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},u.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=r.a),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)},u.prototype.floor=function(){return new u(Math.floor(this.x),Math.floor(this.y))},u.prototype.fract=function(){return new u(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},u.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},u.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},u.prototype.normalize=function(){var e=this.length();return 0===e||(this.x/=e,this.y/=e),this},u.prototype.clone=function(){return new u(this.x,this.y)},u.Zero=function(){return new u(0,0)},u.One=function(){return new u(1,1)},u.FromArray=function(e,t){return void 0===t&&(t=0),new u(e[t],e[t+1])},u.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1]},u.CatmullRom=function(e,t,i,r,n){var o=n*n,s=n*o;return new u(.5*(2*t.x+(-e.x+i.x)*n+(2*e.x-5*t.x+4*i.x-r.x)*o+(-e.x+3*t.x-3*i.x+r.x)*s),.5*(2*t.y+(-e.y+i.y)*n+(2*e.y-5*t.y+4*i.y-r.y)*o+(-e.y+3*t.y-3*i.y+r.y)*s))},u.Clamp=function(e,t,i){var r=e.x;r=(r=r>i.x?i.x:r)<t.x?t.x:r;var n=e.y;return new u(r,n=(n=n>i.y?i.y:n)<t.y?t.y:n)},u.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o,a=2*s-3*o+1,h=-2*s+3*o,l=s-2*o+n,c=s-o;return new u(e.x*a+i.x*h+t.x*l+r.x*c,e.y*a+i.y*h+t.y*l+r.y*c)},u.Lerp=function(e,t,i){return new u(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i)},u.Dot=function(e,t){return e.x*t.x+e.y*t.y},u.Normalize=function(e){var t=e.clone();return t.normalize(),t},u.Minimize=function(e,t){return new u(e.x<t.x?e.x:t.x,e.y<t.y?e.y:t.y)},u.Maximize=function(e,t){return new u(e.x>t.x?e.x:t.x,e.y>t.y?e.y:t.y)},u.Transform=function(e,t){var i=u.Zero();return u.TransformToRef(e,t,i),i},u.TransformToRef=function(e,t,i){var r=t.m,n=e.x*r[0]+e.y*r[4]+r[12],o=e.x*r[1]+e.y*r[5]+r[13];i.x=n,i.y=o},u.PointInTriangle=function(e,t,i,r){var n=.5*(-i.y*r.x+t.y*(-i.x+r.x)+t.x*(i.y-r.y)+i.x*r.y),o=n<0?-1:1,s=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*o,a=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*o;return 0<s&&0<a&&s+a<2*n*o},u.Distance=function(e,t){return Math.sqrt(u.DistanceSquared(e,t))},u.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},u.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},u.DistanceOfPointFromSegment=function(e,t,i){var r=u.DistanceSquared(t,i);if(0===r)return u.Distance(e,t);var n=i.subtract(t),o=Math.max(0,Math.min(1,u.Dot(e.subtract(t),n)/r)),s=t.add(n.multiplyByFloats(o,o));return u.Distance(e,s)},u);function u(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}var d=(f.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},f.prototype.getClassName=function(){return"Vector3"},f.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*e^(0|this.y))^(0|this.z)},f.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},f.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},f.prototype.toQuaternion=function(){return p.RotationYawPitchRoll(this.y,this.x,this.z)},f.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e.x,e.y,e.z)},f.prototype.addInPlaceFromFloats=function(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this},f.prototype.add=function(e){return new f(this.x+e.x,this.y+e.y,this.z+e.z)},f.prototype.addToRef=function(e,t){return t.copyFromFloats(this.x+e.x,this.y+e.y,this.z+e.z)},f.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},f.prototype.subtract=function(e){return new f(this.x-e.x,this.y-e.y,this.z-e.z)},f.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e.x,e.y,e.z,t)},f.prototype.subtractFromFloats=function(e,t,i){return new f(this.x-e,this.y-t,this.z-i)},f.prototype.subtractFromFloatsToRef=function(e,t,i,r){return r.copyFromFloats(this.x-e,this.y-t,this.z-i)},f.prototype.negate=function(){return new f(-this.x,-this.y,-this.z)},f.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},f.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y,-1*this.z)},f.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},f.prototype.scale=function(e){return new f(this.x*e,this.y*e,this.z*e)},f.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this.x*e,this.y*e,this.z*e)},f.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this.x*e,this.y*e,this.z*e)},f.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},f.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=r.a),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)&&o.a.WithinEpsilon(this.z,e.z,t)},f.prototype.equalsToFloats=function(e,t,i){return this.x===e&&this.y===t&&this.z===i},f.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},f.prototype.multiply=function(e){return this.multiplyByFloats(e.x,e.y,e.z)},f.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this.x*e.x,this.y*e.y,this.z*e.z)},f.prototype.multiplyByFloats=function(e,t,i){return new f(this.x*e,this.y*t,this.z*i)},f.prototype.divide=function(e){return new f(this.x/e.x,this.y/e.y,this.z/e.z)},f.prototype.divideToRef=function(e,t){return t.copyFromFloats(this.x/e.x,this.y/e.y,this.z/e.z)},f.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},f.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e.x,e.y,e.z)},f.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e.x,e.y,e.z)},f.prototype.minimizeInPlaceFromFloats=function(e,t,i){return e<this.x&&(this.x=e),t<this.y&&(this.y=t),i<this.z&&(this.z=i),this},f.prototype.maximizeInPlaceFromFloats=function(e,t,i){return e>this.x&&(this.x=e),t>this.y&&(this.y=t),i>this.z&&(this.z=i),this},f.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this.x),i=Math.abs(this.y);if(!o.a.WithinEpsilon(t,i,e))return!0;var r=Math.abs(this.z);return!o.a.WithinEpsilon(t,r,e)||!o.a.WithinEpsilon(i,r,e)},Object.defineProperty(f.prototype,"isNonUniform",{get:function(){var e=Math.abs(this.x),t=Math.abs(this.y);if(e!==t)return!0;var i=Math.abs(this.z);return e!==i||t!==i},enumerable:!0,configurable:!0}),f.prototype.floor=function(){return new f(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},f.prototype.fract=function(){return new f(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},f.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},f.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},f.prototype.normalize=function(){return this.normalizeFromLength(this.length())},f.prototype.reorderInPlace=function(i){var r=this;return"xyz"===(i=i.toLowerCase())||(g.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(e,t){r[e]=g.Vector3[0][i[t]]})),this},f.prototype.rotateByQuaternionToRef=function(e,t){return e.toRotationMatrix(g.Matrix[0]),f.TransformCoordinatesToRef(this,g.Matrix[0],t),t},f.prototype.rotateByQuaternionAroundPointToRef=function(e,t,i){return this.subtractToRef(t,g.Vector3[0]),g.Vector3[0].rotateByQuaternionToRef(e,g.Vector3[0]),t.addToRef(g.Vector3[0],i),i},f.prototype.cross=function(e){return f.Cross(this,e)},f.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},f.prototype.normalizeToNew=function(){var e=new f(0,0,0);return this.normalizeToRef(e),e},f.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/t,e)},f.prototype.clone=function(){return new f(this.x,this.y,this.z)},f.prototype.copyFrom=function(e){return this.copyFromFloats(e.x,e.y,e.z)},f.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},f.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},f.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},f.GetClipFactor=function(e,t,i,r){var n=f.Dot(e,i)-r;return n/(n-(f.Dot(t,i)-r))},f.GetAngleBetweenVectors=function(e,t,i){var r=e.normalizeToRef(g.Vector3[1]),n=t.normalizeToRef(g.Vector3[2]),o=f.Dot(r,n),s=g.Vector3[3];return f.CrossToRef(r,n,s),0<f.Dot(s,i)?Math.acos(o):-Math.acos(o)},f.FromArray=function(e,t){return void 0===t&&(t=0),new f(e[t],e[t+1],e[t+2])},f.FromFloatArray=function(e,t){return f.FromArray(e,t)},f.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},f.FromFloatArrayToRef=function(e,t,i){return f.FromArrayToRef(e,t,i)},f.FromFloatsToRef=function(e,t,i,r){r.copyFromFloats(e,t,i)},f.Zero=function(){return new f(0,0,0)},f.One=function(){return new f(1,1,1)},f.Up=function(){return new f(0,1,0)},Object.defineProperty(f,"UpReadOnly",{get:function(){return f._UpReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ZeroReadOnly",{get:function(){return f._ZeroReadOnly},enumerable:!0,configurable:!0}),f.Down=function(){return new f(0,-1,0)},f.Forward=function(){return new f(0,0,1)},f.Backward=function(){return new f(0,0,-1)},f.Right=function(){return new f(1,0,0)},f.Left=function(){return new f(-1,0,0)},f.TransformCoordinates=function(e,t){var i=f.Zero();return f.TransformCoordinatesToRef(e,t,i),i},f.TransformCoordinatesToRef=function(e,t,i){f.TransformCoordinatesFromFloatsToRef(e.x,e.y,e.z,t,i)},f.TransformCoordinatesFromFloatsToRef=function(e,t,i,r,n){var o=r.m,s=e*o[0]+t*o[4]+i*o[8]+o[12],a=e*o[1]+t*o[5]+i*o[9]+o[13],h=e*o[2]+t*o[6]+i*o[10]+o[14],l=1/(e*o[3]+t*o[7]+i*o[11]+o[15]);n.x=s*l,n.y=a*l,n.z=h*l},f.TransformNormal=function(e,t){var i=f.Zero();return f.TransformNormalToRef(e,t,i),i},f.TransformNormalToRef=function(e,t,i){this.TransformNormalFromFloatsToRef(e.x,e.y,e.z,t,i)},f.TransformNormalFromFloatsToRef=function(e,t,i,r,n){var o=r.m;n.x=e*o[0]+t*o[4]+i*o[8],n.y=e*o[1]+t*o[5]+i*o[9],n.z=e*o[2]+t*o[6]+i*o[10]},f.CatmullRom=function(e,t,i,r,n){var o=n*n,s=n*o;return new f(.5*(2*t.x+(-e.x+i.x)*n+(2*e.x-5*t.x+4*i.x-r.x)*o+(-e.x+3*t.x-3*i.x+r.x)*s),.5*(2*t.y+(-e.y+i.y)*n+(2*e.y-5*t.y+4*i.y-r.y)*o+(-e.y+3*t.y-3*i.y+r.y)*s),.5*(2*t.z+(-e.z+i.z)*n+(2*e.z-5*t.z+4*i.z-r.z)*o+(-e.z+3*t.z-3*i.z+r.z)*s))},f.Clamp=function(e,t,i){var r=new f;return f.ClampToRef(e,t,i,r),r},f.ClampToRef=function(e,t,i,r){var n=e.x;n=(n=n>i.x?i.x:n)<t.x?t.x:n;var o=e.y;o=(o=o>i.y?i.y:o)<t.y?t.y:o;var s=e.z;s=(s=s>i.z?i.z:s)<t.z?t.z:s,r.copyFromFloats(n,o,s)},f.CheckExtends=function(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)},f.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o,a=2*s-3*o+1,h=-2*s+3*o,l=s-2*o+n,c=s-o;return new f(e.x*a+i.x*h+t.x*l+r.x*c,e.y*a+i.y*h+t.y*l+r.y*c,e.z*a+i.z*h+t.z*l+r.z*c)},f.Lerp=function(e,t,i){var r=new f(0,0,0);return f.LerpToRef(e,t,i,r),r},f.LerpToRef=function(e,t,i,r){r.x=e.x+(t.x-e.x)*i,r.y=e.y+(t.y-e.y)*i,r.z=e.z+(t.z-e.z)*i},f.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},f.Cross=function(e,t){var i=f.Zero();return f.CrossToRef(e,t,i),i},f.CrossToRef=function(e,t,i){var r=e.y*t.z-e.z*t.y,n=e.z*t.x-e.x*t.z,o=e.x*t.y-e.y*t.x;i.copyFromFloats(r,n,o)},f.Normalize=function(e){var t=f.Zero();return f.NormalizeToRef(e,t),t},f.NormalizeToRef=function(e,t){e.normalizeToRef(t)},f.Project=function(e,t,i,r){var n=r.width,o=r.height,s=r.x,a=r.y,h=g.Matrix[1];c.FromValuesToRef(n/2,0,0,0,0,-o/2,0,0,0,0,.5,0,s+n/2,o/2+a,.5,1,h);var l=g.Matrix[0];return t.multiplyToRef(i,l),l.multiplyToRef(h,l),f.TransformCoordinates(e,l)},f._UnprojectFromInvertedMatrixToRef=function(e,t,i){f.TransformCoordinatesToRef(e,t,i);var r=t.m,n=e.x*r[3]+e.y*r[7]+e.z*r[11]+r[15];o.a.WithinEpsilon(n,1)&&i.scaleInPlace(1/n)},f.UnprojectFromTransform=function(e,t,i,r,n){var o=g.Matrix[0];r.multiplyToRef(n,o),o.invert(),e.x=e.x/t*2-1,e.y=-(e.y/i*2-1);var s=new f;return f._UnprojectFromInvertedMatrixToRef(e,o,s),s},f.Unproject=function(e,t,i,r,n,o){var s=f.Zero();return f.UnprojectToRef(e,t,i,r,n,o,s),s},f.UnprojectToRef=function(e,t,i,r,n,o,s){f.UnprojectFloatsToRef(e.x,e.y,e.z,t,i,r,n,o,s)},f.UnprojectFloatsToRef=function(e,t,i,r,n,o,s,a,h){var l=g.Matrix[0];o.multiplyToRef(s,l),l.multiplyToRef(a,l),l.invert();var c=g.Vector3[0];c.x=e/r*2-1,c.y=-(t/n*2-1),c.z=2*i-1,f._UnprojectFromInvertedMatrixToRef(c,l,h)},f.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},f.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},f.Distance=function(e,t){return Math.sqrt(f.DistanceSquared(e,t))},f.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return i*i+r*r+n*n},f.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},f.RotationFromAxis=function(e,t,i){var r=f.Zero();return f.RotationFromAxisToRef(e,t,i,r),r},f.RotationFromAxisToRef=function(e,t,i,r){var n=g.Quaternion[0];p.RotationQuaternionFromAxisToRef(e,t,i,n),n.toEulerAnglesToRef(r)},f._UpReadOnly=f.Up(),f._ZeroReadOnly=f.Zero(),f);function f(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=i}var h=(l.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},l.prototype.getClassName=function(){return"Vector4"},l.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*(e=397*e^(0|this.y))^(0|this.z))^(0|this.w)},l.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},l.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},l.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},l.prototype.add=function(e){return new l(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},l.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},l.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},l.prototype.subtract=function(e){return new l(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},l.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},l.prototype.subtractFromFloats=function(e,t,i,r){return new l(this.x-e,this.y-t,this.z-i,this.w-r)},l.prototype.subtractFromFloatsToRef=function(e,t,i,r,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-i,n.w=this.w-r,this},l.prototype.negate=function(){return new l(-this.x,-this.y,-this.z,-this.w)},l.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},l.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},l.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},l.prototype.scale=function(e){return new l(this.x*e,this.y*e,this.z*e,this.w*e)},l.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},l.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},l.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},l.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=r.a),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)&&o.a.WithinEpsilon(this.z,e.z,t)&&o.a.WithinEpsilon(this.w,e.w,t)},l.prototype.equalsToFloats=function(e,t,i,r){return this.x===e&&this.y===t&&this.z===i&&this.w===r},l.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},l.prototype.multiply=function(e){return new l(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},l.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},l.prototype.multiplyByFloats=function(e,t,i,r){return new l(this.x*e,this.y*t,this.z*i,this.w*r)},l.prototype.divide=function(e){return new l(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},l.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},l.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},l.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},l.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},l.prototype.floor=function(){return new l(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},l.prototype.fract=function(){return new l(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},l.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},l.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},l.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},l.prototype.toVector3=function(){return new d(this.x,this.y,this.z)},l.prototype.clone=function(){return new l(this.x,this.y,this.z,this.w)},l.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},l.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},l.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},l.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},l.FromArray=function(e,t){return new l(e[t=t||0],e[t+1],e[t+2],e[t+3])},l.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},l.FromFloatArrayToRef=function(e,t,i){l.FromArrayToRef(e,t,i)},l.FromFloatsToRef=function(e,t,i,r,n){n.x=e,n.y=t,n.z=i,n.w=r},l.Zero=function(){return new l(0,0,0,0)},l.One=function(){return new l(1,1,1,1)},l.Normalize=function(e){var t=l.Zero();return l.NormalizeToRef(e,t),t},l.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},l.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},l.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},l.Distance=function(e,t){return Math.sqrt(l.DistanceSquared(e,t))},l.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,o=e.w-t.w;return i*i+r*r+n*n+o*o},l.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},l.TransformNormal=function(e,t){var i=l.Zero();return l.TransformNormalToRef(e,t,i),i},l.TransformNormalToRef=function(e,t,i){var r=t.m,n=e.x*r[0]+e.y*r[4]+e.z*r[8],o=e.x*r[1]+e.y*r[5]+e.z*r[9],s=e.x*r[2]+e.y*r[6]+e.z*r[10];i.x=n,i.y=o,i.z=s,i.w=e.w},l.TransformNormalFromFloatsToRef=function(e,t,i,r,n,o){var s=n.m;o.x=e*s[0]+t*s[4]+i*s[8],o.y=e*s[1]+t*s[5]+i*s[9],o.z=e*s[2]+t*s[6]+i*s[10],o.w=r},l.FromVector3=function(e,t){return void 0===t&&(t=0),new l(e.x,e.y,e.z,t)},l);function l(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r}var p=(_.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},_.prototype.getClassName=function(){return"Quaternion"},_.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*(e=397*e^(0|this.y))^(0|this.z))^(0|this.w)},_.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},_.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},_.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=r.a),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)&&o.a.WithinEpsilon(this.z,e.z,t)&&o.a.WithinEpsilon(this.w,e.w,t)},_.prototype.clone=function(){return new _(this.x,this.y,this.z,this.w)},_.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},_.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},_.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},_.prototype.add=function(e){return new _(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},_.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},_.prototype.subtract=function(e){return new _(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},_.prototype.scale=function(e){return new _(this.x*e,this.y*e,this.z*e,this.w*e)},_.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},_.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},_.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},_.prototype.multiply=function(e){var t=new _(0,0,0,1);return this.multiplyToRef(e,t),t},_.prototype.multiplyToRef=function(e,t){var i=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,r=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,n=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,o=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(i,r,n,o),this},_.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},_.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},_.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},_.prototype.conjugate=function(){return new _(-this.x,-this.y,-this.z,this.w)},_.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},_.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},_.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=d.Zero();return this.toEulerAnglesToRef(t),t},_.prototype.toEulerAnglesToRef=function(e){var t=this.z,i=this.x,r=this.y,n=this.w,o=n*n,s=t*t,a=i*i,h=r*r,l=r*t-i*n;return l<-.4999999?(e.y=2*Math.atan2(r,n),e.x=Math.PI/2,e.z=0):.4999999<l?(e.y=2*Math.atan2(r,n),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(i*r+t*n),-s-a+h+o),e.x=Math.asin(-2*(t*r-i*n)),e.y=Math.atan2(2*(t*i+r*n),s-a-h+o)),this},_.prototype.toRotationMatrix=function(e){return c.FromQuaternionToRef(this,e),this},_.prototype.fromRotationMatrix=function(e){return _.FromRotationMatrixToRef(e,this),this},_.FromRotationMatrix=function(e){var t=new _;return _.FromRotationMatrixToRef(e,t),t},_.FromRotationMatrixToRef=function(e,t){var i,r=e.m,n=r[0],o=r[4],s=r[8],a=r[1],h=r[5],l=r[9],c=r[2],u=r[6],f=r[10],d=n+h+f;0<d?(i=.5/Math.sqrt(d+1),t.w=.25/i,t.x=(u-l)*i,t.y=(s-c)*i,t.z=(a-o)*i):h<n&&f<n?(i=2*Math.sqrt(1+n-h-f),t.w=(u-l)/i,t.x=.25*i,t.y=(o+a)/i,t.z=(s+c)/i):f<h?(i=2*Math.sqrt(1+h-n-f),t.w=(s-c)/i,t.x=(o+a)/i,t.y=.25*i,t.z=(l+u)/i):(i=2*Math.sqrt(1+f-n-h),t.w=(a-o)/i,t.x=(s+c)/i,t.y=(l+u)/i,t.z=.25*i)},_.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},_.AreClose=function(e,t){return 0<=_.Dot(e,t)},_.Zero=function(){return new _(0,0,0,0)},_.Inverse=function(e){return new _(-e.x,-e.y,-e.z,e.w)},_.InverseToRef=function(e,t){return t.set(-e.x,-e.y,-e.z,e.w),t},_.Identity=function(){return new _(0,0,0,1)},_.IsIdentity=function(e){return e&&0===e.x&&0===e.y&&0===e.z&&1===e.w},_.RotationAxis=function(e,t){return _.RotationAxisToRef(e,t,new _)},_.RotationAxisToRef=function(e,t,i){var r=Math.sin(t/2);return e.normalize(),i.w=Math.cos(t/2),i.x=e.x*r,i.y=e.y*r,i.z=e.z*r,i},_.FromArray=function(e,t){return new _(e[t=t||0],e[t+1],e[t+2],e[t+3])},_.FromEulerAngles=function(e,t,i){var r=new _;return _.RotationYawPitchRollToRef(t,e,i,r),r},_.FromEulerAnglesToRef=function(e,t,i,r){return _.RotationYawPitchRollToRef(t,e,i,r),r},_.FromEulerVector=function(e){var t=new _;return _.RotationYawPitchRollToRef(e.y,e.x,e.z,t),t},_.FromEulerVectorToRef=function(e,t){return _.RotationYawPitchRollToRef(e.y,e.x,e.z,t),t},_.RotationYawPitchRoll=function(e,t,i){var r=new _;return _.RotationYawPitchRollToRef(e,t,i,r),r},_.RotationYawPitchRollToRef=function(e,t,i,r){var n=.5*i,o=.5*t,s=.5*e,a=Math.sin(n),h=Math.cos(n),l=Math.sin(o),c=Math.cos(o),u=Math.sin(s),f=Math.cos(s);r.x=f*l*h+u*c*a,r.y=u*c*h-f*l*a,r.z=f*c*a-u*l*h,r.w=f*c*h+u*l*a},_.RotationAlphaBetaGamma=function(e,t,i){var r=new _;return _.RotationAlphaBetaGammaToRef(e,t,i,r),r},_.RotationAlphaBetaGammaToRef=function(e,t,i,r){var n=.5*(i+e),o=.5*(i-e),s=.5*t;r.x=Math.cos(o)*Math.sin(s),r.y=Math.sin(o)*Math.sin(s),r.z=Math.sin(n)*Math.cos(s),r.w=Math.cos(n)*Math.cos(s)},_.RotationQuaternionFromAxis=function(e,t,i){var r=new _(0,0,0,0);return _.RotationQuaternionFromAxisToRef(e,t,i,r),r},_.RotationQuaternionFromAxisToRef=function(e,t,i,r){var n=g.Matrix[0];c.FromXYZAxesToRef(e.normalize(),t.normalize(),i.normalize(),n),_.FromRotationMatrixToRef(n,r)},_.Slerp=function(e,t,i){var r=_.Identity();return _.SlerpToRef(e,t,i,r),r},_.SlerpToRef=function(e,t,i,r){var n,o,s=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,a=!1;if(s<0&&(a=!0,s=-s),.999999<s)o=1-i,n=a?-i:i;else{var h=Math.acos(s),l=1/Math.sin(h);o=Math.sin((1-i)*h)*l,n=a?-Math.sin(i*h)*l:Math.sin(i*h)*l}r.x=o*e.x+n*t.x,r.y=o*e.y+n*t.y,r.z=o*e.z+n*t.z,r.w=o*e.w+n*t.w},_.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o,a=2*s-3*o+1,h=-2*s+3*o,l=s-2*o+n,c=s-o;return new _(e.x*a+i.x*h+t.x*l+r.x*c,e.y*a+i.y*h+t.y*l+r.y*c,e.z*a+i.z*h+t.z*l+r.z*c,e.w*a+i.w*h+t.w*l+r.w*c)},_);function _(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}var c=(Object.defineProperty(j.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),j.prototype._markAsUpdated=function(){this.updateFlag=j._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},j.prototype._updateIdentityStatus=function(e,t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!0),this.updateFlag=j._updateFlagSeed++,this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&r},j.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity},j.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},j.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e=this._m,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],c=e[9],u=e[10],f=e[11],d=e[12],p=e[13],_=e[14],g=e[15],m=u*g-_*f,v=c*g-p*f,b=c*_-p*u,y=l*g-d*f,x=l*_-u*d,T=l*p-d*c;return t*(s*m-a*v+h*b)+i*-(o*m-a*y+h*x)+r*(o*v-s*y+h*T)+n*-(o*b-s*x+a*T)},j.prototype.toArray=function(){return this._m},j.prototype.asArray=function(){return this._m},j.prototype.invert=function(){return this.invertToRef(this),this},j.prototype.reset=function(){return j.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},j.prototype.add=function(e){var t=new j;return this.addToRef(e,t),t},j.prototype.addToRef=function(e,t){for(var i=this._m,r=t._m,n=e.m,o=0;o<16;o++)r[o]=i[o]+n[o];return t._markAsUpdated(),this},j.prototype.addToSelf=function(e){for(var t=this._m,i=e.m,r=0;r<16;r++)t[r]+=i[r];return this._markAsUpdated(),this},j.prototype.invertToRef=function(e){if(!0===this._isIdentity)return j.IdentityToRef(e),this;var t=this._m,i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],l=t[7],c=t[8],u=t[9],f=t[10],d=t[11],p=t[12],_=t[13],g=t[14],m=t[15],v=f*m-g*d,b=u*m-_*d,y=u*g-_*f,x=c*m-p*d,T=c*g-f*p,M=c*_-p*u,E=+(a*v-h*b+l*y),A=-(s*v-h*x+l*T),O=+(s*b-a*x+l*M),P=-(s*y-a*T+h*M),C=i*E+r*A+n*O+o*P;if(0==C)return e.copyFrom(this),this;var S=1/C,R=h*m-g*l,I=a*m-_*l,w=a*g-_*h,D=s*m-p*l,L=s*g-p*h,F=s*_-p*a,N=h*d-f*l,B=a*d-u*l,k=a*f-u*h,U=s*d-c*l,V=s*f-c*h,z=s*u-c*a;return j.FromValuesToRef(E*S,-(r*v-n*b+o*y)*S,(r*R-n*I+o*w)*S,-(r*N-n*B+o*k)*S,A*S,(i*v-n*x+o*T)*S,-(i*R-n*D+o*L)*S,(i*N-n*U+o*V)*S,O*S,-(i*b-r*x+o*M)*S,(i*I-r*D+o*F)*S,-(i*B-r*U+o*z)*S,P*S,(i*y-r*T+n*M)*S,-(i*w-r*L+n*F)*S,(i*k-r*V+n*z)*S,e),this},j.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this._markAsUpdated(),this},j.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this._markAsUpdated(),this},j.prototype.setTranslationFromFloats=function(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this._markAsUpdated(),this},j.prototype.addTranslationFromFloats=function(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this._markAsUpdated(),this},j.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e.x,e.y,e.z)},j.prototype.getTranslation=function(){return new d(this._m[12],this._m[13],this._m[14])},j.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},j.prototype.removeRotationAndScaling=function(){var e=this.m;return j.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]),this},j.prototype.multiply=function(e){var t=new j;return this.multiplyToRef(e,t),t},j.prototype.copyFrom=function(e){return e.copyToArray(this._m),this._updateIdentityStatus(e._isIdentity,e._isIdentityDirty,e._isIdentity3x2,e._isIdentity3x2Dirty),this},j.prototype.copyToArray=function(e,t){void 0===t&&(t=0);var i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this},j.prototype.multiplyToRef=function(e,t){return this._isIdentity?t.copyFrom(e):e._isIdentity?t.copyFrom(this):(this.multiplyToArray(e,t._m,0),t._markAsUpdated()),this},j.prototype.multiplyToArray=function(e,t,i){var r=this._m,n=e.m,o=r[0],s=r[1],a=r[2],h=r[3],l=r[4],c=r[5],u=r[6],f=r[7],d=r[8],p=r[9],_=r[10],g=r[11],m=r[12],v=r[13],b=r[14],y=r[15],x=n[0],T=n[1],M=n[2],E=n[3],A=n[4],O=n[5],P=n[6],C=n[7],S=n[8],R=n[9],I=n[10],w=n[11],D=n[12],L=n[13],F=n[14],N=n[15];return t[i]=o*x+s*A+a*S+h*D,t[i+1]=o*T+s*O+a*R+h*L,t[i+2]=o*M+s*P+a*I+h*F,t[i+3]=o*E+s*C+a*w+h*N,t[i+4]=l*x+c*A+u*S+f*D,t[i+5]=l*T+c*O+u*R+f*L,t[i+6]=l*M+c*P+u*I+f*F,t[i+7]=l*E+c*C+u*w+f*N,t[i+8]=d*x+p*A+_*S+g*D,t[i+9]=d*T+p*O+_*R+g*L,t[i+10]=d*M+p*P+_*I+g*F,t[i+11]=d*E+p*C+_*w+g*N,t[i+12]=m*x+v*A+b*S+y*D,t[i+13]=m*T+v*O+b*R+y*L,t[i+14]=m*M+v*P+b*I+y*F,t[i+15]=m*E+v*C+b*w+y*N,this},j.prototype.equals=function(e){if(!e)return!1;if((this._isIdentity||e._isIdentity)&&!this._isIdentityDirty&&!e._isIdentityDirty)return this._isIdentity&&e._isIdentity;var t=this.m,i=e.m;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]&&t[9]===i[9]&&t[10]===i[10]&&t[11]===i[11]&&t[12]===i[12]&&t[13]===i[13]&&t[14]===i[14]&&t[15]===i[15]},j.prototype.clone=function(){var e=new j;return e.copyFrom(this),e},j.prototype.getClassName=function(){return"Matrix"},j.prototype.getHashCode=function(){for(var e=0|this._m[0],t=1;t<16;t++)e=397*e^(0|this._m[t]);return e},j.prototype.decompose=function(e,t,i){if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;var r=this._m;if(i&&i.copyFromFloats(r[12],r[13],r[14]),(e=e||g.Vector3[0]).x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),e.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),e.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),this.determinant()<=0&&(e.y*=-1),0===e.x||0===e.y||0===e.z)return t&&t.copyFromFloats(0,0,0,1),!1;if(t){var n=1/e.x,o=1/e.y,s=1/e.z;j.FromValuesToRef(r[0]*n,r[1]*n,r[2]*n,0,r[4]*o,r[5]*o,r[6]*o,0,r[8]*s,r[9]*s,r[10]*s,0,0,0,0,1,g.Matrix[0]),p.FromRotationMatrixToRef(g.Matrix[0],t)}return!0},j.prototype.getRow=function(e){if(e<0||3<e)return null;var t=4*e;return new h(this._m[0+t],this._m[1+t],this._m[2+t],this._m[3+t])},j.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},j.prototype.transpose=function(){return j.Transpose(this)},j.prototype.transposeToRef=function(e){return j.TransposeToRef(this,e),this},j.prototype.setRowFromFloats=function(e,t,i,r,n){if(e<0||3<e)return this;var o=4*e;return this._m[0+o]=t,this._m[1+o]=i,this._m[2+o]=r,this._m[3+o]=n,this._markAsUpdated(),this},j.prototype.scale=function(e){var t=new j;return this.scaleToRef(e,t),t},j.prototype.scaleToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]=this._m[i]*e;return t._markAsUpdated(),this},j.prototype.scaleAndAddToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t._markAsUpdated(),this},j.prototype.toNormalMatrix=function(e){var t=g.Matrix[0];this.invertToRef(t),t.transposeToRef(e);var i=e._m;j.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e)},j.prototype.getRotationMatrix=function(){var e=new j;return this.getRotationMatrixToRef(e),e},j.prototype.getRotationMatrixToRef=function(e){var t=g.Vector3[0];if(!this.decompose(t))return j.IdentityToRef(e),this;var i=this._m,r=1/t.x,n=1/t.y,o=1/t.z;return j.FromValuesToRef(i[0]*r,i[1]*r,i[2]*r,0,i[4]*n,i[5]*n,i[6]*n,0,i[8]*o,i[9]*o,i[10]*o,0,0,0,0,1,e),this},j.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},j.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},j.FromArray=function(e,t){void 0===t&&(t=0);var i=new j;return j.FromArrayToRef(e,t,i),i},j.FromArrayToRef=function(e,t,i){for(var r=0;r<16;r++)i._m[r]=e[r+t];i._markAsUpdated()},j.FromFloat32ArrayToRefScaled=function(e,t,i,r){for(var n=0;n<16;n++)r._m[n]=e[n+t]*i;r._markAsUpdated()},Object.defineProperty(j,"IdentityReadOnly",{get:function(){return j._identityReadOnly},enumerable:!0,configurable:!0}),j.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,l,c,u,f,d,p,_,g){var m=g._m;m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=n,m[5]=o,m[6]=s,m[7]=a,m[8]=h,m[9]=l,m[10]=c,m[11]=u,m[12]=f,m[13]=d,m[14]=p,m[15]=_,g._markAsUpdated()},j.FromValues=function(e,t,i,r,n,o,s,a,h,l,c,u,f,d,p,_){var g=new j,m=g._m;return m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=n,m[5]=o,m[6]=s,m[7]=a,m[8]=h,m[9]=l,m[10]=c,m[11]=u,m[12]=f,m[13]=d,m[14]=p,m[15]=_,g._markAsUpdated(),g},j.Compose=function(e,t,i){var r=new j;return j.ComposeToRef(e,t,i,r),r},j.ComposeToRef=function(e,t,i,r){var n=r._m,o=t.x,s=t.y,a=t.z,h=t.w,l=o+o,c=s+s,u=a+a,f=o*l,d=o*c,p=o*u,_=s*c,g=s*u,m=a*u,v=h*l,b=h*c,y=h*u,x=e.x,T=e.y,M=e.z;n[0]=(1-(_+m))*x,n[1]=(d+y)*x,n[2]=(p-b)*x,n[3]=0,n[4]=(d-y)*T,n[5]=(1-(f+m))*T,n[6]=(g+v)*T,n[7]=0,n[8]=(p+b)*M,n[9]=(g-v)*M,n[10]=(1-(f+_))*M,n[11]=0,n[12]=i.x,n[13]=i.y,n[14]=i.z,n[15]=1,r._markAsUpdated()},j.Identity=function(){var e=j.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e},j.IdentityToRef=function(e){j.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0)},j.Zero=function(){var e=j.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e},j.RotationX=function(e){var t=new j;return j.RotationXToRef(e,t),t},j.Invert=function(e){var t=new j;return e.invertToRef(t),t},j.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);j.FromValuesToRef(1,0,0,0,0,r,i,0,0,-i,r,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i)},j.RotationY=function(e){var t=new j;return j.RotationYToRef(e,t),t},j.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);j.FromValuesToRef(r,0,-i,0,0,1,0,0,i,0,r,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i)},j.RotationZ=function(e){var t=new j;return j.RotationZToRef(e,t),t},j.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);j.FromValuesToRef(r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i)},j.RotationAxis=function(e,t){var i=new j;return j.RotationAxisToRef(e,t,i),i},j.RotationAxisToRef=function(e,t,i){var r=Math.sin(-t),n=Math.cos(-t),o=1-n;e.normalize();var s=i._m;s[0]=e.x*e.x*o+n,s[1]=e.x*e.y*o-e.z*r,s[2]=e.x*e.z*o+e.y*r,s[3]=0,s[4]=e.y*e.x*o+e.z*r,s[5]=e.y*e.y*o+n,s[6]=e.y*e.z*o-e.x*r,s[7]=0,s[8]=e.z*e.x*o-e.y*r,s[9]=e.z*e.y*o+e.x*r,s[10]=e.z*e.z*o+n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i._markAsUpdated()},j.RotationAlignToRef=function(e,t,i){var r=d.Cross(t,e),n=d.Dot(t,e),o=1/(1+n),s=i._m;s[0]=r.x*r.x*o+n,s[1]=r.y*r.x*o-r.z,s[2]=r.z*r.x*o+r.y,s[3]=0,s[4]=r.x*r.y*o+r.z,s[5]=r.y*r.y*o+n,s[6]=r.z*r.y*o-r.x,s[7]=0,s[8]=r.x*r.z*o-r.y,s[9]=r.y*r.z*o+r.x,s[10]=r.z*r.z*o+n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i._markAsUpdated()},j.RotationYawPitchRoll=function(e,t,i){var r=new j;return j.RotationYawPitchRollToRef(e,t,i,r),r},j.RotationYawPitchRollToRef=function(e,t,i,r){p.RotationYawPitchRollToRef(e,t,i,g.Quaternion[0]),g.Quaternion[0].toRotationMatrix(r)},j.Scaling=function(e,t,i){var r=new j;return j.ScalingToRef(e,t,i,r),r},j.ScalingToRef=function(e,t,i,r){j.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,r),r._updateIdentityStatus(1===e&&1===t&&1===i)},j.Translation=function(e,t,i){var r=new j;return j.TranslationToRef(e,t,i,r),r},j.TranslationToRef=function(e,t,i,r){j.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,r),r._updateIdentityStatus(0===e&&0===t&&0===i)},j.Lerp=function(e,t,i){var r=new j;return j.LerpToRef(e,t,i,r),r},j.LerpToRef=function(e,t,i,r){for(var n=r._m,o=e.m,s=t.m,a=0;a<16;a++)n[a]=o[a]*(1-i)+s[a]*i;r._markAsUpdated()},j.DecomposeLerp=function(e,t,i){var r=new j;return j.DecomposeLerpToRef(e,t,i,r),r},j.DecomposeLerpToRef=function(e,t,i,r){var n=g.Vector3[0],o=g.Quaternion[0],s=g.Vector3[1];e.decompose(n,o,s);var a=g.Vector3[2],h=g.Quaternion[1],l=g.Vector3[3];t.decompose(a,h,l);var c=g.Vector3[4];d.LerpToRef(n,a,i,c);var u=g.Quaternion[2];p.SlerpToRef(o,h,i,u);var f=g.Vector3[5];d.LerpToRef(s,l,i,f),j.ComposeToRef(c,u,f,r)},j.LookAtLH=function(e,t,i){var r=new j;return j.LookAtLHToRef(e,t,i,r),r},j.LookAtLHToRef=function(e,t,i,r){var n=g.Vector3[0],o=g.Vector3[1],s=g.Vector3[2];t.subtractToRef(e,s),s.normalize(),d.CrossToRef(i,s,n);var a=n.lengthSquared();0===a?n.x=1:n.normalizeFromLength(Math.sqrt(a)),d.CrossToRef(s,n,o),o.normalize();var h=-d.Dot(n,e),l=-d.Dot(o,e),c=-d.Dot(s,e);j.FromValuesToRef(n.x,o.x,s.x,0,n.y,o.y,s.y,0,n.z,o.z,s.z,0,h,l,c,1,r)},j.LookAtRH=function(e,t,i){var r=new j;return j.LookAtRHToRef(e,t,i,r),r},j.LookAtRHToRef=function(e,t,i,r){var n=g.Vector3[0],o=g.Vector3[1],s=g.Vector3[2];e.subtractToRef(t,s),s.normalize(),d.CrossToRef(i,s,n);var a=n.lengthSquared();0===a?n.x=1:n.normalizeFromLength(Math.sqrt(a)),d.CrossToRef(s,n,o),o.normalize();var h=-d.Dot(n,e),l=-d.Dot(o,e),c=-d.Dot(s,e);j.FromValuesToRef(n.x,o.x,s.x,0,n.y,o.y,s.y,0,n.z,o.z,s.z,0,h,l,c,1,r)},j.OrthoLH=function(e,t,i,r){var n=new j;return j.OrthoLHToRef(e,t,i,r,n),n},j.OrthoLHToRef=function(e,t,i,r,n){var o=2/e,s=2/t,a=2/(r-i),h=-(r+i)/(r-i);j.FromValuesToRef(o,0,0,0,0,s,0,0,0,0,a,0,0,0,h,1,n),n._updateIdentityStatus(1==o&&1==s&&1==a&&0==h)},j.OrthoOffCenterLH=function(e,t,i,r,n,o){var s=new j;return j.OrthoOffCenterLHToRef(e,t,i,r,n,o,s),s},j.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){j.FromValuesToRef(2/(t-e),0,0,0,0,2/(r-i),0,0,0,0,2/(o-n),0,(e+t)/(e-t),(r+i)/(i-r),-(o+n)/(o-n),1,s),s._markAsUpdated()},j.OrthoOffCenterRH=function(e,t,i,r,n,o){var s=new j;return j.OrthoOffCenterRHToRef(e,t,i,r,n,o,s),s},j.OrthoOffCenterRHToRef=function(e,t,i,r,n,o,s){j.OrthoOffCenterLHToRef(e,t,i,r,n,o,s),s._m[10]*=-1},j.PerspectiveLH=function(e,t,i,r){var n=new j;return j.FromValuesToRef(2*i/e,0,0,0,0,2*i/t,0,0,0,0,(r+i)/(r-i),1,0,0,-2*r*i/(r-i),0,n),n._updateIdentityStatus(!1),n},j.PerspectiveFovLH=function(e,t,i,r){var n=new j;return j.PerspectiveFovLHToRef(e,t,i,r,n),n},j.PerspectiveFovLHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=i,a=r,h=1/Math.tan(.5*e);j.FromValuesToRef(o?h/t:h,0,0,0,0,o?h:h*t,0,0,0,0,(a+s)/(a-s),1,0,0,-2*a*s/(a-s),0,n),n._updateIdentityStatus(!1)},j.PerspectiveFovReverseLHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=1/Math.tan(.5*e);j.FromValuesToRef(o?s/t:s,0,0,0,0,o?s:s*t,0,0,0,0,-i,1,0,0,1,0,n),n._updateIdentityStatus(!1)},j.PerspectiveFovRH=function(e,t,i,r){var n=new j;return j.PerspectiveFovRHToRef(e,t,i,r,n),n},j.PerspectiveFovRHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=i,a=r,h=1/Math.tan(.5*e);j.FromValuesToRef(o?h/t:h,0,0,0,0,o?h:h*t,0,0,0,0,-(a+s)/(a-s),-1,0,0,-2*a*s/(a-s),0,n),n._updateIdentityStatus(!1)},j.PerspectiveFovReverseRHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=1/Math.tan(.5*e);j.FromValuesToRef(o?s/t:s,0,0,0,0,o?s:s*t,0,0,0,0,-i,-1,0,0,-1,0,n),n._updateIdentityStatus(!1)},j.PerspectiveFovWebVRToRef=function(e,t,i,r,n){void 0===n&&(n=!1);var o=n?-1:1,s=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),l=Math.tan(e.rightDegrees*Math.PI/180),c=2/(h+l),u=2/(s+a),f=r._m;f[0]=c,f[1]=f[2]=f[3]=f[4]=0,f[5]=u,f[6]=f[7]=0,f[8]=(h-l)*c*.5,f[9]=-(s-a)*u*.5,f[10]=-i/(t-i),f[11]=o,f[12]=f[13]=f[15]=0,f[14]=-2*i*t/(i-t),r._markAsUpdated()},j.GetFinalMatrix=function(e,t,i,r,n,o){var s=e.width,a=e.height,h=e.x,l=e.y,c=j.FromValues(s/2,0,0,0,0,-a/2,0,0,0,0,o-n,0,h+s/2,a/2+l,n,1),u=g.Matrix[0];return t.multiplyToRef(i,u),u.multiplyToRef(r,u),u.multiply(c)},j.GetAsMatrix2x2=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[4],t[5]])},j.GetAsMatrix3x3=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]])},j.Transpose=function(e){var t=new j;return j.TransposeToRef(e,t),t},j.TransposeToRef=function(e,t){var i=t._m,r=e.m;i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i[12]=r[3],i[13]=r[7],i[14]=r[11],i[15]=r[15],t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},j.Reflection=function(e){var t=new j;return j.ReflectionToRef(e,t),t},j.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;j.FromValuesToRef(o*i+1,s*i,a*i,0,o*r,s*r+1,a*r,0,o*n,s*n,a*n+1,0,o*e.d,s*e.d,a*e.d,1,t)},j.FromXYZAxesToRef=function(e,t,i,r){j.FromValuesToRef(e.x,e.y,e.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1,r)},j.FromQuaternionToRef=function(e,t){var i=e.x*e.x,r=e.y*e.y,n=e.z*e.z,o=e.x*e.y,s=e.z*e.w,a=e.z*e.x,h=e.y*e.w,l=e.y*e.z,c=e.x*e.w;t._m[0]=1-2*(r+n),t._m[1]=2*(o+s),t._m[2]=2*(a-h),t._m[3]=0,t._m[4]=2*(o-s),t._m[5]=1-2*(n+i),t._m[6]=2*(l+c),t._m[7]=0,t._m[8]=2*(a+h),t._m[9]=2*(l-c),t._m[10]=1-2*(r+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t._markAsUpdated()},j._updateFlagSeed=0,j._identityReadOnly=j.Identity(),j);function j(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}var g=(m.Vector3=n.a.BuildArray(6,d.Zero),m.Matrix=n.a.BuildArray(2,c.Identity),m.Quaternion=n.a.BuildArray(3,p.Zero),m);function m(){}var v=(b.Vector2=n.a.BuildArray(3,a.Zero),b.Vector3=n.a.BuildArray(13,d.Zero),b.Vector4=n.a.BuildArray(3,h.Zero),b.Quaternion=n.a.BuildArray(2,p.Zero),b.Matrix=n.a.BuildArray(8,c.Identity),b);function b(){}s.a.RegisteredTypes["BABYLON.Vector2"]=a,s.a.RegisteredTypes["BABYLON.Vector3"]=d,s.a.RegisteredTypes["BABYLON.Vector4"]=h,s.a.RegisteredTypes["BABYLON.Matrix"]=c},function(e,t,i){"use strict";i.d(t,"c",function(){return n}),i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function n(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var o=function(){return(o=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function s(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(s=(o<3?n(s):3<o?n(t,i,s):n(t,i))||s);return 3<o&&s&&Object.defineProperty(t,i,s),s}},function(e,t,i){"use strict";i.d(t,"a",function(){return _}),i.d(t,"b",function(){return l});var _=(r.prototype.createVertexBuffer=function(e,t,i,r,n,o,s){void 0===o&&(o=!1);var a=o?t:t*Float32Array.BYTES_PER_ELEMENT,h=r?o?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new l(this._engine,this,e,this._updatable,!0,h,void 0===n?this._instanced:n,a,i,void 0,void 0,!0,this._divisor||s)},r.prototype.isUpdatable=function(){return this._updatable},r.prototype.getData=function(){return this._data},r.prototype.getBuffer=function(){return this._buffer},r.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},r.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},r.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},r.prototype.update=function(e){this.create(e)},r.prototype.updateDirectly=function(e,t,i,r){void 0===r&&(r=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=null)},r.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},r);function r(e,t,i,r,n,o,s,a){void 0===r&&(r=0),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=o,this._divisor=a||1,this._data=t,this.byteStride=s?r:r*Float32Array.BYTES_PER_ELEMENT,n||this.create()}var l=(Object.defineProperty(g.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),g.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},g.prototype.getKind=function(){return this._kind},g.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},g.prototype.getData=function(){return this._buffer.getData()},g.prototype.getBuffer=function(){return this._buffer.getBuffer()},g.prototype.getStrideSize=function(){return this.byteStride/g.GetTypeByteLength(this.type)},g.prototype.getOffset=function(){return this.byteOffset/g.GetTypeByteLength(this.type)},g.prototype.getSize=function(){return this._size},g.prototype.getIsInstanced=function(){return this._instanced},g.prototype.getInstanceDivisor=function(){return this._instanceDivisor},g.prototype.create=function(e){this._buffer.create(e)},g.prototype.update=function(e){this._buffer.update(e)},g.prototype.updateDirectly=function(e,t,i){void 0===i&&(i=!1),this._buffer.updateDirectly(e,t,void 0,i)},g.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},g.prototype.forEach=function(e,t){g.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)},g.DeduceStride=function(e){switch(e){case g.UVKind:case g.UV2Kind:case g.UV3Kind:case g.UV4Kind:case g.UV5Kind:case g.UV6Kind:return 2;case g.NormalKind:case g.PositionKind:return 3;case g.ColorKind:case g.MatricesIndicesKind:case g.MatricesIndicesExtraKind:case g.MatricesWeightsKind:case g.MatricesWeightsExtraKind:case g.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},g.GetTypeByteLength=function(e){switch(e){case g.BYTE:case g.UNSIGNED_BYTE:return 1;case g.SHORT:case g.UNSIGNED_SHORT:return 2;case g.INT:case g.UNSIGNED_INT:case g.FLOAT:return 4;default:throw new Error("Invalid type '"+e+"'")}},g.ForEach=function(e,t,i,r,n,o,s,a){if(e instanceof Array)for(var h=t/4,l=i/4,c=0;c<o;c+=r){for(var u=0;u<r;u++)a(e[h+u],c+u);h+=l}else{var f=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),d=g.GetTypeByteLength(n);for(c=0;c<o;c+=r){var p=t;for(u=0;u<r;u++)a(g._GetFloatValue(f,n,p,s),c+u),p+=d;t+=i}}},g._GetFloatValue=function(e,t,i,r){switch(t){case g.BYTE:var n=e.getInt8(i);return r&&(n=Math.max(n/127,-1)),n;case g.UNSIGNED_BYTE:return n=e.getUint8(i),r&&(n/=255),n;case g.SHORT:return n=e.getInt16(i,!0),r&&(n=Math.max(n/32767,-1)),n;case g.UNSIGNED_SHORT:return n=e.getUint16(i,!0),r&&(n/=65535),n;case g.INT:return e.getInt32(i,!0);case g.UNSIGNED_INT:return e.getUint32(i,!0);case g.FLOAT:return e.getFloat32(i,!0);default:throw new Error("Invalid component type "+t)}},g.BYTE=5120,g.UNSIGNED_BYTE=5121,g.SHORT=5122,g.UNSIGNED_SHORT=5123,g.INT=5124,g.UNSIGNED_INT=5125,g.FLOAT=5126,g.PositionKind="position",g.NormalKind="normal",g.TangentKind="tangent",g.UVKind="uv",g.UV2Kind="uv2",g.UV3Kind="uv3",g.UV4Kind="uv4",g.UV5Kind="uv5",g.UV6Kind="uv6",g.ColorKind="color",g.MatricesIndicesKind="matricesIndices",g.MatricesWeightsKind="matricesWeights",g.MatricesIndicesExtraKind="matricesIndicesExtra",g.MatricesWeightsExtraKind="matricesWeightsExtra",g);function g(e,t,i,r,n,o,s,a,h,l,c,u,f){if(void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===f&&(f=1),t instanceof _?(this._buffer=t,this._ownsBuffer=!1):(this._buffer=new _(e,t,r,o,n,s,u),this._ownsBuffer=!0),this._kind=i,null==l){var d=this.getData();this.type=g.FLOAT,d instanceof Int8Array?this.type=g.BYTE:d instanceof Uint8Array?this.type=g.UNSIGNED_BYTE:d instanceof Int16Array?this.type=g.SHORT:d instanceof Uint16Array?this.type=g.UNSIGNED_SHORT:d instanceof Int32Array?this.type=g.INT:d instanceof Uint32Array&&(this.type=g.UNSIGNED_INT)}else this.type=l;var p=g.GetTypeByteLength(this.type);u?(this._size=h||(o?o/p:g.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*p,this.byteOffset=a||0):(this._size=h||o||g.DeduceStride(i),this.byteStride=o?o*p:this._buffer.byteStride||this._size*p,this.byteOffset=(a||0)*p),this.normalized=c,this._instanced=void 0!==s&&s,this._instanceDivisor=s?f:0}},function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"c",function(){return a}),i.d(t,"j",function(){return h}),i.d(t,"d",function(){return _}),i.d(t,"g",function(){return g}),i.d(t,"k",function(){return m}),i.d(t,"h",function(){return v}),i.d(t,"f",function(){return b}),i.d(t,"e",function(){return y}),i.d(t,"i",function(){return x}),i.d(t,"a",function(){return T});function r(e,t,i){var r=e();u.a&&u.a.AddTagsTo(r,t.tags);var n=p(r);for(var o in n){var s=n[o],a=t[o],h=s.type;if(null!=a&&"uniqueId"!==o)switch(h){case 0:case 6:case 11:r[o]=a;break;case 1:r[o]=i||a.isRenderTarget?a:a.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:r[o]=i?a:a.clone()}}return r}var u=i(21),f=i(0),n=i(8),d=i(7),l={},c={};function p(e){var t=e.getClassName();if(c[t])return c[t];c[t]={};for(var i=c[t],r=e,n=t;n;){var o=l[n];for(var s in o)i[s]=o[s];var a=void 0,h=!1;do{if(!(a=Object.getPrototypeOf(r)).getClassName){h=!0;break}if(a.getClassName()!==n)break;r=a}while(a);if(h)break;n=a.getClassName(),r=a}return i}function o(n,o){return function(e,t){var i,r=(i=e.getClassName(),l[i]||(l[i]={}),l[i]);r[t]||(r[t]={type:n,sourceName:o})}}function s(e,t){return void 0===t&&(t=null),r=e,void 0===(n=t)&&(n=null),function(t,e){var i=n||"_"+e;Object.defineProperty(t,e,{get:function(){return this[i]},set:function(e){this[i]!==e&&(this[i]=e,t[r].apply(this))},enumerable:!0,configurable:!0})};var r,n}function a(e){return o(0,e)}function h(e){return o(1,e)}function _(e){return o(2,e)}function g(e){return o(3,e)}function m(e){return o(5,e)}function v(e){return o(6,e)}function b(e){return o(7,e)}function y(e){return o(8,e)}function x(e){return o(10,e)}var T=(M.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var r=e.animations[i];t.animations.push(r.serialize())}}},M.Serialize=function(e,t){t=t||{},u.a&&(t.tags=u.a.GetTags(e));var i=p(e);for(var r in i){var n=i[r],o=n.sourceName||r,s=n.type,a=e[r];if(null!=a)switch(s){case 0:t[o]=a;break;case 1:t[o]=a.serialize();break;case 2:t[o]=a.asArray();break;case 3:t[o]=a.serialize();break;case 4:case 5:t[o]=a.asArray();break;case 6:t[o]=a.id;break;case 7:t[o]=a.serialize();break;case 8:t[o]=a.asArray();break;case 9:t[o]=a.serialize();break;case 10:t[o]=a.asArray();break;case 11:t[o]=a.id;case 12:t[o]=a.asArray()}}return t},M.Parse=function(e,t,i,r){void 0===r&&(r=null);var n=e();r=r||"",u.a&&u.a.AddTagsTo(n,t.tags);var o=p(n);for(var s in o){var a=o[s],h=t[a.sourceName||s],l=a.type;if(null!=h){var c=n;switch(l){case 0:c[s]=h;break;case 1:i&&(c[s]=M._TextureParser(h,i,r));break;case 2:c[s]=d.a.FromArray(h);break;case 3:c[s]=M._FresnelParametersParser(h);break;case 4:c[s]=f.d.FromArray(h);break;case 5:c[s]=f.e.FromArray(h);break;case 6:i&&(c[s]=i.getLastMeshByID(h));break;case 7:c[s]=M._ColorCurvesParser(h);break;case 8:c[s]=d.b.FromArray(h);break;case 9:c[s]=M._ImageProcessingConfigurationParser(h);break;case 10:c[s]=f.b.FromArray(h);break;case 11:i&&(c[s]=i.getCameraByID(h));case 12:c[s]=f.a.FromArray(h)}}}return n},M.Clone=function(e,t){return r(e,t,!1)},M.Instanciate=function(e,t){return r(e,t,!0)},M._ImageProcessingConfigurationParser=function(e){throw n.a.WarnImport("ImageProcessingConfiguration")},M._FresnelParametersParser=function(e){throw n.a.WarnImport("FresnelParameters")},M._ColorCurvesParser=function(e){throw n.a.WarnImport("ColorCurves")},M._TextureParser=function(e,t,i){throw n.a.WarnImport("Texture")},M);function M(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var r=(n.prototype.initalize=function(e,t,i,r){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this},n);function n(e,t,i,r){void 0===t&&(t=!1),this.initalize(e,t,i,r)}var s=function(e,t,i){void 0===i&&(i=null),this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1};h.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},h.Watch=function(e,t,i,r){void 0===i&&(i=-1),void 0===r&&(r=null);var n=new h;n._observers=new Array;for(var o=0,s=n._observables=e;o<s.length;o++){var a=s[o].add(t,i,!1,r);a&&n._observers.push(a)}return n};function h(){}var o=(Object.defineProperty(a.prototype,"observers",{get:function(){return this._observers},enumerable:!0,configurable:!0}),a.prototype.add=function(e,t,i,r,n){if(void 0===t&&(t=-1),void 0===i&&(i=!1),void 0===r&&(r=null),void 0===n&&(n=!1),!e)return null;var o=new s(e,t,r);return o.unregisterOnNextCall=n,i?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},a.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},a.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},a.prototype.removeCallback=function(e,t){for(var i=0;i<this._observers.length;i++){var r=this._observers[i];if(!(r._willBeUnregistered||r.callback!==e||t&&t!==r.scope))return this._deferUnregister(r),!0}return!1},a.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},a.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},a.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},a.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},a.prototype.notifyObservers=function(e,t,i,r){if(void 0===t&&(t=-1),!this._observers.length)return!0;var n=this._eventState;n.mask=t,n.target=i,n.currentTarget=r,n.skipNextObservers=!1,n.lastReturnValue=e;for(var o=0,s=this._observers;o<s.length;o++){var a=s[o];if(!a._willBeUnregistered&&(a.mask&t&&(a.scope?n.lastReturnValue=a.callback.apply(a.scope,[e,n]):n.lastReturnValue=a.callback(e,n),a.unregisterOnNextCall&&this._deferUnregister(a)),n.skipNextObservers))return!1}return!0},a.prototype.notifyObserversWithPromise=function(i,e,t,r){var n=this;void 0===e&&(e=-1);var o=Promise.resolve(i);if(!this._observers.length)return o;var s=this._eventState;return s.mask=e,s.target=t,s.currentTarget=r,s.skipNextObservers=!1,this._observers.forEach(function(t){s.skipNextObservers||t._willBeUnregistered||t.mask&e&&(o=t.scope?o.then(function(e){return s.lastReturnValue=e,t.callback.apply(t.scope,[i,s])}):o.then(function(e){return s.lastReturnValue=e,t.callback(i,s)}),t.unregisterOnNextCall&&n._deferUnregister(t))}),o.then(function(){return i})},a.prototype.notifyObserver=function(e,t,i){void 0===i&&(i=-1);var r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.callback(t,r)},a.prototype.hasObservers=function(){return 0<this._observers.length},a.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},a.prototype.clone=function(){var e=new a;return e._observers=this._observers.slice(0),e},a.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var r=i[t];if(r.mask&e||r.mask===e)return!0}return!1},a);function a(e){this._observers=new Array,this._eventState=new r(0),e&&(this._onObserverAdded=e)}},function(e,t,i){"use strict";i.d(t,"a",function(){return v});var r,n=i(4),o=i(0),h=i(9),s=i(11),a=i(13),l=i(14),c=i(29),u=i(1),f=i(15),d=(r=o.d,Object(u.c)(p,r),p);function p(e,t){void 0===t&&(t=0);var i=r.call(this,e.x,e.y)||this;return i.buttonIndex=t,i}var _=(g.prototype.fromValues=function(e,t,i,r,n,o){return this.m[0]=e,this.m[1]=t,this.m[2]=i,this.m[3]=r,this.m[4]=n,this.m[5]=o,this},g.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},g.prototype.invertToRef=function(e){var t=this.m[0],i=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],s=this.m[5],a=this.determinant();if(a<f.a*f.a)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;var h=1/a,l=r*s-n*o,c=i*o-t*s;return e.m[0]=n*h,e.m[1]=-i*h,e.m[2]=-r*h,e.m[3]=t*h,e.m[4]=l*h,e.m[5]=c*h,this},g.prototype.multiplyToRef=function(e,t){var i=this.m[0],r=this.m[1],n=this.m[2],o=this.m[3],s=this.m[4],a=this.m[5],h=e.m[0],l=e.m[1],c=e.m[2],u=e.m[3],f=e.m[4],d=e.m[5];return t.m[0]=i*h+r*c,t.m[1]=i*l+r*u,t.m[2]=n*h+o*c,t.m[3]=n*l+o*u,t.m[4]=s*h+a*c+f,t.m[5]=s*l+a*u+d,this},g.prototype.transformCoordinates=function(e,t,i){return i.x=e*this.m[0]+t*this.m[2]+this.m[4],i.y=e*this.m[1]+t*this.m[3]+this.m[5],this},g.Identity=function(){return new g(1,0,0,1,0,0)},g.TranslationToRef=function(e,t,i){i.fromValues(1,0,0,1,e,t)},g.ScalingToRef=function(e,t,i){i.fromValues(e,0,0,t,0,0)},g.RotationToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.fromValues(r,i,-i,r,0,0)},g.ComposeToRef=function(e,t,i,r,n,o,s){g.TranslationToRef(e,t,g._TempPreTranslationMatrix),g.ScalingToRef(r,n,g._TempScalingMatrix),g.RotationToRef(i,g._TempRotationMatrix),g.TranslationToRef(-e,-t,g._TempPostTranslationMatrix),g._TempPreTranslationMatrix.multiplyToRef(g._TempScalingMatrix,g._TempCompose0),g._TempCompose0.multiplyToRef(g._TempRotationMatrix,g._TempCompose1),o?(g._TempCompose1.multiplyToRef(g._TempPostTranslationMatrix,g._TempCompose2),g._TempCompose2.multiplyToRef(o,s)):g._TempCompose1.multiplyToRef(g._TempPostTranslationMatrix,s)},g._TempPreTranslationMatrix=g.Identity(),g._TempPostTranslationMatrix=g.Identity(),g._TempRotationMatrix=g.Identity(),g._TempScalingMatrix=g.Identity(),g._TempCompose0=g.Identity(),g._TempCompose1=g.Identity(),g._TempCompose2=g.Identity(),g);function g(e,t,i,r,n,o){this.m=new Float32Array(6),this.fromValues(e,t,i,r,n,o)}var m=i(10),v=(Object.defineProperty(b.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(e){this._shadowBlur!==e&&(this._shadowBlur=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(b.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(e){this._fontOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.width=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.height=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"style",{get:function(){return this._style},set:function(e){var t=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add(function(){t._markAsDirty(),t._resetFontCache()})),this._markAsDirty(),this._resetFontCache()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fontSizeInPixels",{get:function(){var e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.fontSize=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"color",{get:function(){return this._color},set:function(e){this._color!==e&&(this._color=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(e){this._paddingLeft.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingLeft=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(e){this._paddingRight.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingRight=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(e){this._paddingTop.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingTop=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(e){this._paddingBottom.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingBottom=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(e){this._left.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.left=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(e){this._top.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.top=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.linkOffsetX=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.linkOffsetY=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"disabledColorItem",{get:function(){return this._disabledColorItem},set:function(e){this._disabledColorItem!==e&&(this._disabledColorItem=e,this._markAsDirty())},enumerable:!0,configurable:!0}),b.prototype._getTypeName=function(){return"Control"},b.prototype.getAscendantOfClass=function(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null},b.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},b.prototype.isAscendant=function(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))},b.prototype.getLocalCoordinates=function(e){var t=o.d.Zero();return this.getLocalCoordinatesToRef(e,t),t},b.prototype.getLocalCoordinatesToRef=function(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this},b.prototype.getParentLocalCoordinates=function(e){var t=o.d.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t},b.prototype.moveToVector3=function(e,t){if(this._host&&this.parent===this._host._rootContainer){this.horizontalAlignment=b.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=b.VERTICAL_ALIGNMENT_TOP;var i=this._host._getGlobalViewport(t),r=o.e.Project(e,o.a.Identity(),t.getTransformMatrix(),i);this._moveToProjectedPosition(r),r.z<0||1<r.z?this.notRenderable=!0:this.notRenderable=!1}else a.b.Error("Cannot move a control to a vector3 if the control is not at root level")},b.prototype.getDescendantsToRef=function(e,t,i){void 0===t&&(t=!1)},b.prototype.getDescendants=function(e,t){var i=new Array;return this.getDescendantsToRef(i,e,t),i},b.prototype.linkWithMesh=function(e){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)e&&a.b.Error("Cannot link a control to a mesh if the control is not at root level");else{var t=this._host._linkedControls.indexOf(this);-1===t?e&&(this.horizontalAlignment=b.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=b.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=e,this._host._linkedControls.push(this)):(this._linkedMesh=e)||this._host._linkedControls.splice(t,1)}},b.prototype._moveToProjectedPosition=function(e){var t=this._left.getValue(this._host),i=this._top.getValue(this._host),r=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(r-t)<.5&&(r=t),Math.abs(n-i)<.5&&(n=i)),this.left=r+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},b.prototype._offsetLeft=function(e){this._isDirty=!0,this._currentMeasure.left+=e},b.prototype._offsetTop=function(e){this._isDirty=!0,this._currentMeasure.top+=e},b.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},b.prototype._flagDescendantsAsMatrixDirty=function(){},b.prototype._intersectsRect=function(e){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=e.left+e.width||this._tmpMeasureA.top>=e.top+e.height||this._tmpMeasureA.left+this._tmpMeasureA.width<=e.left||this._tmpMeasureA.top+this._tmpMeasureA.height<=e.top)},b.prototype.invalidateRect=function(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization)if(this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),c.a.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var e=this.shadowOffsetX,t=this.shadowOffsetY,i=this.shadowBlur,r=Math.min(Math.min(e,0)-2*i,0),n=Math.max(Math.max(e,0)+2*i,0),o=Math.min(Math.min(t,0)-2*i,0),s=Math.max(Math.max(t,0)+2*i,0);this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+r),Math.floor(this._tmpMeasureA.top+o),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+n),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+s))}else this.host.invalidateRect(Math.floor(this._tmpMeasureA.left),Math.floor(this._tmpMeasureA.top),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height))},b.prototype._markAsDirty=function(e){void 0===e&&(e=!1),(this._isVisible||e)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},b.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},b.prototype._link=function(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},b.prototype._transform=function(e){if(this._isMatrixDirty||1!==this._scaleX||1!==this._scaleY||0!==this._rotation){var t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;e&&(e.translate(t,i),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-i)),!this._isMatrixDirty&&this._cachedOffsetX===t&&this._cachedOffsetY===i||(this._cachedOffsetX=t,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),_.ComposeToRef(-t,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix))}},b.prototype._renderHighlight=function(e){this.isHighlighted&&(e.save(),e.strokeStyle="#4affff",e.lineWidth=2,this._renderHighlightSpecific(e),e.restore())},b.prototype._renderHighlightSpecific=function(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},b.prototype._applyStates=function(e){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(e.font=this._font),this._color&&(e.fillStyle=this._color),b.AllowAlphaInheritance?e.globalAlpha*=this._alpha:this._alphaSet&&(e.globalAlpha=this.parent?this.parent.alpha*this._alpha:this._alpha)},b.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this.host._numLayoutCalls++,this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save(),this._applyStates(t);for(var i=0;this._rebuildLayout=!1,this._processMeasures(e,t),i++,this._rebuildLayout&&i<3;);3<=i&&s.a.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,!(this._isDirty=!1)},b.prototype._processMeasures=function(e,t){this._currentMeasure.copyFrom(e),this._preMeasure(e,t),this._measure(),this._computeAlignment(e,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(e,t),this._cachedParentMeasure.copyFrom(e),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},b.prototype._evaluateClippingState=function(e){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>e.left+e.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<e.left)return void(this._isClipped=!0);if(this._currentMeasure.top>e.top+e.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<e.top)return void(this._isClipped=!0)}this._isClipped=!1},b.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host)},b.prototype._computeAlignment=function(e,t){var i=this._currentMeasure.width,r=this._currentMeasure.height,n=e.width,o=e.height,s=0,a=0;switch(this.horizontalAlignment){case b.HORIZONTAL_ALIGNMENT_LEFT:s=0;break;case b.HORIZONTAL_ALIGNMENT_RIGHT:s=n-i;break;case b.HORIZONTAL_ALIGNMENT_CENTER:s=(n-i)/2}switch(this.verticalAlignment){case b.VERTICAL_ALIGNMENT_TOP:a=0;break;case b.VERTICAL_ALIGNMENT_BOTTOM:a=o-r;break;case b.VERTICAL_ALIGNMENT_CENTER:a=(o-r)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=n*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=n*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=n*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=o*this._paddingTop.getValue(this._host),this._currentMeasure.height-=o*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=o*this._paddingBottom.getValue(this._host),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=n*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=o*this._top.getValue(this._host),this._currentMeasure.left+=s,this._currentMeasure.top+=a},b.prototype._preMeasure=function(e,t){},b.prototype._additionalProcessing=function(e,t){},b.prototype._clipForChildren=function(e){},b.prototype._clip=function(e,t){if(e.beginPath(),b._ClipMeasure.copyFrom(this._currentMeasure),t){t.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);var i=new c.a(0,0,0,0);i.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),i.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),i.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-i.left,i.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-i.top,b._ClipMeasure.copyFrom(i)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var r=this.shadowOffsetX,n=this.shadowOffsetY,o=this.shadowBlur,s=Math.min(Math.min(r,0)-2*o,0),a=Math.max(Math.max(r,0)+2*o,0),h=Math.min(Math.min(n,0)-2*o,0),l=Math.max(Math.max(n,0)+2*o,0);e.rect(b._ClipMeasure.left+s,b._ClipMeasure.top+h,b._ClipMeasure.width+a-s,b._ClipMeasure.height+l-h)}else e.rect(b._ClipMeasure.left,b._ClipMeasure.top,b._ClipMeasure.width,b._ClipMeasure.height);e.clip()},b.prototype._render=function(e,t){return!this.isVisible||this.notRenderable||this._isClipped?this._isDirty=!1:(this.host._numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)},b.prototype._draw=function(e,t){},b.prototype.contains=function(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y,!(e<this._currentMeasure.left||e>this._currentMeasure.left+this._currentMeasure.width||t<this._currentMeasure.top||t>this._currentMeasure.top+this._currentMeasure.height||(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),0))},b.prototype._processPicking=function(e,t,i,r,n,o,s){return!(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(e,t)||(this._processObservables(i,e,t,r,n,o,s),0))},b.prototype._onPointerMove=function(e,t,i){this.onPointerMoveObservable.notifyObservers(t,-1,e,this)&&null!=this.parent&&this.parent._onPointerMove(e,t,i)},b.prototype._onPointerEnter=function(e){return!(!this._isEnabled||0<this._enterCount||(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this)&&null!=this.parent&&this.parent._onPointerEnter(e),0))},b.prototype._onPointerOut=function(e,t){if(void 0===t&&(t=!1),t||this._isEnabled&&e!==this){var i=!(this._enterCount=0);e.isAscendant(this)||(i=this.onPointerOutObservable.notifyObservers(this,-1,e,this)),i&&null!=this.parent&&this.parent._onPointerOut(e,t)}},b.prototype._onPointerDown=function(e,t,i,r){return this._onPointerEnter(this),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new d(t,r),-1,e,this)&&null!=this.parent&&this.parent._onPointerDown(e,t,i,r),!0)},b.prototype._onPointerUp=function(e,t,i,r,n){if(this._isEnabled){this._downCount=0,delete this._downPointerIds[i];var o=n;n&&(0<this._enterCount||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new d(t,r),-1,e,this)),this.onPointerUpObservable.notifyObservers(new d(t,r),-1,e,this)&&null!=this.parent&&this.parent._onPointerUp(e,t,i,r,o)}},b.prototype._forcePointerUp=function(e){if(void 0===e&&(e=null),null!==e)this._onPointerUp(this,o.d.Zero(),e,0,!0);else for(var t in this._downPointerIds)this._onPointerUp(this,o.d.Zero(),+t,0,!0)},b.prototype._onWheelScroll=function(e,t){this._isEnabled&&this.onWheelObservable.notifyObservers(new o.d(e,t))&&null!=this.parent&&this.parent._onWheelScroll(e,t)},b.prototype._processObservables=function(e,t,i,r,n,o,s){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,i),e!==h.a.POINTERMOVE)return e===h.a.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,r,n),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0):e===h.a.POINTERUP?(this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,n,!0),delete this._host._lastControlDown[r],!0):!(e!==h.a.POINTERWHEEL||!this._host._lastControlOver[r]||(this._host._lastControlOver[r]._onWheelScroll(o,s),0));this._onPointerMove(this,this._dummyVector2,r);var a=this._host._lastControlOver[r];return a&&a!==this&&a._onPointerOut(this),a!==this&&this._onPointerEnter(this),this._host._lastControlOver[r]=this,!0},b.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=b._GetFontOffset(this._font))},b.prototype.dispose=function(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),!this._host||-1<this._host._linkedControls.indexOf(this)&&this.linkWithMesh(null)},Object.defineProperty(b,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return b._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!0,configurable:!0}),Object.defineProperty(b,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return b._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(b,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return b._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),Object.defineProperty(b,"VERTICAL_ALIGNMENT_TOP",{get:function(){return b._VERTICAL_ALIGNMENT_TOP},enumerable:!0,configurable:!0}),Object.defineProperty(b,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return b._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!0,configurable:!0}),Object.defineProperty(b,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return b._VERTICAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),b._GetFontOffset=function(e){if(b._FontHeightSizes[e])return b._FontHeightSizes[e];var t=document.createElement("span");t.innerHTML="Hg",t.style.font=e;var i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";var r=document.createElement("div");r.appendChild(t),r.appendChild(i),document.body.appendChild(r);var n=0,o=0;try{o=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",n=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(r)}var s={ascent:n,height:o,descent:o-n};return b._FontHeightSizes[e]=s},b.drawEllipse=function(e,t,i,r,n){n.translate(e,t),n.scale(i,r),n.beginPath(),n.arc(0,0,1,0,2*Math.PI),n.closePath(),n.scale(1/i,1/r),n.translate(-e,-t)},b.AllowAlphaInheritance=!1,b._ClipMeasure=new c.a(0,0,0,0),b._HORIZONTAL_ALIGNMENT_LEFT=0,b._HORIZONTAL_ALIGNMENT_RIGHT=1,b._HORIZONTAL_ALIGNMENT_CENTER=2,b._VERTICAL_ALIGNMENT_TOP=0,b._VERTICAL_ALIGNMENT_BOTTOM=1,b._VERTICAL_ALIGNMENT_CENTER=2,b._FontHeightSizes={},b.AddHeader=function(){},b);function b(e){this.name=e,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=c.a.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new l.a(18,l.a.UNITMODE_PIXEL,!1),this._width=new l.a(1,l.a.UNITMODE_PERCENTAGE,!1),this._height=new l.a(1,l.a.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=b.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=b.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=c.a.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=c.a.Empty(),this._cachedParentMeasure=c.a.Empty(),this._paddingLeft=new l.a(0),this._paddingRight=new l.a(0),this._paddingTop=new l.a(0),this._paddingBottom=new l.a(0),this._left=new l.a(0),this._top=new l.a(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=_.Identity(),this._invertTransformMatrix=_.Identity(),this._transformedPosition=o.d.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._fontSet=!1,this._dummyVector2=o.d.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new l.a(0),this._linkOffsetY=new l.a(0),this.onWheelObservable=new n.a,this.onPointerMoveObservable=new n.a,this.onPointerOutObservable=new n.a,this.onPointerDownObservable=new n.a,this.onPointerUpObservable=new n.a,this.onPointerClickObservable=new n.a,this.onPointerEnterObservable=new n.a,this.onDirtyObservable=new n.a,this.onBeforeDrawObservable=new n.a,this.onAfterDrawObservable=new n.a,this._tmpMeasureA=new c.a(0,0,0,0)}m.a.RegisteredTypes["BABYLON.GUI.Control"]=v},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var m=i(4),v=i(25),n=i(11),b=i(68),r=(Object.defineProperty(y.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new m.a),this._onBindObservable},enumerable:!0,configurable:!0}),y.prototype._useFinalCode=function(e,t,i){if(i){var r=i.vertexElement||i.vertex||i.spectorName||i,n=i.fragmentElement||i.fragment||i.spectorName||i;this._vertexSourceCode="#define SHADER_NAME vertex:"+r+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(y.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),y.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},y.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},y.prototype.getEngine=function(){return this._engine},y.prototype.getPipelineContext=function(){return this._pipelineContext},y.prototype.getAttributesNames=function(){return this._attributesNames},y.prototype.getAttributeLocation=function(e){return this._attributes[e]},y.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},y.prototype.getAttributesCount=function(){return this._attributes.length},y.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},y.prototype.getUniform=function(e){return this._uniforms[e]},y.prototype.getSamplers=function(){return this._samplerList},y.prototype.getCompilationError=function(){return this._compilationError},y.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},y.prototype.executeWhenCompiled=function(t){var e=this;this.isReady()?t(this):(this.onCompileObservable.add(function(e){t(e)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){e._checkIsReady(null)},16))},y.prototype._checkIsReady=function(t){var e=this;try{if(this._isReadyInternal())return}catch(e){return void this._processCompilationErrors(e,t)}setTimeout(function(){e._checkIsReady(t)},16)},y.prototype._loadShader=function(e,t,i,r){var n;"undefined"!=typeof HTMLElement&&e instanceof HTMLElement?r(v.a.GetDOMTextContent(e)):"source:"!==e.substr(0,7)?"base64:"!==e.substr(0,7)?y.ShadersStore[e+t+"Shader"]?r(y.ShadersStore[e+t+"Shader"]):i&&y.ShadersStore[e+i+"Shader"]?r(y.ShadersStore[e+i+"Shader"]):(n="."===e[0]||"/"===e[0]||-1<e.indexOf("http")?e:y.ShadersRepository+e,this._engine._loadFile(n+"."+t.toLowerCase()+".fx",r)):r(window.atob(e.substr(7))):r(e.substr(7))},y.prototype._rebuildProgram=function(e,t,i,r){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){r&&r(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(31);n._pipelineContext._handlesSpectorRebuildCallback(i)},this._fallbacks=null,this._prepareEffect()},y.prototype._prepareEffect=function(){var n=this,o=this._attributesNames,e=this.defines;this._valueCache={};var s=this._pipelineContext;try{var a=this._engine;this._pipelineContext=a.createPipelineContext();var t=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?a._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,t,null,this._transformFeedbackVaryings):a._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,t,e,this._transformFeedbackVaryings),a._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(a.supportsUniformBuffers)for(var e in n._uniformBuffersNames)n.bindUniformBlock(e,n._uniformBuffersNames[e]);var t;if(a.getUniforms(n._pipelineContext,n._uniformsNames).forEach(function(e,t){n._uniforms[n._uniformsNames[t]]=e}),n._attributes=a.getAttributes(n._pipelineContext,o),o)for(var i=0;i<o.length;i++){var r=o[i];n._attributeLocationByName[r]=n._attributes[i]}for(t=0;t<n._samplerList.length;t++)null==n.getUniform(n._samplerList[t])&&(n._samplerList.splice(t,1),t--);n._samplerList.forEach(function(e,t){n._samplers[e]=t}),a.bindSamplers(n),n._compilationError="",n._isReady=!0,n.onCompiled&&n.onCompiled(n),n.onCompileObservable.notifyObservers(n),n.onCompileObservable.clear(),n._fallbacks&&n._fallbacks.unBindMesh(),s&&n.getEngine()._deletePipelineContext(s)}),this._pipelineContext.isAsync&&this._checkIsReady(s)}catch(e){this._processCompilationErrors(e,s)}},y.prototype._processCompilationErrors=function(e,t){void 0===t&&(t=null),this._compilationError=e.message;var i=this._attributesNames,r=this._fallbacks;n.a.Error("Unable to compile effect:"),n.a.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),n.a.Error("Attributes: "+i.map(function(e){return" "+e})),n.a.Error("Defines:\r\n"+this.defines),n.a.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,n.a.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(y.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),y.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},y.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},y.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},y.prototype.setTextureArray=function(e,t){var i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){for(var r=this._samplerList.indexOf(e),n=1;n<t.length;n++){var o=i+(n-1).toString();this._samplerList.splice(r+n,0,o)}for(var s=0,a=0,h=this._samplerList;a<h.length;a++){var l=h[a];this._samplers[l]=s,s+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},y.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},y.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},y.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)},y.prototype._cacheFloat2=function(e,t,i){var r=this._valueCache[e];if(!r||2!==r.length)return r=[t,i],this._valueCache[e]=r,!0;var n=!1;return r[0]!==t&&(r[0]=t,n=!0),r[1]!==i&&(r[1]=i,n=!0),n},y.prototype._cacheFloat3=function(e,t,i,r){var n=this._valueCache[e];if(!n||3!==n.length)return n=[t,i,r],this._valueCache[e]=n,!0;var o=!1;return n[0]!==t&&(n[0]=t,o=!0),n[1]!==i&&(n[1]=i,o=!0),n[2]!==r&&(n[2]=r,o=!0),o},y.prototype._cacheFloat4=function(e,t,i,r,n){var o=this._valueCache[e];if(!o||4!==o.length)return o=[t,i,r,n],this._valueCache[e]=o,!0;var s=!1;return o[0]!==t&&(o[0]=t,s=!0),o[1]!==i&&(o[1]=i,s=!0),o[2]!==r&&(o[2]=r,s=!0),o[3]!==n&&(o[3]=n,s=!0),s},y.prototype.bindUniformBuffer=function(e,t){var i=this._uniformBuffersNames[t];void 0!==i&&y._baseCache[i]!==e&&(y._baseCache[i]=e,this._engine.bindUniformBufferBase(e,i))},y.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},y.prototype.setInt=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t||(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t)),this},y.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},y.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},y.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},y.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},y.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},y.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},y.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},y.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},y.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},y.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},y.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},y.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},y.prototype.setMatrices=function(e,t){return t&&(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t)),this},y.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrices(this._uniforms[e],t.toArray()),this},y.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},y.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},y.prototype.setFloat=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t||(this._valueCache[e]=t,this._engine.setFloat(this._uniforms[e],t)),this},y.prototype.setBool=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t||(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t?1:0)),this},y.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this._uniforms[e],t.x,t.y),this},y.prototype.setFloat2=function(e,t,i){return this._cacheFloat2(e,t,i)&&this._engine.setFloat2(this._uniforms[e],t,i),this},y.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z),this},y.prototype.setFloat3=function(e,t,i,r){return this._cacheFloat3(e,t,i,r)&&this._engine.setFloat3(this._uniforms[e],t,i,r),this},y.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w),this},y.prototype.setFloat4=function(e,t,i,r,n){return this._cacheFloat4(e,t,i,r,n)&&this._engine.setFloat4(this._uniforms[e],t,i,r,n),this},y.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b),this},y.prototype.setColor4=function(e,t,i){return this._cacheFloat4(e,t.r,t.g,t.b,i)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i),this},y.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a),this},y.prototype.dispose=function(){this._engine._releaseEffect(this)},y.RegisterShader=function(e,t,i){t&&(y.ShadersStore[e+"PixelShader"]=t),i&&(y.ShadersStore[e+"VertexShader"]=i)},y.ResetCache=function(){y._baseCache={}},y.ShadersRepository="src/Shaders/",y._uniqueIdSeed=0,y._baseCache={},y.ShadersStore={},y.IncludesShadersStore={},y);function y(i,e,t,r,n,o,s,a,h,l){var c,u,f=this;if(void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new m.a,this.onErrorObservable=new m.a,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=i,e.attributes){var d=e;if(this._engine=t,this._attributesNames=d.attributes,this._uniformsNames=d.uniformsNames.concat(d.samplers),this._samplerList=d.samplers.slice(),this.defines=d.defines,this.onError=d.onError,this.onCompiled=d.onCompiled,this._fallbacks=d.fallbacks,this._indexParameters=d.indexParameters,this._transformFeedbackVaryings=d.transformFeedbackVaryings||null,d.uniformBuffersNames)for(var p=0;p<d.uniformBuffersNames.length;p++)this._uniformBuffersNames[d.uniformBuffersNames[p]]=p}else this._engine=n,this.defines=null==o?"":o,this._uniformsNames=t.concat(r),this._samplerList=r?r.slice():[],this._attributesNames=e,this.onError=h,this.onCompiled=a,this._indexParameters=l,this._fallbacks=s;this._attributeLocationByName={},this.uniqueId=y._uniqueIdSeed++;var _=v.a.IsWindowObjectExist()?this._engine.getHostDocument():null;c=i.vertexSource?"source:"+i.vertexSource:i.vertexElement?(c=_?_.getElementById(i.vertexElement):null)||i.vertexElement:i.vertex||i,u=i.fragmentSource?"source:"+i.fragmentSource:i.fragmentElement?(u=_?_.getElementById(i.fragmentElement):null)||i.fragmentElement:i.fragment||i;var g={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:y.ShadersRepository,includesShadersStore:y.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:2<=this._engine.webGLVersion?"WEBGL2":"WEBGL1"};this._loadShader(c,"Vertex","",function(t){f._loadShader(u,"Fragment","Pixel",function(e){b.a.Process(t,g,function(t){g.isFragment=!0,b.a.Process(e,g,function(e){f._useFinalCode(t,e,i)})})})})}},function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return l}),i.d(t,"c",function(){return u});var n=i(16),r=i(15),o=i(30),s=i(10),a=(h.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},h.prototype.getClassName=function(){return"Color3"},h.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*e^(255*this.g|0))^(255*this.b|0)},h.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},h.prototype.toColor4=function(e){return void 0===e&&(e=1),new l(this.r,this.g,this.b,e)},h.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},h.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},h.prototype.multiply=function(e){return new h(this.r*e.r,this.g*e.g,this.b*e.b)},h.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},h.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},h.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},h.prototype.scale=function(e){return new h(this.r*e,this.g*e,this.b*e)},h.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},h.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},h.prototype.clampToRef=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=1),i.r=n.a.Clamp(this.r,e,t),i.g=n.a.Clamp(this.g,e,t),i.b=n.a.Clamp(this.b,e,t),this},h.prototype.add=function(e){return new h(this.r+e.r,this.g+e.g,this.b+e.b)},h.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},h.prototype.subtract=function(e){return new h(this.r-e.r,this.g-e.g,this.b-e.b)},h.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},h.prototype.clone=function(){return new h(this.r,this.g,this.b)},h.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},h.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},h.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},h.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,i=255*this.b|0;return"#"+n.a.ToHex(e)+n.a.ToHex(t)+n.a.ToHex(i)},h.prototype.toLinearSpace=function(){var e=new h;return this.toLinearSpaceToRef(e),e},h.prototype.toHSV=function(){var e=new h;return this.toHSVToRef(e),e},h.prototype.toHSVToRef=function(e){var t=this.r,i=this.g,r=this.b,n=Math.max(t,i,r),o=Math.min(t,i,r),s=0,a=0,h=n,l=n-o;0!==n&&(a=l/n),n!=o&&(n==t?(s=(i-r)/l,i<r&&(s+=6)):n==i?s=(r-t)/l+2:n==r&&(s=(t-i)/l+4),s*=60),e.r=s,e.g=a,e.b=h},h.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,r.c),e.g=Math.pow(this.g,r.c),e.b=Math.pow(this.b,r.c),this},h.prototype.toGammaSpace=function(){var e=new h;return this.toGammaSpaceToRef(e),e},h.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,r.b),e.g=Math.pow(this.g,r.b),e.b=Math.pow(this.b,r.b),this},h.HSVtoRGBToRef=function(e,t,i,r){var n=i*t,o=e/60,s=n*(1-Math.abs(o%2-1)),a=0,h=0,l=0;0<=o&&o<=1?(a=n,h=s):1<=o&&o<=2?(a=s,h=n):2<=o&&o<=3?(h=n,l=s):3<=o&&o<=4?(h=s,l=n):4<=o&&o<=5?(a=s,l=n):5<=o&&o<=6&&(a=n,l=s);var c=i-n;r.set(a+c,h+c,l+c)},h.FromHexString=function(e){if("#"!==e.substring(0,1)||7!==e.length)return new h(0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);return h.FromInts(t,i,r)},h.FromArray=function(e,t){return void 0===t&&(t=0),new h(e[t],e[t+1],e[t+2])},h.FromInts=function(e,t,i){return new h(e/255,t/255,i/255)},h.Lerp=function(e,t,i){var r=new h(0,0,0);return h.LerpToRef(e,t,i,r),r},h.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i},h.Red=function(){return new h(1,0,0)},h.Green=function(){return new h(0,1,0)},h.Blue=function(){return new h(0,0,1)},h.Black=function(){return new h(0,0,0)},Object.defineProperty(h,"BlackReadOnly",{get:function(){return h._BlackReadOnly},enumerable:!0,configurable:!0}),h.White=function(){return new h(1,1,1)},h.Purple=function(){return new h(.5,0,.5)},h.Magenta=function(){return new h(1,0,1)},h.Yellow=function(){return new h(1,1,0)},h.Gray=function(){return new h(.5,.5,.5)},h.Teal=function(){return new h(0,1,1)},h.Random=function(){return new h(Math.random(),Math.random(),Math.random())},h._BlackReadOnly=h.Black(),h);function h(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.r=e,this.g=t,this.b=i}var l=(c.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},c.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},c.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},c.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},c.prototype.add=function(e){return new c(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},c.prototype.subtract=function(e){return new c(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},c.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},c.prototype.scale=function(e){return new c(this.r*e,this.g*e,this.b*e,this.a*e)},c.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},c.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},c.prototype.clampToRef=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=1),i.r=n.a.Clamp(this.r,e,t),i.g=n.a.Clamp(this.g,e,t),i.b=n.a.Clamp(this.b,e,t),i.a=n.a.Clamp(this.a,e,t),this},c.prototype.multiply=function(e){return new c(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)},c.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},c.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},c.prototype.getClassName=function(){return"Color4"},c.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},c.prototype.clone=function(){return new c(this.r,this.g,this.b,this.a)},c.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},c.prototype.copyFromFloats=function(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this},c.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},c.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,i=255*this.b|0,r=255*this.a|0;return"#"+n.a.ToHex(e)+n.a.ToHex(t)+n.a.ToHex(i)+n.a.ToHex(r)},c.prototype.toLinearSpace=function(){var e=new c;return this.toLinearSpaceToRef(e),e},c.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,r.c),e.g=Math.pow(this.g,r.c),e.b=Math.pow(this.b,r.c),e.a=this.a,this},c.prototype.toGammaSpace=function(){var e=new c;return this.toGammaSpaceToRef(e),e},c.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,r.b),e.g=Math.pow(this.g,r.b),e.b=Math.pow(this.b,r.b),e.a=this.a,this},c.FromHexString=function(e){if("#"!==e.substring(0,1)||9!==e.length)return new c(0,0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16),n=parseInt(e.substring(7,9),16);return c.FromInts(t,i,r,n)},c.Lerp=function(e,t,i){var r=new c(0,0,0,0);return c.LerpToRef(e,t,i,r),r},c.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i},c.FromColor3=function(e,t){return void 0===t&&(t=1),new c(e.r,e.g,e.b,t)},c.FromArray=function(e,t){return void 0===t&&(t=0),new c(e[t],e[t+1],e[t+2],e[t+3])},c.FromInts=function(e,t,i,r){return new c(e/255,t/255,i/255,r/255)},c.CheckColors4=function(e,t){if(e.length!==3*t)return e;for(var i=[],r=0;r<e.length;r+=3){var n=r/3*4;i[n]=e[r],i[1+n]=e[r+1],i[2+n]=e[r+2],i[3+n]=1}return i},c);function c(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.r=e,this.g=t,this.b=i,this.a=r}var u=(f.Color3=o.a.BuildArray(3,a.Black),f.Color4=o.a.BuildArray(3,function(){return new l(0,0,0,0)}),f);function f(){}s.a.RegisteredTypes["BABYLON.Color3"]=a,s.a.RegisteredTypes["BABYLON.Color4"]=l},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"c",function(){return l}),i.d(t,"b",function(){return f});var r=i(1),o=i(0),n=(s.POINTERDOWN=1,s.POINTERUP=2,s.POINTERMOVE=4,s.POINTERWHEEL=8,s.POINTERPICK=16,s.POINTERTAP=32,s.POINTERDOUBLETAP=64,s);function s(){}function a(e,t){this.type=e,this.event=t}var h,l=(h=a,Object(r.c)(c,h),c);function c(e,t,i,r){var n=h.call(this,e,t)||this;return n.ray=null,n.skipOnPointerObservable=!1,n.localPosition=new o.d(i,r),n}var u,f=(u=a,Object(r.c)(d,u),d);function d(e,t,i){var r=u.call(this,e,t)||this;return r.pickInfo=i,r}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},n.RegisteredTypes={},n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n._AddLogEntry=function(e){n._LogCache=e+n._LogCache,n.OnNewCacheEntry&&n.OnNewCacheEntry(e)},n._FormatMessage=function(e){function t(e){return e<10?"0"+e:""+e}var i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},n._LogDisabled=function(e){},n._LogEnabled=function(e){var t=n._FormatMessage(e);console.log("BJS - "+t),n._AddLogEntry("<div style='color:white'>"+t+"</div><br>")},n._WarnDisabled=function(e){},n._WarnEnabled=function(e){var t=n._FormatMessage(e);console.warn("BJS - "+t),n._AddLogEntry("<div style='color:orange'>"+t+"</div><br>")},n._ErrorDisabled=function(e){},n._ErrorEnabled=function(e){n.errorsCount++;var t=n._FormatMessage(e);console.error("BJS - "+t),n._AddLogEntry("<div style='color:red'>"+t+"</div><br>")},Object.defineProperty(n,"LogCache",{get:function(){return n._LogCache},enumerable:!0,configurable:!0}),n.ClearLogCache=function(){n._LogCache="",n.errorsCount=0},Object.defineProperty(n,"LogLevels",{set:function(e){n.Log=(e&n.MessageLogLevel)===n.MessageLogLevel?n._LogEnabled:n._LogDisabled,n.Warn=(e&n.WarningLogLevel)===n.WarningLogLevel?n._WarnEnabled:n._WarnDisabled,n.Error=(e&n.ErrorLogLevel)===n.ErrorLogLevel?n._ErrorEnabled:n._ErrorDisabled},enumerable:!0,configurable:!0}),n.NoneLogLevel=0,n.MessageLogLevel=1,n.WarningLogLevel=2,n.ErrorLogLevel=4,n.AllLogLevel=7,n._LogCache="",n.errorsCount=0,n.Log=n._LogEnabled,n.Warn=n._WarnEnabled,n.Error=n._ErrorEnabled,n);function n(){}},function(e,t,i){"use strict";i.r(t),i.d(t,"VertexData",function(){return r});var te=i(0),g=i(2),s=i(8),m=i(7),r=(v.prototype.set=function(e,t){switch(t){case g.b.PositionKind:this.positions=e;break;case g.b.NormalKind:this.normals=e;break;case g.b.TangentKind:this.tangents=e;break;case g.b.UVKind:this.uvs=e;break;case g.b.UV2Kind:this.uvs2=e;break;case g.b.UV3Kind:this.uvs3=e;break;case g.b.UV4Kind:this.uvs4=e;break;case g.b.UV5Kind:this.uvs5=e;break;case g.b.UV6Kind:this.uvs6=e;break;case g.b.ColorKind:this.colors=e;break;case g.b.MatricesIndicesKind:this.matricesIndices=e;break;case g.b.MatricesWeightsKind:this.matricesWeights=e;break;case g.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case g.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},v.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},v.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},v.prototype.updateMesh=function(e){return this._update(e),this},v.prototype.updateGeometry=function(e){return this._update(e),this},v.prototype._applyTo=function(e,t){return void 0===t&&(t=!1),this.positions&&e.setVerticesData(g.b.PositionKind,this.positions,t),this.normals&&e.setVerticesData(g.b.NormalKind,this.normals,t),this.tangents&&e.setVerticesData(g.b.TangentKind,this.tangents,t),this.uvs&&e.setVerticesData(g.b.UVKind,this.uvs,t),this.uvs2&&e.setVerticesData(g.b.UV2Kind,this.uvs2,t),this.uvs3&&e.setVerticesData(g.b.UV3Kind,this.uvs3,t),this.uvs4&&e.setVerticesData(g.b.UV4Kind,this.uvs4,t),this.uvs5&&e.setVerticesData(g.b.UV5Kind,this.uvs5,t),this.uvs6&&e.setVerticesData(g.b.UV6Kind,this.uvs6,t),this.colors&&e.setVerticesData(g.b.ColorKind,this.colors,t),this.matricesIndices&&e.setVerticesData(g.b.MatricesIndicesKind,this.matricesIndices,t),this.matricesWeights&&e.setVerticesData(g.b.MatricesWeightsKind,this.matricesWeights,t),this.matricesIndicesExtra&&e.setVerticesData(g.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),this.matricesWeightsExtra&&e.setVerticesData(g.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),this.indices?e.setIndices(this.indices,null,t):e.setIndices([],null),this},v.prototype._update=function(e,t,i){return this.positions&&e.updateVerticesData(g.b.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(g.b.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(g.b.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(g.b.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(g.b.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(g.b.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(g.b.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(g.b.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(g.b.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(g.b.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(g.b.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(g.b.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(g.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(g.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this},v.prototype.transform=function(e){var t,i=e.m[0]*e.m[5]*e.m[10]<0,r=te.e.Zero();if(this.positions){var n=te.e.Zero();for(t=0;t<this.positions.length;t+=3)te.e.FromArrayToRef(this.positions,t,n),te.e.TransformCoordinatesToRef(n,e,r),this.positions[t]=r.x,this.positions[t+1]=r.y,this.positions[t+2]=r.z}if(this.normals){var o=te.e.Zero();for(t=0;t<this.normals.length;t+=3)te.e.FromArrayToRef(this.normals,t,o),te.e.TransformNormalToRef(o,e,r),this.normals[t]=r.x,this.normals[t+1]=r.y,this.normals[t+2]=r.z}if(this.tangents){var s=te.f.Zero(),a=te.f.Zero();for(t=0;t<this.tangents.length;t+=4)te.f.FromArrayToRef(this.tangents,t,s),te.f.TransformNormalToRef(s,e,a),this.tangents[t]=a.x,this.tangents[t+1]=a.y,this.tangents[t+2]=a.z,this.tangents[t+3]=a.w}if(i&&this.indices)for(t=0;t<this.indices.length;t+=3){var h=this.indices[t+1];this.indices[t+1]=this.indices[t+2],this.indices[t+2]=h}return this},v.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var i=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var r=this.indices.length+e.indices.length,n=new(t||this.indices instanceof Uint32Array?Uint32Array:Uint16Array)(r);n.set(this.indices);for(var o=this.indices.length,s=0;s<e.indices.length;s++)n[o+s]=e.indices[s]+i;this.indices=n}else for(s=0;s<e.indices.length;s++)this.indices.push(e.indices[s]+i)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},v.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var i=t.length+e.length,r=e instanceof Float32Array,n=t instanceof Float32Array;if(r){var o=new Float32Array(i);return o.set(e),o.set(t,e.length),o}if(n){var s=e.slice(0),a=0;for(i=t.length;a<i;a++)s.push(t[a]);return s}return e.concat(t)},v.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");function r(e,t){var i=g.b.DeduceStride(e);if(t.length%i!=0)throw new Error("The "+e+"s array count must be a multiple of "+i);return t.length/i}function e(e,t){var i=r(e,t);if(i!==n)throw new Error("The "+e+"s element count ("+i+") does not match the positions count ("+n+")")}var n=r(g.b.PositionKind,this.positions);this.normals&&e(g.b.NormalKind,this.normals),this.tangents&&e(g.b.TangentKind,this.tangents),this.uvs&&e(g.b.UVKind,this.uvs),this.uvs2&&e(g.b.UV2Kind,this.uvs2),this.uvs3&&e(g.b.UV3Kind,this.uvs3),this.uvs4&&e(g.b.UV4Kind,this.uvs4),this.uvs5&&e(g.b.UV5Kind,this.uvs5),this.uvs6&&e(g.b.UV6Kind,this.uvs6),this.colors&&e(g.b.ColorKind,this.colors),this.matricesIndices&&e(g.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&e(g.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&e(g.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&e(g.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},v.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},v.ExtractFromMesh=function(e,t,i){return v._ExtractFrom(e,t,i)},v.ExtractFromGeometry=function(e,t,i){return v._ExtractFrom(e,t,i)},v._ExtractFrom=function(e,t,i){var r=new v;return e.isVerticesDataPresent(g.b.PositionKind)&&(r.positions=e.getVerticesData(g.b.PositionKind,t,i)),e.isVerticesDataPresent(g.b.NormalKind)&&(r.normals=e.getVerticesData(g.b.NormalKind,t,i)),e.isVerticesDataPresent(g.b.TangentKind)&&(r.tangents=e.getVerticesData(g.b.TangentKind,t,i)),e.isVerticesDataPresent(g.b.UVKind)&&(r.uvs=e.getVerticesData(g.b.UVKind,t,i)),e.isVerticesDataPresent(g.b.UV2Kind)&&(r.uvs2=e.getVerticesData(g.b.UV2Kind,t,i)),e.isVerticesDataPresent(g.b.UV3Kind)&&(r.uvs3=e.getVerticesData(g.b.UV3Kind,t,i)),e.isVerticesDataPresent(g.b.UV4Kind)&&(r.uvs4=e.getVerticesData(g.b.UV4Kind,t,i)),e.isVerticesDataPresent(g.b.UV5Kind)&&(r.uvs5=e.getVerticesData(g.b.UV5Kind,t,i)),e.isVerticesDataPresent(g.b.UV6Kind)&&(r.uvs6=e.getVerticesData(g.b.UV6Kind,t,i)),e.isVerticesDataPresent(g.b.ColorKind)&&(r.colors=e.getVerticesData(g.b.ColorKind,t,i)),e.isVerticesDataPresent(g.b.MatricesIndicesKind)&&(r.matricesIndices=e.getVerticesData(g.b.MatricesIndicesKind,t,i)),e.isVerticesDataPresent(g.b.MatricesWeightsKind)&&(r.matricesWeights=e.getVerticesData(g.b.MatricesWeightsKind,t,i)),e.isVerticesDataPresent(g.b.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=e.getVerticesData(g.b.MatricesIndicesExtraKind,t,i)),e.isVerticesDataPresent(g.b.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=e.getVerticesData(g.b.MatricesWeightsExtraKind,t,i)),r.indices=e.getIndices(t,i),r},v.CreateRibbon=function(e){throw s.a.WarnImport("ribbonBuilder")},v.CreateBox=function(e){throw s.a.WarnImport("boxBuilder")},v.CreateTiledBox=function(e){throw s.a.WarnImport("tiledBoxBuilder")},v.CreateTiledPlane=function(e){throw s.a.WarnImport("tiledPlaneBuilder")},v.CreateSphere=function(e){throw s.a.WarnImport("sphereBuilder")},v.CreateCylinder=function(e){throw s.a.WarnImport("cylinderBuilder")},v.CreateTorus=function(e){throw s.a.WarnImport("torusBuilder")},v.CreateLineSystem=function(e){throw s.a.WarnImport("linesBuilder")},v.CreateDashedLines=function(e){throw s.a.WarnImport("linesBuilder")},v.CreateGround=function(e){throw s.a.WarnImport("groundBuilder")},v.CreateTiledGround=function(e){throw s.a.WarnImport("groundBuilder")},v.CreateGroundFromHeightMap=function(e){throw s.a.WarnImport("groundBuilder")},v.CreatePlane=function(e){throw s.a.WarnImport("planeBuilder")},v.CreateDisc=function(e){throw s.a.WarnImport("discBuilder")},v.CreatePolygon=function(e,t,i,r,n,o){throw s.a.WarnImport("polygonBuilder")},v.CreateIcoSphere=function(e){throw s.a.WarnImport("icoSphereBuilder")},v.CreatePolyhedron=function(e){throw s.a.WarnImport("polyhedronBuilder")},v.CreateTorusKnot=function(e){throw s.a.WarnImport("torusKnotBuilder")},v.ComputeNormals=function(e,t,i,r){var n=0,o=0,s=0,a=0,h=0,l=0,c=0,u=0,f=0,d=0,p=0,_=0,g=0,m=0,v=0,b=0,y=0,x=0,T=0,M=0,E=!1,A=!1,O=!1,P=!1,C=1,S=0,R=null;if(r&&(E=!!r.facetNormals,A=!!r.facetPositions,O=!!r.facetPartitioning,C=!0===r.useRightHandedSystem?-1:1,S=r.ratio||0,P=!!r.depthSort,R=r.distanceTo,P)){void 0===R&&(R=te.e.Zero());var I=r.depthSortedFacets}var w=0,D=0,L=0,F=0;if(O&&r&&r.bbSize){var N=0,B=0,k=0,U=0,V=0,z=0,j=0,W=0,G=0,H=0,X=0,K=0,Y=0,q=0,Z=0,Q=0,J=r.bbSize.x>r.bbSize.y?r.bbSize.x:r.bbSize.y;J=J>r.bbSize.z?J:r.bbSize.z,w=r.subDiv.X*S/r.bbSize.x,D=r.subDiv.Y*S/r.bbSize.y,L=r.subDiv.Z*S/r.bbSize.z,F=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0}for(n=0;n<e.length;n++)i[n]=0;var $=t.length/3|0;for(n=0;n<$;n++){if(g=1+(_=3*t[3*n]),m=_+2,b=1+(v=3*t[3*n+1]),y=v+2,T=1+(x=3*t[3*n+2]),M=x+2,o=e[_]-e[v],s=e[g]-e[b],a=e[m]-e[y],h=e[x]-e[v],l=e[T]-e[b],u=C*(s*(c=e[M]-e[y])-a*l),f=C*(a*h-o*c),d=C*(o*l-s*h),u/=p=0===(p=Math.sqrt(u*u+f*f+d*d))?1:p,f/=p,d/=p,E&&r&&(r.facetNormals[n].x=u,r.facetNormals[n].y=f,r.facetNormals[n].z=d),A&&r&&(r.facetPositions[n].x=(e[_]+e[v]+e[x])/3,r.facetPositions[n].y=(e[g]+e[b]+e[T])/3,r.facetPositions[n].z=(e[m]+e[y]+e[M])/3),O&&r&&(N=Math.floor((r.facetPositions[n].x-r.bInfo.minimum.x*S)*w),B=Math.floor((r.facetPositions[n].y-r.bInfo.minimum.y*S)*D),k=Math.floor((r.facetPositions[n].z-r.bInfo.minimum.z*S)*L),U=Math.floor((e[_]-r.bInfo.minimum.x*S)*w),V=Math.floor((e[g]-r.bInfo.minimum.y*S)*D),z=Math.floor((e[m]-r.bInfo.minimum.z*S)*L),j=Math.floor((e[v]-r.bInfo.minimum.x*S)*w),W=Math.floor((e[b]-r.bInfo.minimum.y*S)*D),G=Math.floor((e[y]-r.bInfo.minimum.z*S)*L),H=Math.floor((e[x]-r.bInfo.minimum.x*S)*w),X=Math.floor((e[T]-r.bInfo.minimum.y*S)*D),K=Math.floor((e[M]-r.bInfo.minimum.z*S)*L),q=U+r.subDiv.max*V+F*z,Z=j+r.subDiv.max*W+F*G,Q=H+r.subDiv.max*X+F*K,Y=N+r.subDiv.max*B+F*k,r.facetPartitioning[Y]=r.facetPartitioning[Y]?r.facetPartitioning[Y]:new Array,r.facetPartitioning[q]=r.facetPartitioning[q]?r.facetPartitioning[q]:new Array,r.facetPartitioning[Z]=r.facetPartitioning[Z]?r.facetPartitioning[Z]:new Array,r.facetPartitioning[Q]=r.facetPartitioning[Q]?r.facetPartitioning[Q]:new Array,r.facetPartitioning[q].push(n),Z!=q&&r.facetPartitioning[Z].push(n),Q!=Z&&Q!=q&&r.facetPartitioning[Q].push(n),Y!=q&&Y!=Z&&Y!=Q&&r.facetPartitioning[Y].push(n)),P&&r&&r.facetPositions){var ee=I[n];ee.ind=3*n,ee.sqDistance=te.e.DistanceSquared(r.facetPositions[n],R)}i[_]+=u,i[g]+=f,i[m]+=d,i[v]+=u,i[b]+=f,i[y]+=d,i[x]+=u,i[T]+=f,i[M]+=d}for(n=0;n<i.length/3;n++)u=i[3*n],f=i[3*n+1],d=i[3*n+2],u/=p=0===(p=Math.sqrt(u*u+f*f+d*d))?1:p,f/=p,d/=p,i[3*n]=u,i[3*n+1]=f,i[3*n+2]=d},v._ComputeSides=function(e,t,i,r,n,o,s){var a,h,l=i.length,c=r.length;switch(e=e||v.DEFAULTSIDE){case v.FRONTSIDE:break;case v.BACKSIDE:var u;for(a=0;a<l;a+=3)u=i[a],i[a]=i[a+2],i[a+2]=u;for(h=0;h<c;h++)r[h]=-r[h];break;case v.DOUBLESIDE:for(var f=t.length,d=f/3,p=0;p<f;p++)t[f+p]=t[p];for(a=0;a<l;a+=3)i[a+l]=i[a+2]+d,i[a+1+l]=i[a+1]+d,i[a+2+l]=i[a]+d;for(h=0;h<c;h++)r[c+h]=-r[h];var _=n.length,g=0;for(g=0;g<_;g++)n[g+_]=n[g];for(o=o||new te.f(0,0,1,1),s=s||new te.f(0,0,1,1),a=g=0;a<_/2;a++)n[g]=o.x+(o.z-o.x)*n[g],n[g+1]=o.y+(o.w-o.y)*n[g+1],n[g+_]=s.x+(s.z-s.x)*n[g+_],n[g+_+1]=s.y+(s.w-s.y)*n[g+_+1],g+=2}},v.ImportVertexData=function(e,t){var i=new v,r=e.positions;r&&i.set(r,g.b.PositionKind);var n=e.normals;n&&i.set(n,g.b.NormalKind);var o=e.tangents;o&&i.set(o,g.b.TangentKind);var s=e.uvs;s&&i.set(s,g.b.UVKind);var a=e.uv2s;a&&i.set(a,g.b.UV2Kind);var h=e.uv3s;h&&i.set(h,g.b.UV3Kind);var l=e.uv4s;l&&i.set(l,g.b.UV4Kind);var c=e.uv5s;c&&i.set(c,g.b.UV5Kind);var u=e.uv6s;u&&i.set(u,g.b.UV6Kind);var f=e.colors;f&&i.set(m.b.CheckColors4(f,r.length/3),g.b.ColorKind);var d=e.matricesIndices;d&&i.set(d,g.b.MatricesIndicesKind);var p=e.matricesWeights;p&&i.set(p,g.b.MatricesWeightsKind);var _=e.indices;_&&(i.indices=_),t.setAllVerticesData(i,e.updatable)},v.FRONTSIDE=0,v.BACKSIDE=1,v.DOUBLESIDE=2,v.DEFAULTSIDE=0,v);function v(){}},function(e,t,i){"use strict";i.d(t,"b",function(){return T}),i.d(t,"a",function(){return E});var a,r,o=i(4),s=i(25),n=i(11),h=i(57),l=i(37),c=i(8),u=i(60),f=i(23),d=i(36);(r=a=a||{})[r.Pending=0]="Pending",r[r.Fulfilled=1]="Fulfilled",r[r.Rejected=2]="Rejected";var p=function(){this.count=0,this.target=0,this.results=[]},_=(Object.defineProperty(g.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!0,configurable:!0}),g.prototype.catch=function(e){return this.then(void 0,e)},g.prototype.then=function(e,t){var i=this,r=new g;return r._onFulfilled=e,r._onRejected=t,this._children.push(r),(r._parent=this)._state!==a.Pending&&setTimeout(function(){if(i._state===a.Fulfilled||i._rejectWasConsumed){var e=r._resolve(i._result);if(null!=e)if(void 0!==e._state){var t=e;r._children.push(t),t._parent=r,r=t}else r._result=e}else r._reject(i._reason)}),r},g.prototype._moveChildren=function(e){var t,i=this;if((t=this._children).push.apply(t,e.splice(0,e.length)),this._children.forEach(function(e){e._parent=i}),this._state===a.Fulfilled)for(var r=0,n=this._children;r<n.length;r++)n[r]._resolve(this._result);else if(this._state===a.Rejected)for(var o=0,s=this._children;o<s.length;o++)s[o]._reject(this._reason)},g.prototype._resolve=function(e){try{this._state=a.Fulfilled;var t=null;if(this._onFulfilled&&(t=this._onFulfilled(e)),null!=t)if(void 0!==t._state){var i=t;i._parent=this,i._moveChildren(this._children),e=i._result}else e=t;this._result=e;for(var r=0,n=this._children;r<n.length;r++)n[r]._resolve(e);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(e){this._reject(e,!0)}},g.prototype._reject=function(t,e){if(void 0===e&&(e=!1),this._state=a.Rejected,this._reason=t,this._onRejected&&!e)try{this._onRejected(t),this._rejectWasConsumed=!0}catch(e){t=e}for(var i=0,r=this._children;i<r.length;i++){var n=r[i];this._rejectWasConsumed?n._resolve(null):n._reject(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},g.resolve=function(e){var t=new g;return t._resolve(e),t},g._RegisterForFulfillment=function(e,t,i){e.then(function(e){return t.results[i]=e,t.count++,t.count===t.target&&t.rootPromise._resolve(t.results),null},function(e){t.rootPromise._state!==a.Rejected&&t.rootPromise._reject(e)})},g.all=function(e){var t=new g,i=new p;if(i.target=e.length,i.rootPromise=t,e.length)for(var r=0;r<e.length;r++)g._RegisterForFulfillment(e[r],i,r);else t._resolve([]);return t},g.race=function(e){var t=new g;if(e.length)for(var i=0,r=e;i<r.length;i++)r[i].then(function(e){return t&&(t._resolve(e),t=null),null},function(e){t&&(t._reject(e),t=null)});return t},g);function g(e){var t=this;if(this._state=a.Pending,this._children=new Array,this._rejectWasConsumed=!1,e)try{e(function(e){t._resolve(e)},function(e){t._reject(e)})}catch(e){this._reject(e)}}var m=(v.Apply=function(e){void 0===e&&(e=!1),!e&&"undefined"!=typeof Promise||(window.Promise=_)},v);function v(){}var b=i(64),y=i(61),x=i(71),T=(Object.defineProperty(M,"BaseUrl",{get:function(){return d.a.BaseUrl},set:function(e){d.a.BaseUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(M,"DefaultRetryStrategy",{get:function(){return d.a.DefaultRetryStrategy},set:function(e){d.a.DefaultRetryStrategy=e},enumerable:!0,configurable:!0}),Object.defineProperty(M,"UseFallbackTexture",{get:function(){return f.a.UseFallbackTexture},set:function(e){f.a.UseFallbackTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(M,"RegisteredExternalClasses",{get:function(){return y.a.RegisteredExternalClasses},set:function(e){y.a.RegisteredExternalClasses=e},enumerable:!0,configurable:!0}),Object.defineProperty(M,"fallbackTexture",{get:function(){return f.a.FallbackTexture},set:function(e){f.a.FallbackTexture=e},enumerable:!0,configurable:!0}),M.FetchToRef=function(e,t,i,r,n,o){var s=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*r%r|0)*i);o.r=n[s]/255,o.g=n[1+s]/255,o.b=n[2+s]/255,o.a=n[3+s]/255},M.Mix=function(e,t,i){return e*(1-i)+t*i},M.Instantiate=function(e){return y.a.Instantiate(e)},M.Slice=function(e,t,i){return e.slice?e.slice(t,i):Array.prototype.slice.call(e,t,i)},M.SetImmediate=function(e){b.a.SetImmediate(e)},M.IsExponentOfTwo=function(e){for(var t=1;(t*=2)<e;);return t===e},M.FloatRound=function(e){return Math.fround?Math.fround(e):M._tmpFloatArray[0]=e},M.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},M.GetFolderPath=function(e,t){void 0===t&&(t=!1);var i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)},M.ToDegrees=function(e){return 180*e/Math.PI},M.ToRadians=function(e){return e*Math.PI/180},M.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},M.GetPointerPrefix=function(){var e="pointer";return s.a.IsWindowObjectExist()&&!window.PointerEvent&&s.a.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(e="mouse"),e},M.SetCorsBehavior=function(e,t){d.a.SetCorsBehavior(e,t)},M.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},Object.defineProperty(M,"PreprocessUrl",{get:function(){return d.a.PreprocessUrl},set:function(e){d.a.PreprocessUrl=e},enumerable:!0,configurable:!0}),M.LoadImage=function(e,t,i,r,n){return d.a.LoadImage(e,t,i,r,n)},M.LoadFile=function(e,t,i,r,n,o){return d.a.LoadFile(e,t,i,r,n,o)},M.LoadFileAsync=function(e,r){return void 0===r&&(r=!0),new Promise(function(t,i){d.a.LoadFile(e,function(e){t(e)},void 0,void 0,r,function(e,t){i(t)})})},M.LoadScript=function(t,e,i,r){if(s.a.IsWindowObjectExist()){var n=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",t),r&&(o.id=r),o.onload=function(){e&&e()},o.onerror=function(e){i&&i("Unable to load script '"+t+"'",e)},n.appendChild(o)}},M.LoadScriptAsync=function(t,e){var r=this;return new Promise(function(e,i){r.LoadScript(t,function(){e()},function(e,t){i(t)})})},M.ReadFileAsDataURL=function(e,t,i){var r=new FileReader,n={onCompleteObservable:new o.a,abort:function(){return r.abort()}};return r.onloadend=function(e){n.onCompleteObservable.notifyObservers(n)},r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e),n},M.ReadFile=function(e,t,i,r,n){return d.a.ReadFile(e,t,i,r,n)},M.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},M.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},M.DeepCopy=function(e,t,i,r){h.a.DeepCopy(e,t,i,r)},M.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},M.RegisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch(e){}}},M.UnregisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.removeEventListener(r.name,r.handler);try{e.parent&&e.parent.removeEventListener(r.name,r.handler)}catch(e){}}},M.DumpFramebuffer=function(e,t,i,r,n,o){void 0===n&&(n="image/png");for(var s=4*e,a=t/2,h=i.readPixels(0,0,e,t),l=0;l<a;l++)for(var c=0;c<s;c++){var u=c+l*s,f=c+(t-l-1)*s,d=h[u];h[u]=h[f],h[f]=d}M._ScreenshotCanvas||(M._ScreenshotCanvas=document.createElement("canvas")),M._ScreenshotCanvas.width=e,M._ScreenshotCanvas.height=t;var p=M._ScreenshotCanvas.getContext("2d");if(p){var _=p.createImageData(e,t);_.data.set(h),p.putImageData(_,0,0),M.EncodeScreenshotCanvasData(r,n,o)}},M.ToBlob=function(e,t,i){void 0===i&&(i="image/png"),e.toBlob||(e.toBlob=function(n,o,s){var a=this;setTimeout(function(){for(var e=atob(a.toDataURL(o,s).split(",")[1]),t=e.length,i=new Uint8Array(t),r=0;r<t;r++)i[r]=e.charCodeAt(r);n(new Blob([i]))})}),e.toBlob(function(e){t(e)},i)},M.EncodeScreenshotCanvasData=function(e,t,s){void 0===t&&(t="image/png"),e?e(M._ScreenshotCanvas.toDataURL(t)):this.ToBlob(M._ScreenshotCanvas,function(e){if("download"in document.createElement("a")){if(!s){var t=new Date,i=(t.getFullYear()+"-"+(t.getMonth()+1)).slice(2)+"-"+t.getDate()+"_"+t.getHours()+"-"+("0"+t.getMinutes()).slice(-2);s="screenshot_"+i+".png"}M.Download(e,s)}else{var r=URL.createObjectURL(e),n=window.open("");if(!n)return;var o=n.document.createElement("img");o.onload=function(){URL.revokeObjectURL(r)},o.src=r,n.document.body.appendChild(o)}},t)},M.Download=function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=i,r.download=t,r.addEventListener("click",function(){r.parentElement&&r.parentElement.removeChild(r)}),r.click(),window.URL.revokeObjectURL(i)}},M.CreateScreenshot=function(e,t,i,r,n){throw void 0===n&&(n="image/png"),c.a.WarnImport("ScreenshotTools")},M.CreateScreenshotAsync=function(e,t,i,r){throw void 0===r&&(r="image/png"),c.a.WarnImport("ScreenshotTools")},M.CreateScreenshotUsingRenderTarget=function(e,t,i,r,n,o,s,a){throw void 0===n&&(n="image/png"),void 0===o&&(o=1),void 0===s&&(s=!1),c.a.WarnImport("ScreenshotTools")},M.CreateScreenshotUsingRenderTargetAsync=function(e,t,i,r,n,o,s){throw void 0===r&&(r="image/png"),void 0===n&&(n=1),void 0===o&&(o=!1),c.a.WarnImport("ScreenshotTools")},M.RandomId=function(){return x.a.RandomId()},M.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},M.DecodeBase64=function(e){for(var t=atob(e.split(",")[1]),i=t.length,r=new Uint8Array(new ArrayBuffer(i)),n=0;n<i;n++)r[n]=t.charCodeAt(n);return r.buffer},M.GetAbsoluteUrl=function(e){var t=document.createElement("a");return t.href=e,t.href},Object.defineProperty(M,"errorsCount",{get:function(){return n.a.errorsCount},enumerable:!0,configurable:!0}),M.Log=function(e){n.a.Log(e)},M.Warn=function(e){n.a.Warn(e)},M.Error=function(e){n.a.Error(e)},Object.defineProperty(M,"LogCache",{get:function(){return n.a.LogCache},enumerable:!0,configurable:!0}),M.ClearLogCache=function(){n.a.ClearLogCache()},Object.defineProperty(M,"LogLevels",{set:function(e){n.a.LogLevels=e},enumerable:!0,configurable:!0}),Object.defineProperty(M,"PerformanceLogLevel",{set:function(e){return(e&M.PerformanceUserMarkLogLevel)===M.PerformanceUserMarkLogLevel?(M.StartPerformanceCounter=M._StartUserMark,void(M.EndPerformanceCounter=M._EndUserMark)):(e&M.PerformanceConsoleLogLevel)===M.PerformanceConsoleLogLevel?(M.StartPerformanceCounter=M._StartPerformanceConsole,void(M.EndPerformanceCounter=M._EndPerformanceConsole)):(M.StartPerformanceCounter=M._StartPerformanceCounterDisabled,void(M.EndPerformanceCounter=M._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),M._StartPerformanceCounterDisabled=function(e,t){},M._EndPerformanceCounterDisabled=function(e,t){},M._StartUserMark=function(e,t){if(void 0===t&&(t=!0),!M._performance){if(!s.a.IsWindowObjectExist())return;M._performance=window.performance}t&&M._performance.mark&&M._performance.mark(e+"-Begin")},M._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&M._performance.mark&&(M._performance.mark(e+"-End"),M._performance.measure(e,e+"-Begin",e+"-End"))},M._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(M._StartUserMark(e,t),console.time&&console.time(e))},M._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(M._EndUserMark(e,t),console.timeEnd(e))},Object.defineProperty(M,"Now",{get:function(){return l.a.Now},enumerable:!0,configurable:!0}),M.GetClassName=function(e,t){void 0===t&&(t=!1);var i=null;return i=!t&&e.getClassName?e.getClassName():(e instanceof Object&&(i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),i||typeof e)},M.First=function(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}return null},M.getFullClassName=function(e,t){void 0===t&&(t=!1);var i=null,r=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);i=n.constructor.__bjsclassName__,r=n.constructor.__bjsmoduleName__}i=i||typeof e}return i?(null!=r?r+".":"")+i:null},M.DelayAsync=function(t){return new Promise(function(e){setTimeout(function(){e()},t)})},M.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},M.UseCustomRequestHeaders=!1,M.CustomRequestHeaders=u.a.CustomRequestHeaders,M.CorsBehavior="anonymous",M._tmpFloatArray=new Float32Array(1),M.GetDOMTextContent=s.a.GetDOMTextContent,M.NoneLogLevel=n.a.NoneLogLevel,M.MessageLogLevel=n.a.MessageLogLevel,M.WarningLogLevel=n.a.WarningLogLevel,M.ErrorLogLevel=n.a.ErrorLogLevel,M.AllLogLevel=n.a.AllLogLevel,M.IsWindowObjectExist=s.a.IsWindowObjectExist,M.PerformanceNoneLogLevel=0,M.PerformanceUserMarkLogLevel=1,M.PerformanceConsoleLogLevel=2,M.StartPerformanceCounter=M._StartPerformanceCounterDisabled,M.EndPerformanceCounter=M._EndPerformanceCounterDisabled,M);function M(){}var E=(A.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},A.prototype.breakLoop=function(){this._done=!0,this._successCallback()},A.Run=function(e,t,i,r){void 0===r&&(r=0);var n=new A(e,t,i,r);return n.executeNext(),n},A.SyncAsyncForLoop=function(r,n,o,e,s,t){return void 0===t&&(t=0),A.Run(Math.ceil(r/n),function(i){s&&s()?i.breakLoop():setTimeout(function(){for(var e=0;e<n;++e){var t=i.index*n+e;if(r<=t)break;if(o(t),s&&s()){i.breakLoop();break}}i.executeNext()},t)},e)},A);function A(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this.index=r-1,this._done=!1,this._fn=t,this._successCallback=i}f.a.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",m.Apply()},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(Object.defineProperty(n.prototype,"isPercentage",{get:function(){return this.unit===n.UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPixel",{get:function(){return this.unit===n.UNITMODE_PIXEL},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"internalValue",{get:function(){return this._value},enumerable:!0,configurable:!0}),n.prototype.getValueInPixel=function(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t},n.prototype.updateInPlace=function(e,t){return void 0===t&&(t=n.UNITMODE_PIXEL),this._value=e,this.unit=t,this},n.prototype.getValue=function(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==n.UNITMODE_PERCENTAGE){var t=0,i=0;if(e.idealWidth&&(t=this._value*e.getSize().width/e.idealWidth),e.idealHeight&&(i=this._value*e.getSize().height/e.idealHeight),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?t:i;if(e.idealWidth)return t;if(e.idealHeight)return i}return this._value},n.prototype.toString=function(e,t){switch(this.unit){case n.UNITMODE_PERCENTAGE:var i=100*this.getValue(e);return(t?i.toFixed(t):i)+"%";case n.UNITMODE_PIXEL:var r=this.getValue(e);return(t?r.toFixed(t):r)+"px"}return this.unit.toString()},n.prototype.fromString=function(e){var t=n._Regex.exec(e.toString());if(!t||0===t.length)return!1;var i=parseFloat(t[1]),r=this._originalUnit;if(this.negativeValueAllowed||i<0&&(i=0),4===t.length)switch(t[3]){case"px":r=n.UNITMODE_PIXEL;break;case"%":r=n.UNITMODE_PERCENTAGE,i/=100}return(i!==this._value||r!==this.unit)&&(this._value=i,this.unit=r,!0)},Object.defineProperty(n,"UNITMODE_PERCENTAGE",{get:function(){return n._UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"UNITMODE_PIXEL",{get:function(){return n._UNITMODE_PIXEL},enumerable:!0,configurable:!0}),n._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,n._UNITMODE_PERCENTAGE=0,n._UNITMODE_PIXEL=1,n);function n(e,t,i){void 0===t&&(t=n.UNITMODE_PIXEL),void 0===i&&(i=!0),this.unit=t,this.negativeValueAllowed=i,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=e,this._originalUnit=t}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"c",function(){return n}),i.d(t,"a",function(){return o});var r=1/2.2,n=2.2,o=.001},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.WithinEpsilon=function(e,t,i){void 0===i&&(i=1401298e-51);var r=e-t;return-i<=r&&r<=i},n.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},n.Sign=function(e){return 0==(e=+e)||isNaN(e)?e:0<e?1:-1},n.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},n.Log2=function(e){return Math.log(e)*Math.LOG2E},n.Repeat=function(e,t){return e-Math.floor(e/t)*t},n.Normalize=function(e,t,i){return(e-t)/(i-t)},n.Denormalize=function(e,t,i){return e*(i-t)+t},n.DeltaAngle=function(e,t){var i=n.Repeat(t-e,360);return 180<i&&(i-=360),i},n.PingPong=function(e,t){var i=n.Repeat(e,2*t);return t-Math.abs(i-t)},n.SmoothStep=function(e,t,i){var r=n.Clamp(i);return t*(r=-2*r*r*r+3*r*r)+e*(1-r)},n.MoveTowards=function(e,t,i){return Math.abs(t-e)<=i?t:e+n.Sign(t-e)*i},n.MoveTowardsAngle=function(e,t,i){var r=n.DeltaAngle(e,t);return-i<r&&r<i?t:n.MoveTowards(e,t=e+r,i)},n.Lerp=function(e,t,i){return e+(t-e)*i},n.LerpAngle=function(e,t,i){var r=n.Repeat(t-e,360);return 180<r&&(r-=360),e+r*n.Clamp(i)},n.InverseLerp=function(e,t,i){return e!=t?n.Clamp((i-e)/(t-e)):0},n.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o;return e*(2*s-3*o+1)+i*(-2*s+3*o)+t*(s-2*o+n)+r*(s-o)},n.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},n.RangeToPercent=function(e,t,i){return(e-t)/(i-t)},n.PercentToRange=function(e,t,i){return(i-t)*e+t},n.NormalizeRadians=function(e){return e-=n.TwoPi*Math.floor((e+Math.PI)/n.TwoPi)},n.TwoPi=2*Math.PI,n);function n(){}},function(e,t,i){"use strict";i.r(t),i.d(t,"_CreationDataStorage",function(){return P}),i.d(t,"_InstancesBatch",function(){return S}),i.d(t,"Mesh",function(){return F});var r=i(1),n=i(4),f=i(13),_=i(57),g=i(21),O=i(0),I=i(7),c=i(34),w=i(2),M=i(12),D=i(41),m=(Object.defineProperty(o,"ForceFullSceneLoadingForIncremental",{get:function(){return o._ForceFullSceneLoadingForIncremental},set:function(e){o._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ShowLoadingScreen",{get:function(){return o._ShowLoadingScreen},set:function(e){o._ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(o,"loggingLevel",{get:function(){return o._loggingLevel},set:function(e){o._loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(o,"CleanBoneMatrixWeights",{get:function(){return o._CleanBoneMatrixWeights},set:function(e){o._CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),o._ForceFullSceneLoadingForIncremental=!1,o._ShowLoadingScreen=!0,o._CleanBoneMatrixWeights=!1,o._loggingLevel=0,o);function o(){}var u=i(32),s=i(58),d=(Object.defineProperty(L.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),L.CreateGeometryForMesh=function(e){var t=new L(L.RandomId(),e.getScene());return t.applyToMesh(e),t},Object.defineProperty(L.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),L.prototype.getScene=function(){return this._scene},L.prototype.getEngine=function(){return this._engine},L.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(L.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),L.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},L.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},L.prototype.setVerticesData=function(e,t,i,r){void 0===i&&(i=!1);var n=new w.b(this._engine,t,e,i,0===this._meshes.length,r);this.setVerticesBuffer(n)},L.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},L.prototype.setVerticesBuffer=function(e,t){void 0===t&&(t=null);var i=e.getKind();if(this._vertexBuffers[i]&&this._vertexBuffers[i].dispose(),this._vertexBuffers[i]=e,i===w.b.PositionKind){var r=e.getData();null!=t?this._totalVertices=t:null!=r&&(this._totalVertices=r.length/(e.byteStride/4)),this._updateExtend(r),this._resetPointsArrayCache();for(var n=this._meshes,o=n.length,s=0;s<o;s++){var a=n[s];a._boundingInfo=new u.a(this._extend.minimum,this._extend.maximum),a._createGlobalSubMesh(!1),a.computeWorldMatrix(!0)}}this.notifyUpdate(i),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},L.prototype.updateVerticesDataDirectly=function(e,t,i,r){void 0===r&&(r=!1);var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,i,r),this.notifyUpdate(e))},L.prototype.updateVerticesData=function(e,t,i){void 0===i&&(i=!1);var r=this.getVertexBuffer(e);r&&(r.update(t),e===w.b.PositionKind&&this._updateBoundingInfo(i,t),this.notifyUpdate(e))},L.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var i=0,r=this._meshes;i<r.length;i++){var n=r[i];n._boundingInfo?n._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):n._boundingInfo=new u.a(this._extend.minimum,this._extend.maximum);for(var o=0,s=n.subMeshes;o<s.length;o++)s[o].refreshBoundingInfo()}},L.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var i=this.getVertexBuffers();i&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(i,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)):this._engine.bindBuffers(i,t,e))}},L.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},L.prototype.getVerticesData=function(e,t,i){var r=this.getVertexBuffer(e);if(!r)return null;var n=r.getData();if(!n)return null;var o=r.getSize()*w.b.GetTypeByteLength(r.type),s=this._totalVertices*r.getSize();if(r.type!==w.b.FLOAT||r.byteStride!==o){var a=[];return r.forEach(s,function(e){return a.push(e)}),a}if((n instanceof Array||n instanceof Float32Array)&&0===r.byteOffset&&n.length===s)return i||t&&1!==this._meshes.length?f.b.Slice(n):n;if(n instanceof Array){var h=r.byteOffset/4;return f.b.Slice(n,h,h+s)}if(n instanceof ArrayBuffer)return new Float32Array(n,r.byteOffset,s);if(h=n.byteOffset+r.byteOffset,i||t&&1!==this._meshes.length){var l=new Float32Array(s),c=new Float32Array(n.buffer,h,s);return l.set(c),l}return new Float32Array(n.buffer,h,s)},L.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},L.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},L.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},L.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},L.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},L.prototype.updateIndices=function(e,t,i){if(void 0===i&&(i=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var r=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(var n=0,o=this._meshes;n<o.length;n++)o[n]._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)},L.prototype.setIndices=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),null!=t&&(this._totalVertices=t);for(var r=0,n=this._meshes;r<n.length;r++)n[r]._createGlobalSubMesh(!0);this.notifyUpdate()},L.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},L.prototype.getIndices=function(e,t){if(!this.isReady())return null;var i=this._indices;if(t||e&&1!==this._meshes.length){for(var r=i.length,n=[],o=0;o<r;o++)n.push(i[o]);return n}return i},L.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},L.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},L.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);-1!==r&&(i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose())},L.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;(e._geometry=this)._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},L.prototype._updateExtend=function(e){void 0===e&&(e=null),e=e||this.getVerticesData(w.b.PositionKind),this._extend=Object(s.a)(e,0,this._totalVertices,this.boundingBias,3)},L.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var i in this._vertexBuffers){1===t&&this._vertexBuffers[i].create();var r=this._vertexBuffers[i].getBuffer();r&&(r.references=t),i===w.b.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new u.a(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}1===t&&this._indices&&0<this._indices.length&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},L.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,i=this._meshes;t<i.length;t++)i[t]._markSubMeshesAsAttributesDirty()},L.prototype.load=function(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))},L.prototype._queueLoad=function(n,o){var s=this;this.delayLoadingFile&&(n._addPendingData(this),n._loadFile(this.delayLoadingFile,function(e){if(s._delayLoadingFunction){s._delayLoadingFunction(JSON.parse(e),s),s.delayLoadState=1,s._delayInfo=[],n._removePendingData(s);for(var t=s._meshes,i=t.length,r=0;r<i;r++)s._applyToMesh(t[r]);o&&o()}},void 0,!0))},L.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&0<e.length){for(var t=0;t<e.length;t+=3){var i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}var r=this.getVerticesData(w.b.PositionKind,!1);if(null!=r&&0<r.length){for(t=0;t<r.length;t+=3)r[t+2]=-r[t+2];this.setVerticesData(w.b.PositionKind,r,!1)}var n=this.getVerticesData(w.b.NormalKind,!1);if(null!=n&&0<n.length){for(t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(w.b.NormalKind,n,!1)}},L.prototype._resetPointsArrayCache=function(){this._positions=null},L.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(w.b.PositionKind);if(!e||0===e.length)return!1;this._positions=[];for(var t=0;t<e.length;t+=3)this._positions.push(O.e.FromArray(e,t));return!0},L.prototype.isDisposed=function(){return this._isDisposed},L.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},L.prototype.dispose=function(){var e,t=this._meshes,i=t.length;for(e=0;e<i;e++)this.releaseForMesh(t[e]);for(var r in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[r].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},L.prototype.copy=function(e){var t=new M.VertexData;t.indices=[];var i=this.getIndices();if(i)for(var r=0;r<i.length;r++)t.indices.push(i[r]);var n,o=!1,s=!1;for(n in this._vertexBuffers){var a=this.getVerticesData(n);if(a&&(a instanceof Float32Array?t.set(new Float32Array(a),n):t.set(a.slice(0),n),!s)){var h=this.getVertexBuffer(n);h&&(s=!(o=h.isUpdatable()))}}var l=new L(e,this._scene,t,o);for(n in l.delayLoadState=this.delayLoadState,l.delayLoadingFile=this.delayLoadingFile,l._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)l._delayInfo=l._delayInfo||[],l._delayInfo.push(n);return l._boundingInfo=new u.a(this._extend.minimum,this._extend.maximum),l},L.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,g.a&&g.a.HasTags(this)&&(e.tags=g.a.GetTags(this)),e},L.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},L.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(w.b.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(w.b.PositionKind)),this.isVertexBufferUpdatable(w.b.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(w.b.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(w.b.NormalKind)),this.isVertexBufferUpdatable(w.b.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(w.b.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(w.b.TangentKind)),this.isVertexBufferUpdatable(w.b.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(w.b.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(w.b.UVKind)),this.isVertexBufferUpdatable(w.b.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(w.b.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(w.b.UV2Kind)),this.isVertexBufferUpdatable(w.b.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(w.b.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(w.b.UV3Kind)),this.isVertexBufferUpdatable(w.b.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(w.b.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(w.b.UV4Kind)),this.isVertexBufferUpdatable(w.b.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(w.b.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(w.b.UV5Kind)),this.isVertexBufferUpdatable(w.b.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(w.b.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(w.b.UV6Kind)),this.isVertexBufferUpdatable(w.b.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(w.b.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(w.b.ColorKind)),this.isVertexBufferUpdatable(w.b.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(w.b.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(w.b.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(w.b.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(w.b.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(w.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(w.b.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},L.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},L.RandomId=function(){return f.b.RandomId()},L._ImportGeometry=function(e,t){var i=t.getScene(),r=e.geometryId;if(r){var n=i.getGeometryByID(r);n&&n.applyToMesh(t)}else if(e instanceof ArrayBuffer){var o=t._binaryInfo;if(o.positionsAttrDesc&&0<o.positionsAttrDesc.count){var s=new Float32Array(e,o.positionsAttrDesc.offset,o.positionsAttrDesc.count);t.setVerticesData(w.b.PositionKind,s,!1)}if(o.normalsAttrDesc&&0<o.normalsAttrDesc.count){var a=new Float32Array(e,o.normalsAttrDesc.offset,o.normalsAttrDesc.count);t.setVerticesData(w.b.NormalKind,a,!1)}if(o.tangetsAttrDesc&&0<o.tangetsAttrDesc.count){var h=new Float32Array(e,o.tangetsAttrDesc.offset,o.tangetsAttrDesc.count);t.setVerticesData(w.b.TangentKind,h,!1)}if(o.uvsAttrDesc&&0<o.uvsAttrDesc.count){var l=new Float32Array(e,o.uvsAttrDesc.offset,o.uvsAttrDesc.count);t.setVerticesData(w.b.UVKind,l,!1)}if(o.uvs2AttrDesc&&0<o.uvs2AttrDesc.count){var c=new Float32Array(e,o.uvs2AttrDesc.offset,o.uvs2AttrDesc.count);t.setVerticesData(w.b.UV2Kind,c,!1)}if(o.uvs3AttrDesc&&0<o.uvs3AttrDesc.count){var u=new Float32Array(e,o.uvs3AttrDesc.offset,o.uvs3AttrDesc.count);t.setVerticesData(w.b.UV3Kind,u,!1)}if(o.uvs4AttrDesc&&0<o.uvs4AttrDesc.count){var f=new Float32Array(e,o.uvs4AttrDesc.offset,o.uvs4AttrDesc.count);t.setVerticesData(w.b.UV4Kind,f,!1)}if(o.uvs5AttrDesc&&0<o.uvs5AttrDesc.count){var d=new Float32Array(e,o.uvs5AttrDesc.offset,o.uvs5AttrDesc.count);t.setVerticesData(w.b.UV5Kind,d,!1)}if(o.uvs6AttrDesc&&0<o.uvs6AttrDesc.count){var p=new Float32Array(e,o.uvs6AttrDesc.offset,o.uvs6AttrDesc.count);t.setVerticesData(w.b.UV6Kind,p,!1)}if(o.colorsAttrDesc&&0<o.colorsAttrDesc.count){var _=new Float32Array(e,o.colorsAttrDesc.offset,o.colorsAttrDesc.count);t.setVerticesData(w.b.ColorKind,_,!1,o.colorsAttrDesc.stride)}if(o.matricesIndicesAttrDesc&&0<o.matricesIndicesAttrDesc.count){for(var g=new Int32Array(e,o.matricesIndicesAttrDesc.offset,o.matricesIndicesAttrDesc.count),m=[],v=0;v<g.length;v++){var b=g[v];m.push(255&b),m.push((65280&b)>>8),m.push((16711680&b)>>16),m.push(b>>24)}t.setVerticesData(w.b.MatricesIndicesKind,m,!1)}if(o.matricesWeightsAttrDesc&&0<o.matricesWeightsAttrDesc.count){var y=new Float32Array(e,o.matricesWeightsAttrDesc.offset,o.matricesWeightsAttrDesc.count);t.setVerticesData(w.b.MatricesWeightsKind,y,!1)}if(o.indicesAttrDesc&&0<o.indicesAttrDesc.count){var x=new Int32Array(e,o.indicesAttrDesc.offset,o.indicesAttrDesc.count);t.setIndices(x,null)}if(o.subMeshesAttrDesc&&0<o.subMeshesAttrDesc.count){var T=new Int32Array(e,o.subMeshesAttrDesc.offset,5*o.subMeshesAttrDesc.count);for(t.subMeshes=[],v=0;v<o.subMeshesAttrDesc.count;v++){var M=T[5*v+0],E=T[5*v+1],A=T[5*v+2],O=T[5*v+3],P=T[5*v+4];D.b.AddToMesh(M,E,A,O,P,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(w.b.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(w.b.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(w.b.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(w.b.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(w.b.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(w.b.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(w.b.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(w.b.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(w.b.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(w.b.ColorKind,I.b.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(w.b.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{for(m=[],v=0;v<e.matricesIndices.length;v++){var C=e.matricesIndices[v];m.push(255&C),m.push((65280&C)>>8),m.push((16711680&C)>>16),m.push(C>>24)}t.setVerticesData(w.b.MatricesIndicesKind,m,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(w.b.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{for(m=[],v=0;v<e.matricesIndicesExtra.length;v++)C=e.matricesIndicesExtra[v],m.push(255&C),m.push((65280&C)>>8),m.push((16711680&C)>>16),m.push(C>>24);t.setVerticesData(w.b.MatricesIndicesExtraKind,m,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(L._CleanMatricesWeights(e,t),t.setVerticesData(w.b.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(w.b.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(var S=0;S<e.subMeshes.length;S++){var R=e.subMeshes[S];D.b.AddToMesh(R.materialIndex,R.verticesStart,R.verticesCount,R.indexStart,R.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),delete t._shouldGenerateFlatShading),t.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(t)},L._CleanMatricesWeights=function(e,t){if(m.CleanBoneMatrixWeights){var i=0;if(-1<e.skeletonId){var r=t.getScene().getLastSkeletonByID(e.skeletonId);if(r){i=r.bones.length;for(var n=t.getVerticesData(w.b.MatricesIndicesKind),o=t.getVerticesData(w.b.MatricesIndicesExtraKind),s=e.matricesWeights,a=e.matricesWeightsExtra,h=e.numBoneInfluencer,l=s.length,c=0;c<l;c+=4){for(var u=0,f=-1,d=0;d<4;d++)u+=p=s[c+d],p<.001&&f<0&&(f=d);if(a)for(d=0;d<4;d++){var p;u+=p=a[c+d],p<.001&&f<0&&(f=d+4)}if((f<0||h-1<f)&&(f=h-1),.001<u){var _=1/u;for(d=0;d<4;d++)s[c+d]*=_;if(a)for(d=0;d<4;d++)a[c+d]*=_}else 4<=f?(a[c+f-4]=1-u,o[c+f-4]=i):(s[c+f]=1-u,n[c+f]=i)}t.setVerticesData(w.b.MatricesIndicesKind,n),e.matricesWeightsExtra&&t.setVerticesData(w.b.MatricesIndicesExtraKind,o)}}}},L.Parse=function(e,t,i){if(t.getGeometryByID(e.id))return null;var r=new L(e.id,t,void 0,e.updatable);return g.a&&g.a.AddTagsTo(r,e.tags),e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new u.a(O.e.FromArray(e.boundingBoxMinimum),O.e.FromArray(e.boundingBoxMaximum)),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(w.b.UVKind),e.hasUVs2&&r._delayInfo.push(w.b.UV2Kind),e.hasUVs3&&r._delayInfo.push(w.b.UV3Kind),e.hasUVs4&&r._delayInfo.push(w.b.UV4Kind),e.hasUVs5&&r._delayInfo.push(w.b.UV5Kind),e.hasUVs6&&r._delayInfo.push(w.b.UV6Kind),e.hasColors&&r._delayInfo.push(w.b.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(w.b.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(w.b.MatricesWeightsKind),r._delayLoadingFunction=M.VertexData.ImportVertexData):M.VertexData.ImportVertexData(e,r),t.pushGeometry(r,!0),r},L);function L(e,t,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=r,i?this.setAllVerticesData(i,r):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),n&&(this.applyToMesh(n),n.computeWorldMatrix(!0))}var v,a=i(42),y=i(27),x=i(62),l=i(3),E=i(11),p=i(10),b=i(8),T=i(22),h=function(e,t){this.distance=e,this.mesh=t},A=i(53),P=function(){},C=function(){this.visibleInstances={},this.batchCache=new S,this.instancesBufferSize=2048},S=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},R=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},F=(v=a.a,Object(r.c)(N,v),N._GetDefaultSideOrientation=function(e){return e||N.FRONTSIDE},Object.defineProperty(N.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new n.a),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new n.a),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new n.a),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new n.a),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"hasInstances",{get:function(){return 0<this.instances.length},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(e){this._internalMeshDataInfo._morphTargetManager!==e&&(this._internalMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(e){this._instanceDataStorage.manualUpdate=e},enumerable:!0,configurable:!0}),N.prototype.instantiateHierarchy=function(e,t,i){void 0===e&&(e=null);var r=!(0<this.getTotalVertices())||t&&t.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));r&&(r.parent=e||this.parent,r.position=this.position.clone(),r.scaling=this.scaling.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),i&&i(this,r));for(var n=0,o=this.getChildTransformNodes(!0);n<o.length;n++)o[n].instantiateHierarchy(r,t,i);return r},N.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(N.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),N.prototype.toString=function(e){var t=v.prototype.toString.call(this,e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){var r=this.getIndices(),n=this.getVerticesData(w.b.PositionKind);n&&r&&(t+=", flat shading: "+(n.length/3===r.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t},N.prototype._unBindEffect=function(){v.prototype._unBindEffect.call(this);for(var e=0,t=this.instances;e<t.length;e++)t[e]._unBindEffect()},Object.defineProperty(N.prototype,"hasLODLevels",{get:function(){return 0<this._internalMeshDataInfo._LODLevels.length},enumerable:!0,configurable:!0}),N.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},N.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},N.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return E.a.Warn("You cannot use a mesh as LOD level twice"),this;var i=new h(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this},N.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++){var r=t._LODLevels[i];if(r.distance===e)return r.mesh}return null},N.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},N.prototype.getLOD=function(e,t){var i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;var r=(t||this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.globalPosition).length();if(i._LODLevels[i._LODLevels.length-1].distance>r)return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this;for(var n=0;n<i._LODLevels.length;n++){var o=i._LODLevels[n];if(o.distance<r)return o.mesh&&(o.mesh._preActivate(),o.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(r,this,o.mesh),o.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this},Object.defineProperty(N.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),N.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},N.prototype.getVerticesData=function(e,t,i){return this._geometry?this._geometry.getVerticesData(e,t,i):null},N.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},N.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},N.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},N.prototype.getVerticesDataKinds=function(){if(this._geometry)return this._geometry.getVerticesDataKinds();var t=new Array;return this._delayInfo&&this._delayInfo.forEach(function(e){t.push(e)}),t},N.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},N.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(N.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),N.prototype.isReady=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),2===this.delayLoadState)return!1;if(!v.prototype.isReady.call(this,e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;var i=this.getEngine(),r=this.getScene(),n=t||i.getCaps().instancedArrays&&0<this.instances.length;this.computeWorldMatrix();var o=this.material||r.defaultMaterial;if(o)if(o._storeEffectOnSubMeshes)for(var s=0,a=this.subMeshes;s<a.length;s++){var h=(p=a[s]).getMaterial();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,p,n))return!1}else if(!h.isReady(this,n))return!1}else if(!o.isReady(this,n))return!1;for(var l=0,c=this.lightSources;l<c.length;l++){var u=c[l].getShadowGenerator();if(u)for(var f=0,d=this.subMeshes;f<d.length;f++){var p=d[f];if(!u.isReady(p,n))return!1}}for(var _=0,g=this._internalMeshDataInfo._LODLevels;_<g.length;_++){var m=g[_];if(m.mesh&&!m.mesh.isReady(n))return!1}return!0},Object.defineProperty(N.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),N.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},N.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(N.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),N.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this},N.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},N.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},N.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},N.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&0<this.subMeshes.length){var i=this.getIndices();if(!i)return null;var r=i.length,n=!1;if(e)n=!0;else for(var o=0,s=this.subMeshes;o<s.length;o++){var a=s[o];if(a.indexStart+a.indexCount>=r){n=!0;break}if(a.verticesStart+a.verticesCount>=t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new D.b(0,0,t,0,this.getTotalIndices(),this)},N.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),i=t/e|0,r=0;i%3!=0;)i++;this.releaseSubMeshes();for(var n=0;n<e&&!(t<=r);n++)D.b.CreateFromIndices(0,r,Math.min(i,t-r),this),r+=i;this.synchronizeInstances()}},N.prototype.setVerticesData=function(e,t,i,r){if(void 0===i&&(i=!1),this._geometry)this._geometry.setVerticesData(e,t,i,r);else{var n=new M.VertexData;n.set(t,e);var o=this.getScene();new d(d.RandomId(),o,n,i,this)}return this},N.prototype.removeVerticesData=function(e){this._geometry&&this._geometry.removeVerticesData(e)},N.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},N.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},N.prototype.updateVerticesData=function(e,t,i,r){return this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i)),this},N.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var i=this.getVerticesData(w.b.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(w.b.PositionKind,i,!1,!1),t){var r=this.getIndices(),n=this.getVerticesData(w.b.NormalKind);if(!n)return this;M.VertexData.ComputeNormals(i,r,n),this.updateVerticesData(w.b.NormalKind,n,!1,!1)}return this},N.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(d.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},N.prototype.setIndices=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=!1),this._geometry)this._geometry.setIndices(e,t,i);else{var r=new M.VertexData;r.indices=e;var n=this.getScene();new d(d.RandomId(),n,r,i,this)}return this},N.prototype.updateIndices=function(e,t,i){return void 0===i&&(i=!1),this._geometry&&this._geometry.updateIndices(e,t,i),this},N.prototype.toLeftHanded=function(){return this._geometry&&this._geometry.toLeftHanded(),this},N.prototype._bind=function(e,t,i){if(!this._geometry)return this;var r,n=this.getScene().getEngine();if(this._unIndexed)r=null;else switch(i){case y.a.PointFillMode:r=null;break;case y.a.WireFrameFillMode:r=e._getLinesIndexBuffer(this.getIndices(),n);break;default:case y.a.TriangleFillMode:r=this._geometry.getIndexBuffer()}return this._geometry._bind(t,r),this},N.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var r=this.getScene().getEngine();return this._unIndexed||t==y.a.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,i):t==y.a.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,i):r.drawElementsType(t,e.indexStart,e.indexCount,i),this},N.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},N.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},N.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},N.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},N.prototype._getInstancesRenderList=function(e,t){if(void 0===t&&(t=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var i=this.getScene(),r=i._isInIntermediateRendering(),n=r?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,o=this._instanceDataStorage.batchCache;if(o.mustReturn=!1,o.renderSelf[e]=t||!n&&this.isEnabled()&&this.isVisible,o.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){var s=this._instanceDataStorage.visibleInstances,a=i.getRenderId(),h=r?s.intermediateDefaultRenderId:s.defaultRenderId;o.visibleInstances[e]=s[a],!o.visibleInstances[e]&&h&&(o.visibleInstances[e]=s[h])}return o.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==o.visibleInstances[e]&&void 0!==o.visibleInstances[e],this._instanceDataStorage.previousBatch=o},N.prototype._renderWithInstances=function(e,t,i,r,n){var o=i.visibleInstances[e._id];if(!o)return this;for(var s=this._instanceDataStorage,a=s.instancesBufferSize,h=s.instancesBuffer,l=16*(o.length+1)*4;s.instancesBufferSize<l;)s.instancesBufferSize*=2;s.instancesData&&a==s.instancesBufferSize||(s.instancesData=new Float32Array(s.instancesBufferSize/4));var c=0,u=0,f=i.renderSelf[e._id];if(this._instanceDataStorage.manualUpdate)u=(f?1:0)+o.length;else{var d=this._effectiveMesh.getWorldMatrix();if(f&&(d.copyToArray(s.instancesData,c),c+=16,u++),o)for(var p=0;p<o.length;p++)o[p].getWorldMatrix().copyToArray(s.instancesData,c),c+=16,u++}return h&&a==s.instancesBufferSize?h.updateDirectly(s.instancesData,0,u):(h&&h.dispose(),h=new w.a(n,s.instancesData,!0,16,!1,!0),s.instancesBuffer=h,this.setVerticesBuffer(h.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(h.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(h.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(h.createVertexBuffer("world3",12,4))),this._processInstancedBuffers(o,f),this.getScene()._activeIndices.addCount(e.indexCount*u,!1),this._bind(e,r,t),this._draw(e,t,u),n.unbindInstanceAttributes(),this},N.prototype._processInstancedBuffers=function(e,t){},N.prototype._processRendering=function(e,t,i,r,n,o,s){var a=this.getScene(),h=a.getEngine();if(n)this._renderWithInstances(e,i,r,t,h);else{var l=0;r.renderSelf[e._id]&&(o&&o(!1,this._effectiveMesh.getWorldMatrix(),s),l++,this._draw(e,i,this._instanceDataStorage.overridenInstanceCount));var c=r.visibleInstances[e._id];if(c){var u=c.length;l+=u;for(var f=0;f<u;f++){var d=c[f].getWorldMatrix();o&&o(!0,d,s),this._draw(e,i)}}a._activeIndices.addCount(e.indexCount*l,!1)}return this},N.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),v.prototype._rebuild.call(this)},N.prototype._freeze=function(){if(this.subMeshes){for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},N.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},N.prototype.render=function(e,t,i){var r=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var n=this._getInstancesRenderList(e._id,!!i);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var o,s=r.getEngine(),a=n.hardwareInstancedRendering[e._id],h=this._instanceDataStorage,l=e.getMaterial();if(!l)return this;if(!h.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==l){if(l._storeEffectOnSubMeshes){if(!l.isReadyForSubMesh(this,e,a))return this}else if(!l.isReady(this,a))return this;this._effectiveMaterial=l}t&&s.setAlphaMode(this._effectiveMaterial.alphaMode);for(var c=0,u=r._beforeRenderingMeshStage;c<u.length;c++)u[c].action(this,e,n);if(!(o=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var f,d=i||this._effectiveMesh;if(!h.isFrozen&&this._effectiveMaterial.backFaceCulling){var p=d._getWorldMatrixDeterminant();null==(f=this.overrideMaterialSideOrientation)&&(f=this._effectiveMaterial.sideOrientation),p<0&&(f=f===y.a.ClockWiseSideOrientation?y.a.CounterClockWiseSideOrientation:y.a.ClockWiseSideOrientation),h.sideOrientation=f}else f=h.sideOrientation;var _=this._effectiveMaterial._preBind(o,f);this._effectiveMaterial.forceDepthWrite&&s.setDepthWrite(!0);var g=r.forcePointsCloud?y.a.PointFillMode:r.forceWireframe?y.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),a||this._bind(e,o,g);var m=d.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(m,this,e):this._effectiveMaterial.bind(m,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(s.setState(!0,this._effectiveMaterial.zOffset,!1,!_),this._processRendering(e,o,g,n,a,this._onBeforeDraw,this._effectiveMaterial),s.setState(!0,this._effectiveMaterial.zOffset,!1,_)),this._processRendering(e,o,g,n,a,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var v=0,b=r._afterRenderingMeshStage;v<b.length;v++)b[v].action(this,e,n);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},N.prototype._onBeforeDraw=function(e,t,i){e&&i&&i.bindOnlyWorldMatrix(t)},N.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(w.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(w.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},N.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(w.b.MatricesWeightsKind),t=e.length,i=0;i<t;i+=4){var r=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===r)e[i]=1;else{var n=1/r;e[i]*=n,e[i+1]*=n,e[i+2]*=n,e[i+3]*=n}}this.setVerticesData(w.b.MatricesWeightsKind,e)},N.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(w.b.MatricesWeightsExtraKind),t=this.getVerticesData(w.b.MatricesWeightsKind),i=t.length,r=0;r<i;r+=4){var n=t[r]+t[r+1]+t[r+2]+t[r+3];if(0===(n+=e[r]+e[r+1]+e[r+2]+e[r+3]))t[r]=1;else{var o=1/n;t[r]*=o,t[r+1]*=o,t[r+2]*=o,t[r+3]*=o,e[r]*=o,e[r+1]*=o,e[r+2]*=o,e[r+3]*=o}}this.setVerticesData(w.b.MatricesWeightsKind,t),this.setVerticesData(w.b.MatricesWeightsKind,e)},N.prototype.validateSkinning=function(){var e=this.getVerticesData(w.b.MatricesWeightsExtraKind),t=this.getVerticesData(w.b.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var i=t.length,r=0,n=0,o=0,s=0,a=null===e?4:8,h=new Array,l=0;l<=a;l++)h[l]=0;for(l=0;l<i;l+=4){for(var c=t[l],u=c,f=0===u?0:1,d=1;d<a;d++){var p=d<4?t[l+d]:e[l+d-4];c<p&&r++,0!==p&&f++,u+=p,c=p}if(h[f]++,o<f&&(o=f),0===u)n++;else{var _=1/u,g=0;for(d=0;d<a;d++)g+=d<4?Math.abs(t[l+d]-t[l+d]*_):Math.abs(e[l+d-4]-e[l+d-4]*_);.001<g&&s++}}var m=this.skeleton.bones.length,v=this.getVerticesData(w.b.MatricesIndicesKind),b=this.getVerticesData(w.b.MatricesIndicesExtraKind),y=0;for(l=0;l<i;l++)for(d=0;d<a;d++){var x=d<4?v[d]:b[d-4];(m<=x||x<0)&&y++}return{skinned:!0,valid:0===n&&0===s&&0===y,report:"Number of Weights = "+i/4+"\nMaximum influences = "+o+"\nMissing Weights = "+n+"\nNot Sorted = "+r+"\nNot Normalized = "+s+"\nWeightCounts = ["+h+"]\nNumber of bones = "+m+"\nBad Bone Indices = "+y}},N.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this},N.prototype._queueLoad=function(t){var i=this;t._addPendingData(this);var e=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return f.b.LoadFile(this.delayLoadingFile,function(e){e instanceof ArrayBuffer?i._delayLoadingFunction(e,i):i._delayLoadingFunction(JSON.parse(e),i),i.instances.forEach(function(e){e.refreshBoundingInfo(),e._syncSubMeshes()}),i.delayLoadState=1,t._removePendingData(i)},function(){},t.offlineProvider,e),this},N.prototype.isInFrustum=function(e){return 2!==this.delayLoadState&&!!v.prototype.isInFrustum.call(this,e)&&(this._checkDelayState(),!0)},N.prototype.setMaterialByID=function(e){var t,i=this.getScene().materials;for(t=i.length-1;-1<t;t--)if(i[t].id===e)return this.material=i[t],this;var r=this.getScene().multiMaterials;for(t=r.length-1;-1<t;t--)if(r[t].id===e)return this.material=r[t],this;return this},N.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},N.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(w.b.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var i,r=this.getVerticesData(w.b.PositionKind),n=new Array;for(i=0;i<r.length;i+=3)O.e.TransformCoordinates(O.e.FromArray(r,i),e).toArray(n,i);if(this.setVerticesData(w.b.PositionKind,n,this.getVertexBuffer(w.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(w.b.NormalKind)){for(r=this.getVerticesData(w.b.NormalKind),n=[],i=0;i<r.length;i+=3)O.e.TransformNormal(O.e.FromArray(r,i),e).normalize().toArray(n,i);this.setVerticesData(w.b.NormalKind,n,this.getVertexBuffer(w.b.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},N.prototype.bakeCurrentTransformIntoVertices=function(e){return void 0===e&&(e=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this},Object.defineProperty(N.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),N.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},N.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},N.prototype.clone=function(e,t,i,r){return void 0===e&&(e=""),void 0===t&&(t=null),void 0===r&&(r=!0),new N(e,this.getScene(),t,this,i,r)},N.prototype.dispose=function(e,t){void 0===t&&(t=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(var r in i.meshMap)(s=i.meshMap[r])&&(s._internalMeshDataInfo._source=null,i.meshMap[r]=void 0);i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var n=0,o=this.getScene().meshes;n<o.length;n++){var s;(s=o[n])._internalMeshDataInfo&&s._internalMeshDataInfo._source&&s._internalMeshDataInfo._source===this&&(s._internalMeshDataInfo._source=null)}i._source=null,this._disposeInstanceSpecificData(),v.prototype.dispose.call(this,e,t)},N.prototype._disposeInstanceSpecificData=function(){},N.prototype.applyDisplacementMap=function(e,o,s,a,h,l,c){var u=this;void 0===c&&(c=!1);var t=this.getScene();return f.b.LoadImage(e,function(e){var t=e.width,i=e.height,r=A.a.CreateCanvas(t,i).getContext("2d");r.drawImage(e,0,0);var n=r.getImageData(0,0,t,i).data;u.applyDisplacementMapFromBuffer(n,t,i,o,s,h,l,c),a&&a(u)},function(){},t.offlineProvider),this},N.prototype.applyDisplacementMapFromBuffer=function(e,t,i,r,n,o,s,a){if(void 0===a&&(a=!1),!this.isVerticesDataPresent(w.b.PositionKind)||!this.isVerticesDataPresent(w.b.NormalKind)||!this.isVerticesDataPresent(w.b.UVKind))return E.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var h=this.getVerticesData(w.b.PositionKind,!0,!0),l=this.getVerticesData(w.b.NormalKind),c=this.getVerticesData(w.b.UVKind),u=O.e.Zero(),f=O.e.Zero(),d=O.d.Zero();o=o||O.d.Zero(),s=s||new O.d(1,1);for(var p=0;p<h.length;p+=3){O.e.FromArrayToRef(h,p,u),O.e.FromArrayToRef(l,p,f),O.d.FromArrayToRef(c,p/3*2,d);var _=4*((Math.abs(d.x*s.x+o.x)*t%t|0)+(Math.abs(d.y*s.y+o.y)*i%i|0)*t),g=e[_]/255*.3+e[1+_]/255*.59+e[2+_]/255*.11;f.normalize(),f.scaleInPlace(r+(n-r)*g),(u=u.add(f)).toArray(h,p)}return M.VertexData.ComputeNormals(h,this.getIndices(),l),a?(this.setVerticesData(w.b.PositionKind,h),this.setVerticesData(w.b.NormalKind,l)):(this.updateVerticesData(w.b.PositionKind,h),this.updateVerticesData(w.b.NormalKind,l)),this},N.prototype.convertToFlatShadedMesh=function(){var e,t,i=this.getVerticesDataKinds(),r={},n={},o={},s=!1;for(e=0;e<i.length;e++){t=i[e];var a=this.getVertexBuffer(t);t!==w.b.NormalKind?(r[t]=a,n[t]=r[t].getData(),o[t]=[]):(s=a.isUpdatable(),i.splice(e,1),e--)}var h,l=this.subMeshes.slice(0),c=this.getIndices(),u=this.getTotalIndices();for(h=0;h<u;h++){var f=c[h];for(e=0;e<i.length;e++)for(var d=r[t=i[e]].getStrideSize(),p=0;p<d;p++)o[t].push(n[t][f*d+p])}var _=[],g=o[w.b.PositionKind];for(h=0;h<u;h+=3){c[h]=h,c[h+1]=h+1,c[h+2]=h+2;for(var m=O.e.FromArray(g,3*h),v=O.e.FromArray(g,3*(h+1)),b=O.e.FromArray(g,3*(h+2)),y=m.subtract(v),x=b.subtract(v),T=O.e.Normalize(O.e.Cross(y,x)),M=0;M<3;M++)_.push(T.x),_.push(T.y),_.push(T.z)}for(this.setIndices(c),this.setVerticesData(w.b.NormalKind,_,s),e=0;e<i.length;e++)t=i[e],this.setVerticesData(t,o[t],r[t].isUpdatable());this.releaseSubMeshes();for(var E=0;E<l.length;E++){var A=l[E];D.b.AddToMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this)}return this.synchronizeInstances(),this},N.prototype.convertToUnIndexedMesh=function(){var e,t,i=this.getVerticesDataKinds(),r={},n={},o={};for(e=0;e<i.length;e++){t=i[e];var s=this.getVertexBuffer(t);r[t]=s,n[t]=r[t].getData(),o[t]=[]}var a,h=this.subMeshes.slice(0),l=this.getIndices(),c=this.getTotalIndices();for(a=0;a<c;a++){var u=l[a];for(e=0;e<i.length;e++)for(var f=r[t=i[e]].getStrideSize(),d=0;d<f;d++)o[t].push(n[t][u*f+d])}for(a=0;a<c;a+=3)l[a]=a,l[a+1]=a+1,l[a+2]=a+2;for(this.setIndices(l),e=0;e<i.length;e++)t=i[e],this.setVerticesData(t,o[t],r[t].isUpdatable());this.releaseSubMeshes();for(var p=0;p<h.length;p++){var _=h[p];D.b.AddToMesh(_.materialIndex,_.indexStart,_.indexCount,_.indexStart,_.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},N.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,i,r=M.VertexData.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(w.b.NormalKind)&&r.normals)for(t=0;t<r.normals.length;t++)r.normals[t]*=-1;if(r.indices)for(t=0;t<r.indices.length;t+=3)i=r.indices[t+1],r.indices[t+1]=r.indices[t+2],r.indices[t+2]=i;return r.applyToMesh(this,this.isVertexBufferUpdatable(w.b.PositionKind)),this},N.prototype.increaseVertices=function(e){var t=M.VertexData.ExtractFromMesh(this),i=t.uvs,r=t.indices,n=t.positions,o=t.normals;if(null===r||null===n||null===o||null===i)E.a.Warn("VertexData contains null entries");else{for(var s,a,h=e+1,l=new Array,c=0;c<h+1;c++)l[c]=new Array;var u,f=new O.e(0,0,0),d=new O.e(0,0,0),p=new O.d(0,0),_=new Array,g=new Array,m=new Array,v=n.length,b=i.length;for(c=0;c<r.length;c+=3){g[0]=r[c],g[1]=r[c+1],g[2]=r[c+2];for(var y=0;y<3;y++)if(s=g[y],a=g[(y+1)%3],void 0===m[s]&&void 0===m[a]?(m[s]=new Array,m[a]=new Array):(void 0===m[s]&&(m[s]=new Array),void 0===m[a]&&(m[a]=new Array)),void 0===m[s][a]&&void 0===m[a][s]){m[s][a]=[],f.x=(n[3*a]-n[3*s])/h,f.y=(n[3*a+1]-n[3*s+1])/h,f.z=(n[3*a+2]-n[3*s+2])/h,d.x=(o[3*a]-o[3*s])/h,d.y=(o[3*a+1]-o[3*s+1])/h,d.z=(o[3*a+2]-o[3*s+2])/h,p.x=(i[2*a]-i[2*s])/h,p.y=(i[2*a+1]-i[2*s+1])/h,m[s][a].push(s);for(var x=1;x<h;x++)m[s][a].push(n.length/3),n[v]=n[3*s]+x*f.x,o[v++]=o[3*s]+x*d.x,n[v]=n[3*s+1]+x*f.y,o[v++]=o[3*s+1]+x*d.y,n[v]=n[3*s+2]+x*f.z,o[v++]=o[3*s+2]+x*d.z,i[b++]=i[2*s]+x*p.x,i[b++]=i[2*s+1]+x*p.y;m[s][a].push(a),m[a][s]=new Array,u=m[s][a].length;for(var T=0;T<u;T++)m[a][s][T]=m[s][a][u-1-T]}for(l[0][0]=r[c],l[1][0]=m[r[c]][r[c+1]][1],l[1][1]=m[r[c]][r[c+2]][1],x=2;x<h;x++)for(l[x][0]=m[r[c]][r[c+1]][x],l[x][x]=m[r[c]][r[c+2]][x],f.x=(n[3*l[x][x]]-n[3*l[x][0]])/x,f.y=(n[3*l[x][x]+1]-n[3*l[x][0]+1])/x,f.z=(n[3*l[x][x]+2]-n[3*l[x][0]+2])/x,d.x=(o[3*l[x][x]]-o[3*l[x][0]])/x,d.y=(o[3*l[x][x]+1]-o[3*l[x][0]+1])/x,d.z=(o[3*l[x][x]+2]-o[3*l[x][0]+2])/x,p.x=(i[2*l[x][x]]-i[2*l[x][0]])/x,p.y=(i[2*l[x][x]+1]-i[2*l[x][0]+1])/x,y=1;y<x;y++)l[x][y]=n.length/3,n[v]=n[3*l[x][0]]+y*f.x,o[v++]=o[3*l[x][0]]+y*d.x,n[v]=n[3*l[x][0]+1]+y*f.y,o[v++]=o[3*l[x][0]+1]+y*d.y,n[v]=n[3*l[x][0]+2]+y*f.z,o[v++]=o[3*l[x][0]+2]+y*d.z,i[b++]=i[2*l[x][0]]+y*p.x,i[b++]=i[2*l[x][0]+1]+y*p.y;for(l[h]=m[r[c+1]][r[c+2]],_.push(l[0][0],l[1][0],l[1][1]),x=1;x<h;x++){for(y=0;y<x;y++)_.push(l[x][y],l[x+1][y],l[x+1][y+1]),_.push(l[x][y],l[x+1][y+1],l[x][y+1]);_.push(l[x][y],l[x+1][y],l[x+1][y+1])}}t.indices=_,t.applyToMesh(this,this.isVertexBufferUpdatable(w.b.PositionKind))}},N.prototype.forceSharedVertices=function(){var e=M.VertexData.ExtractFromMesh(this),t=e.uvs,i=e.indices,r=e.positions,n=e.colors;if(void 0===i||void 0===r||null===i||null===r)E.a.Warn("VertexData contains empty entries");else{for(var o,s,a=new Array,h=new Array,l=new Array,c=new Array,u=new Array,f=0,d=new Array,p=0;p<i.length;p+=3){s=[i[p],i[p+1],i[p+2]],u=new Array;for(var _=0;_<3;_++){u[_]="";for(var g=0;g<3;g++)Math.abs(r[3*s[_]+g])<1e-8&&(r[3*s[_]+g]=0),u[_]+=r[3*s[_]+g]+"|";u[_]=u[_].slice(0,-1)}if(u[0]!=u[1]&&u[0]!=u[2]&&u[1]!=u[2])for(_=0;_<3;_++){if((o=d.indexOf(u[_]))<0){for(d.push(u[_]),o=f++,g=0;g<3;g++)a.push(r[3*s[_]+g]);if(null!=n)for(g=0;g<4;g++)c.push(n[4*s[_]+g]);if(null!=t)for(g=0;g<2;g++)l.push(t[2*s[_]+g])}h.push(o)}}var m=new Array;M.VertexData.ComputeNormals(a,h,m),e.positions=a,e.indices=h,e.normals=m,null!=t&&(e.uvs=l),null!=n&&(e.colors=c),e.applyToMesh(this,this.isVertexBufferUpdatable(w.b.PositionKind))}},N._instancedMeshFactory=function(e,t){throw b.a.WarnImport("InstancedMesh")},N._PhysicsImpostorParser=function(e,t,i){throw b.a.WarnImport("PhysicsImpostor")},N.prototype.createInstance=function(e){return N._instancedMeshFactory(e,this)},N.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this},N.prototype.optimizeIndices=function(i){var r=this,n=this.getIndices(),e=this.getVerticesData(w.b.PositionKind);if(!e||!n)return this;for(var o=new Array,t=0;t<e.length;t+=3)o.push(O.e.FromArray(e,t));var s=new Array;return f.a.SyncAsyncForLoop(o.length,40,function(e){for(var t=o.length-1-e,i=o[t],r=0;r<t;++r){var n=o[r];if(i.equals(n)){s[t]=r;break}}},function(){for(var e=0;e<n.length;++e)n[e]=s[n[e]]||n[e];var t=r.subMeshes.slice(0);r.setIndices(n),r.subMeshes=t,i&&i(r)}),this},N.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),g.a&&g.a.HasTags(this)&&(e.tags=g.a.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){var i=t.id;e.geometryId=i,e.subMeshes=[];for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r];e.subMeshes.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialId=this.material.id):this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id),this.getScene()._getComponent(T.a.NAME_PHYSICSENGINE)){var o=this.getPhysicsImpostor();o&&(e.physicsMass=o.getParam("mass"),e.physicsFriction=o.getParam("friction"),e.physicsRestitution=o.getParam("mass"),e.physicsImpostor=o.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var s=0;s<this.instances.length;s++){var a=this.instances[s];if(!a.doNotSerialize){var h={name:a.name,id:a.id,position:a.position.asArray(),scaling:a.scaling.asArray()};a.parent&&(h.parentId=a.parent.id),a.rotationQuaternion?h.rotationQuaternion=a.rotationQuaternion.asArray():a.rotation&&(h.rotation=a.rotation.asArray()),e.instances.push(h),l.a.AppendSerializedAnimations(a,h),h.ranges=a.serializeAnimationRanges()}}l.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},N.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return E.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var i=e.getActiveTarget(t),r=i.getPositions();if(!r)return void E.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(w.b.PositionKind+t,r,!1,3);var n=i.getNormals();n&&this.geometry.setVerticesData(w.b.NormalKind+t,n,!1,3);var o=i.getTangents();o&&this.geometry.setVerticesData(w.b.TangentKind+t,o,!1,3);var s=i.getUVs();s&&this.geometry.setVerticesData(w.b.UVKind+"_"+t,s,!1,2)}}else for(t=0;this.geometry.isVerticesDataPresent(w.b.PositionKind+t);)this.geometry.removeVerticesData(w.b.PositionKind+t),this.geometry.isVerticesDataPresent(w.b.NormalKind+t)&&this.geometry.removeVerticesData(w.b.NormalKind+t),this.geometry.isVerticesDataPresent(w.b.TangentKind+t)&&this.geometry.removeVerticesData(w.b.TangentKind+t),this.geometry.isVerticesDataPresent(w.b.UVKind+t)&&this.geometry.removeVerticesData(w.b.UVKind+"_"+t),t++}},N.Parse=function(e,t,i){var r;if((r=e.type&&"GroundMesh"===e.type?N._GroundMeshParser(e,t):new N(e.name,t)).id=e.id,g.a&&g.a.AddTagsTo(r,e.tags),r.position=O.e.FromArray(e.position),void 0!==e.metadata&&(r.metadata=e.metadata),e.rotationQuaternion?r.rotationQuaternion=O.b.FromArray(e.rotationQuaternion):e.rotation&&(r.rotation=O.e.FromArray(e.rotation)),r.scaling=O.e.FromArray(e.scaling),e.localMatrix?r.setPreTransformMatrix(O.a.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(O.a.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r.isVisible=e.isVisible,r.infiniteDistance=e.infiniteDistance,r.showBoundingBox=e.showBoundingBox,r.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(r.applyFog=e.applyFog),void 0!==e.pickable&&(r.isPickable=e.pickable),void 0!==e.alphaIndex&&(r.alphaIndex=e.alphaIndex),r.receiveShadows=e.receiveShadows,r.billboardMode=e.billboardMode,void 0!==e.visibility&&(r.visibility=e.visibility),r.checkCollisions=e.checkCollisions,r.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,void 0!==e.isBlocker&&(r.isBlocker=e.isBlocker),r._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(r._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.actions&&(r._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(r.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(r.overlayColor=I.a.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(r.renderOverlay=e.renderOverlay),r.isUnIndexed=!!e.isUnIndexed,r.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new u.a(O.e.FromArray(e.boundingBoxMinimum),O.e.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(r._binaryInfo=e._binaryInfo),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(w.b.UVKind),e.hasUVs2&&r._delayInfo.push(w.b.UV2Kind),e.hasUVs3&&r._delayInfo.push(w.b.UV3Kind),e.hasUVs4&&r._delayInfo.push(w.b.UV4Kind),e.hasUVs5&&r._delayInfo.push(w.b.UV5Kind),e.hasUVs6&&r._delayInfo.push(w.b.UV6Kind),e.hasColors&&r._delayInfo.push(w.b.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(w.b.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(w.b.MatricesWeightsKind),r._delayLoadingFunction=d._ImportGeometry,m.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):d._ImportGeometry(e,r),e.materialId?r.setMaterialByID(e.materialId):r.material=null,-1<e.morphTargetManagerId&&(r.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),-1<e.skeletonId&&(r.skeleton=t.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(r.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var n=0;n<e.animations.length;n++){var o=e.animations[n];(l=p.a.GetClass("BABYLON.Animation"))&&r.animations.push(l.Parse(o))}c.a.ParseAnimationRanges(r,e,t)}if(e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?r.layerMask=Math.abs(parseInt(e.layerMask)):r.layerMask=268435455,e.physicsImpostor&&N._PhysicsImpostorParser(t,r,e),e.lodMeshIds&&(r._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var s=0;s<e.instances.length;s++){var a=e.instances[s],h=r.createInstance(a.name);if(a.id&&(h.id=a.id),g.a&&(a.tags?g.a.AddTagsTo(h,a.tags):g.a.AddTagsTo(h,e.tags)),h.position=O.e.FromArray(a.position),void 0!==a.metadata&&(h.metadata=a.metadata),a.parentId&&(h._waitingParentId=a.parentId),a.rotationQuaternion?h.rotationQuaternion=O.b.FromArray(a.rotationQuaternion):a.rotation&&(h.rotation=O.e.FromArray(a.rotation)),h.scaling=O.e.FromArray(a.scaling),null!=a.checkCollisions&&null!=a.checkCollisions&&(h.checkCollisions=a.checkCollisions),null!=a.pickable&&null!=a.pickable&&(h.isPickable=a.pickable),null!=a.showBoundingBox&&null!=a.showBoundingBox&&(h.showBoundingBox=a.showBoundingBox),null!=a.showSubMeshesBoundingBox&&null!=a.showSubMeshesBoundingBox&&(h.showSubMeshesBoundingBox=a.showSubMeshesBoundingBox),null!=a.alphaIndex&&null!=a.showSubMeshesBoundingBox&&(h.alphaIndex=a.alphaIndex),a.physicsImpostor&&N._PhysicsImpostorParser(t,h,a),a.animations){for(n=0;n<a.animations.length;n++){var l;o=a.animations[n],(l=p.a.GetClass("BABYLON.Animation"))&&h.animations.push(l.Parse(o))}c.a.ParseAnimationRanges(h,a,t),a.autoAnimate&&t.beginAnimation(h,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1)}}return r},N.CreateRibbon=function(e,t,i,r,n,o,s,a,h){throw b.a.WarnImport("MeshBuilder")},N.CreateDisc=function(e,t,i,r,n,o){throw void 0===r&&(r=null),b.a.WarnImport("MeshBuilder")},N.CreateBox=function(e,t,i,r,n){throw void 0===i&&(i=null),b.a.WarnImport("MeshBuilder")},N.CreateSphere=function(e,t,i,r,n,o){throw b.a.WarnImport("MeshBuilder")},N.CreateHemisphere=function(e,t,i,r){throw b.a.WarnImport("MeshBuilder")},N.CreateCylinder=function(e,t,i,r,n,o,s,a,h){throw b.a.WarnImport("MeshBuilder")},N.CreateTorus=function(e,t,i,r,n,o,s){throw b.a.WarnImport("MeshBuilder")},N.CreateTorusKnot=function(e,t,i,r,n,o,s,a,h,l){throw b.a.WarnImport("MeshBuilder")},N.CreateLines=function(e,t,i,r,n){throw void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=null),b.a.WarnImport("MeshBuilder")},N.CreateDashedLines=function(e,t,i,r,n,o,s,a){throw void 0===o&&(o=null),b.a.WarnImport("MeshBuilder")},N.CreatePolygon=function(e,t,i,r,n,o,s){throw void 0===s&&(s=earcut),b.a.WarnImport("MeshBuilder")},N.ExtrudePolygon=function(e,t,i,r,n,o,s,a){throw void 0===a&&(a=earcut),b.a.WarnImport("MeshBuilder")},N.ExtrudeShape=function(e,t,i,r,n,o,s,a,h,l){throw void 0===s&&(s=null),b.a.WarnImport("MeshBuilder")},N.ExtrudeShapeCustom=function(e,t,i,r,n,o,s,a,h,l,c,u){throw b.a.WarnImport("MeshBuilder")},N.CreateLathe=function(e,t,i,r,n,o,s){throw b.a.WarnImport("MeshBuilder")},N.CreatePlane=function(e,t,i,r,n){throw b.a.WarnImport("MeshBuilder")},N.CreateGround=function(e,t,i,r,n,o){throw b.a.WarnImport("MeshBuilder")},N.CreateTiledGround=function(e,t,i,r,n,o,s,a,h){throw b.a.WarnImport("MeshBuilder")},N.CreateGroundFromHeightMap=function(e,t,i,r,n,o,s,a,h,l,c){throw b.a.WarnImport("MeshBuilder")},N.CreateTube=function(e,t,i,r,n,o,s,a,h,l){throw b.a.WarnImport("MeshBuilder")},N.CreatePolyhedron=function(e,t,i){throw b.a.WarnImport("MeshBuilder")},N.CreateIcoSphere=function(e,t,i){throw b.a.WarnImport("MeshBuilder")},N.CreateDecal=function(e,t,i,r,n,o){throw b.a.WarnImport("MeshBuilder")},N.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(w.b.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(w.b.PositionKind)||this.setVerticesData(w.b.PositionKind,t,!0)}return e._sourcePositions},N.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(w.b.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(w.b.NormalKind)||this.setVerticesData(w.b.NormalKind,t,!0)}return e._sourceNormals},N.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(w.b.PositionKind))return this;if(!this.isVerticesDataPresent(w.b.NormalKind))return this;if(!this.isVerticesDataPresent(w.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(w.b.MatricesWeightsKind))return this;var t=this._internalMeshDataInfo;if(!t._sourcePositions){var i=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=i}t._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(w.b.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var n=this.getVerticesData(w.b.NormalKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var o=this.getVerticesData(w.b.MatricesIndicesKind),s=this.getVerticesData(w.b.MatricesWeightsKind);if(!s||!o)return this;for(var a,h=4<this.numBoneInfluencers,l=h?this.getVerticesData(w.b.MatricesIndicesExtraKind):null,c=h?this.getVerticesData(w.b.MatricesWeightsExtraKind):null,u=e.getTransformMatrices(this),f=O.e.Zero(),d=new O.a,p=new O.a,_=0,g=0;g<r.length;g+=3,_+=4){var m;for(a=0;a<4;a++)0<(m=s[_+a])&&(O.a.FromFloat32ArrayToRefScaled(u,Math.floor(16*o[_+a]),m,p),d.addToSelf(p));if(h)for(a=0;a<4;a++)0<(m=c[_+a])&&(O.a.FromFloat32ArrayToRefScaled(u,Math.floor(16*l[_+a]),m,p),d.addToSelf(p));O.e.TransformCoordinatesFromFloatsToRef(t._sourcePositions[g],t._sourcePositions[g+1],t._sourcePositions[g+2],d,f),f.toArray(r,g),O.e.TransformNormalFromFloatsToRef(t._sourceNormals[g],t._sourceNormals[g+1],t._sourceNormals[g+2],d,f),f.toArray(n,g),d.reset()}return this.updateVerticesData(w.b.PositionKind,r),this.updateVerticesData(w.b.NormalKind,n),this},N.MinMax=function(e){var i=null,r=null;return e.forEach(function(e){var t=e.getBoundingInfo().boundingBox;i&&r?(i.minimizeInPlace(t.minimumWorld),r.maximizeInPlace(t.maximumWorld)):(i=t.minimumWorld,r=t.maximumWorld)}),i&&r?{min:i,max:r}:{min:O.e.Zero(),max:O.e.Zero()}},N.Center=function(e){var t=e instanceof Array?N.MinMax(e):e;return O.e.Center(t.min,t.max)},N.MergeMeshes=function(e,t,i,r,n,o){var s;if(void 0===t&&(t=!0),!i){var a=0;for(s=0;s<e.length;s++)if(e[s]&&65536<=(a+=e[s].getTotalVertices()))return E.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(o){var h,l,c=null;n=!1}var u,f=new Array,d=new Array,p=null,_=new Array,g=null;for(s=0;s<e.length;s++)if(e[s]){var m=e[s];if(m.isAnInstance)return E.a.Warn("Cannot merge instance meshes."),null;var v=m.computeWorldMatrix(!0);if((u=M.VertexData.ExtractFromMesh(m,!0,!0)).transform(v),p?p.merge(u,i):(p=u,g=m),n&&_.push(m.getTotalIndices()),o)if(m.material){var b=m.material;if(b instanceof x.a){for(l=0;l<b.subMaterials.length;l++)f.indexOf(b.subMaterials[l])<0&&f.push(b.subMaterials[l]);for(h=0;h<m.subMeshes.length;h++)d.push(f.indexOf(b.subMaterials[m.subMeshes[h].materialIndex])),_.push(m.subMeshes[h].indexCount)}else for(f.indexOf(b)<0&&f.push(b),h=0;h<m.subMeshes.length;h++)d.push(f.indexOf(b)),_.push(m.subMeshes[h].indexCount)}else for(h=0;h<m.subMeshes.length;h++)d.push(0),_.push(m.subMeshes[h].indexCount)}if(g=g,r=r||new N(g.name+"_merged",g.getScene()),p.applyToMesh(r),r.checkCollisions=g.checkCollisions,t)for(s=0;s<e.length;s++)e[s]&&e[s].dispose();if(n||o){r.releaseSubMeshes();for(var y=s=0;s<_.length;)D.b.CreateFromIndices(0,y,_[s],r),y+=_[s],s++}if(o){for((c=new x.a(g.name+"_merged",g.getScene())).subMaterials=f,h=0;h<r.subMeshes.length;h++)r.subMeshes[h].materialIndex=d[h];r.material=c}else r.material=g.material;return r},N.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},N.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var i=this.instances[this.instances.length-1];(this.instances[t]=i)._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},N.FRONTSIDE=M.VertexData.FRONTSIDE,N.BACKSIDE=M.VertexData.BACKSIDE,N.DOUBLESIDE=M.VertexData.DOUBLESIDE,N.DEFAULTSIDE=M.VertexData.DEFAULTSIDE,N.NO_CAP=0,N.CAP_START=1,N.CAP_END=2,N.CAP_ALL=3,N.NO_FLIP=0,N.FLIP_TILE=1,N.ROTATE_TILE=2,N.FLIP_ROW=3,N.ROTATE_ROW=4,N.FLIP_N_ROTATE_TILE=5,N.FLIP_N_ROTATE_ROW=6,N.CENTER=0,N.LEFT=1,N.RIGHT=2,N.TOP=3,N.BOTTOM=4,N._GroundMeshParser=function(e,t){throw b.a.WarnImport("GroundMesh")},N);function N(e,t,i,r,n,o){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===o&&(o=!0);var s=v.call(this,e,t)||this;if(s._internalMeshDataInfo=new R,s.delayLoadState=0,s.instances=new Array,s._creationDataStorage=null,s._geometry=null,s._instanceDataStorage=new C,s._effectiveMaterial=null,s._shouldGenerateFlatShading=!1,s._originalBuilderSideOrientation=N.DEFAULTSIDE,s.overrideMaterialSideOrientation=null,t=s.getScene(),r){if(r._geometry&&r._geometry.applyToMesh(s),_.a.DeepCopy(r,s,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable","lightSources","morphTargetManager"],["_poseMatrix"]),s._internalMeshDataInfo._source=r,t.useClonedMeshMap&&(r._internalMeshDataInfo.meshMap||(r._internalMeshDataInfo.meshMap={}),r._internalMeshDataInfo.meshMap[s.uniqueId]=s),s._originalBuilderSideOrientation=r._originalBuilderSideOrientation,s._creationDataStorage=r._creationDataStorage,r._ranges){var a=r._ranges;for(var e in a)a.hasOwnProperty(e)&&a[e]&&s.createAnimationRange(e,a[e].from,a[e].to)}var h;if(r.metadata&&r.metadata.clone?s.metadata=r.metadata.clone():s.metadata=r.metadata,g.a&&g.a.HasTags(r)&&g.a.AddTagsTo(s,g.a.GetTags(r,!0)),s.parent=r.parent,s.setPivotMatrix(r.getPivotMatrix()),s.id=e+"."+r.id,s.material=r.material,!n)for(var l=r.getDescendants(!0),c=0;c<l.length;c++){var u=l[c];u.clone&&u.clone(e+"."+u.name,s)}if(r.morphTargetManager&&(s.morphTargetManager=r.morphTargetManager),t.getPhysicsEngine){var f=t.getPhysicsEngine();if(o&&f){var d=f.getImpostorForPhysicsObject(r);d&&(s.physicsImpostor=d.clone(s))}}for(h=0;h<t.particleSystems.length;h++){var p=t.particleSystems[h];p.emitter===r&&p.clone(p.name,s)}s.refreshBoundingInfo(),s.computeWorldMatrix(!0)}return null!==i&&(s.parent=i),s._instanceDataStorage.hardwareInstancedRendering=s.getEngine().getCaps().instancedArrays,s}},function(e,t,i){"use strict";i.d(t,"a",function(){return b});var r=i(1),s=i(3),_=i(4),n=i(0),o=i(23),a=i(71),h=i(46),l=(i(36),Object.defineProperty(c.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(17))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uid",{get:function(){return this._uid||(this._uid=a.a.RandomId()),this._uid},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return this.name},c.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(c.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),c.prototype.getScene=function(){return this._scene},c.prototype.getTextureMatrix=function(){return n.a.IdentityReadOnly},c.prototype.getReflectionTextureMatrix=function(){return n.a.IdentityReadOnly},c.prototype.getInternalTexture=function(){return this._texture},c.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},c.prototype.isReady=function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},c.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},c.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new h.a(this._texture._size,this._texture._size):new h.a(this._texture.baseWidth,this._texture.baseHeight):h.a.Zero()},c.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&t.getEngine().updateTextureSamplingMode(e,this._texture)}},c.prototype.scale=function(e){},Object.defineProperty(c.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),c.prototype._getFromCache=function(e,t,i,r){if(!this._scene)return null;for(var n=this._scene.getEngine().getLoadedTexturesCache(),o=0;o<n.length;o++){var s=n[o];if(!(void 0!==r&&r!==s.invertY||s.url!==e||s.generateMipMaps!==!t||i&&i!==s.samplingMode))return s.incrementReferences(),s}return null},c.prototype._rebuild=function(){},c.prototype.delayLoad=function(){},c.prototype.clone=function(){return null},Object.defineProperty(c.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5},enumerable:!0,configurable:!0}),c.prototype._markAllSubMeshesAsTexturesDirty=function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(1)},c.prototype.readPixels=function(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=null),!this._texture)return null;var r=this.getSize(),n=r.width,o=r.height,s=this.getScene();if(!s)return null;var a=s.getEngine();return 0!=t&&(n/=Math.pow(2,t),o/=Math.pow(2,t),n=Math.round(n),o=Math.round(o)),this._texture.isCube?a._readTexturePixels(this._texture,n,o,e,t,i):a._readTexturePixels(this._texture,n,o,-1,t,i)},c.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(c.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);0<=e&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this)}void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},c.prototype.serialize=function(){if(!this.name)return null;var e=s.a.Serialize(this);return s.a.AppendSerializedAnimations(this,e),e},c.WhenAllReady=function(t,i){var r=t.length;if(0!==r)for(var n,o,e=function(){if((n=t[s]).isReady())0==--r&&i();else if(o=n.onLoadObservable){var e=function(){o.removeCallback(e),0==--r&&i()};o.add(e)}},s=0;s<t.length;s++)e();else i()},c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Object(r.b)([Object(s.c)()],c.prototype,"uniqueId",void 0),Object(r.b)([Object(s.c)()],c.prototype,"name",void 0),Object(r.b)([Object(s.c)()],c.prototype,"metadata",void 0),Object(r.b)([Object(s.c)("hasAlpha")],c.prototype,"_hasAlpha",void 0),Object(r.b)([Object(s.c)()],c.prototype,"getAlphaFromRGB",void 0),Object(r.b)([Object(s.c)()],c.prototype,"level",void 0),Object(r.b)([Object(s.c)()],c.prototype,"coordinatesIndex",void 0),Object(r.b)([Object(s.c)("coordinatesMode")],c.prototype,"_coordinatesMode",void 0),Object(r.b)([Object(s.c)()],c.prototype,"wrapU",void 0),Object(r.b)([Object(s.c)()],c.prototype,"wrapV",void 0),Object(r.b)([Object(s.c)()],c.prototype,"wrapR",void 0),Object(r.b)([Object(s.c)()],c.prototype,"anisotropicFilteringLevel",void 0),Object(r.b)([Object(s.c)()],c.prototype,"isCube",null),Object(r.b)([Object(s.c)()],c.prototype,"is3D",null),Object(r.b)([Object(s.c)()],c.prototype,"is2DArray",null),Object(r.b)([Object(s.c)(),Object(s.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"gammaSpace",void 0),Object(r.b)([Object(s.c)()],c.prototype,"invertZ",void 0),Object(r.b)([Object(s.c)()],c.prototype,"lodLevelInAlpha",void 0),Object(r.b)([Object(s.c)()],c.prototype,"lodGenerationOffset",null),Object(r.b)([Object(s.c)()],c.prototype,"lodGenerationScale",null),Object(r.b)([Object(s.c)()],c.prototype,"linearSpecularLOD",null),Object(r.b)([Object(s.j)()],c.prototype,"irradianceTexture",null),Object(r.b)([Object(s.c)()],c.prototype,"isRenderTarget",void 0),c);function c(e){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=0,this.wrapU=1,this.wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new _.a,this._onDisposeObserver=null,this.delayLoadState=0,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=h.a.Zero(),this._scene=e||o.a.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}var g,u=i(10),f=i(8),m=i(64),d=i(61),p=i(49),v=i(40),b=(g=l,Object(r.c)(y,g),Object.defineProperty(y.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),y.prototype.updateURL=function(e,t,i){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!v.a.StartsWith(this.name,"data:")||(this.name=e),this.url=e,this._buffer=t,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()},y.prototype.delayLoad=function(){if(4===this.delayLoadState){var e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?m.a.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},y.prototype._prepareRowForTextureGeneration=function(e,t,i,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,n.e.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter},y.prototype.getTextureMatrix=function(e){var t=this;if(void 0===e&&(e=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=n.a.Zero(),this._rowGenerationMatrix=new n.a,this._t0=n.e.Zero(),this._t1=n.e.Zero(),this._t2=n.e.Zero()),n.a.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),n.a.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var i=this.getScene();return i&&i.markAllMaterialsAsDirty(1,function(e){return e.hasTexture(t)}),this._cachedTextureMatrix},y.prototype.getReflectionTextureMatrix=function(){var t=this,e=this.getScene();if(!e)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==y.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=n.a.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=n.a.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case y.PLANAR_MODE:n.a.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case y.PROJECTION_MODE:n.a.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var i=e.getProjectionMatrix();this._cachedProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:n.a.IdentityToRef(this._cachedTextureMatrix)}return e.markAllMaterialsAsDirty(1,function(e){return-1!==e.getActiveTextures().indexOf(t)}),this._cachedTextureMatrix},y.prototype.clone=function(){var e=this;return s.a.Clone(function(){return new y(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode,void 0,void 0,e._texture?e._texture._buffer:void 0)},this)},y.prototype.serialize=function(){var e=this.name;y.SerializeBuffers||v.a.StartsWith(this.name,"data:")&&(this.name="");var t=g.prototype.serialize.call(this);return t?(y.SerializeBuffers&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&v.a.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array&&(t.base64String="data:image/png;base64,"+v.a.EncodeArrayBufferToBase64(this._buffer))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,this.name=e,t):null},y.prototype.getClassName=function(){return"Texture"},y.prototype.dispose=function(){g.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},y.Parse=function(a,h,l){if(a.customType){var e=d.a.Instantiate(a.customType).Parse(a,h,l);return a.samplingMode&&e.updateSamplingMode&&e._samplingMode&&e._samplingMode!==a.samplingMode&&e.updateSamplingMode(a.samplingMode),e}if(a.isCube&&!a.isRenderTarget)return y._CubeTextureParser(a,h,l);if(!a.name&&!a.isRenderTarget)return null;var t=s.a.Parse(function(){var e,t=!0;if(a.noMipmap&&(t=!1),a.mirrorPlane){var i=y._CreateMirror(a.name,a.renderTargetSize,h,t);return i._waitingRenderList=a.renderList,i.mirrorPlane=p.a.FromArray(a.mirrorPlane),i}if(a.isRenderTarget){var r=null;if(a.isCube){if(h.reflectionProbes)for(var n=0;n<h.reflectionProbes.length;n++){var o=h.reflectionProbes[n];if(o.name===a.name)return o.cubeTexture}}else(r=y._CreateRenderTargetTexture(a.name,a.renderTargetSize,h,t))._waitingRenderList=a.renderList;return r}if(a.base64String)e=y.CreateFromBase64String(a.base64String,a.name,h,!t,a.invertY);else{var s=l+a.name;y.UseSerializedUrlIfAny&&a.url&&(s=a.url),e=new y(s,h,!t,a.invertY)}return e},a,h);if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),a.samplingMode){var i=a.samplingMode;t&&t.samplingMode!==i&&t.updateSamplingMode(i)}if(t&&a.animations)for(var r=0;r<a.animations.length;r++){var n=a.animations[r],o=u.a.GetClass("BABYLON.Animation");o&&t.animations.push(o.Parse(n))}return t},y.CreateFromBase64String=function(e,t,i,r,n,o,s,a,h){return void 0===o&&(o=y.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=5),new y("data:"+t,i,r,n,o,s,a,e,!1,h)},y.LoadFromDataString=function(e,t,i,r,n,o,s,a,h,l){return void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===o&&(o=!0),void 0===s&&(s=y.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===l&&(l=5),"data:"!==e.substr(0,5)&&(e="data:"+e),new y(e,i,n,o,s,a,h,t,r,l)},y.SerializeBuffers=!0,y._CubeTextureParser=function(e,t,i){throw f.a.WarnImport("CubeTexture")},y._CreateMirror=function(e,t,i,r){throw f.a.WarnImport("MirrorTexture")},y._CreateRenderTargetTexture=function(e,t,i,r){throw f.a.WarnImport("RenderTargetTexture")},y.NEAREST_SAMPLINGMODE=1,y.NEAREST_NEAREST_MIPLINEAR=8,y.BILINEAR_SAMPLINGMODE=2,y.LINEAR_LINEAR_MIPNEAREST=11,y.TRILINEAR_SAMPLINGMODE=3,y.LINEAR_LINEAR_MIPLINEAR=3,y.NEAREST_NEAREST_MIPNEAREST=4,y.NEAREST_LINEAR_MIPNEAREST=5,y.NEAREST_LINEAR_MIPLINEAR=6,y.NEAREST_LINEAR=7,y.NEAREST_NEAREST=1,y.LINEAR_NEAREST_MIPNEAREST=9,y.LINEAR_NEAREST_MIPLINEAR=10,y.LINEAR_LINEAR=2,y.LINEAR_NEAREST=12,y.EXPLICIT_MODE=0,y.SPHERICAL_MODE=1,y.PLANAR_MODE=2,y.CUBIC_MODE=3,y.PROJECTION_MODE=4,y.SKYBOX_MODE=5,y.INVCUBIC_MODE=6,y.EQUIRECTANGULAR_MODE=7,y.FIXED_EQUIRECTANGULAR_MODE=8,y.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,y.CLAMP_ADDRESSMODE=0,y.WRAP_ADDRESSMODE=1,y.MIRROR_ADDRESSMODE=2,y.UseSerializedUrlIfAny=!1,Object(r.b)([Object(s.c)()],y.prototype,"url",void 0),Object(r.b)([Object(s.c)()],y.prototype,"uOffset",void 0),Object(r.b)([Object(s.c)()],y.prototype,"vOffset",void 0),Object(r.b)([Object(s.c)()],y.prototype,"uScale",void 0),Object(r.b)([Object(s.c)()],y.prototype,"vScale",void 0),Object(r.b)([Object(s.c)()],y.prototype,"uAng",void 0),Object(r.b)([Object(s.c)()],y.prototype,"vAng",void 0),Object(r.b)([Object(s.c)()],y.prototype,"wAng",void 0),Object(r.b)([Object(s.c)()],y.prototype,"uRotationCenter",void 0),Object(r.b)([Object(s.c)()],y.prototype,"vRotationCenter",void 0),Object(r.b)([Object(s.c)()],y.prototype,"wRotationCenter",void 0),Object(r.b)([Object(s.c)()],y.prototype,"isBlocking",null),y);function y(e,t,i,r,n,o,s,a,h,l,c){void 0===i&&(i=!1),void 0===r&&(r=!0),void 0===n&&(n=y.TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=!1);var u=g.call(this,t&&"Scene"===t.getClassName()?t:null)||this;u.url=null,u.uOffset=0,u.vOffset=0,u.uScale=1,u.vScale=1,u.uAng=0,u.vAng=0,u.wAng=0,u.uRotationCenter=.5,u.vRotationCenter=.5,u.wRotationCenter=.5,u.inspectableCustomProperties=null,u._noMipmap=!1,u._invertY=!1,u._rowGenerationMatrix=null,u._cachedTextureMatrix=null,u._projectionModeMatrix=null,u._t0=null,u._t1=null,u._t2=null,u._cachedUOffset=-1,u._cachedVOffset=-1,u._cachedUScale=0,u._cachedVScale=0,u._cachedUAng=-1,u._cachedVAng=-1,u._cachedWAng=-1,u._cachedProjectionMatrixId=-1,u._cachedCoordinatesMode=-1,u._initialSamplingMode=y.BILINEAR_SAMPLINGMODE,u._buffer=null,u._deleteBuffer=!1,u._format=null,u._delayedOnLoad=null,u._delayedOnError=null,u.onLoadObservable=new _.a,u._isBlocking=!0,u.name=e||"",u.url=e,u._noMipmap=i,u._invertY=r,u._initialSamplingMode=n,u._buffer=a,u._deleteBuffer=h,u._mimeType=c,l&&(u._format=l);var f=u.getScene(),d=t&&t.getCaps?t:f?f.getEngine():null;if(!d)return u;d.onBeforeTextureInitObservable.notifyObservers(u);function p(){u._texture&&(u._texture._invertVScale&&(u.vScale*=-1,u.vOffset+=1),null!==u._texture._cachedWrapU&&(u.wrapU=u._texture._cachedWrapU,u._texture._cachedWrapU=null),null!==u._texture._cachedWrapV&&(u.wrapV=u._texture._cachedWrapV,u._texture._cachedWrapV=null),null!==u._texture._cachedWrapR&&(u.wrapR=u._texture._cachedWrapR,u._texture._cachedWrapR=null)),u.onLoadObservable.hasObservers()&&u.onLoadObservable.notifyObservers(u),o&&o(),!u.isBlocking&&f&&f.resetCachedMaterial()}return u.url?(u._texture=u._getFromCache(u.url,i,n,r),u._texture?u._texture.isReady?m.a.SetImmediate(function(){return p()}):u._texture.onLoadedObservable.add(p):f&&f.useDelayedTextureLoading?(u.delayLoadState=4,u._delayedOnLoad=p,u._delayedOnError=s):(u._texture=d.createTexture(u.url,i,r,f,n,p,s,u._buffer,void 0,u._format,null,c),h&&delete u._buffer)):(u._delayedOnLoad=p,u._delayedOnError=s),u}s.a._TextureParser=b.Parse},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var c=i(11),n=i(33),u=i(23),f=i(2),l=i(43),r=i(7),o=(s.BindEyePosition=function(e,t){if(t._forcedViewPosition)e.setVector3("vEyePosition",t._forcedViewPosition);else{var i=t.activeCamera.globalPosition;i=i||t.activeCamera.devicePosition,e.setVector3("vEyePosition",t._mirroredCameraPosition?t._mirroredCameraPosition:i)}},s.PrepareDefinesForMergedUV=function(e,t,i){t._needUVs=!0,t[i]=!0,e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,0===e.coordinatesIndex?t.MAINUV1=!0:t.MAINUV2=!0):t[i+"DIRECTUV"]=0},s.BindTextureMatrix=function(e,t,i){var r=e.getTextureMatrix();t.updateMatrix(i+"Matrix",r)},s.GetFogState=function(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==n.Scene.FOGMODE_NONE},s.PrepareDefinesForMisc=function(e,t,i,r,n,o,s){s._areMiscDirty&&(s.LOGARITHMICDEPTH=i,s.POINTSIZE=r,s.FOG=n&&this.GetFogState(e,t),s.NONUNIFORMSCALING=e.nonUniformScaling,s.ALPHATEST=o)},s.PrepareDefinesForFrameBoundValues=function(e,t,i,r,n){void 0===n&&(n=null);var o,s,a,h,l,c,u=!1;o=null==n?void 0!==e.clipPlane&&null!==e.clipPlane:n,s=null==n?void 0!==e.clipPlane2&&null!==e.clipPlane2:n,a=null==n?void 0!==e.clipPlane3&&null!==e.clipPlane3:n,h=null==n?void 0!==e.clipPlane4&&null!==e.clipPlane4:n,l=null==n?void 0!==e.clipPlane5&&null!==e.clipPlane5:n,c=null==n?void 0!==e.clipPlane6&&null!==e.clipPlane6:n,i.CLIPPLANE!==o&&(i.CLIPPLANE=o,u=!0),i.CLIPPLANE2!==s&&(i.CLIPPLANE2=s,u=!0),i.CLIPPLANE3!==a&&(i.CLIPPLANE3=a,u=!0),i.CLIPPLANE4!==h&&(i.CLIPPLANE4=h,u=!0),i.CLIPPLANE5!==l&&(i.CLIPPLANE5=l,u=!0),i.CLIPPLANE6!==c&&(i.CLIPPLANE6=c,u=!0),i.DEPTHPREPASS!==!t.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,u=!0),i.INSTANCES!==r&&(i.INSTANCES=r,u=!0),u&&i.markAsUnprocessed()},s.PrepareDefinesForBones=function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var i=void 0!==t.BONETEXTURE;e.skeleton.isUsingTextureForMatrices&&i?t.BONETEXTURE=!0:(t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!i&&void 0)}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0},s.PrepareDefinesForMorphTargets=function(e,t){var i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.MORPHTARGETS=0<i.numInfluencers,t.NUM_MORPH_INFLUENCERS=i.numInfluencers):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)},s.PrepareDefinesForAttributes=function(e,t,i,r,n,o){if(void 0===n&&(n=!1),void 0===o&&(o=!0),!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;if(t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(f.b.NormalKind),t._needNormals&&e.isVerticesDataPresent(f.b.TangentKind)&&(t.TANGENT=!0),t._needUVs?(t.UV1=e.isVerticesDataPresent(f.b.UVKind),t.UV2=e.isVerticesDataPresent(f.b.UV2Kind)):(t.UV1=!1,t.UV2=!1),i){var s=e.useVertexColors&&e.isVerticesDataPresent(f.b.ColorKind);t.VERTEXCOLOR=s,t.VERTEXALPHA=e.hasVertexAlpha&&s&&o}return r&&this.PrepareDefinesForBones(e,t),n&&this.PrepareDefinesForMorphTargets(e,t),!0},s.PrepareDefinesForMultiview=function(e,t){if(e.activeCamera){var i=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&1<e.activeCamera.outputRenderTarget.getViewCount(),t.MULTIVIEW!=i&&t.markAsUnprocessed()}},s.PrepareDefinesForLight=function(e,t,i,r,n,o,s){switch(s.needNormals=!0,void 0===n["LIGHT"+r]&&(s.needRebuild=!0),n["LIGHT"+r]=!0,n["SPOTLIGHT"+r]=!1,n["HEMILIGHT"+r]=!1,n["POINTLIGHT"+r]=!1,n["DIRLIGHT"+r]=!1,i.prepareLightSpecificDefines(n,r),n["LIGHT_FALLOFF_PHYSICAL"+r]=!1,n["LIGHT_FALLOFF_GLTF"+r]=!1,n["LIGHT_FALLOFF_STANDARD"+r]=!1,i.falloffType){case l.a.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+r]=!0;break;case l.a.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+r]=!0;break;case l.a.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+r]=!0}if(o&&!i.specular.equalsFloats(0,0,0)&&(s.specularEnabled=!0),n["SHADOW"+r]=!1,n["SHADOWCSM"+r]=!1,n["SHADOWCSMDEBUG"+r]=!1,n["SHADOWCSMNUM_CASCADES"+r]=!1,n["SHADOWCSMUSESHADOWMAXZ"+r]=!1,n["SHADOWCSMNOBLEND"+r]=!1,n["SHADOWCSM_RIGHTHANDED"+r]=!1,n["SHADOWPCF"+r]=!1,n["SHADOWPCSS"+r]=!1,n["SHADOWPOISSON"+r]=!1,n["SHADOWESM"+r]=!1,n["SHADOWCUBE"+r]=!1,n["SHADOWLOWQUALITY"+r]=!1,n["SHADOWMEDIUMQUALITY"+r]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled){var a=i.getShadowGenerator();if(a){var h=a.getShadowMap();h&&h.renderList&&0<h.renderList.length&&(s.shadowEnabled=!0,a.prepareDefines(n,r))}}i.lightmapMode!=l.a.LIGHTMAP_DEFAULT?(s.lightmapMode=!0,n["LIGHTMAPEXCLUDED"+r]=!0,n["LIGHTMAPNOSPECULAR"+r]=i.lightmapMode==l.a.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+r]=!1,n["LIGHTMAPNOSPECULAR"+r]=!1)},s.PrepareDefinesForLights=function(e,t,i,r,n,o){if(void 0===n&&(n=4),void 0===o&&(o=!1),!i._areLightsDirty)return i._needNormals;var s=0,a={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!o)for(var h=0,l=t.lightSources;h<l.length;h++){var c=l[h];if(this.PrepareDefinesForLight(e,t,c,s,i,r,a),++s===n)break}i.SPECULARTERM=a.specularEnabled,i.SHADOWS=a.shadowEnabled;for(var u=s;u<n;u++)void 0!==i["LIGHT"+u]&&(i["LIGHT"+u]=!1,i["HEMILIGHT"+u]=!1,i["POINTLIGHT"+u]=!1,i["DIRLIGHT"+u]=!1,i["SPOTLIGHT"+u]=!1,i["SHADOW"+u]=!1,i["SHADOWCSM"+u]=!1,i["SHADOWCSMDEBUG"+u]=!1,i["SHADOWCSMNUM_CASCADES"+u]=!1,i["SHADOWCSMUSESHADOWMAXZ"+u]=!1,i["SHADOWCSMNOBLEND"+u]=!1,i["SHADOWCSM_RIGHTHANDED"+u]=!1,i["SHADOWPCF"+u]=!1,i["SHADOWPCSS"+u]=!1,i["SHADOWPOISSON"+u]=!1,i["SHADOWESM"+u]=!1,i["SHADOWCUBE"+u]=!1,i["SHADOWLOWQUALITY"+u]=!1,i["SHADOWMEDIUMQUALITY"+u]=!1);var f=e.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(a.needRebuild=!0),i.SHADOWFLOAT=a.shadowEnabled&&(f.textureFloatRender&&f.textureFloatLinearFiltering||f.textureHalfFloatRender&&f.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&i.rebuild(),a.needNormals},s.PrepareUniformsAndSamplersForLight=function(e,t,i,r,n){void 0===n&&(n=null),t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),n&&n.push("Light"+e),i.push("shadowSampler"+e),i.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),r&&(i.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e))},s.PrepareUniformsAndSamplersList=function(e,t,i,r){var n;void 0===r&&(r=4);var o=null;e.uniformsNames?(n=e.uniformsNames,o=e.uniformBuffersNames,t=e.samplers,i=e.defines,r=e.maxSimultaneousLights||0):(n=e,t=t||[]);for(var s=0;s<r&&i["LIGHT"+s];s++)this.PrepareUniformsAndSamplersForLight(s,n,t,i["PROJECTEDLIGHTTEXTURE"+s],o);i.NUM_MORPH_INFLUENCERS&&n.push("morphTargetInfluences")},s.HandleFallbacksForShadows=function(e,t,i,r){void 0===i&&(i=4),void 0===r&&(r=0);for(var n=0,o=0;o<i&&e["LIGHT"+o];o++)0<o&&(n=r+o,t.addFallback(n,"LIGHT"+o)),e.SHADOWS||(e["SHADOW"+o]&&t.addFallback(r,"SHADOW"+o),e["SHADOWPCF"+o]&&t.addFallback(r,"SHADOWPCF"+o),e["SHADOWPCSS"+o]&&t.addFallback(r,"SHADOWPCSS"+o),e["SHADOWPOISSON"+o]&&t.addFallback(r,"SHADOWPOISSON"+o),e["SHADOWESM"+o]&&t.addFallback(r,"SHADOWESM"+o));return n++},s.PrepareAttributesForMorphTargetsInfluencers=function(e,t,i){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=i,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)},s.PrepareAttributesForMorphTargets=function(e,t,i){var r=i.NUM_MORPH_INFLUENCERS;if(0<r&&u.a.LastCreatedEngine)for(var n=u.a.LastCreatedEngine.getCaps().maxVertexAttribs,o=t.morphTargetManager,s=o&&o.supportsNormals&&i.NORMAL,a=o&&o.supportsTangents&&i.TANGENT,h=o&&o.supportsUVs&&i.UV1,l=0;l<r;l++)e.push(f.b.PositionKind+l),s&&e.push(f.b.NormalKind+l),a&&e.push(f.b.TangentKind+l),h&&e.push(f.b.UVKind+"_"+l),e.length>n&&c.a.Error("Cannot add more vertex attributes for mesh "+t.name)},s.PrepareAttributesForBones=function(e,t,i,r){0<i.NUM_BONE_INFLUENCERS&&(r.addCPUSkinningFallback(0,t),e.push(f.b.MatricesIndicesKind),e.push(f.b.MatricesWeightsKind),4<i.NUM_BONE_INFLUENCERS&&(e.push(f.b.MatricesIndicesExtraKind),e.push(f.b.MatricesWeightsExtraKind)))},s.PrepareAttributesForInstances=function(e,t){t.INSTANCES&&this.PushAttributesForInstances(e)},s.PushAttributesForInstances=function(e){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3")},s.BindLightProperties=function(e,t,i){e.transferToEffect(t,i+"")},s.BindLight=function(e,t,i,r,n,o){void 0===o&&(o=!1),e._bindLight(t,i,r,n,o)},s.BindLights=function(e,t,i,r,n,o){void 0===n&&(n=4),void 0===o&&(o=!1);for(var s=Math.min(t.lightSources.length,n),a=0;a<s;a++){var h=t.lightSources[a];this.BindLight(h,a,e,i,"boolean"==typeof r?r:r.SPECULARTERM,o)}},s.BindFogParameters=function(e,t,i,r){void 0===r&&(r=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==n.Scene.FOGMODE_NONE&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),r?(e.fogColor.toLinearSpaceToRef(this._tempFogColor),i.setColor3("vFogColor",this._tempFogColor)):i.setColor3("vFogColor",e.fogColor))},s.BindBonesParameters=function(e,t){if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){var i=e.skeleton;if(i.isUsingTextureForMatrices&&-1<t.getUniformIndex("boneTextureWidth")){var r=i.getTransformMatrixTexture(e);t.setTexture("boneSampler",r),t.setFloat("boneTextureWidth",4*(i.bones.length+1))}else{var n=i.getTransformMatrices(e);n&&t.setMatrices("mBones",n)}}},s.BindMorphTargetParameters=function(e,t){var i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)},s.BindLogDepth=function(e,t,i){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(i.activeCamera.maxZ+1)/Math.LN2))},s.BindClipPlane=function(e,t){if(t.clipPlane){var i=t.clipPlane;e.setFloat4("vClipPlane",i.normal.x,i.normal.y,i.normal.z,i.d)}t.clipPlane2&&(i=t.clipPlane2,e.setFloat4("vClipPlane2",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane3&&(i=t.clipPlane3,e.setFloat4("vClipPlane3",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane4&&(i=t.clipPlane4,e.setFloat4("vClipPlane4",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane5&&(i=t.clipPlane5,e.setFloat4("vClipPlane5",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane6&&(i=t.clipPlane6,e.setFloat4("vClipPlane6",i.normal.x,i.normal.y,i.normal.z,i.d))},s._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},s._tempFogColor=r.a.Black(),s);function s(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return g});var o,r=i(1),l=i(3),s=i(28),a=i(13),h=i(4),c=i(0),u=i(34),n=i(11),f=i(10),d=i(8),p=i(52),_=i(50),g=(o=u.a,Object(r.c)(m,o),Object.defineProperty(m.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),m.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},m.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},m.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},m.prototype.getClassName=function(){return"Camera"},m.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},Object.defineProperty(m.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),m.prototype.getActiveMeshes=function(){return this._activeMeshes},m.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},m.prototype.isReady=function(e){if(void 0===e&&(e=!1),e)for(var t=0,i=this._postProcesses;t<i.length;t++){var r=i[t];if(r&&!r.isReady())return!1}return o.prototype.isReady.call(this,e)},m.prototype._initCache=function(){o.prototype._initCache.call(this),this._cache.position=new c.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new c.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},m.prototype._updateCache=function(e){e||o.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},m.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},m.prototype._isSynchronizedViewMatrix=function(){return!!o.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},m.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===m.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},m.prototype.attachControl=function(e,t){},m.prototype.detachControl=function(e){},m.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==m.RIG_MODE_NONE&&this._updateRigCameras()},m.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(m.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),m.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null},m.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var t=0,i=this._rigCameras.length;t<i;t++){var r=this._rigCameras[t],n=r._rigPostProcess;n?("pass"===n.getEffectName()&&(r.isIntermediate=0===this._postProcesses.length),r._postProcesses=this._postProcesses.slice(0).concat(n),n.markTextureDirty()):r._postProcesses=this._postProcesses.slice(0)}},m.prototype.attachPostProcess=function(e,t){return void 0===t&&(t=null),!e.isReusable()&&-1<this._postProcesses.indexOf(e)?(n.a.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(e))},m.prototype.detachPostProcess=function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._cascadePostProcessesToRigCams()},m.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},m.prototype._getViewMatrix=function(){return c.a.Identity()},m.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},m.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)},m.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},m.prototype.getProjectionMatrix=function(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var t=this.getEngine(),i=this.getScene();if(this.mode===m.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var r=t.useReverseDepthBuffer;(i.useRightHandedSystem?r?c.a.PerspectiveFovReverseRHToRef:c.a.PerspectiveFovRHToRef:r?c.a.PerspectiveFovReverseLHToRef:c.a.PerspectiveFovLHToRef)(this.fov,t.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===m.FOVMODE_VERTICAL_FIXED)}else{var n=t.getRenderWidth()/2,o=t.getRenderHeight()/2;i.useRightHandedSystem?c.a.OrthoOffCenterRHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix):c.a.OrthoOffCenterLHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},m.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},m.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?_.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=_.a.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},m.prototype.isInFrustum=function(t,e){if(void 0===e&&(e=!1),this._updateFrustumPlanes(),e&&0<this.rigCameras.length){var i=!1;return this.rigCameras.forEach(function(e){e._updateFrustumPlanes(),i=i||t.isInFrustum(e._frustumPlanes)}),i}return t.isInFrustum(this._frustumPlanes)},m.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},m.prototype.getForwardRay=function(e,t,i){throw void 0===e&&(e=100),d.a.WarnImport("Ray")},m.prototype.dispose=function(e,t){for(void 0===t&&(t=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);0<this._rigCameras.length;){var i=this._rigCameras.pop();i&&i.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==m.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var r=this._postProcesses.length;0<=--r;){var n=this._postProcesses[r];n&&n.dispose(this)}for(r=this.customRenderTargets.length;0<=--r;)this.customRenderTargets[r].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),o.prototype.dispose.call(this,e,t)},Object.defineProperty(m.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),m.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},m.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},m.prototype.setCameraRigMode=function(e,t){if(this.cameraRigMode!==e){for(;0<this._rigCameras.length;){var i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==m.RIG_MODE_NONE){var r=this.createRigCamera(this.name+"_L",0);r&&(r._isLeftCamera=!0);var n=this.createRigCamera(this.name+"_R",1);n&&(n._isRightCamera=!0),r&&n&&(this._rigCameras.push(r),this._rigCameras.push(n))}switch(this.cameraRigMode){case m.RIG_MODE_STEREOSCOPIC_ANAGLYPH:m._setStereoscopicAnaglyphRigMode(this);break;case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case m.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.RIG_MODE_STEREOSCOPIC_INTERLACED:m._setStereoscopicRigMode(this);break;case m.RIG_MODE_VR:m._setVRRigMode(this,t);break;case m.RIG_MODE_WEBVR:m._setWebVRRigMode(this,t)}this._cascadePostProcessesToRigCams(),this.update()}},m._setStereoscopicRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},m._setStereoscopicAnaglyphRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},m._setVRRigMode=function(e,t){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},m._setWebVRRigMode=function(e,t){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},m.prototype._getVRProjectionMatrix=function(){return c.a.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},m.prototype._updateCameraRotationMatrix=function(){},m.prototype._updateWebVRCameraRotationMatrix=function(){},m.prototype._getWebVRProjectionMatrix=function(){return c.a.Identity()},m.prototype._getWebVRViewMatrix=function(){return c.a.Identity()},m.prototype.setCameraRigParameter=function(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=a.b.ToRadians(t/.0637))},m.prototype.createRigCamera=function(e,t){return null},m.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},m.prototype._setupInputs=function(){},m.prototype.serialize=function(){var e=l.a.Serialize(this);return e.type=this.getClassName(),this.parent&&(e.parentId=this.parent.id),this.inputs&&this.inputs.serialize(e),l.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},m.prototype.clone=function(e){return l.a.Clone(m.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},m.prototype.getDirection=function(e){var t=c.e.Zero();return this.getDirectionToRef(e,t),t},Object.defineProperty(m.prototype,"absoluteRotation",{get:function(){var e=c.b.Zero();return this.getWorldMatrix().decompose(void 0,e),e},enumerable:!0,configurable:!0}),m.prototype.getDirectionToRef=function(e,t){c.e.TransformNormalToRef(e,this.getWorldMatrix(),t)},m.GetConstructorFromName=function(e,t,i,r,n){void 0===r&&(r=0),void 0===n&&(n=!0);var o=u.a.Construct(e,t,i,{interaxial_distance:r,isStereoscopicSideBySide:n});return o||function(){return m._createDefaultParsedCamera(t,i)}},m.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},m.Parse=function(e,t){var i=e.type,r=m.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),n=l.a.Parse(r,e,t);if(e.parentId&&(n._waitingParentId=e.parentId),n.inputs&&(n.inputs.parse(e),n._setupInputs()),n.setPosition&&(n.position.copyFromFloats(0,0,0),n.setPosition(c.e.FromArray(e.position))),e.target&&n.setTarget&&n.setTarget(c.e.FromArray(e.target)),e.cameraRigMode){var o=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};n.setCameraRigMode(e.cameraRigMode,o)}if(e.animations){for(var s=0;s<e.animations.length;s++){var a=e.animations[s],h=f.a.GetClass("BABYLON.Animation");h&&n.animations.push(h.Parse(a))}u.a.ParseAnimationRanges(n,e,t)}return e.autoAnimate&&t.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),n},m._createDefaultParsedCamera=function(e,t){throw d.a.WarnImport("UniversalCamera")},m.PERSPECTIVE_CAMERA=0,m.ORTHOGRAPHIC_CAMERA=1,m.FOVMODE_VERTICAL_FIXED=0,m.FOVMODE_HORIZONTAL_FIXED=1,m.RIG_MODE_NONE=0,m.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,m.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,m.RIG_MODE_STEREOSCOPIC_INTERLACED=14,m.RIG_MODE_VR=20,m.RIG_MODE_WEBVR=21,m.RIG_MODE_CUSTOM=22,m.ForceAttachControlToAlwaysPreventDefault=!1,Object(r.b)([Object(l.k)("position")],m.prototype,"_position",void 0),Object(r.b)([Object(l.k)()],m.prototype,"upVector",void 0),Object(r.b)([Object(l.c)()],m.prototype,"orthoLeft",void 0),Object(r.b)([Object(l.c)()],m.prototype,"orthoRight",void 0),Object(r.b)([Object(l.c)()],m.prototype,"orthoBottom",void 0),Object(r.b)([Object(l.c)()],m.prototype,"orthoTop",void 0),Object(r.b)([Object(l.c)()],m.prototype,"fov",void 0),Object(r.b)([Object(l.c)()],m.prototype,"minZ",void 0),Object(r.b)([Object(l.c)()],m.prototype,"maxZ",void 0),Object(r.b)([Object(l.c)()],m.prototype,"inertia",void 0),Object(r.b)([Object(l.c)()],m.prototype,"mode",void 0),Object(r.b)([Object(l.c)()],m.prototype,"layerMask",void 0),Object(r.b)([Object(l.c)()],m.prototype,"fovMode",void 0),Object(r.b)([Object(l.c)()],m.prototype,"cameraRigMode",void 0),Object(r.b)([Object(l.c)()],m.prototype,"interaxialDistance",void 0),Object(r.b)([Object(l.c)()],m.prototype,"isStereoscopicSideBySide",void 0),m);function m(e,t,i,r){void 0===r&&(r=!0);var n=o.call(this,e,i)||this;return n._position=c.e.Zero(),n.upVector=c.e.Up(),n.orthoLeft=null,n.orthoRight=null,n.orthoBottom=null,n.orthoTop=null,n.fov=.8,n.minZ=1,n.maxZ=1e4,n.inertia=.9,n.mode=m.PERSPECTIVE_CAMERA,n.isIntermediate=!1,n.viewport=new p.a(0,0,1,1),n.layerMask=268435455,n.fovMode=m.FOVMODE_VERTICAL_FIXED,n.cameraRigMode=m.RIG_MODE_NONE,n.customRenderTargets=new Array,n.outputRenderTarget=null,n.onViewMatrixChangedObservable=new h.a,n.onProjectionMatrixChangedObservable=new h.a,n.onAfterCheckInputsObservable=new h.a,n.onRestoreStateObservable=new h.a,n.isRigCamera=!1,n._rigCameras=new Array,n._webvrViewMatrix=c.a.Identity(),n._skipRendering=!1,n._projectionMatrix=new c.a,n._postProcesses=new Array,n._activeMeshes=new s.a(256),n._globalPosition=c.e.Zero(),n._computedViewMatrix=c.a.Identity(),n._doNotComputeProjectionMatrix=!1,n._transformMatrix=c.a.Zero(),n._refreshFrustumPlanes=!0,n._isCamera=!0,n._isLeftCamera=!1,n._isRightCamera=!1,n.getScene().addCamera(n),r&&!n.getScene().activeCamera&&(n.getScene().activeCamera=n),n.position=t,n}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=(l.Eval=function(e,t){return"true"===(e=e.match(/\([^\(\)]*\)/g)?e.replace(/\([^\(\)]*\)/g,function(e){return e=e.slice(1,e.length-1),l._HandleParenthesisContent(e,t)}):l._HandleParenthesisContent(e,t))||"false"!==e&&l.Eval(e,t)},l._HandleParenthesisContent=function(e,t){var i;t=t||function(e){return"true"===e};var r=e.split("||");for(var n in r)if(r.hasOwnProperty(n)){var o=l._SimplifyNegation(r[n].trim()),s=o.split("&&");if(1<s.length)for(var a=0;a<s.length;++a){var h=l._SimplifyNegation(s[a].trim());if(!(i="true"!==h&&"false"!==h?"!"===h[0]?!t(h.substring(1)):t(h):"true"===h)){o="false";break}}if(i||"true"===o){i=!0;break}i="true"!==o&&"false"!==o?"!"===o[0]?!t(o.substring(1)):t(o):"true"===o}return i?"true":"false"},l._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},l);function l(){}var n=(o.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return o.HasTags(t)},t.addTags=function(e){return o.AddTagsTo(t,e)},t.removeTags=function(e){return o.RemoveTagsFrom(t,e)},t.matchesTagsQuery=function(e){return o.MatchesQuery(t,e)}},o.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},o.HasTags=function(e){if(!e._tags)return!1;var t=e._tags;for(var i in t)if(t.hasOwnProperty(i))return!0;return!1},o.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var i=[];for(var r in e._tags)e._tags.hasOwnProperty(r)&&!0===e._tags[r]&&i.push(r);return i.join(" ")}return e._tags},o.AddTagsTo=function(r,e){e&&"string"==typeof e&&e.split(" ").forEach(function(e,t,i){o._AddTagTo(r,e)})},o._AddTagTo=function(e,t){""!==(t=t.trim())&&"true"!==t&&"false"!==t&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(o.EnableFor(e),e._tags[t]=!0))},o.RemoveTagsFrom=function(e,t){if(o.HasTags(e)){var i=t.split(" ");for(var r in i)o._RemoveTagFrom(e,i[r])}},o._RemoveTagFrom=function(e,t){delete e._tags[t]},o.MatchesQuery=function(t,e){return void 0===e||(""===e?o.HasTags(t):r.Eval(e,function(e){return o.HasTags(t)&&t._tags[e]}))},o);function o(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return a});var r=i(1),n=(o.NAME_EFFECTLAYER="EffectLayer",o.NAME_LAYER="Layer",o.NAME_LENSFLARESYSTEM="LensFlareSystem",o.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",o.NAME_PARTICLESYSTEM="ParticleSystem",o.NAME_GAMEPAD="Gamepad",o.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",o.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",o.NAME_DEPTHRENDERER="DepthRenderer",o.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",o.NAME_SPRITE="Sprite",o.NAME_OUTLINERENDERER="Outline",o.NAME_PROCEDURALTEXTURE="ProceduralTexture",o.NAME_SHADOWGENERATOR="ShadowGenerator",o.NAME_OCTREE="Octree",o.NAME_PHYSICSENGINE="PhysicsEngine",o.NAME_AUDIO="Audio",o.STEP_ISREADYFORMESH_EFFECTLAYER=0,o.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,o.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,o.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,o.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,o.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,o.STEP_BEFORECAMERADRAW_LAYER=1,o.STEP_BEFORERENDERTARGETDRAW_LAYER=0,o.STEP_BEFORERENDERINGMESH_OUTLINE=0,o.STEP_AFTERRENDERINGMESH_OUTLINE=0,o.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,o.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,o.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,o.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,o.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,o.STEP_AFTERRENDERTARGETDRAW_LAYER=0,o.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,o.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,o.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,o.STEP_AFTERCAMERADRAW_LAYER=3,o.STEP_AFTERRENDER_AUDIO=0,o.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,o.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,o.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,o.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,o.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,o.STEP_POINTERMOVE_SPRITE=0,o.STEP_POINTERDOWN_SPRITE=0,o.STEP_POINTERUP_SPRITE=0,o);function o(){}var s,a=(s=Array,Object(r.c)(h,s),h.Create=function(){return Object.create(h.prototype)},h.prototype.registerStep=function(e,t,i){var r=0;for(Number.MAX_VALUE;r<this.length&&!(e<this[r].index);r++);this.splice(r,0,{index:e,component:t,action:i.bind(t)})},h.prototype.clear=function(){this.length=0},h);function h(e){return s.apply(this,e)||this}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(Object.defineProperty(n,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),n.Instances=new Array,n._LastCreatedScene=null,n.UseFallbackTexture=!0,n.FallbackTexture="",n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return d});var C=i(23),f=i(6),c=i(8),x=i(4),T=(Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},r.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},r);function r(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}var M=(Object.defineProperty(n.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),n.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=n.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=n.KEEP,this._stencilOpDepthFail=n.KEEP,this._stencilOpStencilDepthPass=n.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},n.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},n.ALWAYS=519,n.KEEP=7680,n.REPLACE=7681,n);function n(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}var E=(Object.defineProperty(o.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),o.prototype.setAlphaBlendConstants=function(e,t,i,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)},o.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},o.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},o.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},o.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},o);function o(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}var S=i(38),A=i(11),O=i(25),P=(s.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},s.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},s.prototype.postProcessor=function(e,t,i){var r=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},s);function s(){}var a=i(51),h=(Object.defineProperty(l.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),l.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},l);function l(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}var u=i(53),R=function(){},d=(Object.defineProperty(I,"NpmPackage",{get:function(){return"babylonjs@4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(I,"Version",{get:function(){return"4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ShadersRepository",{get:function(){return f.a.ShadersRepository},set:function(e){f.a.ShadersRepository=e},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"supportsUniformBuffers",{get:function(){return 1<this.webGLVersion&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),I.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},I.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)this._compiledEffects[e]._prepareEffect();f.a.ResetCache()},I.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},I.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++)t[e]._rebuild()},I.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:1<this._webGLVersion?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:1<this._webGLVersion||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:1<this._webGLVersion||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:1<this._webGLVersion||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:1<this._webGLVersion&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(1<this._webGLVersion||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(1<this._webGLVersion||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(1<this._webGLVersion||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=0<this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(1<this._webGLVersion||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),1<this._webGLVersion&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),1<this._webGLVersion)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(1<this._webGLVersion)this._caps.depthTextureExtension=!0;else{var r=this._gl.getExtension("WEBGL_depth_texture");null!=r&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=r.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(1<this._webGLVersion)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n))}if(1<this._webGLVersion)this._caps.instancedArrays=!0;else{var o=this._gl.getExtension("ANGLE_instanced_arrays");null!=o?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=o.drawArraysInstancedANGLE.bind(o),this._gl.drawElementsInstanced=o.drawElementsInstancedANGLE.bind(o),this._gl.vertexAttribDivisor=o.vertexAttribDivisorANGLE.bind(o)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var s=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);s&&a&&(this._caps.highPrecisionShaderSupported=0!==s.precision&&0!==a.precision)}if(1<this._webGLVersion)this._caps.blendMinMax=!0;else{var h=this._gl.getExtension("EXT_blend_minmax");null!=h&&(this._caps.blendMinMax=!0,this._gl.MAX=h.MAX_EXT,this._gl.MIN=h.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var l=0;l<this._maxSimultaneousTextures;l++)this._nextFreeTextureSlots.push(l)},Object.defineProperty(I.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),I.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(I.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),I.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=u.a.CreateCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},I.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},I.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},I.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},I.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},I.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},I.prototype.getCaps=function(){return this._caps},I.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);0<=t&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},I.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}0<this._activeRenderLoops.length?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},I.prototype.getRenderingCanvas=function(){return this._renderingCanvas},I.prototype.getHostWindow=function(){return O.a.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},I.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},I.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},I.prototype._queueNewFrame=function(e,t){return I.QueueNewFrame(e,t)},I.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},I.prototype.clear=function(e,t,i,r){void 0===r&&(r=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},I.prototype._viewport=function(e,t,i,r){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=r,this._gl.viewport(e,t,i,r))},I.prototype.setViewport=function(e,t,i){var r=t||this.getRenderWidth(),n=i||this.getRenderHeight(),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._viewport(o*r,s*n,r*e.width,n*e.height)},I.prototype.beginFrame=function(){},I.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},I.prototype.resize=function(){var e,t;t=O.a.IsWindowObjectExist()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},I.prototype.setSize=function(e,t){this._renderingCanvas&&(e|=0,t|=0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t))},I.prototype.bindFramebuffer=function(e,t,i,r,n,o,s){void 0===t&&(t=0),void 0===o&&(o=0),void 0===s&&(s=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var a=this._gl;e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,e._webGLTexture,o,s):e.isCube&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,o);var h=e._depthStencilTexture;if(h){var l=h._generateStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,l,h._webGLTexture,o,s):e.isCube?a.framebufferTexture2D(a.FRAMEBUFFER,l,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,h._webGLTexture,o):a.framebufferTexture2D(a.FRAMEBUFFER,l,a.TEXTURE_2D,h._webGLTexture,o)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,r):(i||(i=e.width,o&&(i/=Math.pow(2,o))),r||(r=e.height,o&&(r/=Math.pow(2,o))),this._viewport(0,0,i,r)),this.wipeCaches()},I.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},I.prototype.unBindFramebuffer=function(e,t,i){void 0===t&&(t=!1),this._currentRenderTarget=null;var r=this._gl;e._MSAAFramebuffer&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,e._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e._framebuffer),r.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(r.TEXTURE_2D,e,!0),r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null)),i&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),i()),this._bindUnboundFramebuffer(null)},I.prototype.flushFramebuffer=function(){this._gl.flush()},I.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},I.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},I.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},I.prototype._createVertexBuffer=function(e,t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");var r=new a.a(i);return this.bindArrayBuffer(r),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),r.references=1,r},I.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},I.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},I.prototype.createIndexBuffer=function(e,t){var i=this._gl.createBuffer(),r=new a.a(i);if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(r);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=4===n.BYTES_PER_ELEMENT,r},I.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(65535<=e[t])return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},I.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},I.prototype.bindUniformBlock=function(e,t,i){var r=e.program,n=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,n,i)},I.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},I.prototype.bindBuffer=function(e,t){!this._vaoRecordInProgress&&this._currentBoundBuffer[t]===e||(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},I.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},I.prototype._vertexAttribPointer=function(e,t,i,r,n,o,s){var a=this._currentBufferPointers[t],h=!1;a.active?(a.buffer!==e&&(a.buffer=e,h=!0),a.size!==i&&(a.size=i,h=!0),a.type!==r&&(a.type=r,h=!0),a.normalized!==n&&(a.normalized=n,h=!0),a.stride!==o&&(a.stride=o,h=!0),a.offset!==s&&(a.offset=s,h=!0)):(h=!0,a.active=!0,a.index=t,a.size=i,a.type=r,a.normalized=n,a.stride=o,a.offset=s,a.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,r,n,o,s))},I.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},I.prototype._bindVertexBuffersAttributes=function(e,t){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var r=0;r<i.length;r++){var n=t.getAttributeLocation(r);if(0<=n){var o=e[i[r]];if(!o)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var s=o.getBuffer();s&&(this._vertexAttribPointer(s,n,o.getSize(),o.type,o.normalized,o.byteStride,o.byteOffset),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(s))))}}},I.prototype.recordVertexArrayObject=function(e,t,i){var r=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(r),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),r},I.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},I.prototype.bindBuffersDirectly=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e;var o=(this._cachedEffectForVertexBuffers=n).getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s=0,a=0;a<o;a++)if(a<i.length){var h=n.getAttributeLocation(a);0<=h&&(this._gl.enableVertexAttribArray(h),this._vertexAttribArraysEnabled[h]=!0,this._vertexAttribPointer(e,h,i[a],this._gl.FLOAT,!1,r,s)),s+=4*i[a]}}this._bindIndexBufferWithCache(t)},I.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},I.prototype.bindBuffers=function(e,t,i){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i)),this._bindIndexBufferWithCache(t)},I.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var r=this._currentInstanceBuffers[t];e!=r&&r.references&&(e=r,this.bindArrayBuffer(r));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},I.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},I.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},I.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},I.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(var r=0;r<4;r++){var n=i[r];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*r),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},I.prototype.bindInstancesBuffer=function(e,t,i){void 0===i&&(i=!0),this.bindArrayBuffer(e);var r=0;if(i)for(var n=0;n<t.length;n++)r+=4*(o=t[n]).attributeSize;for(n=0;n<t.length;n++){var o;void 0===(o=t[n]).index&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,r,o.offset),this._gl.vertexAttribDivisor(o.index,void 0===o.divisor?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e)}},I.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},I.prototype.disableInstanceAttribute=function(e){for(var t,i=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,t=this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},I.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},I.prototype.draw=function(e,t,i,r){this.drawElementsType(e?0:1,t,i,r)},I.prototype.drawPointClouds=function(e,t,i){this.drawArraysType(2,e,t,i)},I.prototype.drawUnIndexed=function(e,t,i,r){this.drawArraysType(e?0:1,t,i,r)},I.prototype.drawElementsType=function(e,t,i,r){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,s=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(n,i,o,t*s,r):this._gl.drawElements(n,i,o,t*s)},I.prototype.drawArraysType=function(e,t,i,r){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);r?this._gl.drawArraysInstanced(n,t,i,r):this._gl.drawArrays(n,t,i)},I.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},I.prototype._reportDrawCall=function(){},I.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},I.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},I.prototype.createEffect=function(e,t,i,r,n,o,s,a,h){var l=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(n||t.defines);if(this._compiledEffects[l]){var c=this._compiledEffects[l];return s&&c.isReady()&&s(c),c}var u=new f.a(e,t,i,r,this,n,o,s,a,h);return u._key=l,this._compiledEffects[l]=u},I._ConcatenateShader=function(e,t,i){return void 0===i&&(i=""),i+(t?t+"\n":"")+e},I.prototype._compileShader=function(e,t,i,r){return this._compileRawShader(I._ConcatenateShader(e,i,r),t)},I.prototype._compileRawShader=function(e,t){var i=this._gl,r=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!r)throw new Error("Something went wrong while compile the shader.");return i.shaderSource(r,e),i.compileShader(r),r},I.prototype.createRawShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null),r=r||this._gl;var o=this._compileRawShader(t,"vertex"),s=this._compileRawShader(i,"fragment");return this._createShaderProgram(e,o,s,r,n)},I.prototype.createShaderProgram=function(e,t,i,r,n,o){void 0===o&&(o=null),n=n||this._gl;var s=1<this._webGLVersion?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",r,s),h=this._compileShader(i,"fragment",r,s);return this._createShaderProgram(e,a,h,n,o)},I.prototype.createPipelineContext=function(){var e=new h;return(e.engine=this)._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},I.prototype._createShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null);var o=r.createProgram();if(!(e.program=o))throw new Error("Unable to create program");return r.attachShader(o,t),r.attachShader(o,i),r.linkProgram(o),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),o},I.prototype._finalizePipelineContext=function(e){var t=e.context,i=e.vertexShader,r=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var o,s;if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(i)))throw e.vertexCompilationError=o,new Error("VERTEX SHADER "+o);if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(r)))throw e.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o);if(s=t.getProgramInfoLog(n))throw e.programLinkError=s,new Error(s)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS)&&(s=t.getProgramInfoLog(n))))throw e.programValidationError=s,new Error(s);t.deleteShader(i),t.deleteShader(r),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},I.prototype._preparePipelineContext=function(e,t,i,r,n,o,s){var a=e;a.program=r?this.createRawShaderProgram(a,t,i,void 0,s):this.createShaderProgram(a,t,i,o,void 0,s),a.program.__SPECTOR_rebuildProgram=n},I.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},I.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var i=e;if(i.isParallelCompiled){var r=i.onCompiled;i.onCompiled=r?function(){r(),t()}:t}else t()},I.prototype.getUniforms=function(e,t){for(var i=new Array,r=e,n=0;n<t.length;n++)i.push(this._gl.getUniformLocation(r.program,t[n]));return i},I.prototype.getAttributes=function(e,t){for(var i=[],r=e,n=0;n<t.length;n++)try{i.push(this._gl.getAttribLocation(r.program,t[n]))}catch(e){i.push(-1)}return i},I.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),(this._currentEffect=e).onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},I.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},I.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},I.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},I.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},I.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},I.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},I.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},I.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},I.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},I.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},I.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},I.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},I.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},I.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},I.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},I.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},I.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},I.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},I.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(I.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!0,configurable:!0}),I.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},I.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},I.prototype._getSamplingParameters=function(e,t){var i=this._gl,r=i.NEAREST,n=i.NEAREST;switch(e){case 11:r=i.LINEAR,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:r=i.LINEAR,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:r=i.NEAREST,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:r=i.NEAREST,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:r=i.NEAREST,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:r=i.NEAREST,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:r=i.NEAREST,n=i.LINEAR;break;case 1:r=i.NEAREST,n=i.NEAREST;break;case 9:r=i.LINEAR,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:r=i.LINEAR,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:r=i.LINEAR,n=i.LINEAR;break;case 12:r=i.LINEAR,n=i.NEAREST}return{min:n,mag:r}},I.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},I.prototype.createTexture=function(e,i,t,l,s,r,n,o,a,c,h,u){var f=this;void 0===s&&(s=3),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===c&&(c=null),void 0===h&&(h=null);for(var d=String(e),p="data:"===d.substr(0,5),_="blob:"===d.substr(0,5),g=p&&-1!==d.indexOf(";base64,"),m=a||new S.a(this,S.b.Url),v=d.lastIndexOf("."),b=h||(-1<v?d.substring(v).toLowerCase():""),y=null,x=0,T=I._TextureLoaders;x<T.length;x++){var M=T[x];if(M.canLoad(b)){y=M;break}}l&&l._addPendingData(m),m.url=d,m.generateMipMaps=!i,m.samplingMode=s,m.invertY=t,this._doNotHandleContextLost||(m._buffer=o);var E=null;function A(e,t){l&&l._removePendingData(m),E&&m.onLoadedObservable.remove(E),C.a.UseFallbackTexture?f.createTexture(C.a.FallbackTexture,i,m.invertY,l,s,null,n,o,m):n&&n(e||"Unknown error",t)}if(r&&!a&&(E=m.onLoadedObservable.add(r)),a||this._internalTexturesCache.push(m),y){var O=function(e){y.loadData(e,m,function(e,t,i,r,n,o){o?A("TextureLoader failed to load data"):f._prepareWebGLTexture(m,l,e,t,m.invertY,!i,r,function(){return n(),!1},s)})};o?o instanceof ArrayBuffer?O(new Uint8Array(o)):ArrayBuffer.isView(o)?O(o):n&&n("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(d,function(e){return O(new Uint8Array(e))},void 0,l?l.offlineProvider:void 0,!0,function(e,t){A("Unable to load "+(e&&e.responseURL,t))})}else{var P=function(h){_&&!f._doNotHandleContextLost&&(m._buffer=h),f._prepareWebGLTexture(m,l,h.width,h.height,m.invertY,i,!1,function(e,t,i){var r=f._gl,n=h.width===e&&h.height===t,o=c?f._getInternalFormat(c):".jpg"===b?r.RGB:r.RGBA;if(n)return r.texImage2D(r.TEXTURE_2D,0,o,o,r.UNSIGNED_BYTE,h),!1;var s=f._caps.maxTextureSize;if(h.width>s||h.height>s||!f._supportsHardwareTextureRescaling)return f._prepareWorkingCanvas(),f._workingCanvas&&f._workingContext&&(f._workingCanvas.width=e,f._workingCanvas.height=t,f._workingContext.drawImage(h,0,0,h.width,h.height,0,0,e,t),r.texImage2D(r.TEXTURE_2D,0,o,o,r.UNSIGNED_BYTE,f._workingCanvas),m.width=e,m.height=t),!1;var a=new S.a(f,S.b.Temp);return f._bindTextureDirectly(r.TEXTURE_2D,a,!0),r.texImage2D(r.TEXTURE_2D,0,o,o,r.UNSIGNED_BYTE,h),f._rescaleTexture(a,m,l,o,function(){f._releaseTexture(a),f._bindTextureDirectly(r.TEXTURE_2D,m,!0),i()}),!0},s)};!p||g?o&&(o.decoding||o.close)?P(o):I._FileToolsLoadImage(d,P,A,l?l.offlineProvider:null,u):"string"==typeof o||o instanceof ArrayBuffer||ArrayBuffer.isView(o)||o instanceof Blob?I._FileToolsLoadImage(o,P,A,l?l.offlineProvider:null,u):o&&P(o)}return m},I._FileToolsLoadImage=function(e,t,i,r,n){throw c.a.WarnImport("FileTools")},I.prototype._rescaleTexture=function(e,t,i,r,n){},I.prototype.createRawTexture=function(e,t,i,r,n,o,s,a,h){throw void 0===a&&(a=null),void 0===h&&(h=0),c.a.WarnImport("Engine.RawTexture")},I.prototype.createRawCubeTexture=function(e,t,i,r,n,o,s,a){throw void 0===a&&(a=null),c.a.WarnImport("Engine.RawTexture")},I.prototype.createRawTexture3D=function(e,t,i,r,n,o,s,a,h,l){throw void 0===h&&(h=null),void 0===l&&(l=0),c.a.WarnImport("Engine.RawTexture")},I.prototype.createRawTexture2DArray=function(e,t,i,r,n,o,s,a,h,l){throw void 0===h&&(h=null),void 0===l&&(l=0),c.a.WarnImport("Engine.RawTexture")},I.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},I.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},I.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},I.prototype.updateTextureSamplingMode=function(e,t,i){void 0===i&&(i=!1);var r=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||i);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,n.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),t.samplingMode=e},I.prototype.updateTextureWrappingMode=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),e),e._cachedWrapR=r),this._bindTextureDirectly(n,null)},I.prototype._setupDepthStencilTexture=function(e,t,i,r,n){var o=t.width||t,s=t.height||t,a=t.layers||0;e.baseWidth=o,e.baseHeight=s,e.width=o,e.height=s,e.is2DArray=0<a,e.depth=a,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=i,e.samplingMode=r?2:1,e.type=0,e._comparisonFunction=n;var h=this._gl,l=this._getTextureTarget(e),c=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(l,h.TEXTURE_MAG_FILTER,c.mag),h.texParameteri(l,h.TEXTURE_MIN_FILTER,c.min),h.texParameteri(l,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(l,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),0===n?(h.texParameteri(l,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(l,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(l,h.TEXTURE_COMPARE_FUNC,n),h.texParameteri(l,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE))},I.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,r,n,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var a=this._gl,h=a.TEXTURE_2D;e.isCube&&(h=a.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._gl.compressedTexImage2D(h,s,t,i,r,0,n)},I.prototype._uploadDataToTextureDirectly=function(e,t,i,r,n,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=!1);var s=this._gl,a=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format),l=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format):this._getInternalFormat(n);this._unpackFlipY(e.invertY);var c=s.TEXTURE_2D;e.isCube&&(c=s.TEXTURE_CUBE_MAP_POSITIVE_X+i);var u=Math.round(Math.log(e.width)*Math.LOG2E),f=Math.round(Math.log(e.height)*Math.LOG2E),d=o?e.width:Math.pow(2,Math.max(u-r,0)),p=o?e.height:Math.pow(2,Math.max(f-r,0));s.texImage2D(c,r,l,d,p,0,h,a,t)},I.prototype.updateTextureData=function(e,t,i,r,n,o,s,a){void 0===s&&(s=0),void 0===a&&(a=0);var h=this._gl,l=this._getWebGLTextureType(e.type),c=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var u=h.TEXTURE_2D;e.isCube&&(u=h.TEXTURE_CUBE_MAP_POSITIVE_X+s),h.texSubImage2D(u,a,i,r,n,o,c,l,t)},I.prototype._uploadArrayBufferViewToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl,o=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,i,r),this._bindTextureDirectly(o,null,!0)},I.prototype._prepareWebGLTextureContinuation=function(e,t,i,r,n){var o=this._gl;if(o){var s=this._getSamplingParameters(n,!i);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s.min),i||r||o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},I.prototype._prepareWebGLTexture=function(e,t,i,r,n,o,s,a,h){var l=this;void 0===h&&(h=3);var c=this.getCaps().maxTextureSize,u=Math.min(c,this.needPOTTextures?I.GetExponentOfTwo(i,c):i),f=Math.min(c,this.needPOTTextures?I.GetExponentOfTwo(r,c):r),d=this._gl;d&&(e._webGLTexture?(this._bindTextureDirectly(d.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===n||!!n),e.baseWidth=i,e.baseHeight=r,e.width=u,e.height=f,e.isReady=!0,a(u,f,function(){l._prepareWebGLTextureContinuation(e,t,o,s,h)})||this._prepareWebGLTextureContinuation(e,t,o,s,h)):t&&t._removePendingData(e))},I.prototype._setupFramebufferDepthAttachments=function(e,t,i,r,n){void 0===n&&(n=1);var o=this._gl;if(e&&t)return this._getDepthStencilBuffer(i,r,n,o.DEPTH_STENCIL,o.DEPTH24_STENCIL8,o.DEPTH_STENCIL_ATTACHMENT);if(t){var s=o.DEPTH_COMPONENT16;return 1<this._webGLVersion&&(s=o.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(i,r,n,s,s,o.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(i,r,n,o.STENCIL_INDEX8,o.STENCIL_INDEX8,o.STENCIL_ATTACHMENT):null},I.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},I.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},I.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},I.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},I.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var i=e.getSamplers(),r=0;r<i.length;r++){var n=e.getUniform(i[r]);n&&(this._boundUniforms[r]=n)}this._currentEffect=null},I.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},I.prototype._bindTextureDirectly=function(e,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=!1,o=t&&-1<t._associatedChannel;return i&&o&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||r?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),(this._boundTexturesCache[this._activeChannel]=t)&&(t._associatedChannel=this._activeChannel)):i&&(n=!0,this._activateCurrentTexture()),o&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n},I.prototype._bindTexture=function(e,t){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},I.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),1<this.webGLVersion&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},I.prototype.setTexture=function(e,t,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))},I.prototype._bindSamplerUniformToChannel=function(e,t){var i=this._boundUniforms[e];i&&i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)},I.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},I.prototype._setTexture=function(e,t,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),1<this.webGLVersion&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var n;n=r?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!i&&n&&(n._associatedChannel=e);var o=!0;this._boundTexturesCache[e]===n&&(i||this._bindSamplerUniformToChannel(n._associatedChannel,e),o=!1),this._activeChannel=e;var s=this._getTextureTarget(n);if(o&&this._bindTextureDirectly(s,n,i),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==t.coordinatesMode){n._cachedCoordinatesMode=t.coordinatesMode;var a=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=a,t.wrapV=a}n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n.is3D&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(s,n,t.anisotropicFilteringLevel)}return!0},I.prototype.setTextureArray=function(e,t,i){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(var r=0;r<i.length;r++){var n=i[r].getInternalTexture();n?(this._textureUnits[r]=e+r,n._associatedChannel=e+r):this._textureUnits[r]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<i.length;o++)this._setTexture(this._textureUnits[o],i[o],!0)}},I.prototype._setAnisotropicLevel=function(e,t,i){var r=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),r&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)},I.prototype._setTextureParameterFloat=function(e,t,i,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,i)},I.prototype._setTextureParameterInteger=function(e,t,i,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,i)},I.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},I.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},I.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],O.a.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,f.a.ResetCache();for(var e=0,t=this._activeRequests;e<t.length;e++)t[e].abort()},I.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},I.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},I.prototype.getError=function(){return this._gl.getError()},I.prototype._canRenderToFloatFramebuffer=function(){return 1<this._webGLVersion?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},I.prototype._canRenderToHalfFloatFramebuffer=function(){return 1<this._webGLVersion?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},I.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i=!0,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if((i=(i=i&&o===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);var s=t.RGBA,a=t.UNSIGNED_BYTE,h=new Uint8Array(4);t.readPixels(0,0,1,1,s,a,h),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(r),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i},I.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},I.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=this._gl.RGB;break;case 5:t=this._gl.RGBA}if(1<this._webGLVersion)switch(e){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER}return t},I.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},I.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},I.prototype._loadFile=function(e,t,i,r,n,o){var s=this,a=I._FileToolsLoadFile(e,t,i,r,n,o);return this._activeRequests.push(a),a.onCompleteObservable.add(function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)}),a},I._FileToolsLoadFile=function(e,t,i,r,n,o){throw c.a.WarnImport("FileTools")},I.prototype.readPixels=function(e,t,i,r,n){void 0===n&&(n=!0);var o=n?4:3,s=n?this._gl.RGBA:this._gl.RGB,a=new Uint8Array(r*i*o);return this._gl.readPixels(e,t,i,r,s,this._gl.UNSIGNED_BYTE,a),a},I.isSupported=function(){if(null===this._isSupported)try{var e=u.a.CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._isSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._isSupported=!1}return this._isSupported},I.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},I.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},I.NearestPOT=function(e){var t=I.CeilingPOT(e),i=I.FloorPOT(e);return e-i<t-e?i:t},I.GetExponentOfTwo=function(e,t,i){var r;switch(void 0===i&&(i=2),i){case 1:r=I.FloorPOT(e);break;case 2:r=I.NearestPOT(e);break;case 3:default:r=I.CeilingPOT(e)}return Math.min(r,t)},I.QueueNewFrame=function(e,t){return O.a.IsWindowObjectExist()?(t=t||window).requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},I.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},I.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],I._TextureLoaders=[],I.CollisionsEpsilon=.001,I._isSupported=null,I);function I(e,t,i,r){var h=this;void 0===r&&(r=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new x.a,this.onContextRestoredObservable=new x.a,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new T,this._stencilState=new M,this._alphaState=new E,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new x.a,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(e,t,i,r,n,o){var s=h._gl,a=s.createRenderbuffer();return s.bindRenderbuffer(s.RENDERBUFFER,a),1<i&&s.renderbufferStorageMultisample?s.renderbufferStorageMultisample(s.RENDERBUFFER,i,n,e,t):s.renderbufferStorage(s.RENDERBUFFER,r,e,t),s.framebufferRenderbuffer(s.FRAMEBUFFER,o,s.RENDERBUFFER,a),s.bindRenderbuffer(s.RENDERBUFFER,null),a},this._boundUniforms={};var n=null;if(e){if(i=i||{},e.getContext){if(n=e,this._renderingCanvas=n,null!=t&&(i.antialias=t),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.timeStep&&(i.timeStep=1/60),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent)for(var o=navigator.userAgent,s=0,a=I.ExceptionList;s<a.length;s++){var l=a[s],c=l.key,u=l.targets;if(new RegExp(c).test(o)){if(l.capture&&l.captureConstraint){var f=l.capture,d=l.captureConstraint,p=new RegExp(f).exec(o);if(p&&0<p.length)if(d<=parseInt(p[p.length-1]))continue}for(var _=0,g=u;_<g.length;_++){switch(g[_]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),h._contextWasLost=!0,A.a.Warn("WebGL context lost."),h.onContextLostObservable.notifyObservers(h)},this._onContextRestored=function(){setTimeout(function(){h._initGLContext(),h._rebuildEffects(),h._rebuildInternalTextures(),h._rebuildBuffers(),h.wipeCaches(!0),A.a.Warn("WebGL context successfully restored."),h.onContextRestoredObservable.notifyObservers(h),h._contextWasLost=!1},0)},n.addEventListener("webglcontextlost",this._onContextLost,!1),n.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),!i.disableWebGL2Support)try{this._gl=n.getContext("webgl2",i)||n.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!n)throw new Error("The provided canvas is null or undefined.");try{this._gl=n.getContext("webgl",i)||n.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var m=this._gl.getContextAttributes();m&&(i.stencil=m.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var v=O.a.IsWindowObjectExist()&&window.devicePixelRatio||1,b=i.limitDeviceRatio||v;this._hardwareScalingLevel=r?1/Math.min(b,v):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext();for(var y=0;y<this._caps.maxVertexAttribs;y++)this._currentBufferPointers[y]=new R;1<this.webGLVersion&&(this._shaderProcessor=new P),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=i,console.log("Babylon.js v"+I.Version+" - "+this.description)}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.IsWindowObjectExist=function(){return"undefined"!=typeof window},n.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},n.GetDOMTextContent=function(e){for(var t="",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},n);function n(){}},function(e,t,i){"use strict";i.r(t),i.d(t,"Engine",function(){return v});var r=i(1),h=i(4),l=i(25),n=i(23),o=i(8),s=i(24),a=i(37),c=(u.prototype.sampleFrame=function(e){if(void 0===e&&(e=a.a.Now),this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(u.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),u.prototype.enable=function(){this._enabled=!0},u.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(u.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),u.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},u);function u(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new f(e)}var f=(d.prototype.add=function(e){var t;if(this.isSaturated()){var i=this._samples[this._pos];t=i-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(i-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},d.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},d.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},d.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},d.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},d);function d(e){this._samples=new Array(e),this.reset()}var p=i(54),_=i(51),g=i(11);s.a.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},s.a.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},s.a.prototype.getAlphaMode=function(){return this._alphaMode},s.a.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case 1:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case 2:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case 3:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case 4:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case 5:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=e}},s.a.prototype.getAlphaEquation=function(){return this._alphaEquation};var m,v=(m=s.a,Object(r.c)(b,m),Object.defineProperty(b,"NpmPackage",{get:function(){return s.a.NpmPackage},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Version",{get:function(){return s.a.Version},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Instances",{get:function(){return n.a.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LastCreatedEngine",{get:function(){return n.a.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LastCreatedScene",{get:function(){return n.a.LastCreatedScene},enumerable:!0,configurable:!0}),b.MarkAllMaterialsAsDirty=function(e,t){for(var i=0;i<b.Instances.length;i++)for(var r=b.Instances[i],n=0;n<r.scenes.length;n++)r.scenes[n].markAllMaterialsAsDirty(e,t)},b.DefaultLoadingScreenFactory=function(e){throw o.a.WarnImport("LoadingScreen")},Object.defineProperty(b.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!b._RescalePostProcessFactory},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),b.prototype.getInputElement=function(){return this._renderingCanvas},b.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},b.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},b.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},b.prototype.getTimeStep=function(){return 1e3*this._timeStep},b.prototype.generateMipMapsForCubemap=function(e,t){if(void 0===t&&(t=!0),e.generateMipMaps){var i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}},b.prototype.setState=function(e,t,i,r){void 0===t&&(t=0),void 0===r&&(r=!1),this._depthCullingState.cull===e&&!i||(this._depthCullingState.cull=e);var n=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;this._depthCullingState.cullFace===n&&!i||(this._depthCullingState.cullFace=n),this.setZOffset(t);var o=r?this._gl.CW:this._gl.CCW;this._depthCullingState.frontFace===o&&!i||(this._depthCullingState.frontFace=o)},b.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},b.prototype.getZOffset=function(){return this._depthCullingState.zOffset},b.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},b.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},b.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},b.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},b.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},b.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},b.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},b.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},b.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},b.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},b.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},b.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},b.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},b.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},b.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},b.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},b.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},b.prototype.setDirectViewport=function(e,t,i,r){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,r),n},b.prototype.scissorClear=function(e,t,i,r,n){this.enableScissor(e,t,i,r),this.clear(n,!0,!0,!0),this.disableScissor()},b.prototype.enableScissor=function(e,t,i,r){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,i,r)},b.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},b.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},b.prototype.initWebVR=function(){throw o.a.WarnImport("WebVRCamera")},b.prototype._prepareVRComponent=function(){},b.prototype._connectVREvents=function(e,t){},b.prototype._submitVRFrame=function(){},b.prototype.disableVR=function(){},b.prototype.isVRPresenting=function(){return!1},b.prototype._requestVRFrame=function(){},b.prototype._loadFileAsync=function(e,r,n){var o=this;return new Promise(function(t,i){o._loadFile(e,function(e){t(e)},void 0,r,n,function(e,t){i(t)})})},b.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},b.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},b.prototype.setDepthStencilTexture=function(e,t,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0):this._setTexture(e,null))},b.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},b.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},b.prototype._convertRGBtoRGBATextureData=function(e,t,i,r){var n;n=new(1===r?Float32Array:Uint32Array)(t*i*4);for(var o=0;o<t;o++)for(var s=0;s<i;s++){var a=3*(s*t+o),h=4*(s*t+o);n[0+h]=e[0+a],n[1+h]=e[1+a],n[2+h]=e[2+a],n[3+h]=1}return n},b.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var i=t[e];i.resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}m.prototype._rebuildBuffers.call(this)},b.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++)(0,this._activeRenderLoops[e])()},b.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}0<this._activeRenderLoops.length?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},b.prototype._renderViews=function(){return!1},b.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},b.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&b._RequestFullscreen(this._renderingCanvas))},b.prototype.exitFullscreen=function(){this.isFullscreen&&b._ExitFullscreen()},b.prototype.enterPointerlock=function(){this._renderingCanvas&&b._RequestPointerlock(this._renderingCanvas)},b.prototype.exitPointerlock=function(){b._ExitPointerlock()},b.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),m.prototype.beginFrame.call(this)},b.prototype.endFrame=function(){m.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},b.prototype.resize=function(){this.isVRPresenting()||m.prototype.resize.call(this)},b.prototype.setSize=function(e,t){if(this._renderingCanvas&&(m.prototype.setSize.call(this,e,t),this.scenes)){for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++)r.cameras[n]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},b.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0);var n=t.length||t.byteLength;void 0===r||n<=r&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,r):new Uint8Array(t.buffer,t.byteOffset+i,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},b.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),m.prototype._deletePipelineContext.call(this,e)},b.prototype.createShaderProgram=function(e,t,i,r,n,o){void 0===o&&(o=null),n=n||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var s=m.prototype.createShaderProgram.call(this,e,t,i,r,n,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),s},b.prototype._createShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null);var o=r.createProgram();if(!(e.program=o))throw new Error("Unable to create program");if(r.attachShader(o,t),r.attachShader(o,i),1<this.webGLVersion&&n){var s=this.createTransformFeedback();this.bindTransformFeedback(s),this.setTranformFeedbackVaryings(o,n),e.transformFeedback=s}return r.linkProgram(o),1<this.webGLVersion&&n&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),o},b.prototype._releaseTexture=function(t){m.prototype._releaseTexture.call(this,t),this.scenes.forEach(function(e){e.postProcesses.forEach(function(e){e._outputTexture==t&&(e._outputTexture=null)}),e.cameras.forEach(function(e){e._postProcesses.forEach(function(e){e&&e._outputTexture==t&&(e._outputTexture=null)})})})},b.prototype._rescaleTexture=function(t,i,r,n,o){var s=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var a=this.createRenderTargetTexture({width:i.width,height:i.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&b._RescalePostProcessFactory&&(this._rescalePostProcess=b._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){s._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};var e=r;(e=e||s.scenes[s.scenes.length-1]).postProcessManager.directRender([s._rescalePostProcess],a,!0),s._bindTextureDirectly(s._gl.TEXTURE_2D,i,!0),s._gl.copyTexImage2D(s._gl.TEXTURE_2D,0,n,0,0,i.width,i.height,0),s.unBindFramebuffer(a),s._releaseTexture(a),o&&o()})},b.prototype.getFps=function(){return this._fps},b.prototype.getDeltaTime=function(){return this._deltaTime},b.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},b.prototype._uploadImageToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl,o=this._getWebGLTextureType(e.type),s=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,s),h=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(h,e,!0),this._unpackFlipY(e.invertY);var l=n.TEXTURE_2D;e.isCube&&(l=n.TEXTURE_CUBE_MAP_POSITIVE_X+i),n.texImage2D(l,r,a,s,o,t),this._bindTextureDirectly(h,null,!0)},b.prototype.updateDynamicIndexBuffer=function(e,t,i){var r;void 0===i&&(i=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),r=t instanceof Uint16Array||t instanceof Uint32Array?t:new(e.is32Bits?Uint32Array:Uint16Array)(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},b.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var i=this._gl;if(t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(i.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),1<t&&i.renderbufferStorageMultisample){var r=i.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=r,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var n=i.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorageMultisample(i.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this._bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),this._bindUnboundFramebuffer(null),t},b.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else g.a.Error("WebGL 1 does not support texture comparison.")},b.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var i=new _.a(t);return i.capacity=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i},b.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},b.prototype._clientWaitAsync=function(n,o,s){void 0===o&&(o=0),void 0===s&&(s=10);var a=this._gl;return new Promise(function(t,i){var r=function(){var e=a.clientWaitSync(n,o,0);e!=a.WAIT_FAILED?e!=a.TIMEOUT_EXPIRED?t():setTimeout(r,s):i()};r()})},b.prototype._readPixelsAsync=function(e,t,i,r,n,o,s){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,h=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,h),a.bufferData(a.PIXEL_PACK_BUFFER,s.byteLength,a.STREAM_READ),a.readPixels(e,t,i,r,n,o,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var l=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(a.flush(),this._clientWaitAsync(l,0,10).then(function(){return a.deleteSync(l),a.bindBuffer(a.PIXEL_PACK_BUFFER,h),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,s),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(h),s})):null},b.prototype._readTexturePixels=function(e,t,i,r,n,o){void 0===r&&(r=-1),void 0===n&&(n=0),void 0===o&&(o=null);var s=this._gl;if(!this._dummyFramebuffer){var a=s.createFramebuffer();if(!a)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=a}s.bindFramebuffer(s.FRAMEBUFFER,this._dummyFramebuffer),-1<r?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._webGLTexture,n):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e._webGLTexture,n);var h=void 0!==e.type?this._getWebGLTextureType(e.type):s.UNSIGNED_BYTE;switch(h){case s.UNSIGNED_BYTE:o=o||new Uint8Array(4*t*i),h=s.UNSIGNED_BYTE;break;default:o=o||new Float32Array(4*t*i),h=s.FLOAT}return s.readPixels(0,0,t,i,s.RGBA,h,o),s.bindFramebuffer(s.FRAMEBUFFER,this._currentFramebuffer),o},b.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===b.Instances.length&&b.audioEngine&&b.audioEngine.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),l.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),m.prototype.dispose.call(this);var e=b.Instances.indexOf(this);0<=e&&b.Instances.splice(e,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},b.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},b.prototype.displayLoadingUI=function(){if(l.a.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},b.prototype.hideLoadingUI=function(){if(l.a.IsWindowObjectExist()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),b._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&e.requestPointerLock()},b._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},b._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},b._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},b.ALPHA_DISABLE=0,b.ALPHA_ADD=1,b.ALPHA_COMBINE=2,b.ALPHA_SUBTRACT=3,b.ALPHA_MULTIPLY=4,b.ALPHA_MAXIMIZED=5,b.ALPHA_ONEONE=6,b.ALPHA_PREMULTIPLIED=7,b.ALPHA_PREMULTIPLIED_PORTERDUFF=8,b.ALPHA_INTERPOLATE=9,b.ALPHA_SCREENMODE=10,b.DELAYLOADSTATE_NONE=0,b.DELAYLOADSTATE_LOADED=1,b.DELAYLOADSTATE_LOADING=2,b.DELAYLOADSTATE_NOTLOADED=4,b.NEVER=512,b.ALWAYS=519,b.LESS=513,b.EQUAL=514,b.LEQUAL=515,b.GREATER=516,b.GEQUAL=518,b.NOTEQUAL=517,b.KEEP=7680,b.REPLACE=7681,b.INCR=7682,b.DECR=7683,b.INVERT=5386,b.INCR_WRAP=34055,b.DECR_WRAP=34056,b.TEXTURE_CLAMP_ADDRESSMODE=0,b.TEXTURE_WRAP_ADDRESSMODE=1,b.TEXTURE_MIRROR_ADDRESSMODE=2,b.TEXTUREFORMAT_ALPHA=0,b.TEXTUREFORMAT_LUMINANCE=1,b.TEXTUREFORMAT_LUMINANCE_ALPHA=2,b.TEXTUREFORMAT_RGB=4,b.TEXTUREFORMAT_RGBA=5,b.TEXTUREFORMAT_RED=6,b.TEXTUREFORMAT_R=6,b.TEXTUREFORMAT_RG=7,b.TEXTUREFORMAT_RED_INTEGER=8,b.TEXTUREFORMAT_R_INTEGER=8,b.TEXTUREFORMAT_RG_INTEGER=9,b.TEXTUREFORMAT_RGB_INTEGER=10,b.TEXTUREFORMAT_RGBA_INTEGER=11,b.TEXTURETYPE_UNSIGNED_BYTE=0,b.TEXTURETYPE_UNSIGNED_INT=0,b.TEXTURETYPE_FLOAT=1,b.TEXTURETYPE_HALF_FLOAT=2,b.TEXTURETYPE_BYTE=3,b.TEXTURETYPE_SHORT=4,b.TEXTURETYPE_UNSIGNED_SHORT=5,b.TEXTURETYPE_INT=6,b.TEXTURETYPE_UNSIGNED_INTEGER=7,b.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,b.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,b.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,b.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,b.TEXTURETYPE_UNSIGNED_INT_24_8=12,b.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,b.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,b.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,b.TEXTURE_NEAREST_SAMPLINGMODE=1,b.TEXTURE_BILINEAR_SAMPLINGMODE=2,b.TEXTURE_TRILINEAR_SAMPLINGMODE=3,b.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,b.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,b.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,b.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,b.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,b.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,b.TEXTURE_NEAREST_LINEAR=7,b.TEXTURE_NEAREST_NEAREST=1,b.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,b.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,b.TEXTURE_LINEAR_LINEAR=2,b.TEXTURE_LINEAR_NEAREST=12,b.TEXTURE_EXPLICIT_MODE=0,b.TEXTURE_SPHERICAL_MODE=1,b.TEXTURE_PLANAR_MODE=2,b.TEXTURE_CUBIC_MODE=3,b.TEXTURE_PROJECTION_MODE=4,b.TEXTURE_SKYBOX_MODE=5,b.TEXTURE_INVCUBIC_MODE=6,b.TEXTURE_EQUIRECTANGULAR_MODE=7,b.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,b.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,b.SCALEMODE_FLOOR=1,b.SCALEMODE_NEAREST=2,b.SCALEMODE_CEILING=3,b._RescalePostProcessFactory=null,b);function b(e,t,i,r){void 0===r&&(r=!1);var n=m.call(this,e,t,i,r)||this;if(n.enableOfflineSupport=!1,n.disableManifestCheck=!1,n.scenes=new Array,n.onNewSceneAddedObservable=new h.a,n.postProcesses=new Array,n.isPointerLock=!1,n.onResizeObservable=new h.a,n.onCanvasBlurObservable=new h.a,n.onCanvasFocusObservable=new h.a,n.onCanvasPointerOutObservable=new h.a,n.onBeginFrameObservable=new h.a,n.customAnimationFrameRequester=null,n.onEndFrameObservable=new h.a,n.onBeforeShaderCompilationObservable=new h.a,n.onAfterShaderCompilationObservable=new h.a,n._deterministicLockstep=!1,n._lockstepMaxSteps=4,n._timeStep=1/60,n._fps=60,n._deltaTime=0,n._drawCalls=new p.a,n.canvasTabIndex=1,n.disablePerformanceMonitorInBackground=!1,n._performanceMonitor=new c,!e)return n;if(i=n._creationOptions,b.Instances.push(n),e.getContext){var o=e;if(n._onCanvasFocus=function(){n.onCanvasFocusObservable.notifyObservers(n)},n._onCanvasBlur=function(){n.onCanvasBlurObservable.notifyObservers(n)},o.addEventListener("focus",n._onCanvasFocus),o.addEventListener("blur",n._onCanvasBlur),n._onBlur=function(){n.disablePerformanceMonitorInBackground&&n._performanceMonitor.disable(),n._windowIsBackground=!0},n._onFocus=function(){n.disablePerformanceMonitorInBackground&&n._performanceMonitor.enable(),n._windowIsBackground=!1},n._onCanvasPointerOut=function(e){n.onCanvasPointerOutObservable.notifyObservers(e)},o.addEventListener("pointerout",n._onCanvasPointerOut),l.a.IsWindowObjectExist()){var s=n.getHostWindow();s.addEventListener("blur",n._onBlur),s.addEventListener("focus",n._onFocus);var a=document;n._onFullscreenChange=function(){void 0!==a.fullscreen?n.isFullscreen=a.fullscreen:void 0!==a.mozFullScreen?n.isFullscreen=a.mozFullScreen:void 0!==a.webkitIsFullScreen?n.isFullscreen=a.webkitIsFullScreen:void 0!==a.msIsFullScreen&&(n.isFullscreen=a.msIsFullScreen),n.isFullscreen&&n._pointerLockRequested&&o&&b._RequestPointerlock(o)},document.addEventListener("fullscreenchange",n._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",n._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",n._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",n._onFullscreenChange,!1),n._onPointerLockChange=function(){n.isPointerLock=a.mozPointerLockElement===o||a.webkitPointerLockElement===o||a.msPointerLockElement===o||a.pointerLockElement===o},document.addEventListener("pointerlockchange",n._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",n._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",n._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",n._onPointerLockChange,!1),!b.audioEngine&&i.audioEngine&&b.AudioEngineFactory&&(b.audioEngine=b.AudioEngineFactory(n.getRenderingCanvas()))}n._connectVREvents(),n.enableOfflineSupport=void 0!==b.OfflineProviderFactory,i.doNotHandleTouchAction||n._disableTouchAction(),n._deterministicLockstep=!!i.deterministicLockstep,n._lockstepMaxSteps=i.lockstepMaxSteps||0,n._timeStep=i.timeStep||1/60}return n._prepareVRComponent(),i.autoEnableWebVR&&n.initWebVR(),n}},function(e,t,i){"use strict";i.d(t,"a",function(){return f});var l=i(1),r=i(3),n=i(13),o=i(4),s=i(23),c=i(41),a=i(59),h=i(11),u=i(49),f=(Object.defineProperty(d.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alpha=e,this.markAsDirty(d.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(d.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new o.a),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new o.a),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(d.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(d.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"wireframe",{get:function(){switch(this._fillMode){case d.WireFrameFillMode:case d.LineListDrawMode:case d.LineLoopDrawMode:case d.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(e){this.fillMode=e?d.WireFrameFillMode:d.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case d.PointFillMode:case d.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(e){this.fillMode=e?d.PointFillMode:d.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(d.MiscDirtyFlag))},enumerable:!0,configurable:!0}),d.prototype.toString=function(e){return"Name: "+this.name},d.prototype.getClassName=function(){return"Material"},Object.defineProperty(d.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),d.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},d.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},d.prototype.isReady=function(e,t){return!0},d.prototype.isReadyForSubMesh=function(e,t,i){return!1},d.prototype.getEffect=function(){return this._effect},d.prototype.getScene=function(){return this._scene},d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.markDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];if(i.subMeshes)for(var r=0,n=i.subMeshes;r<n.length;r++){var o=n[r];o.getMaterial()===this&&o.effect&&(o.effect._wasPreviouslyReady=!1)}}},d.prototype._preBind=function(e,t){void 0===t&&(t=null);var i=this._scene.getEngine(),r=(null==t?this.sideOrientation:t)===d.ClockWiseSideOrientation;return i.enableEffect(e||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,r),r},d.prototype.bind=function(e,t){},d.prototype.bindForSubMesh=function(e,t,i){},d.prototype.bindOnlyWorldMatrix=function(e){},d.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},d.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},d.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},d.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},d.prototype._afterBind=function(e){if((this._scene._cachedMaterial=this)._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}0!==this.depthFunction&&(t=this._scene.getEngine(),this._cachedDepthFunctionState=t.getDepthFunction()||0,t.setDepthFunction(this.depthFunction))},d.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},d.prototype.getActiveTextures=function(){return[]},d.prototype.hasTexture=function(e){return!1},d.prototype.clone=function(e){return null},d.prototype.getBindedMeshes=function(){var t=this;if(this.meshMap){var e=new Array;for(var i in this.meshMap){var r=this.meshMap[i];r&&e.push(r)}return e}return this._scene.meshes.filter(function(e){return e.material===t})},d.prototype.forceCompilation=function(t,i,e,r){var n=this,o=Object(l.a)({clipPlane:!1,useInstances:!1},e),s=new c.a,a=this.getScene(),h=function(){if(n._scene&&n._scene.getEngine()){s._materialDefines&&(s._materialDefines._renderId=-1);var e=a.clipPlane;o.clipPlane&&(a.clipPlane=new u.a(0,0,0,1)),n._storeEffectOnSubMeshes?n.isReadyForSubMesh(t,s,o.useInstances)?i&&i(n):s.effect&&s.effect.getCompilationError()&&s.effect.allFallbacksProcessed()?r&&r(s.effect.getCompilationError()):setTimeout(h,16):n.isReady()?i&&i(n):setTimeout(h,16),o.clipPlane&&(a.clipPlane=e)}};h()},d.prototype.forceCompilationAsync=function(i,r){var n=this;return new Promise(function(e,t){n.forceCompilation(i,function(){e()},r,function(e){t(e)})})},d.prototype.markAsDirty=function(e){this.getScene().blockMaterialDirtyMechanism||(d._DirtyCallbackArray.length=0,e&d.TextureDirtyFlag&&d._DirtyCallbackArray.push(d._TextureDirtyCallBack),e&d.LightDirtyFlag&&d._DirtyCallbackArray.push(d._LightsDirtyCallBack),e&d.FresnelDirtyFlag&&d._DirtyCallbackArray.push(d._FresnelDirtyCallBack),e&d.AttributesDirtyFlag&&d._DirtyCallbackArray.push(d._AttributeDirtyCallBack),e&d.MiscDirtyFlag&&d._DirtyCallbackArray.push(d._MiscDirtyCallBack),d._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(d._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},d.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,i=this.getScene().meshes;t<i.length;t++){var r=i[t];if(r.subMeshes)for(var n=0,o=r.subMeshes;n<o.length;n++){var s=o[n];s.getMaterial()===this&&s._materialDefines&&e(s._materialDefines)}}},d.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(d._AllDirtyCallBack)},d.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(d._ImageProcessingDirtyCallBack)},d.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(d._TextureDirtyCallBack)},d.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(d._FresnelDirtyCallBack)},d.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(d._FresnelAndMiscDirtyCallBack)},d.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(d._LightsDirtyCallBack)},d.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(d._AttributeDirtyCallBack)},d.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(d._MiscDirtyCallBack)},d.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(d._TextureAndMiscDirtyCallBack)},d.prototype.dispose=function(e,t,i){var r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),!0!==i)if(this.meshMap)for(var n in this.meshMap)(a=this.meshMap[n])&&(a.material=null,this.releaseVertexArrayObject(a,e));else for(var o=0,s=r.meshes;o<s.length;o++){var a;(a=s[o]).material!==this||a.sourceMesh||(a.material=null,this.releaseVertexArrayObject(a,e))}this._uniformBuffer.dispose(),e&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},d.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var i=e.geometry;if(this._storeEffectOnSubMeshes)for(var r=0,n=e.subMeshes;r<n.length;r++){var o=n[r];i._releaseVertexArrayObject(o._materialEffect),t&&o._materialEffect&&o._materialEffect.dispose()}else i._releaseVertexArrayObject(this._effect)}},d.prototype.serialize=function(){return r.a.Serialize(this)},d.Parse=function(e,t,i){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return h.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";return n.b.Instantiate(e.customType).Parse(e,t,i)},d.TriangleFillMode=0,d.WireFrameFillMode=1,d.PointFillMode=2,d.PointListDrawMode=3,d.LineListDrawMode=4,d.LineLoopDrawMode=5,d.LineStripDrawMode=6,d.TriangleStripDrawMode=7,d.TriangleFanDrawMode=8,d.ClockWiseSideOrientation=0,d.CounterClockWiseSideOrientation=1,d.TextureDirtyFlag=1,d.LightDirtyFlag=2,d.FresnelDirtyFlag=4,d.AttributesDirtyFlag=8,d.MiscDirtyFlag=16,d.AllDirtyFlag=31,d._AllDirtyCallBack=function(e){return e.markAllAsDirty()},d._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},d._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},d._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},d._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},d._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},d._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},d._FresnelAndMiscDirtyCallBack=function(e){d._FresnelDirtyCallBack(e),d._MiscDirtyCallBack(e)},d._TextureAndMiscDirtyCallBack=function(e){d._TextureDirtyCallBack(e),d._MiscDirtyCallBack(e)},d._DirtyCallbackArray=[],d._RunDirtyCallBacks=function(e){for(var t=0,i=d._DirtyCallbackArray;t<i.length;t++)(0,i[t])(e)},Object(l.b)([Object(r.c)()],d.prototype,"id",void 0),Object(l.b)([Object(r.c)()],d.prototype,"uniqueId",void 0),Object(l.b)([Object(r.c)()],d.prototype,"name",void 0),Object(l.b)([Object(r.c)()],d.prototype,"checkReadyOnEveryCall",void 0),Object(l.b)([Object(r.c)()],d.prototype,"checkReadyOnlyOnce",void 0),Object(l.b)([Object(r.c)()],d.prototype,"state",void 0),Object(l.b)([Object(r.c)("alpha")],d.prototype,"_alpha",void 0),Object(l.b)([Object(r.c)("backFaceCulling")],d.prototype,"_backFaceCulling",void 0),Object(l.b)([Object(r.c)()],d.prototype,"sideOrientation",void 0),Object(l.b)([Object(r.c)("alphaMode")],d.prototype,"_alphaMode",void 0),Object(l.b)([Object(r.c)()],d.prototype,"_needDepthPrePass",void 0),Object(l.b)([Object(r.c)()],d.prototype,"disableDepthWrite",void 0),Object(l.b)([Object(r.c)()],d.prototype,"forceDepthWrite",void 0),Object(l.b)([Object(r.c)()],d.prototype,"depthFunction",void 0),Object(l.b)([Object(r.c)()],d.prototype,"separateCullingPass",void 0),Object(l.b)([Object(r.c)("fogEnabled")],d.prototype,"_fogEnabled",void 0),Object(l.b)([Object(r.c)()],d.prototype,"pointSize",void 0),Object(l.b)([Object(r.c)()],d.prototype,"zOffset",void 0),Object(l.b)([Object(r.c)()],d.prototype,"wireframe",null),Object(l.b)([Object(r.c)()],d.prototype,"pointsCloud",null),Object(l.b)([Object(r.c)()],d.prototype,"fillMode",null),d);function d(e,t,i){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new o.a,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=d.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=e,this.id=e||n.b.RandomId(),this._scene=t||s.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=d.ClockWiseSideOrientation:this.sideOrientation=d.CounterClockWiseSideOrientation,this._uniformBuffer=new a.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}},function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return a});var r=i(1),n=(o.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},o.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},o.prototype.sort=function(e){this.data.sort(e)},o.prototype.reset=function(){this.length=0},o.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},o.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},o.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},o.prototype.contains=function(e){return-1!==this.indexOf(e)},o._GlobalId=0,o);function o(e){this.length=0,this.data=new Array(e),this._id=o._GlobalId++}var s,a=(s=n,Object(r.c)(h,s),h.prototype.push=function(e){s.prototype.push.call(this,e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},h.prototype.pushNoDuplicate=function(e){return!(e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||(this.push(e),0))},h.prototype.reset=function(){s.prototype.reset.call(this),this._duplicateId++},h.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},h);function h(){var e=null!==s&&s.apply(this,arguments)||this;return e._duplicateId=0,e}},function(e,t,i){"use strict";i.d(t,"a",function(){return h});var r=i(0),n=[new r.d(0,0),new r.d(0,0),new r.d(0,0),new r.d(0,0)],o=[new r.d(0,0),new r.d(0,0),new r.d(0,0),new r.d(0,0)],s=new r.d(0,0),a=new r.d(0,0),h=(l.prototype.copyFrom=function(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height},l.prototype.copyFromFloats=function(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r},l.CombineToRef=function(e,t,i){var r=Math.min(e.left,t.left),n=Math.min(e.top,t.top),o=Math.max(e.left+e.width,t.left+t.width),s=Math.max(e.top+e.height,t.top+t.height);i.left=r,i.top=n,i.width=o-r,i.height=s-n},l.prototype.transformToRef=function(e,t){n[0].copyFromFloats(this.left,this.top),n[1].copyFromFloats(this.left+this.width,this.top),n[2].copyFromFloats(this.left+this.width,this.top+this.height),n[3].copyFromFloats(this.left,this.top+this.height),s.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),a.copyFromFloats(0,0);for(var i=0;i<4;i++)e.transformCoordinates(n[i].x,n[i].y,o[i]),s.x=Math.floor(Math.min(s.x,o[i].x)),s.y=Math.floor(Math.min(s.y,o[i].y)),a.x=Math.ceil(Math.max(a.x,o[i].x)),a.y=Math.ceil(Math.max(a.y,o[i].y));t.left=s.x,t.top=s.y,t.width=a.x-s.x,t.height=a.y-s.y},l.prototype.isEqualsTo=function(e){return this.left===e.left&&this.top===e.top&&this.width===e.width&&this.height===e.height},l.Empty=function(){return new l(0,0,0,0)},l);function l(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.BuildArray=function(e,t){for(var i=[],r=0;r<e;++r)i.push(t());return i},n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var l,r=i(1),h=i(11),n=i(5),o=i(29),s=i(10),a=(l=n.a,Object(r.c)(c,l),Object.defineProperty(c.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(e){this._adaptHeightToChildren!==e&&((this._adaptHeightToChildren=e)&&(this.height="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(e){this._adaptWidthToChildren!==e&&((this._adaptWidthToChildren=e)&&(this.width="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),c.prototype._getTypeName=function(){return"Container"},c.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this.children;e<t.length;e++)t[e]._markMatrixAsDirty()},c.prototype.getChildByName=function(e){for(var t=0,i=this.children;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},c.prototype.getChildByType=function(e,t){for(var i=0,r=this.children;i<r.length;i++){var n=r[i];if(n.typeName===t)return n}return null},c.prototype.containsControl=function(e){return-1!==this.children.indexOf(e)},c.prototype.addControl=function(e){return e&&(-1!==this._children.indexOf(e)||(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty())),this},c.prototype.clearControls=function(){for(var e=0,t=this.children.slice();e<t.length;e++){var i=t[e];this.removeControl(i)}return this},c.prototype.removeControl=function(e){var t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this},c.prototype._reOrderControl=function(e){this.removeControl(e);for(var t=!1,i=0;i<this._children.length;i++)if(this._children[i].zIndex>e.zIndex){this._children.splice(i,0,e),t=!0;break}t||this._children.push(e),(e.parent=this)._markAsDirty()},c.prototype._offsetLeft=function(e){l.prototype._offsetLeft.call(this,e);for(var t=0,i=this._children;t<i.length;t++)i[t]._offsetLeft(e)},c.prototype._offsetTop=function(e){l.prototype._offsetTop.call(this,e);for(var t=0,i=this._children;t<i.length;t++)i[t]._offsetTop(e)},c.prototype._markAllAsDirty=function(){l.prototype._markAllAsDirty.call(this);for(var e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()},c.prototype._localDraw=function(e){this._background&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())},c.prototype._link=function(e){l.prototype._link.call(this,e);for(var t=0,i=this._children;t<i.length;t++)i[t]._link(e)},c.prototype._beforeLayout=function(){},c.prototype._processMeasures=function(e,t){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(e)||(l.prototype._processMeasures.call(this,e,t),this._evaluateClippingState(e))},c.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var i=0;t.save(),this._applyStates(t),this._beforeLayout();do{var r=-1,n=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(var o=0,s=this._children;o<s.length;o++){var a=s[o];a._tempParentMeasure.copyFrom(this._measureForChildren),a._layout(this._measureForChildren,t)&&(this.adaptWidthToChildren&&a._width.isPixel&&(r=Math.max(r,a._currentMeasure.width)),this.adaptHeightToChildren&&a._height.isPixel&&(n=Math.max(n,a._currentMeasure.height)))}this.adaptWidthToChildren&&0<=r&&this.width!==r+"px"&&(this.width=r+"px",this._rebuildLayout=!0),this.adaptHeightToChildren&&0<=n&&this.height!==n+"px"&&(this.height=n+"px",this._rebuildLayout=!0),this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return 3<=i&&this.logLayoutCycleErrors&&h.a.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},c.prototype._postMeasure=function(){},c.prototype._draw=function(e,t){this._localDraw(e),this.clipChildren&&this._clipForChildren(e);for(var i=0,r=this._children;i<r.length;i++){var n=r[i];t&&!n._intersectsRect(t)||n._render(e,t)}},c.prototype.getDescendantsToRef=function(e,t,i){if(void 0===t&&(t=!1),this.children)for(var r=0;r<this.children.length;r++){var n=this.children[r];i&&!i(n)||e.push(n),t||n.getDescendantsToRef(e,!1,i)}},c.prototype._processPicking=function(e,t,i,r,n,o,s){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!l.prototype.contains.call(this,e,t))return!1;for(var a=this._children.length-1;0<=a;a--){var h=this._children[a];if(h._processPicking(e,t,i,r,n,o,s))return h.hoverCursor&&this._host._changeCursor(h.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(i,e,t,r,n,o,s)},c.prototype._additionalProcessing=function(e,t){l.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.copyFrom(this._currentMeasure)},c.prototype.dispose=function(){l.prototype.dispose.call(this);for(var e=this.children.length-1;0<=e;e--)this.children[e].dispose()},c);function c(e){var t=l.call(this,e)||this;return t.name=e,t._children=new Array,t._measureForChildren=o.a.Empty(),t._background="",t._adaptWidthToChildren=!1,t._adaptHeightToChildren=!1,t.logLayoutCycleErrors=!1,t.maxLayoutCycle=3,t}s.a.RegisteredTypes["BABYLON.GUI.Container"]=a},function(e,t,i){"use strict";i.d(t,"a",function(){return f});var r=i(30),c=i(0),d=i(15),n=(h.prototype.reConstruct=function(e,t,i){var r=e.x,n=e.y,o=e.z,s=t.x,a=t.y,h=t.z,l=this.vectors;this.minimum.copyFromFloats(r,n,o),this.maximum.copyFromFloats(s,a,h),l[0].copyFromFloats(r,n,o),l[1].copyFromFloats(s,a,h),l[2].copyFromFloats(s,n,o),l[3].copyFromFloats(r,a,o),l[4].copyFromFloats(r,n,h),l[5].copyFromFloats(s,a,o),l[6].copyFromFloats(r,a,h),l[7].copyFromFloats(s,n,h),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||c.a.IdentityReadOnly,this._update(this._worldMatrix)},h.prototype.scale=function(e){var t=h.TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),r=i.length();i.normalizeFromLength(r);var n=r*e,o=i.scaleInPlace(.5*n),s=this.center.subtractToRef(o,t[1]),a=this.center.addToRef(o,t[2]);return this.reConstruct(s,a,this._worldMatrix),this},h.prototype.getWorldMatrix=function(){return this._worldMatrix},h.prototype._update=function(e){var t=this.minimumWorld,i=this.maximumWorld,r=this.directions,n=this.vectorsWorld,o=this.vectors;if(e.isIdentity()){for(t.copyFrom(this.minimum),i.copyFrom(this.maximum),s=0;s<8;++s)n[s].copyFrom(o[s]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(var s=0;s<8;++s){var a=n[s];c.e.TransformCoordinatesToRef(o[s],e,a),t.minimizeInPlace(a),i.maximizeInPlace(a)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}c.e.FromArrayToRef(e.m,0,r[0]),c.e.FromArrayToRef(e.m,4,r[1]),c.e.FromArrayToRef(e.m,8,r[2]),this._worldMatrix=e},h.prototype.isInFrustum=function(e){return h.IsInFrustum(this.vectorsWorld,e)},h.prototype.isCompletelyInFrustum=function(e){return h.IsCompletelyInFrustum(this.vectorsWorld,e)},h.prototype.intersectsPoint=function(e){var t=this.minimumWorld,i=this.maximumWorld,r=t.x,n=t.y,o=t.z,s=i.x,a=i.y,h=i.z,l=e.x,c=e.y,u=e.z,f=-d.a;return!(s-l<f||l-r<f||a-c<f||c-n<f||h-u<f||u-o<f)},h.prototype.intersectsSphere=function(e){return h.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},h.prototype.intersectsMinMax=function(e,t){var i=this.minimumWorld,r=this.maximumWorld,n=i.x,o=i.y,s=i.z,a=r.x,h=r.y,l=r.z,c=e.x,u=e.y,f=e.z,d=t.x,p=t.y,_=t.z;return!(a<c||d<n||h<u||p<o||l<f||_<s)},h.Intersects=function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)},h.IntersectsSphere=function(e,t,i,r){var n=h.TmpVector3[0];return c.e.ClampToRef(i,e,t,n),c.e.DistanceSquared(i,n)<=r*r},h.IsCompletelyInFrustum=function(e,t){for(var i=0;i<6;++i)for(var r=t[i],n=0;n<8;++n)if(r.dotCoordinate(e[n])<0)return!1;return!0},h.IsInFrustum=function(e,t){for(var i=0;i<6;++i){for(var r=!0,n=t[i],o=0;o<8;++o)if(0<=n.dotCoordinate(e[o])){r=!1;break}if(r)return!1}return!0},h.TmpVector3=r.a.BuildArray(3,c.e.Zero),h);function h(e,t,i){this.vectors=r.a.BuildArray(8,c.e.Zero),this.center=c.e.Zero(),this.centerWorld=c.e.Zero(),this.extendSize=c.e.Zero(),this.extendSizeWorld=c.e.Zero(),this.directions=r.a.BuildArray(3,c.e.Zero),this.vectorsWorld=r.a.BuildArray(8,c.e.Zero),this.minimumWorld=c.e.Zero(),this.maximumWorld=c.e.Zero(),this.minimum=c.e.Zero(),this.maximum=c.e.Zero(),this.reConstruct(e,t,i)}function o(e,t,i){var r=c.e.Dot(t.centerWorld,e),n=Math.abs(c.e.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(c.e.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(c.e.Dot(t.directions[2],e))*t.extendSize.z;i.min=r-n,i.max=r+n}function s(e,t,i){return o(e,t,l),o(e,i,u),!(u.max<l.min||l.max<u.min)}var a=i(65),l={min:0,max:0},u={min:0,max:0},f=(p.prototype.reConstruct=function(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)},Object.defineProperty(p.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),p.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},p.prototype.centerOn=function(e,t){var i=p.TmpVector3[0].copyFrom(e).subtractInPlace(t),r=p.TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this},p.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},p.prototype.isInFrustum=function(e,t){return void 0===t&&(t=0),!(2!==t&&3!==t||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(1===t||3===t||this.boundingBox.isInFrustum(e))},Object.defineProperty(p.prototype,"diagonalLength",{get:function(){var e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,p.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),p.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},p.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},p.prototype.intersectsPoint=function(e){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e)},p.prototype.intersects=function(e,t){if(!a.a.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!n.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var i=this.boundingBox,r=e.boundingBox;return!!(s(i.directions[0],i,r)&&s(i.directions[1],i,r)&&s(i.directions[2],i,r)&&s(r.directions[0],i,r)&&s(r.directions[1],i,r)&&s(r.directions[2],i,r)&&s(c.e.Cross(i.directions[0],r.directions[0]),i,r)&&s(c.e.Cross(i.directions[0],r.directions[1]),i,r)&&s(c.e.Cross(i.directions[0],r.directions[2]),i,r)&&s(c.e.Cross(i.directions[1],r.directions[0]),i,r)&&s(c.e.Cross(i.directions[1],r.directions[1]),i,r)&&s(c.e.Cross(i.directions[1],r.directions[2]),i,r)&&s(c.e.Cross(i.directions[2],r.directions[0]),i,r)&&s(c.e.Cross(i.directions[2],r.directions[1]),i,r)&&s(c.e.Cross(i.directions[2],r.directions[2]),i,r))},p.TmpVector3=r.a.BuildArray(2,c.e.Zero),p);function p(e,t,i){this._isLocked=!1,this.boundingBox=new n(e,t,i),this.boundingSphere=new a.a(e,t,i)}},function(e,t,i){"use strict";i.r(t),i.d(t,"Scene",function(){return H});var n=i(1),v=i(13),r=i(37),o=i(4),s=i(28),a=(h.prototype.copyFrom=function(e){var i=this;this.clear(),e.forEach(function(e,t){return i.add(e,t)})},h.prototype.get=function(e){var t=this._data[e];if(void 0!==t)return t},h.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return void 0!==i||(i=t(e))&&this.add(e,i),i},h.prototype.getOrAdd=function(e,t){var i=this.get(e);return void 0!==i?i:(this.add(e,t),t)},h.prototype.contains=function(e){return void 0!==this._data[e]},h.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},h.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},h.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null},h.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},h.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(h.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),h.prototype.forEach=function(e){for(var t in this._data)e(t,this._data[t])},h.prototype.first=function(e){for(var t in this._data){var i=e(t,this._data[t]);if(i)return i}return null},h);function h(){this._count=0,this._data={}}var l=i(21),c=i(0),u=i(39),f=i(42),b=i(20),d=(p.AddParser=function(e,t){this._BabylonFileParsers[e]=t},p.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},p.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},p.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},p.Parse=function(e,t,i,r){for(var n in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(n)&&this._BabylonFileParsers[n](e,t,i,r)},p.prototype.getNodes=function(){var t=new Array;return t=(t=(t=(t=t.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach(function(e){return t=t.concat(e.bones)}),t},p._BabylonFileParsers={},p._IndividualBabylonFileParsers={},p);function p(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this.environmentTexture=null}var _=i(55),g=i(59),m=i(43),y=i(47),x=(T.CreateNew=function(e,t,i){var r=e.getScene();return new T(e,r.pointerX,r.pointerY,r.meshUnderPointer||e,t,i)},T.CreateNewFromSprite=function(e,t,i,r){return new T(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,r)},T.CreateNewFromScene=function(e,t){return new T(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)},T.CreateNewFromPrimitive=function(e,t,i,r){return new T(e,t.x,t.y,null,i,r)},T);function T(e,t,i,r,n,o){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=n,this.additionalData=o}var M=i(66),E=i(74),A=i(22),O=i(25),P=i(11),C=i(23),S=i(8),R=i(9),I=(Object.defineProperty(w,"HasTriggers",{get:function(){for(var e in w.Triggers)if(w.Triggers.hasOwnProperty(e))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(w,"HasPickTriggers",{get:function(){for(var e in w.Triggers)if(w.Triggers.hasOwnProperty(e)){var t=parseInt(e);if(1<=t&&t<=7)return!0}return!1},enumerable:!0,configurable:!0}),w.HasSpecificTrigger=function(e){for(var t in w.Triggers)if(w.Triggers.hasOwnProperty(t)&&parseInt(t)===e)return!0;return!1},w.Triggers={},w);function w(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}var D=i(44),L=(Object.defineProperty(F.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),F);function F(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}var N=(Object.defineProperty(B.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"unTranslatedPointer",{get:function(){return new c.d(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!0,configurable:!0}),B.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},B.prototype._processPointerMove=function(e,t){var i=this._scene,r=i.getEngine(),n=r.getInputElement();if(n){n.tabIndex=r.canvasTabIndex,i.doNotHandleCursors||(n.style.cursor=i.defaultCursor);var o=!!(e&&e.hit&&e.pickedMesh);o?(i.setPointerOverMesh(e.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(i.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?n.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:n.style.cursor=i.hoverCursor))):i.setPointerOverMesh(null);for(var s=0,a=i._pointerMoveStage;s<a.length;s++)e=a[s].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,o,n);if(e){var h=t.type===this._wheelEventName?R.a.POINTERWHEEL:R.a.POINTERMOVE;if(i.onPointerMove&&i.onPointerMove(t,e,h),i.onPointerObservable.hasObservers()){var l=new R.b(h,t,e);this._setRayOnPointerInfo(l),i.onPointerObservable.notifyObservers(l,h)}}}},B.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,c.a.Identity(),t.activeCamera)))},B.prototype._checkPrePointerObservable=function(e,t,i){var r=this._scene,n=new R.c(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(n.ray=e.ray),r.onPrePointerObservable.notifyObservers(n,i),!!n.skipOnPointerObservable},B.prototype.simulatePointerMove=function(e,t){var i=new PointerEvent("pointermove",t);this._checkPrePointerObservable(e,i,R.a.POINTERMOVE)||this._processPointerMove(e,i)},B.prototype.simulatePointerDown=function(e,t){var i=new PointerEvent("pointerdown",t);this._checkPrePointerObservable(e,i,R.a.POINTERDOWN)||this._processPointerDown(e,i)},B.prototype._processPointerDown=function(e,t){var i=this,r=this._scene;if(e&&e.hit&&e.pickedMesh){this._pickedDownMesh=e.pickedMesh;var n=e.pickedMesh._getActionManagerForTrigger();if(n){if(n.hasPickTriggers)switch(n.processTrigger(5,x.CreateNew(e.pickedMesh,t)),t.button){case 0:n.processTrigger(2,x.CreateNew(e.pickedMesh,t));break;case 1:n.processTrigger(4,x.CreateNew(e.pickedMesh,t));break;case 2:n.processTrigger(3,x.CreateNew(e.pickedMesh,t))}n.hasSpecificTrigger(8)&&window.setTimeout(function(){var e=r.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e==i._pickedDownMesh},!1,r.cameraToUseForPointers);e&&e.hit&&e.pickedMesh&&n&&0!==i._totalPointersPressed&&Date.now()-i._startingPointerTime>B.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,n.processTrigger(8,x.CreateNew(e.pickedMesh,t)))},B.LongPressDelay)}}else for(var o=0,s=r._pointerDownStage;o<s.length;o++)e=s[o].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t);if(e){var a=R.a.POINTERDOWN;if(r.onPointerDown&&r.onPointerDown(t,e,a),r.onPointerObservable.hasObservers()){var h=new R.b(a,t,e);this._setRayOnPointerInfo(h),r.onPointerObservable.notifyObservers(h,a)}}},B.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>B.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>B.DragMovementThreshold},B.prototype.simulatePointerUp=function(e,t,i){var r=new PointerEvent("pointerup",t),n=new L;i?n.doubleClick=!0:n.singleClick=!0,this._checkPrePointerObservable(e,r,R.a.POINTERUP)||this._processPointerUp(e,r,n)},B.prototype._processPointerUp=function(e,t,i){var r=this._scene;if(e&&e&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(r.onPointerPick&&r.onPointerPick(t,e),i.singleClick&&!i.ignore&&r.onPointerObservable.hasObservers())){var n=R.a.POINTERPICK,o=new R.b(n,t,e);this._setRayOnPointerInfo(o),r.onPointerObservable.notifyObservers(o,n)}var s=e.pickedMesh._getActionManagerForTrigger();if(s&&!i.ignore){s.processTrigger(7,x.CreateNew(e.pickedMesh,t)),!i.hasSwiped&&i.singleClick&&s.processTrigger(1,x.CreateNew(e.pickedMesh,t));var a=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&a&&a.processTrigger(6,x.CreateNew(e.pickedMesh,t))}}else if(!i.ignore)for(var h=0,l=r._pointerUpStage;h<l.length;h++)e=l[h].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var c=this._pickedDownMesh._getActionManagerForTrigger(16);c&&c.processTrigger(16,x.CreateNew(this._pickedDownMesh,t))}var u=0;r.onPointerObservable.hasObservers()&&(i.ignore||i.hasSwiped||(i.singleClick&&r.onPointerObservable.hasSpecificMask(R.a.POINTERTAP)?u=R.a.POINTERTAP:i.doubleClick&&r.onPointerObservable.hasSpecificMask(R.a.POINTERDOUBLETAP)&&(u=R.a.POINTERDOUBLETAP),!u)||(o=new R.b(u,t,e),this._setRayOnPointerInfo(o),r.onPointerObservable.notifyObservers(o,u)),i.ignore||(u=R.a.POINTERUP,o=new R.b(u,t,e),this._setRayOnPointerInfo(o),r.onPointerObservable.notifyObservers(o,u))),r.onPointerUp&&!i.ignore&&r.onPointerUp(t,e,u)},B.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},B.prototype.attachControl=function(e,t,i,r){var u=this;void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===r&&(r=null);var n=this._scene;if(r=r||n.getEngine().getInputElement()){var o=n.getEngine();this._initActionManager=function(e,t){if(!u._meshPickProceed){var i=n.pick(u._unTranslatedPointerX,u._unTranslatedPointerY,n.pointerDownPredicate,!1,n.cameraToUseForPointers);(u._currentPickResult=i)&&(e=i.hit&&i.pickedMesh?i.pickedMesh._getActionManagerForTrigger():null),u._meshPickProceed=!0}return e},this._delayedSimpleClick=function(e,t,i){(Date.now()-u._previousStartingPointerTime>B.DoubleClickDelay&&!u._doubleClickOccured||e!==u._previousButtonPressed)&&(u._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,i(t,u._currentPickResult))},this._initClickEvent=function(e,t,i,r){var n=new L,o=u._currentPickResult=null,s=e.hasSpecificMask(R.a.POINTERPICK)||t.hasSpecificMask(R.a.POINTERPICK)||e.hasSpecificMask(R.a.POINTERTAP)||t.hasSpecificMask(R.a.POINTERTAP)||e.hasSpecificMask(R.a.POINTERDOUBLETAP)||t.hasSpecificMask(R.a.POINTERDOUBLETAP);!s&&I&&(o=u._initActionManager(o,n))&&(s=o.hasPickTriggers);var a=!1;if(s){var h=i.button;if(n.hasSwiped=u._isPointerSwiping(),!n.hasSwiped){var l=!B.ExclusiveDoubleClickMode;l||(l=!e.hasSpecificMask(R.a.POINTERDOUBLETAP)&&!t.hasSpecificMask(R.a.POINTERDOUBLETAP))&&!I.HasSpecificTrigger(6)&&(o=u._initActionManager(o,n))&&(l=!o.hasSpecificTrigger(6)),l?(Date.now()-u._previousStartingPointerTime>B.DoubleClickDelay||h!==u._previousButtonPressed)&&(n.singleClick=!0,r(n,u._currentPickResult),a=!0):(u._previousDelayedSimpleClickTimeout=u._delayedSimpleClickTimeout,u._delayedSimpleClickTimeout=window.setTimeout(u._delayedSimpleClick.bind(u,h,n,r),B.DoubleClickDelay));var c=e.hasSpecificMask(R.a.POINTERDOUBLETAP)||t.hasSpecificMask(R.a.POINTERDOUBLETAP);!c&&I.HasSpecificTrigger(6)&&(o=u._initActionManager(o,n))&&(c=o.hasSpecificTrigger(6)),c&&(h===u._previousButtonPressed&&Date.now()-u._previousStartingPointerTime<B.DoubleClickDelay&&!u._doubleClickOccured?(n.hasSwiped||u._isPointerSwiping()?(u._doubleClickOccured=!1,u._previousStartingPointerTime=u._startingPointerTime,u._previousStartingPointerPosition.x=u._startingPointerPosition.x,u._previousStartingPointerPosition.y=u._startingPointerPosition.y,u._previousButtonPressed=h,B.ExclusiveDoubleClickMode?(u._previousDelayedSimpleClickTimeout&&clearTimeout(u._previousDelayedSimpleClickTimeout),u._previousDelayedSimpleClickTimeout=u._delayedSimpleClickTimeout,r(n,u._previousPickResult)):r(n,u._currentPickResult)):(u._previousStartingPointerTime=0,u._doubleClickOccured=!0,n.doubleClick=!0,n.ignore=!1,B.ExclusiveDoubleClickMode&&u._previousDelayedSimpleClickTimeout&&clearTimeout(u._previousDelayedSimpleClickTimeout),u._previousDelayedSimpleClickTimeout=u._delayedSimpleClickTimeout,r(n,u._currentPickResult)),a=!0):(u._doubleClickOccured=!1,u._previousStartingPointerTime=u._startingPointerTime,u._previousStartingPointerPosition.x=u._startingPointerPosition.x,u._previousStartingPointerPosition.y=u._startingPointerPosition.y,u._previousButtonPressed=h))}}a||r(n,u._currentPickResult)},this._onPointerMove=function(e){if(u._updatePointerPosition(e),!u._checkPrePointerObservable(null,e,e.type===u._wheelEventName?R.a.POINTERWHEEL:R.a.POINTERMOVE)&&(n.cameraToUseForPointers||n.activeCamera)){n.pointerMovePredicate||(n.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||n.constantlyUpdateMeshUnderPointer||null!=e._getActionManagerForTrigger())&&(!n.cameraToUseForPointers||0!=(n.cameraToUseForPointers.layerMask&e.layerMask))});var t=n.pick(u._unTranslatedPointerX,u._unTranslatedPointerY,n.pointerMovePredicate,!1,n.cameraToUseForPointers);u._processPointerMove(t,e)}},this._onPointerDown=function(e){if(u._totalPointersPressed++,u._pickedDownMesh=null,u._meshPickProceed=!1,u._updatePointerPosition(e),n.preventDefaultOnPointerDown&&r&&(e.preventDefault(),r.focus()),u._startingPointerPosition.x=u._pointerX,u._startingPointerPosition.y=u._pointerY,u._startingPointerTime=Date.now(),!u._checkPrePointerObservable(null,e,R.a.POINTERDOWN)&&(n.cameraToUseForPointers||n.activeCamera)){u._pointerCaptures[e.pointerId]=!0,n.pointerDownPredicate||(n.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!n.cameraToUseForPointers||0!=(n.cameraToUseForPointers.layerMask&e.layerMask))}),u._pickedDownMesh=null;var t=n.pick(u._unTranslatedPointerX,u._unTranslatedPointerY,n.pointerDownPredicate,!1,n.cameraToUseForPointers);u._processPointerDown(t,e)}},this._onPointerUp=function(i){0!==u._totalPointersPressed&&(u._totalPointersPressed--,u._pickedUpMesh=null,u._meshPickProceed=!1,u._updatePointerPosition(i),n.preventDefaultOnPointerUp&&r&&(i.preventDefault(),r.focus()),u._initClickEvent(n.onPrePointerObservable,n.onPointerObservable,i,function(e,t){if(n.onPrePointerObservable.hasObservers()&&!e.ignore){if(!e.hasSwiped){if(e.singleClick&&n.onPrePointerObservable.hasSpecificMask(R.a.POINTERTAP)&&u._checkPrePointerObservable(null,i,R.a.POINTERTAP))return;if(e.doubleClick&&n.onPrePointerObservable.hasSpecificMask(R.a.POINTERDOUBLETAP)&&u._checkPrePointerObservable(null,i,R.a.POINTERDOUBLETAP))return}if(u._checkPrePointerObservable(null,i,R.a.POINTERUP))return}u._pointerCaptures[i.pointerId]&&(u._pointerCaptures[i.pointerId]=!1,(n.cameraToUseForPointers||n.activeCamera)&&(n.pointerUpPredicate||(n.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!n.cameraToUseForPointers||0!=(n.cameraToUseForPointers.layerMask&e.layerMask))}),!u._meshPickProceed&&(I&&I.HasTriggers||n.onPointerObservable.hasObservers())&&u._initActionManager(null,e),t=t||u._currentPickResult,u._processPointerUp(t,i,e),u._previousPickResult=u._currentPickResult))}))},this._onKeyDown=function(e){var t=D.a.KEYDOWN;if(n.onPreKeyboardObservable.hasObservers()){var i=new D.c(t,e);if(n.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnPointerObservable)return}n.onKeyboardObservable.hasObservers()&&(i=new D.b(t,e),n.onKeyboardObservable.notifyObservers(i,t)),n.actionManager&&n.actionManager.processTrigger(14,x.CreateNewFromScene(n,e))},this._onKeyUp=function(e){var t=D.a.KEYUP;if(n.onPreKeyboardObservable.hasObservers()){var i=new D.c(t,e);if(n.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnPointerObservable)return}n.onKeyboardObservable.hasObservers()&&(i=new D.b(t,e),n.onKeyboardObservable.notifyObservers(i,t)),n.actionManager&&n.actionManager.processTrigger(15,x.CreateNewFromScene(n,e))},this._onCanvasFocusObserver=o.onCanvasFocusObservable.add((document.activeElement===r&&h(),h)),this._onCanvasBlurObserver=o.onCanvasBlurObservable.add(function(){r&&(r.removeEventListener("keydown",u._onKeyDown),r.removeEventListener("keyup",u._onKeyUp))});var s=v.b.GetPointerPrefix();if(i&&(r.addEventListener(s+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",r.addEventListener(this._wheelEventName,this._onPointerMove,!1)),t&&r.addEventListener(s+"down",this._onPointerDown,!1),e){var a=n.getEngine().getHostWindow();a&&a.addEventListener(s+"up",this._onPointerUp,!1)}}function h(){r&&(r.addEventListener("keydown",u._onKeyDown,!1),r.addEventListener("keyup",u._onKeyUp,!1))}},B.prototype.detachControl=function(){var e=v.b.GetPointerPrefix(),t=this._scene.getEngine().getInputElement(),i=this._scene.getEngine();t&&(t.removeEventListener(e+"move",this._onPointerMove),t.removeEventListener(this._wheelEventName,this._onPointerMove),t.removeEventListener(e+"down",this._onPointerDown),window.removeEventListener(e+"up",this._onPointerUp),this._onCanvasBlurObserver&&i.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&i.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),t.removeEventListener("keydown",this._onKeyDown),t.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(t.style.cursor=this._scene.defaultCursor))},B.prototype.setPointerOverMesh=function(e){var t;this._pointerOverMesh!==e&&(this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(10))&&t.processTrigger(10,x.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=e,this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(9))&&t.processTrigger(9,x.CreateNew(this._pointerOverMesh)))},B.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},B.DragMovementThreshold=10,B.LongPressDelay=500,B.DoubleClickDelay=300,B.ExclusiveDoubleClickMode=!1,B);function B(e){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new c.d(0,0),this._previousStartingPointerPosition=new c.d(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=e}var k=i(54),U=i(7),V=i(50),z=(Object.defineProperty(j,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!0,configurable:!0}),j._UniqueIdCounter=0,j);function j(){}var W,G=i(36),H=(W=d,Object(n.c)(X,W),X.DefaultMaterialFactory=function(e){throw S.a.WarnImport("StandardMaterial")},X.CollisionCoordinatorFactory=function(){throw S.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(X.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(e){this._environmentIntensity!==e&&(this._environmentIntensity=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(X,"DragMovementThreshold",{get:function(){return N.DragMovementThreshold},set:function(e){N.DragMovementThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(X,"LongPressDelay",{get:function(){return N.LongPressDelay},set:function(e){N.LongPressDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(X,"DoubleClickDelay",{get:function(){return N.DoubleClickDelay},set:function(e){N.DoubleClickDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(X,"ExclusiveDoubleClickMode",{get:function(){return N.ExclusiveDoubleClickMode},set:function(e){N.ExclusiveDoubleClickMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),X.prototype.setStepId=function(e){this._currentStepId=e},X.prototype.getStepId=function(){return this._currentStepId},X.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(X.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=X.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=X.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),X.prototype._registerTransientComponents=function(){if(0<this._transientComponents.length){for(var e=0,t=this._transientComponents;e<t.length;e++)t[e].register();this._transientComponents=[]}},X.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e),e.addFromContainer&&e.serialize&&this._serializableComponents.push(e)},X.prototype._getComponent=function(e){for(var t=0,i=this._components;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},X.prototype.getClassName=function(){return"Scene"},X.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},X.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},X.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(X.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!0,configurable:!0}),X.prototype.getCachedMaterial=function(){return this._cachedMaterial},X.prototype.getCachedEffect=function(){return this._cachedEffect},X.prototype.getCachedVisibility=function(){return this._cachedVisibility},X.prototype.isCachedMaterialInvalid=function(e,t,i){return void 0===i&&(i=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i},X.prototype.getEngine=function(){return this._engine},X.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(X.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),X.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(X.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),X.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(X.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),X.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(X.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),X.prototype.getActiveMeshes=function(){return this._activeMeshes},X.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},X.prototype.getRenderId=function(){return this._renderId},X.prototype.getFrameId=function(){return this._frameId},X.prototype.incrementRenderId=function(){this._renderId++},X.prototype._createUbo=function(){this._sceneUbo=new g.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},X.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},X.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},X.prototype.simulatePointerUp=function(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this},X.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._inputManager.isPointerCaptured(e)},X.prototype.attachControl=function(e,t,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===i&&(i=!0),this._inputManager.attachControl(e,t,i)},X.prototype.detachControl=function(){this._inputManager.detachControl()},X.prototype.isReady=function(){if(this._isDisposed)return!1;var e,t=this.getEngine();if(!t.areAllEffectsReady())return!1;if(0<this._pendingData.length)return!1;for(e=0;e<this.meshes.length;e++){var i=this.meshes[e];if(i.isEnabled()&&i.subMeshes&&0!==i.subMeshes.length){if(!i.isReady(!0))return!1;for(var r="InstancedMesh"===i.getClassName()||"InstancedLinesMesh"===i.getClassName()||t.getCaps().instancedArrays&&0<i.instances.length,n=0,o=this._isReadyForMeshStage;n<o.length;n++)if(!o[n].action(i,r))return!1}}for(e=0;e<this.geometries.length;e++)if(2===this.geometries[e].delayLoadState)return!1;if(this.activeCameras&&0<this.activeCameras.length){for(var s=0,a=this.activeCameras;s<a.length;s++)if(!a[s].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var h=0,l=this.particleSystems;h<l.length;h++)if(!l[h].isReady())return!1;return!0},X.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},X.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},X.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},X.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},X.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},X.prototype._executeOnceBeforeRender=function(e){var t=this,i=function(){e(),setTimeout(function(){t.unregisterBeforeRender(i)})};this.registerBeforeRender(i)},X.prototype.executeOnceBeforeRender=function(e,t){var i=this;void 0!==t?setTimeout(function(){i._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)},X.prototype._addPendingData=function(e){this._pendingData.push(e)},X.prototype._removePendingData=function(e){var t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},X.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(X.prototype,"isLoading",{get:function(){return 0<this._pendingData.length},enumerable:!0,configurable:!0}),X.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},X.prototype.whenReadyAsync=function(){var t=this;return new Promise(function(e){t.executeWhenReady(function(){e()})})},X.prototype._checkIsReady=function(){var e=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},Object.defineProperty(X.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),X.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=r.a.Now},X.prototype.getViewMatrix=function(){return this._viewMatrix},X.prototype.getProjectionMatrix=function(){return this._projectionMatrix},X.prototype.getTransformMatrix=function(){return this._transformMatrix},X.prototype.setTransformMatrix=function(e,t,i,r){this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?V.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=V.a.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,r):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},X.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},X.prototype.getUniqueId=function(){return z.UniqueId},X.prototype.addMesh=function(e,t){var i=this;void 0===t&&(t=!1),this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){i.addMesh(e)}))},X.prototype.removeMesh=function(e,t){var i=this;void 0===t&&(t=!1);var r=this.meshes.indexOf(e);return-1!==r&&(this.meshes[r]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){i.removeMesh(e)}),r},X.prototype.addTransformNode=function(e){this._blockEntityCollection||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},X.prototype.removeTransformNode=function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var i=this.transformNodes[this.transformNodes.length-1];(this.transformNodes[t]=i)._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t},X.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e)),t},X.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},X.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var i=0,r=this.meshes;i<r.length;i++)r[i]._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t},X.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes());var i=this.activeCameras.indexOf(e);return-1!==i&&this.activeCameras.splice(i,1),this.activeCamera===e&&(0<this.cameras.length?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},X.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&this.particleSystems.splice(t,1),t},X.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},X.prototype.stopAnimation=function(e,t,i){},X.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},X.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),t},X.prototype.removeMaterial=function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var i=this.materials[this.materials.length-1];(this.materials[t]=i)._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t},X.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},X.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},X.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var t=0,i=this.meshes;t<i.length;t++){var r=i[t];-1===r.lightSources.indexOf(e)&&(r.lightSources.push(e),r._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},X.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(m.a.CompareLightsPriority)},X.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},X.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},X.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},X.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},X.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},X.prototype.addMultiMaterial=function(e){this._blockEntityCollection||this.multiMaterials.push(e)},X.prototype.addMaterial=function(e){this._blockEntityCollection||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},X.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},X.prototype.addGeometry=function(e){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},X.prototype.addActionManager=function(e){this.actionManagers.push(e)},X.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},X.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var i=this._engine.getInputElement();i&&(this.activeCamera&&this.activeCamera.detachControl(i),this.activeCamera=e,t&&e.attachControl(i))},X.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?this.activeCamera=t:null},X.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?this.activeCamera=t:null},X.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},X.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},X.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},X.prototype.getLastMaterialByID=function(e){for(var t=this.materials.length-1;0<=t;t--)if(this.materials[t].id===e)return this.materials[t];return null},X.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},X.prototype.getTextureByUniqueID=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null},X.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},X.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},X.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},X.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].id===e)return i.bones[r];return null},X.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].name===e)return i.bones[r];return null},X.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},X.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},X.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},X.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},X.prototype.getGeometryByID=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},X.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var t=this.geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].uniqueId===e)return this.geometries[i];return null},X.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueID(e.uniqueId)||(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),0))},X.prototype.removeGeometry=function(e){var t;if(this.geometriesByUniqueId){if(void 0===(t=this.geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var i=this.geometries[this.geometries.length-1];this.geometries[t]=i,this.geometriesByUniqueId&&(this.geometriesByUniqueId[i.uniqueId]=t,this.geometriesByUniqueId[e.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},X.prototype.getGeometries=function(){return this.geometries},X.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},X.prototype.getMeshesByID=function(t){return this.meshes.filter(function(e){return e.id===t})},X.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},X.prototype.getTransformNodeByUniqueID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},X.prototype.getTransformNodesByID=function(t){return this.transformNodes.filter(function(e){return e.id===t})},X.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},X.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;0<=t;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},X.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;0<=t;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;0<=t;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;0<=t;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;0<=t;t--)if(this.lights[t].id===e)return this.lights[t];return null},X.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var i=this.getTransformNodeByID(e);if(i)return i;var r=this.getLightByID(e);if(r)return r;var n=this.getCameraByID(e);if(n)return n;var o=this.getBoneByID(e);return o||null},X.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var i=this.getTransformNodeByName(e);if(i)return i;var r=this.getLightByName(e);if(r)return r;var n=this.getCameraByName(e);if(n)return n;var o=this.getBoneByName(e);return o||null},X.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},X.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},X.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;0<=t;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},X.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},X.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},X.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},X.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},X.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var i=this.morphTargetManagers[t],r=0;r<i.numTargets;++r){var n=i.getTarget(r);if(n.id===e)return n}return null},X.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(X.prototype,"uid",{get:function(){return this._uid||(this._uid=v.b.RandomId()),this._uid},enumerable:!0,configurable:!0}),X.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new a),this._externalData.add(e,t)},X.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},X.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new a),this._externalData.getOrAddWithFactory(e,t)},X.prototype.removeExternalData=function(e){return this._externalData.remove(e)},X.prototype._evaluateSubMesh=function(e,t,i){if(i.hasInstances||i.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var r=0,n=this._evaluateSubMeshStage;r<n.length;r++)n[r].action(t,e);var o=e.getMaterial();null!=o&&(o.hasRenderTargetTextures&&null!=o.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(o)&&(this._processedMaterials.push(o),this._renderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,o))}},X.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(X.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!0,configurable:!0}),X.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},X.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},X.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},X.prototype.freezeActiveMeshes=function(t){var i=this;return void 0===t&&(t=!1),this.executeWhenReady(function(){if(i.activeCamera){i._frustumPlanes||i.setTransformMatrix(i.activeCamera.getViewMatrix(),i.activeCamera.getProjectionMatrix()),i._evaluateActiveMeshes(),i._activeMeshesFrozen=!0,i._skipEvaluateActiveMeshesCompletely=t;for(var e=0;e<i._activeMeshes.length;e++)i._activeMeshes.data[e]._freeze()}}),this},X.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},X.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var e=this._activeMeshes.length,t=0;t<e;t++)(s=this._activeMeshes.data[t]).computeWorldMatrix()}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var i=0,r=this._beforeEvaluateActiveMeshStage;i<r.length;i++)r[i].action();var n=this.getActiveMeshCandidates(),o=n.length;for(t=0;t<o;t++){var s;if(!(s=n.data[t]).isBlocked&&(this._totalVertices.addCount(s.getTotalVertices(),!1),s.isReady()&&s.isEnabled()&&0!==s.scaling.lengthSquared())){s.computeWorldMatrix(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s);var a=this.customLODSelector?this.customLODSelector(s,this.activeCamera):s.getLOD(this.activeCamera);null!=a&&(a!==s&&a.billboardMode!==u.a.BILLBOARDMODE_NONE&&a.computeWorldMatrix(),s._preActivate(),s.isVisible&&0<s.visibility&&0!=(s.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||s.alwaysSelectAsActiveMesh||s.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),a!==s&&a._activate(this._renderId,!1),s._activate(this._renderId,!1)&&(s.isAnInstance?s._internalAbstractMeshDataInfo._actAsRegularMesh&&(a=s):a._internalAbstractMeshDataInfo._onlyForInstances=!1,a._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(s,a)),s._postActivate()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var h=0;h<this.particleSystems.length;h++){var l=this.particleSystems[h];if(l.isStarted()&&l.emitter){var c=l.emitter;c.position&&!c.isEnabled()||(this._activeParticleSystems.push(l),l.animate(),this._renderingManager.dispatchParticles(l))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},X.prototype._activeMesh=function(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));for(var i=0,r=this._activeMeshStage;i<r.length;i++)r[i].action(e,t);if(null!=t&&void 0!==t.subMeshes&&null!==t.subMeshes&&0<t.subMeshes.length)for(var n=this.getActiveSubMeshCandidates(t),o=n.length,s=0;s<o;s++){var a=n.data[s];this._evaluateSubMesh(a,t,e)}},X.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},X.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&1<this.activeCamera.outputRenderTarget.getViewCount())this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var e=this.activeCamera.outputRenderTarget.getInternalTexture();e?this.getEngine().bindFramebuffer(e):P.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},X.prototype._renderForCamera=function(e,t){if(!e||!e._skipRendering){var i=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&e.outputRenderTarget&&1<e.outputRenderTarget.getViewCount()?this.setTransformMatrix(e._rigCameras[0].getViewMatrix(),e._rigCameras[0].getProjectionMatrix(),e._rigCameras[1].getViewMatrix(),e._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var r=0;r<this._softwareSkinnedMeshes.length;r++){var n=this._softwareSkinnedMeshes.data[r];n.applySkeleton(n.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&0<e.customRenderTargets.length&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&0<t.customRenderTargets.length&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets);for(var o=0,s=this._gatherActiveCameraRenderTargetsStage;o<s.length;o++)s[o].action(this._renderTargets);if(this.renderTargetsEnabled){var a=!(this._intermediateRendering=!0);if(0<this._renderTargets.length){v.b.StartPerformanceCounter("Render targets",0<this._renderTargets.length);for(var h=0;h<this._renderTargets.length;h++){var l=this._renderTargets.data[h];if(l._shouldRender()){this._renderId++;var c=l.activeCamera&&l.activeCamera!==this.activeCamera;l.render(c,this.dumpNextRenderTargets),a=!0}}v.b.EndPerformanceCounter("Render targets",0<this._renderTargets.length),this._renderId++}for(var u=0,f=this._cameraDrawRenderTargetStage;u<f.length;u++)a=f[u].action(this.activeCamera)||a;this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(a=!0),a&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._prepareFrame();for(var d=0,p=this._beforeCameraDrawStage;d<p.length;d++)p[d].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var _=0,g=this._afterCameraDrawStage;_<g.length;_++)g[_].action(this.activeCamera);this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._finalizeFrame(e.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},X.prototype._processSubCameras=function(e){if(e.cameraRigMode===b.a.RIG_MODE_NONE||e.outputRenderTarget&&1<e.outputRenderTarget.getViewCount()&&this.getEngine().getCaps().multiview)return this._renderForCamera(e),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else for(var t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e);this._activeCamera=e,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(e)},X.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var i=0;t.actionManager&&i<t.actionManager.actions.length;i++){var r=t.actionManager.actions[i];if(12===r.trigger||13===r.trigger){var n=r.getTriggerParameter(),o=n instanceof f.a?n:n.mesh,s=o.intersectsMesh(t,n.usePreciseIntersection),a=t._intersectionsInProgress.indexOf(o);s&&-1===a?12===r.trigger?(r._executeCurrent(x.CreateNew(t,void 0,o)),t._intersectionsInProgress.push(o)):13===r.trigger&&t._intersectionsInProgress.push(o):!s&&-1<a&&(13===r.trigger&&r._executeCurrent(x.CreateNew(t,void 0,o)),t.actionManager.hasSpecificTrigger(13,function(e){var t=e instanceof f.a?e:e.mesh;return o===t})&&13!==r.trigger||t._intersectionsInProgress.splice(a,1))}}}},X.prototype._advancePhysicsEngineStep=function(e){},X.prototype._animate=function(){},X.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(X.MinDeltaTime,Math.min(this._engine.getDeltaTime(),X.MaxDeltaTime))+this._timeAccumulator,t=this._engine.getTimeStep(),i=1e3/t/1e3,r=0,n=this._engine.getLockstepMaxSteps(),o=Math.floor(e/t);for(o=Math.min(o,n);0<e&&r<o;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*i,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,r++,e-=t;this._timeAccumulator=e<0?0:e}else e=this.useConstantAnimationDeltaTime?16:Math.max(X.MinDeltaTime,Math.min(this._engine.getDeltaTime(),X.MaxDeltaTime)),this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(e)},X.prototype.render=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(var i=0,r=this._beforeCameraUpdateStage;i<r.length;i++)r[i].action();if(e)if(0<this.activeCameras.length)for(var n=0;n<this.activeCameras.length;n++){var o=this.activeCameras[n];if(o.update(),o.cameraRigMode!==b.a.RIG_MODE_NONE)for(var s=0;s<o._rigCameras.length;s++)o._rigCameras[s].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==b.a.RIG_MODE_NONE))for(s=0;s<this.activeCamera._rigCameras.length;s++)this.activeCamera._rigCameras[s].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var a=this.getEngine(),h=this.activeCamera;if(this.renderTargetsEnabled){v.b.StartPerformanceCounter("Custom render targets",0<this.customRenderTargets.length),this._intermediateRendering=!0;for(var l=0;l<this.customRenderTargets.length;l++){var c=this.customRenderTargets[l];if(c._shouldRender()){if(this._renderId++,this.activeCamera=c.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");a.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),c.render(h!==this.activeCamera,this.dumpNextRenderTargets)}}v.b.EndPerformanceCounter("Custom render targets",0<this.customRenderTargets.length),this._intermediateRendering=!1,this._renderId++}this.activeCamera=h,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var u=0,f=this._beforeClearStage;u<f.length;u++)f[u].action();(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var d=0,p=this._gatherRenderTargetsStage;d<p.length;d++)p[d].action(this._renderTargets);if(0<this.activeCameras.length)for(n=0;n<this.activeCameras.length;n++)0<n&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[n]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var _=0,g=this._afterRenderStage;_<g.length;_++)g[_].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(s=0;s<this._toBeDisposed.length;s++){var m=this._toBeDisposed[s];m&&m.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},X.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},X.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},X.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,C.a._LastCreatedScene===this&&(C.a._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,t=this._components;e<t.length;e++)t[e].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var i=0,r=this._activeRequests;i<r.length;i++)r[i].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var n,o=this._engine.getInputElement();if(o)for(n=0;n<this.cameras.length;n++)this.cameras[n].detachControl(o);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),-1<(n=this._engine.scenes.indexOf(this))&&this._engine.scenes.splice(n,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(X.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),X.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;if(t)for(var i in t._indices=[],t._vertexBuffers)t._vertexBuffers.hasOwnProperty(i)&&(t._vertexBuffers[i]._buffer._data=null)}},X.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var i=t[e];i._buffer&&(i._buffer=null)}},X.prototype.getWorldExtends=function(e){var n=new c.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new c.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var t=e.getBoundingInfo(),i=t.boundingBox.minimumWorld,r=t.boundingBox.maximumWorld;c.e.CheckExtends(i,n,o),c.e.CheckExtends(r,n,o)}}),{min:n,max:o}},X.prototype.createPickingRay=function(e,t,i,r,n){throw void 0===n&&(n=!1),S.a.WarnImport("Ray")},X.prototype.createPickingRayToRef=function(e,t,i,r,n,o){throw void 0===o&&(o=!1),S.a.WarnImport("Ray")},X.prototype.createPickingRayInCameraSpace=function(e,t,i){throw S.a.WarnImport("Ray")},X.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,r){throw S.a.WarnImport("Ray")},X.prototype.pick=function(e,t,i,r,n,o){var s=new y.a;return s._pickingUnavailable=!0,s},X.prototype.pickWithRay=function(e,t,i,r){throw S.a.WarnImport("Ray")},X.prototype.multiPick=function(e,t,i,r,n){throw S.a.WarnImport("Ray")},X.prototype.multiPickWithRay=function(e,t,i){throw S.a.WarnImport("Ray")},X.prototype.setPointerOverMesh=function(e){this._inputManager.setPointerOverMesh(e)},X.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},X.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++)t[e]._rebuild();for(var i=0,r=this.meshes;i<r.length;i++)r[i]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var n=0,o=this._components;n<o.length;n++)o[n].rebuild();for(var s=0,a=this.particleSystems;s<a.length;s++)a[s].rebuild()},X.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++)t[e]._rebuild();this.markAllMaterialsAsDirty(1)},X.prototype._getByTags=function(e,t,i){if(void 0===t)return e;var r=[];for(var n in i=i||function(e){},e){var o=e[n];l.a&&l.a.MatchesQuery(o,t)&&(r.push(o),i(o))}return r},X.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},X.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},X.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},X.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},X.prototype.setRenderingOrder=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,i,r)},X.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,r)},X.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(X.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&((this._blockMaterialDirtyMechanism=e)||this.markAllMaterialsAsDirty(31))},enumerable:!0,configurable:!0}),X.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var i=0,r=this.materials;i<r.length;i++){var n=r[i];t&&!t(n)||n.markAsDirty(e)}},X.prototype._loadFile=function(e,t,i,r,n,o){var s=this,a=G.a.LoadFile(e,t,i,r?this.offlineProvider:void 0,n,o);return this._activeRequests.push(a),a.onCompleteObservable.add(function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)}),a},X.prototype._loadFileAsync=function(e,r,n,o){var s=this;return new Promise(function(t,i){s._loadFile(e,function(e){t(e)},r,n,o,function(e,t){i(t)})})},X.prototype._requestFile=function(e,t,i,r,n,o,s){var a=this,h=G.a.RequestFile(e,t,i,r?this.offlineProvider:void 0,n,o,s);return this._activeRequests.push(h),h.onCompleteObservable.add(function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)}),h},X.prototype._requestFileAsync=function(e,r,n,o,s){var a=this;return new Promise(function(t,i){a._requestFile(e,function(e){t(e)},r,n,o,function(e){i(e)},s)})},X.prototype._readFile=function(e,t,i,r,n){var o=this,s=G.a.ReadFile(e,t,i,r,n);return this._activeRequests.push(s),s.onCompleteObservable.add(function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)}),s},X.prototype._readFileAsync=function(e,r,n){var o=this;return new Promise(function(t,i){o._readFile(e,function(e){t(e)},r,n,function(e){i(e)})})},X.FOGMODE_NONE=0,X.FOGMODE_EXP=1,X.FOGMODE_EXP2=2,X.FOGMODE_LINEAR=3,X.MinDeltaTime=1,X.MaxDeltaTime=1e3,X);function X(e,t){var i=W.call(this)||this;i._inputManager=new N(i),i.cameraToUseForPointers=null,i._isScene=!0,i._blockEntityCollection=!1,i.autoClear=!0,i.autoClearDepthAndStencil=!0,i.clearColor=new U.b(.2,.2,.3,1),i.ambientColor=new U.a(0,0,0),i._environmentIntensity=1,i._forceWireframe=!1,i._skipFrustumClipping=!1,i._forcePointsCloud=!1,i.animationsEnabled=!0,i._animationPropertiesOverride=null,i.useConstantAnimationDeltaTime=!1,i.constantlyUpdateMeshUnderPointer=!1,i.hoverCursor="pointer",i.defaultCursor="",i.doNotHandleCursors=!1,i.preventDefaultOnPointerDown=!0,i.preventDefaultOnPointerUp=!0,i.metadata=null,i.reservedDataStore=null,i.disableOfflineSupportExceptionRules=new Array,i.onDisposeObservable=new o.a,i._onDisposeObserver=null,i.onBeforeRenderObservable=new o.a,i._onBeforeRenderObserver=null,i.onAfterRenderObservable=new o.a,i.onAfterRenderCameraObservable=new o.a,i._onAfterRenderObserver=null,i.onBeforeAnimationsObservable=new o.a,i.onAfterAnimationsObservable=new o.a,i.onBeforeDrawPhaseObservable=new o.a,i.onAfterDrawPhaseObservable=new o.a,i.onReadyObservable=new o.a,i.onBeforeCameraRenderObservable=new o.a,i._onBeforeCameraRenderObserver=null,i.onAfterCameraRenderObservable=new o.a,i._onAfterCameraRenderObserver=null,i.onBeforeActiveMeshesEvaluationObservable=new o.a,i.onAfterActiveMeshesEvaluationObservable=new o.a,i.onBeforeParticlesRenderingObservable=new o.a,i.onAfterParticlesRenderingObservable=new o.a,i.onDataLoadedObservable=new o.a,i.onNewCameraAddedObservable=new o.a,i.onCameraRemovedObservable=new o.a,i.onNewLightAddedObservable=new o.a,i.onLightRemovedObservable=new o.a,i.onNewGeometryAddedObservable=new o.a,i.onGeometryRemovedObservable=new o.a,i.onNewTransformNodeAddedObservable=new o.a,i.onTransformNodeRemovedObservable=new o.a,i.onNewMeshAddedObservable=new o.a,i.onMeshRemovedObservable=new o.a,i.onNewSkeletonAddedObservable=new o.a,i.onSkeletonRemovedObservable=new o.a,i.onNewMaterialAddedObservable=new o.a,i.onMaterialRemovedObservable=new o.a,i.onNewTextureAddedObservable=new o.a,i.onTextureRemovedObservable=new o.a,i.onBeforeRenderTargetsRenderObservable=new o.a,i.onAfterRenderTargetsRenderObservable=new o.a,i.onBeforeStepObservable=new o.a,i.onAfterStepObservable=new o.a,i.onActiveCameraChanged=new o.a,i.onBeforeRenderingGroupObservable=new o.a,i.onAfterRenderingGroupObservable=new o.a,i.onMeshImportedObservable=new o.a,i.onAnimationFileImportedObservable=new o.a,i._registeredForLateAnimationBindings=new s.b(256),i.onPrePointerObservable=new o.a,i.onPointerObservable=new o.a,i.onPreKeyboardObservable=new o.a,i.onKeyboardObservable=new o.a,i._useRightHandedSystem=!1,i._timeAccumulator=0,i._currentStepId=0,i._currentInternalStep=0,i._fogEnabled=!0,i._fogMode=X.FOGMODE_NONE,i.fogColor=new U.a(.2,.2,.3),i.fogDensity=.1,i.fogStart=0,i.fogEnd=1e3,i._shadowsEnabled=!0,i._lightsEnabled=!0,i.activeCameras=new Array,i._texturesEnabled=!0,i.particlesEnabled=!0,i.spritesEnabled=!0,i._skeletonsEnabled=!0,i.lensFlaresEnabled=!0,i.collisionsEnabled=!0,i.gravity=new c.e(0,-9.807,0),i.postProcessesEnabled=!0,i.postProcesses=new Array,i.renderTargetsEnabled=!0,i.dumpNextRenderTargets=!1,i.customRenderTargets=new Array,i.importedMeshesFiles=new Array,i.probesEnabled=!0,i._meshesForIntersections=new s.b(256),i.proceduralTexturesEnabled=!0,i._totalVertices=new k.a,i._activeIndices=new k.a,i._activeParticles=new k.a,i._activeBones=new k.a,i._animationTime=0,i.animationTimeScale=1,i._renderId=0,i._frameId=0,i._executeWhenReadyTimeoutId=-1,i._intermediateRendering=!1,i._viewUpdateFlag=-1,i._projectionUpdateFlag=-1,i._toBeDisposed=new Array(256),i._activeRequests=new Array,i._pendingData=new Array,i._isDisposed=!1,i.dispatchAllSubMeshesOfActiveMeshes=!1,i._activeMeshes=new s.a(256),i._processedMaterials=new s.a(256),i._renderTargets=new s.b(256),i._activeParticleSystems=new s.a(256),i._activeSkeletons=new s.b(32),i._softwareSkinnedMeshes=new s.b(32),i._activeAnimatables=new Array,i._transformMatrix=c.a.Zero(),i.requireLightSorting=!1,i._components=[],i._serializableComponents=[],i._transientComponents=[],i._beforeCameraUpdateStage=A.b.Create(),i._beforeClearStage=A.b.Create(),i._gatherRenderTargetsStage=A.b.Create(),i._gatherActiveCameraRenderTargetsStage=A.b.Create(),i._isReadyForMeshStage=A.b.Create(),i._beforeEvaluateActiveMeshStage=A.b.Create(),i._evaluateSubMeshStage=A.b.Create(),i._activeMeshStage=A.b.Create(),i._cameraDrawRenderTargetStage=A.b.Create(),i._beforeCameraDrawStage=A.b.Create(),i._beforeRenderTargetDrawStage=A.b.Create(),i._beforeRenderingGroupDrawStage=A.b.Create(),i._beforeRenderingMeshStage=A.b.Create(),i._afterRenderingMeshStage=A.b.Create(),i._afterRenderingGroupDrawStage=A.b.Create(),i._afterCameraDrawStage=A.b.Create(),i._afterRenderTargetDrawStage=A.b.Create(),i._afterRenderStage=A.b.Create(),i._pointerMoveStage=A.b.Create(),i._pointerDownStage=A.b.Create(),i._pointerUpStage=A.b.Create(),i.geometriesByUniqueId=null,i._defaultMeshCandidates={data:[],length:0},i._defaultSubMeshCandidates={data:[],length:0},i._preventFreeActiveMeshesAndRenderingGroups=!1,i._activeMeshesFrozen=!1,i._skipEvaluateActiveMeshesCompletely=!1,i._allowPostProcessClearColor=!0,i.getDeterministicFrameTime=function(){return i._engine.getTimeStep()},i._blockMaterialDirtyMechanism=!1;var r=Object(n.a)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},t);return i._engine=e||C.a.LastCreatedEngine,r.virtual||(C.a._LastCreatedScene=i)._engine.scenes.push(i),i._uid=null,i._renderingManager=new E.a(i),M.a&&(i.postProcessManager=new M.a(i)),O.a.IsWindowObjectExist()&&i.attachControl(),i._createUbo(),_.a&&(i._imageProcessingConfiguration=new _.a),i.setDefaultCandidateProviders(),r.useGeometryUniqueIdsMap&&(i.geometriesByUniqueId={}),i.useMaterialMeshMap=r.useMaterialMeshMap,i.useClonedMeshMap=r.useClonedMeshMap,t&&t.virtual||i._engine.onNewSceneAddedObservable.notifyObservers(i),i}},function(e,t,i){"use strict";i.d(t,"a",function(){return h});var r=i(1),u=i(0),n=i(3),o=i(4),s=i(23),a=i(8),h=(l.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},l.Construct=function(e,t,i,r){var n=this._NodeConstructors[e];return n?n(t,i,r):null},Object.defineProperty(l.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(e){this._doNotSerialize=e},enumerable:!0,configurable:!0}),l.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(l.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var i=this._parentNode._children.indexOf(this);-1!==i&&this._parentNode._children.splice(i,1),e||this._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),l.prototype._addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},l.prototype._removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._sceneRootNodesIndex]=e[t],e[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(l.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),l.prototype.getClassName=function(){return"Node"},Object.defineProperty(l.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),l.prototype.getScene=function(){return this._scene},l.prototype.getEngine=function(){return this._scene.getEngine()},l.prototype.addBehavior=function(e,t){var i=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(function(){e.attach(i)}):e.attach(this),this._behaviors.push(e)),this},l.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this},Object.defineProperty(l.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),l.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},l.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},l.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(l.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),l.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},l.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},l.prototype._getActionManagerForTrigger=function(e,t){return void 0===t&&(t=!0),this.parent?this.parent._getActionManagerForTrigger(e,!1):null},l.prototype._updateCache=function(e){},l.prototype._isSynchronized=function(){return!0},l.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},l.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},l.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},l.prototype.isReady=function(e){return void 0===e&&(e=!1),this._isReady},l.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},l.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(e){e._syncParentEnabledState()})},l.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},l.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},l.prototype._getDescendants=function(e,t,i){if(void 0===t&&(t=!1),this._children)for(var r=0;r<this._children.length;r++){var n=this._children[r];i&&!i(n)||e.push(n),t||n._getDescendants(e,!1,i)}},l.prototype.getDescendants=function(e,t){var i=new Array;return this._getDescendants(i,e,t),i},l.prototype.getChildMeshes=function(e,t){var i=[];return this._getDescendants(i,e,function(e){return(!t||t(e))&&void 0!==e.cullingStrategy}),i},l.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},l.prototype._setReady=function(e){e!==this._isReady&&(e?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},l.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];if(i.name===e)return i}return null},l.prototype.createAnimationRange=function(e,t,i){if(!this._ranges[e]){this._ranges[e]=l._AnimationRangeFactory(e,t,i);for(var r=0,n=this.animations.length;r<n;r++)this.animations[r]&&this.animations[r].createRange(e,t,i)}},l.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null},l.prototype.getAnimationRange=function(e){return this._ranges[e]},l.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},l.prototype.beginAnimation=function(e,t,i,r){var n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,i,r):null},l.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i=this._ranges[t];if(i){var r={};r.name=t,r.from=i.from,r.to=i.to,e.push(r)}}return e},l.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=u.a.Identity()),this._worldMatrix},l.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._isDisposed=!0,!e)for(var i=0,r=this.getDescendants(!0);i<r.length;i++)r[i].dispose(e,t);this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var n=0,o=this._behaviors;n<o.length;n++)o[n].detach();this._behaviors=[]},l.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var r=0;r<t.ranges.length;r++){var n=t.ranges[r];e.createAnimationRange(n.name,n.from,n.to)}},l.prototype.getHierarchyBoundingVectors=function(e,t){var i,r;if(void 0===e&&(e=!0),void 0===t&&(t=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){var n=this.getBoundingInfo();i=n.boundingBox.minimumWorld.clone(),r=n.boundingBox.maximumWorld.clone()}else i=new u.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new u.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(var o=0,s=this.getDescendants(!1);o<s.length;o++){var a=s[o];if(a.computeWorldMatrix(!0),(!t||t(a))&&a.getBoundingInfo&&0!==a.getTotalVertices()){var h=a.getBoundingInfo().boundingBox,l=h.minimumWorld,c=h.maximumWorld;u.e.CheckExtends(l,i,r),u.e.CheckExtends(c,i,r)}}return{min:i,max:r}},l._AnimationRangeFactory=function(e,t,i){throw a.a.WarnImport("AnimationRange")},l._NodeConstructors={},Object(r.b)([Object(n.c)()],l.prototype,"name",void 0),Object(r.b)([Object(n.c)()],l.prototype,"id",void 0),Object(r.b)([Object(n.c)()],l.prototype,"uniqueId",void 0),Object(r.b)([Object(n.c)()],l.prototype,"state",void 0),Object(r.b)([Object(n.c)()],l.prototype,"metadata",void 0),l);function l(e,t){void 0===t&&(t=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=u.a.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new o.a,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||s.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return s});var r,n,o=i(0);(n=r=r||{})[n.LOCAL=0]="LOCAL",n[n.WORLD=1]="WORLD",n[n.BONE=2]="BONE";var s=(a.X=new o.e(1,0,0),a.Y=new o.e(0,1,0),a.Z=new o.e(0,0,1),a);function a(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return O});var r=i(1),g=i(60),m=i(25),a=i(4),d=(n.FilesToLoad={},n);function n(){}var o=(s.ExponentialBackoff=function(r,n){return void 0===r&&(r=3),void 0===n&&(n=500),function(e,t,i){return 0!==t.status||r<=i||-1!==e.indexOf("file:")?-1:Math.pow(2,i)*n}},s);function s(){}var h,l=(h=Error,Object(r.c)(c,h),c._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c);function c(){return null!==h&&h.apply(this,arguments)||this}var u,p=i(40),f=i(24),_=i(68),v=(u=l,Object(r.c)(b,u),b);function b(e,t){var i=u.call(this,e)||this;return i.name="LoadFileError",l._setPrototypeOf(i,b.prototype),t instanceof g.a?i.request=t:i.file=t,i}var y,x=(y=l,Object(r.c)(T,y),T);function T(e,t){var i=y.call(this,e)||this;return i.request=t,i.name="RequestFileError",l._setPrototypeOf(i,T.prototype),i}var M,E=(M=l,Object(r.c)(A,M),A);function A(e,t){var i=M.call(this,e)||this;return i.file=t,i.name="ReadFileError",l._setPrototypeOf(i,A.prototype),i}var O=(P._CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},P.SetCorsBehavior=function(e,t){if((!e||0!==e.indexOf("data:"))&&P.CorsBehavior)if("string"==typeof P.CorsBehavior||this.CorsBehavior instanceof String)t.crossOrigin=P.CorsBehavior;else{var i=P.CorsBehavior(e);i&&(t.crossOrigin=i)}},P.LoadImage=function(i,t,r,e,n){var o;void 0===n&&(n="");var s=!1;if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)?"undefined"!=typeof Blob?(o=URL.createObjectURL(new Blob([i],{type:n})),s=!0):o="data:"+n+";base64,"+p.a.EncodeArrayBufferToBase64(i):i instanceof Blob?(o=URL.createObjectURL(i),s=!0):(o=P._CleanUrl(i),o=P.PreprocessUrl(i)),"undefined"==typeof Image)return P.LoadFile(o,function(e){createImageBitmap(new Blob([e],{type:n})).then(function(e){t(e),s&&URL.revokeObjectURL(o)}).catch(function(e){r&&r("Error while trying to load image: "+i,e)})},void 0,e||void 0,!0,function(e,t){r&&r("Error while trying to load image: "+i,t)}),null;var a=new Image;P.SetCorsBehavior(o,a);var h=function(){a.removeEventListener("load",h),a.removeEventListener("error",l),t(a),s&&a.src&&URL.revokeObjectURL(a.src)},l=function(e){a.removeEventListener("load",h),a.removeEventListener("error",l),r&&r("Error while trying to load image: "+i,e),s&&a.src&&URL.revokeObjectURL(a.src)};function c(){a.src=o}if(a.addEventListener("load",h),a.addEventListener("error",l),"data:"!==o.substr(0,5)&&e&&e.enableTexturesOffline)e.open(function(){e&&e.loadImage(o,a)},c);else{if(-1!==o.indexOf("file:")){var u=decodeURIComponent(o.substring(5).toLowerCase());if(d.FilesToLoad[u]){try{var f;try{f=URL.createObjectURL(d.FilesToLoad[u])}catch(e){f=URL.createObjectURL(d.FilesToLoad[u])}a.src=f,s=!0}catch(e){a.src=""}return a}}c()}return a},P.ReadFile=function(t,i,e,r,n){var o=new FileReader,s={onCompleteObservable:new a.a,abort:function(){return o.abort()}};return o.onloadend=function(e){return s.onCompleteObservable.notifyObservers(s)},n&&(o.onerror=function(e){n(new E("Unable to read "+t.name,t))}),o.onload=function(e){i(e.target.result)},e&&(o.onprogress=e),r?o.readAsArrayBuffer(t):o.readAsText(t),s},P.LoadFile=function(e,i,t,r,n,o){if(-1!==e.indexOf("file:")){var s=decodeURIComponent(e.substring(5).toLowerCase());0===s.indexOf("./")&&(s=s.substring(2));var a=d.FilesToLoad[s];if(a)return P.ReadFile(a,i,t,n,o?function(e){return o(void 0,new v(e.message,e.file))}:void 0)}return P.RequestFile(e,function(e,t){i(e,t?t.responseURL:void 0)},t,r,n,o?function(e){o(e.request,new v(e.message,e.request))}:void 0)},P.RequestFile=function(e,l,t,i,c,u,f){function r(){var s=new g.a,a=null;_.abort=function(){p=!0,s.readyState!==(XMLHttpRequest.DONE||4)&&s.abort(),null!==a&&(clearTimeout(a),a=null)};var h=function(r){s.open("GET",d),f&&f(s),c&&(s.responseType="arraybuffer"),t&&s.addEventListener("progress",t);var n=function(){s.removeEventListener("loadend",n),_.onCompleteObservable.notifyObservers(_),_.onCompleteObservable.clear()};s.addEventListener("loadend",n);var o=function(){if(!p&&s.readyState===(XMLHttpRequest.DONE||4)){if(s.removeEventListener("readystatechange",o),200<=s.status&&s.status<300||0===s.status&&(!m.a.IsWindowObjectExist()||P.IsFileURL()))return void l(c?s.response:s.responseText,s);var e=P.DefaultRetryStrategy;if(e){var t=e(d,s,r);if(-1!==t)return s.removeEventListener("loadend",n),s=new g.a,void(a=setTimeout(function(){return h(r+1)},t))}var i=new x("Error status: "+s.status+" "+s.statusText+" - Unable to load "+d,s);u&&u(i)}};s.addEventListener("readystatechange",o),s.send()};h(0)}e=P._CleanUrl(e),e=P.PreprocessUrl(e);var d=P.BaseUrl+e,p=!1,_={onCompleteObservable:new a.a,abort:function(){return p=!0}};if(i&&i.enableSceneOffline){var n=function(e){e&&400<e.status?u&&u(e):r()};i.open(function(){i&&i.loadFile(P.BaseUrl+e,function(e){p||l(e),_.onCompleteObservable.notifyObservers(_)},t?function(e){p||t(e)}:void 0,n,c)},n)}else r();return _},P.IsFileURL=function(){return"file:"===location.protocol},P.DefaultRetryStrategy=o.ExponentialBackoff(),P.BaseUrl="",P.CorsBehavior="anonymous",P.PreprocessUrl=function(e){return e},P);function P(){}f.a._FileToolsLoadImage=O.LoadImage.bind(O),f.a._FileToolsLoadFile=O.LoadFile.bind(O),_.a._FileToolsLoadFile=O.LoadFile.bind(O)},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=i(25),n=(Object.defineProperty(o,"Now",{get:function(){return r.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),o);function o(){}},function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"a",function(){return h});var s,r,n=i(4),a=i(70),o=i(8);(r=s=s||{})[r.Unknown=0]="Unknown",r[r.Url=1]="Url",r[r.Temp=2]="Temp",r[r.Raw=3]="Raw",r[r.Dynamic=4]="Dynamic",r[r.RenderTarget=5]="RenderTarget",r[r.MultiRenderTarget=6]="MultiRenderTarget",r[r.Cube=7]="Cube",r[r.CubeRaw=8]="CubeRaw",r[r.CubePrefiltered=9]="CubePrefiltered",r[r.Raw3D=10]="Raw3D",r[r.Raw2DArray=11]="Raw2DArray",r[r.Depth=12]="Depth",r[r.CubeRawRGBD=13]="CubeRawRGBD";var h=(l.prototype.getEngine=function(){return this._engine},Object.defineProperty(l.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),l.prototype.incrementReferences=function(){this._references++},l.prototype.updateSize=function(e,t,i){void 0===i&&(i=1),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},l.prototype._rebuild=function(){var e,t=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case s.Temp:return;case s.Url:return void(e=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){e._swapAndDie(t),t.isReady=!0},null,this._buffer,void 0,this.format));case s.Raw:return(e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case s.Raw3D:return(e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case s.Raw2DArray:return(e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case s.Dynamic:return(e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case s.RenderTarget:var i=new a.a;if(i.generateDepthBuffer=this._generateDepthBuffer,i.generateMipMaps=this.generateMipMaps,i.generateStencilBuffer=this._generateStencilBuffer,i.samplingMode=this.samplingMode,i.type=this.type,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,i);else{var r={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};e=this._engine.createRenderTargetTexture(r,i)}return e._swapAndDie(this),void(this.isReady=!0);case s.Depth:var n={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},o={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(e=this._engine.createDepthStencilTexture(o,n))._swapAndDie(this),void(this.isReady=!0);case s.Cube:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){e._swapAndDie(t),t.isReady=!0},null,this.format,this._extension));case s.CubeRaw:return(e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case s.CubeRawRGBD:return e=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void l._UpdateRGBDAsync(e,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){e._swapAndDie(t),t.isReady=!0});case s.CubePrefiltered:return void((e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(t),t.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},l.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),e._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t,i=this._engine.getLoadedTexturesCache();-1!==(t=i.indexOf(this))&&i.splice(t,1),-1===(t=i.indexOf(e))&&i.push(e)},l.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},l._UpdateRGBDAsync=function(e,t,i,r,n){throw o.a.WarnImport("environmentTextureTools")},l);function l(e,t,i){void 0===i&&(i=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new n.a,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=s.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._engine=e,this._source=t,i||(this._webGLTexture=e._createTexture())}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var o,r=i(1),h=i(3),n=i(4),v=i(0),s=i(34),c=i(35),a=(o=s.a,Object(r.c)(b,o),Object.defineProperty(b.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(b.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){(this._rotationQuaternion=e)&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"forward",{get:function(){return v.e.Normalize(v.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"up",{get:function(){return v.e.Normalize(v.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return v.e.Normalize(v.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),b.prototype.updatePoseMatrix=function(e){return this._poseMatrix?this._poseMatrix.copyFrom(e):this._poseMatrix=e.clone(),this},b.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=v.a.Identity()),this._poseMatrix},b.prototype._isSynchronized=function(){var e=this._cache;if(this.billboardMode!==e.billboardMode||this.billboardMode!==b.BILLBOARDMODE_NONE)return!1;if(e.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!e.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!e.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!e.rotation.equals(this._rotation))return!1;return!!e.scaling.equals(this._scaling)},b.prototype._initCache=function(){o.prototype._initCache.call(this);var e=this._cache;e.localMatrixUpdated=!1,e.position=v.e.Zero(),e.scaling=v.e.Zero(),e.rotation=v.e.Zero(),e.rotationQuaternion=new v.b(0,0,0,0),e.billboardMode=-1,e.infiniteDistance=!1},b.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(b.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!0,configurable:!0}),b.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},b.prototype.setPivotMatrix=function(e,t){return void 0===t&&(t=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=v.a.Invert(this._pivotMatrix)),this},b.prototype.getPivotMatrix=function(){return this._pivotMatrix},b.prototype.instantiateHierarchy=function(e,t,i){void 0===e&&(e=null);var r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);r&&i&&i(this,r);for(var n=0,o=this.getChildTransformNodes(!0);n<o.length;n++)o[n].instantiateHierarchy(r,t,i);return r},b.prototype.freezeWorldMatrix=function(e){return void 0===e&&(e=null),e?this._worldMatrix=e:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},b.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(b.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),b.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},b.prototype.setAbsolutePosition=function(e){if(!e)return this;var t,i,r;if(void 0===e.x){if(arguments.length<3)return this;t=e,i=arguments[1],r=arguments[2]}else t=e.x,i=e.y,r=e.z;if(this.parent){var n=v.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),v.e.TransformCoordinatesFromFloatsToRef(t,i,r,n,this.position)}else this.position.x=t,this.position.y=i,this.position.z=r;return this},b.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=v.e.TransformNormal(e,this._localMatrix),this},b.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=v.c.Matrix[0];return this._localMatrix.invertToRef(e),v.e.TransformNormal(this.position,e)},b.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=v.e.TransformCoordinates(e,this._localMatrix),this},b.prototype.lookAt=function(e,t,i,r,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=c.b.LOCAL);var o=b._lookAtVectorCache,s=n===c.b.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(s,o),this.setDirection(o,t,i,r),n===c.b.WORLD&&this.parent)if(this.rotationQuaternion){var a=v.c.Matrix[0];this.rotationQuaternion.toRotationMatrix(a);var h=v.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),a.multiplyToRef(h,a),this.rotationQuaternion.fromRotationMatrix(a)}else{var l=v.c.Quaternion[0];v.b.FromEulerVectorToRef(this.rotation,l),a=v.c.Matrix[0],l.toRotationMatrix(a),h=v.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),a.multiplyToRef(h,a),l.fromRotationMatrix(a),l.toEulerAnglesToRef(this.rotation)}return this},b.prototype.getDirection=function(e){var t=v.e.Zero();return this.getDirectionToRef(e,t),t},b.prototype.getDirectionToRef=function(e,t){return v.e.TransformNormalToRef(e,this.getWorldMatrix(),t),this},b.prototype.setDirection=function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0);var n=-Math.atan2(e.z,e.x)+Math.PI/2,o=Math.sqrt(e.x*e.x+e.z*e.z),s=-Math.atan2(e.y,o);return this.rotationQuaternion?v.b.RotationYawPitchRollToRef(n+t,s+i,r,this.rotationQuaternion):(this.rotation.x=s+i,this.rotation.y=n+t,this.rotation.z=r),this},b.prototype.setPivotPoint=function(e,t){void 0===t&&(t=c.b.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var i=this.getWorldMatrix();if(t==c.b.WORLD){var r=v.c.Matrix[0];i.invertToRef(r),e=v.e.TransformCoordinates(e,r)}return this.setPivotMatrix(v.a.Translation(-e.x,-e.y,-e.z),!0)},b.prototype.getPivotPoint=function(){var e=v.e.Zero();return this.getPivotPointToRef(e),e},b.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},b.prototype.getAbsolutePivotPoint=function(){var e=v.e.Zero();return this.getAbsolutePivotPointToRef(e),e},b.prototype.getAbsolutePivotPointToRef=function(e){return e.x=this._pivotMatrix.m[12],e.y=this._pivotMatrix.m[13],e.z=this._pivotMatrix.m[14],this.getPivotPointToRef(e),v.e.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},b.prototype.setParent=function(e){if(!e&&!this.parent)return this;var t=v.c.Quaternion[0],i=v.c.Vector3[0],r=v.c.Vector3[1];if(e){var n=v.c.Matrix[0],o=v.c.Matrix[1];this.computeWorldMatrix(!0),e.computeWorldMatrix(!0),e.getWorldMatrix().invertToRef(o),this.getWorldMatrix().multiplyToRef(o,n),n.decompose(r,t,i)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(r,t,i);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(r),this.position.copyFrom(i),this.parent=e,this},Object.defineProperty(b.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),b.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},b.prototype.attachToBone=function(e,t){return this._transformToBoneReferal=t,(this.parent=e).getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},b.prototype.detachFromBone=function(){return this.parent&&(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null),this},b.prototype.rotate=function(e,t,i){var r;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==c.b.LOCAL){if(this.parent){var n=v.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),e=v.e.TransformNormal(e,n)}(r=v.b.RotationAxisToRef(e,t,b._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=v.b.RotationAxisToRef(e,t,b._rotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this},b.prototype.rotateAround=function(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=v.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var r=v.c.Vector3[0],n=v.c.Vector3[1],o=v.c.Vector3[2],s=v.c.Quaternion[0],a=v.c.Matrix[0],h=v.c.Matrix[1],l=v.c.Matrix[2],c=v.c.Matrix[3];return e.subtractToRef(this.position,r),v.a.TranslationToRef(r.x,r.y,r.z,a),v.a.TranslationToRef(-r.x,-r.y,-r.z,h),v.a.RotationAxisToRef(t,i,l),h.multiplyToRef(l,c),c.multiplyToRef(a,c),c.decompose(n,s,o),this.position.addInPlace(o),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},b.prototype.translate=function(e,t,i){var r=e.scale(t);if(i&&i!==c.b.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{var n=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(n)}return this},b.prototype.addRotation=function(e,t,i){var r;this.rotationQuaternion?r=this.rotationQuaternion:(r=v.c.Quaternion[1],v.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));var n=v.c.Quaternion[0];return v.b.RotationYawPitchRollToRef(t,e,i,n),r.multiplyInPlace(n),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this},b.prototype._getEffectiveParent=function(){return this.parent},b.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var t=this.getScene().getRenderId();if(!this._isDirty&&!e&&this.isSynchronized())return this._currentRenderId=t,this._worldMatrix;var i=this.getScene().activeCamera,r=0!=(this._billboardMode&b.BILLBOARDMODE_USE_POSITION),n=this._billboardMode!==b.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;n&&i&&r&&(this.lookAt(i.position),(this.billboardMode&b.BILLBOARDMODE_X)!==b.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&b.BILLBOARDMODE_Y)!==b.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&b.BILLBOARDMODE_Z)!==b.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,this._currentRenderId=t,this._childUpdateId++,this._isDirty=!1;var s=this._getEffectiveParent(),a=o.scaling,h=o.position;if(this._infiniteDistance)if(!this.parent&&i){var l=i.getWorldMatrix(),c=new v.e(l.m[12],l.m[13],l.m[14]);h.copyFromFloats(this._position.x+c.x,this._position.y+c.y,this._position.z+c.z)}else h.copyFrom(this._position);else h.copyFrom(this._position);a.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var u=o.rotationQuaternion;if(this._rotationQuaternion?(this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(v.b.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0)),u.copyFrom(this._rotationQuaternion)):(v.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,u),o.rotation.copyFrom(this._rotation)),this._usePivotMatrix){var f=v.c.Matrix[1];v.a.ScalingToRef(a.x,a.y,a.z,f);var d=v.c.Matrix[0];u.toRotationMatrix(d),this._pivotMatrix.multiplyToRef(f,v.c.Matrix[4]),v.c.Matrix[4].multiplyToRef(d,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(h.x,h.y,h.z)}else v.a.ComposeToRef(a,u,h,this._localMatrix);if(s&&s.getWorldMatrix){if(e&&s.computeWorldMatrix(),n){this._transformToBoneReferal?s.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),v.c.Matrix[7]):v.c.Matrix[7].copyFrom(s.getWorldMatrix());var p=v.c.Vector3[5],_=v.c.Vector3[6];v.c.Matrix[7].decompose(_,void 0,p),v.a.ScalingToRef(_.x,_.y,_.z,v.c.Matrix[7]),v.c.Matrix[7].setTranslation(p),this._localMatrix.multiplyToRef(v.c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(s.getWorldMatrix(),v.c.Matrix[6]),v.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(s.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(n&&i&&this.billboardMode&&!r){var g=v.c.Vector3[0];if(this._worldMatrix.getTranslationToRef(g),v.c.Matrix[1].copyFrom(i.getViewMatrix()),v.c.Matrix[1].setTranslationFromFloats(0,0,0),v.c.Matrix[1].invertToRef(v.c.Matrix[0]),(this.billboardMode&b.BILLBOARDMODE_ALL)!==b.BILLBOARDMODE_ALL){v.c.Matrix[0].decompose(void 0,v.c.Quaternion[0],void 0);var m=v.c.Vector3[1];v.c.Quaternion[0].toEulerAnglesToRef(m),(this.billboardMode&b.BILLBOARDMODE_X)!==b.BILLBOARDMODE_X&&(m.x=0),(this.billboardMode&b.BILLBOARDMODE_Y)!==b.BILLBOARDMODE_Y&&(m.y=0),(this.billboardMode&b.BILLBOARDMODE_Z)!==b.BILLBOARDMODE_Z&&(m.z=0),v.a.RotationYawPitchRollToRef(m.y,m.x,m.z,v.c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(v.c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(v.c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniform?this._updateNonUniformScalingState(!0):s&&s._nonUniformScaling?this._updateNonUniformScalingState(s._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=v.a.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},b.prototype.resetLocalMatrix=function(e){if(void 0===e&&(e=!0),this.computeWorldMatrix(),e)for(var t=this.getChildren(),i=0;i<t.length;++i){var r=t[i];if(r){r.computeWorldMatrix();var n=v.c.Matrix[0];r._localMatrix.multiplyToRef(this._localMatrix,n);var o=v.c.Quaternion[0];n.decompose(r.scaling,o,r.position),r.rotationQuaternion?r.rotationQuaternion=o:o.toEulerAnglesToRef(r.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=v.b.Identity()),this._worldMatrix=v.a.Identity()},b.prototype._afterComputeWorldMatrix=function(){},b.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},b.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},b.prototype.getPositionInCameraSpace=function(e){return void 0===e&&(e=null),e=e||this.getScene().activeCamera,v.e.TransformCoordinates(this.absolutePosition,e.getViewMatrix())},b.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e=e||this.getScene().activeCamera,this.absolutePosition.subtract(e.globalPosition).length()},b.prototype.clone=function(e,t,i){var r=this,n=h.a.Clone(function(){return new b(e,r.getScene())},this);if(n.name=e,n.id=e,t&&(n.parent=t),!i)for(var o=this.getDescendants(!0),s=0;s<o.length;s++){var a=o[s];a.clone&&a.clone(e+"."+a.name,n)}return n},b.prototype.serialize=function(e){var t=h.a.Serialize(this,e);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),this.parent&&(t.parentId=this.parent.id),t},b.Parse=function(e,t,i){var r=h.a.Parse(function(){return new b(e.name,t)},e,t,i);return e.localMatrix?r.setPreTransformMatrix(v.a.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(v.a.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),e.parentId&&(r._waitingParentId=e.parentId),r},b.prototype.getChildTransformNodes=function(e,t){var i=[];return this._getDescendants(i,e,function(e){return(!t||t(e))&&e instanceof b}),i},b.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),e)for(var i=0,r=this.getChildTransformNodes(!0);i<r.length;i++){var n=r[i];n.parent=null,n.computeWorldMatrix(!0)}o.prototype.dispose.call(this,e,t)},b.prototype.normalizeToUnitCube=function(e,t,i){void 0===e&&(e=!0),void 0===t&&(t=!1);var r=null,n=null;t&&(this.rotationQuaternion?(n=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var o=this.getHierarchyBoundingVectors(e,i),s=o.max.subtract(o.min),a=Math.max(s.x,s.y,s.z);if(0===a)return this;var h=1/a;return this.scaling.scaleInPlace(h),t&&(this.rotationQuaternion&&n?this.rotationQuaternion.copyFrom(n):this.rotation&&r&&this.rotation.copyFrom(r)),this},b.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},b.BILLBOARDMODE_NONE=0,b.BILLBOARDMODE_X=1,b.BILLBOARDMODE_Y=2,b.BILLBOARDMODE_Z=4,b.BILLBOARDMODE_ALL=7,b.BILLBOARDMODE_USE_POSITION=128,b._lookAtVectorCache=new v.e(0,0,0),b._rotationAxisCache=new v.b,Object(r.b)([Object(h.k)("position")],b.prototype,"_position",void 0),Object(r.b)([Object(h.k)("rotation")],b.prototype,"_rotation",void 0),Object(r.b)([Object(h.i)("rotationQuaternion")],b.prototype,"_rotationQuaternion",void 0),Object(r.b)([Object(h.k)("scaling")],b.prototype,"_scaling",void 0),Object(r.b)([Object(h.c)("billboardMode")],b.prototype,"_billboardMode",void 0),Object(r.b)([Object(h.c)()],b.prototype,"scalingDeterminant",void 0),Object(r.b)([Object(h.c)("infiniteDistance")],b.prototype,"_infiniteDistance",void 0),Object(r.b)([Object(h.c)()],b.prototype,"ignoreNonUniformScaling",void 0),Object(r.b)([Object(h.c)()],b.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),b);function b(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!0);var r=o.call(this,e,t)||this;return r._forward=new v.e(0,0,1),r._forwardInverted=new v.e(0,0,-1),r._up=new v.e(0,1,0),r._right=new v.e(1,0,0),r._rightInverted=new v.e(-1,0,0),r._position=v.e.Zero(),r._rotation=v.e.Zero(),r._rotationQuaternion=null,r._scaling=v.e.One(),r._isDirty=!1,r._transformToBoneReferal=null,r._isAbsoluteSynced=!1,r._billboardMode=b.BILLBOARDMODE_NONE,r._preserveParentRotationForBillboard=!1,r.scalingDeterminant=1,r._infiniteDistance=!1,r.ignoreNonUniformScaling=!1,r.reIntegrateRotationIntoRotationQuaternion=!1,r._poseMatrix=null,r._localMatrix=v.a.Zero(),r._usePivotMatrix=!1,r._absolutePosition=v.e.Zero(),r._absoluteScaling=v.e.Zero(),r._absoluteRotationQuaternion=v.b.Identity(),r._pivotMatrix=v.a.Identity(),r._postMultiplyPivotMatrix=!1,r._isWorldMatrixFrozen=!1,r._indexInSceneTransformNodesArray=-1,r.onAfterWorldMatrixUpdateObservable=new n.a,r._nonUniformScaling=!1,i&&r.getScene().addTransformNode(r),r}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},n.StartsWith=function(e,t){return 0===e.indexOf(t)},n.Decode=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t},n.EncodeArrayBufferToBase64=function(e){for(var t,i,r,n,o,s,a,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0,u=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);c<u.length;)n=(t=u[c++])>>2,o=(3&t)<<4|(i=c<u.length?u[c++]:Number.NaN)>>4,s=(15&i)<<2|(r=c<u.length?u[c++]:Number.NaN)>>6,a=63&r,isNaN(i)?s=a=64:isNaN(r)&&(a=64),l+=h.charAt(n)+h.charAt(o)+h.charAt(s)+h.charAt(a);return l},n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return u});var r=i(1),n=i(2),c=i(67),o=i(32),s=i(58),a=(Object.defineProperty(h.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(e){this._materialDefines=e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),h.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},h);function h(){this._materialDefines=null,this._materialEffect=null}var l,u=(l=a,Object(r.c)(f,l),f.AddToMesh=function(e,t,i,r,n,o,s,a){return void 0===a&&(a=!0),new f(e,t,i,r,n,o,s,a)},Object.defineProperty(f.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),f.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},f.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},f.prototype.getMesh=function(){return this._mesh},f.prototype.getRenderingMesh=function(){return this._renderingMesh},f.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},f.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(!(e=e||this._renderingMesh.getVerticesData(n.b.PositionKind)))return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,i=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===i.length){var r=this._renderingMesh.getBoundingInfo();t={minimum:r.minimum.clone(),maximum:r.maximum.clone()}}else t=Object(s.b)(e,i,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new o.a(t.minimum,t.maximum),this},f.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},f.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this},f.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},f.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},f.prototype.render=function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},f.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)i.push(e[r],e[r+1],e[r+1],e[r+2],e[r+2],e[r]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer},f.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},f.prototype.intersects=function(e,t,i,r,n){var o=this.getMaterial();if(!o)return null;var s=3,a=!1;switch(o.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:s=1,a=!0}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,r):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,r,n):this._intersectTriangles(e,t,i,s,a,r,n)},f.prototype._intersectLines=function(e,t,i,r,n){for(var o=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){var a=t[i[s]],h=t[i[s+1]],l=e.intersectionSegment(a,h,r);if(!(l<0)&&(n||!o||l<o.distance)&&((o=new c.a(null,null,l)).faceId=s/2,n))break}return o},f.prototype._intersectUnIndexedLines=function(e,t,i,r,n){for(var o=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){var a=t[s],h=t[s+1],l=e.intersectionSegment(a,h,r);if(!(l<0)&&(n||!o||l<o.distance)&&((o=new c.a(null,null,l)).faceId=s/2,n))break}return o},f.prototype._intersectTriangles=function(e,t,i,r,n,o,s){for(var a=null,h=-1,l=this.indexStart;l<this.indexStart+this.indexCount;l+=r){h++;var c=i[l],u=i[l+1],f=i[l+2];if(n&&4294967295===f)l+=2;else{var d=t[c],p=t[u],_=t[f];if(!s||s(d,p,_,e)){var g=e.intersectsTriangle(d,p,_);if(g){if(g.distance<0)continue;if((o||!a||g.distance<a.distance)&&((a=g).faceId=h,o))break}}}}return a},f.prototype._intersectUnIndexedTriangles=function(e,t,i,r,n){for(var o=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=3){var a=t[s],h=t[s+1],l=t[s+2];if(!n||n(a,h,l,e)){var c=e.intersectsTriangle(a,h,l);if(c){if(c.distance<0)continue;if((r||!o||c.distance<o.distance)&&((o=c).faceId=s/3,r))break}}}return o},f.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},f.prototype.clone=function(e,t){var i=new f(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){var r=this.getBoundingInfo();if(!r)return i;i._boundingInfo=new o.a(r.minimum,r.maximum)}return i},f.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},f.prototype.getClassName=function(){return"SubMesh"},f.CreateFromIndices=function(e,t,i,r,n){for(var o=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=(n||r).getIndices(),h=t;h<t+i;h++){var l=a[h];l<o&&(o=l),s<l&&(s=l)}return new f(e,o,s-o+1,t,i,r,n)},f);function f(e,t,i,r,n,o,s,a){void 0===a&&(a=!0);var h=l.call(this)||this;return h.materialIndex=e,h.verticesStart=t,h.verticesCount=i,h.indexStart=r,h.indexCount=n,h._linesIndexCount=0,h._linesIndexBuffer=null,h._lastColliderWorldVertices=null,h._lastColliderTransformMatrix=null,h._renderId=0,h._alphaIndex=0,h._distanceToCamera=0,h._currentMaterial=null,h._mesh=o,h._renderingMesh=s||o,o.subMeshes.push(h),h._trianglePlanes=[],h._id=o.subMeshes.length-1,a&&(h.refreshBoundingInfo(),o.computeWorldMatrix(!0)),h}},function(e,t,i){"use strict";i.d(t,"a",function(){return T});var a,r=i(1),_=i(13),n=i(4),g=i(0),o=i(26),m=i(2),d=i(12),s=i(39),v=i(47),h=i(32),l=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new g.e(0,0,0),this._diffPositionForCollisions=new g.e(0,0,0)},c=i(8),u=i(58),f=i(7),p=i(15),b=i(35),y=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=g.e.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},x=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new y,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1},T=(a=s.a,Object(r.c)(M,a),Object.defineProperty(M,"BILLBOARDMODE_NONE",{get:function(){return s.a.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_X",{get:function(){return s.a.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_Y",{get:function(){return s.a.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_Z",{get:function(){return s.a.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_ALL",{get:function(){return s.a.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_USE_POSITION",{get:function(){return s.a.BILLBOARDMODE_USE_POSITION},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),M.prototype._updateNonUniformScalingState=function(e){return!!a.prototype._updateNonUniformScalingState.call(this,e)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(M.prototype,"onCollide",{set:function(e){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"onCollisionPositionChange",{set:function(e){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){this._internalAbstractMeshDataInfo._visibility!==e&&(this._internalAbstractMeshDataInfo._visibility=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"material",{get:function(){return this._material},set:function(e){this._material!==e&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),(this._material=e)&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(e){this._meshCollisionData._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(e){this._meshCollisionData._collisionGroup=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),M.prototype.getClassName=function(){return"AbstractMesh"},M.prototype.toString=function(e){var t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t},M.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==s.a.BILLBOARDMODE_NONE?this._masterMesh:a.prototype._getEffectiveParent.call(this)},M.prototype._getActionManagerForTrigger=function(e,t){if(void 0===t&&(t=!0),this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},M.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++)t[e]._rebuild()},M.prototype._resyncLightSources=function(){for(var e=this._lightSources.length=0,t=this.getScene().lights;e<t.length;e++){var i=t[e];i.isEnabled()&&i.canAffectMesh(this)&&this._lightSources.push(i)}this._markSubMeshesAsLightDirty()},M.prototype._resyncLightSource=function(e){var t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty()},M.prototype._unBindEffect=function(){for(var e=0,t=this.subMeshes;e<t.length;e++)t[e].setEffect(null)},M.prototype._removeLightSource=function(e,t){var i=this._lightSources.indexOf(e);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))},M.prototype._markSubMeshesAsDirty=function(e){if(this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){var r=i[t];r._materialDefines&&e(r._materialDefines)}},M.prototype._markSubMeshesAsLightDirty=function(t){void 0===t&&(t=!1),this._markSubMeshesAsDirty(function(e){return e.markAsLightDirty(t)})},M.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},M.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++){var i=t[e].getMaterial();i&&i.markAsDirty(16)}},Object.defineProperty(M.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),M.prototype.getLOD=function(e){return this},M.prototype.getTotalVertices=function(){return 0},M.prototype.getTotalIndices=function(){return 0},M.prototype.getIndices=function(){return null},M.prototype.getVerticesData=function(e){return null},M.prototype.setVerticesData=function(e,t,i,r){return this},M.prototype.updateVerticesData=function(e,t,i,r){return this},M.prototype.setIndices=function(e,t){return this},M.prototype.isVerticesDataPresent=function(e){return!1},M.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},M.prototype.normalizeToUnitCube=function(e,t,i){return void 0===e&&(e=!0),void 0===t&&(t=!1),a.prototype.normalizeToUnitCube.call(this,e,t,i)},M.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(M.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(m.b.MatricesIndicesKind)&&this.isVerticesDataPresent(m.b.MatricesWeightsKind)},enumerable:!0,configurable:!0}),M.prototype._preActivate=function(){},M.prototype._preActivateForIntermediateRendering=function(e){},M.prototype._activate=function(e,t){return this._renderId=e,!0},M.prototype._postActivate=function(){},M.prototype._freeze=function(){},M.prototype._unFreeze=function(){},M.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===s.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():a.prototype.getWorldMatrix.call(this)},M.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():a.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(M.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"hasInstances",{get:function(){return!1},enumerable:!0,configurable:!0}),M.prototype.movePOV=function(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this},M.prototype.calcMovePOV=function(e,t,i){var r=new g.a;(this.rotationQuaternion?this.rotationQuaternion:g.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(r);var n=g.e.Zero(),o=this.definedFacingForward?-1:1;return g.e.TransformCoordinatesFromFloatsToRef(e*o,t,i*o,r,n),n},M.prototype.rotatePOV=function(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this},M.prototype.calcRotatePOV=function(e,t,i){var r=this.definedFacingForward?1:-1;return new g.e(e*r,t,i*r)},M.prototype.refreshBoundingInfo=function(e){return void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(e),null),this},M.prototype._refreshBoundingInfo=function(e,t){if(e){var i=Object(u.a)(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new h.a(i.minimum,i.maximum)}if(this.subMeshes)for(var r=0;r<this.subMeshes.length;r++)this.subMeshes[r].refreshBoundingInfo(e);this._updateBoundingInfo()},M.prototype._getPositionData=function(e){var t=this.getVerticesData(m.b.PositionKind);if(t&&e&&this.skeleton){t=_.b.Slice(t),this._generatePointsArray();var i=this.getVerticesData(m.b.MatricesIndicesKind),r=this.getVerticesData(m.b.MatricesWeightsKind);if(r&&i){var n=4<this.numBoneInfluencers,o=n?this.getVerticesData(m.b.MatricesIndicesExtraKind):null,s=n?this.getVerticesData(m.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var a=this.skeleton.getTransformMatrices(this),h=g.c.Vector3[0],l=g.c.Matrix[0],c=g.c.Matrix[1],u=0,f=0;f<t.length;f+=3,u+=4){var d,p;for(l.reset(),d=0;d<4;d++)0<(p=r[u+d])&&(g.a.FromFloat32ArrayToRefScaled(a,Math.floor(16*i[u+d]),p,c),l.addToSelf(c));if(n)for(d=0;d<4;d++)0<(p=s[u+d])&&(g.a.FromFloat32ArrayToRefScaled(a,Math.floor(16*o[u+d]),p,c),l.addToSelf(c));g.e.TransformCoordinatesFromFloatsToRef(t[f],t[f+1],t[f+2],l,h),h.toArray(t,f),this._positions&&this._positions[f/3].copyFrom(h)}}}return t},M.prototype._updateBoundingInfo=function(){var e=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(e.worldMatrixFromCache):this._boundingInfo=new h.a(this.absolutePosition,this.absolutePosition,e.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache),this},M.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,i=0;i<t;i++){var r=this.subMeshes[i];(1<t||!r.IsGlobal)&&r.updateBoundingInfo(e)}return this},M.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(M.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),M.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},M.prototype.isCompletelyInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(e)},M.prototype.intersectsMesh=function(e,t,i){if(void 0===t&&(t=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,t))return!0;if(i)for(var r=0,n=this.getChildMeshes();r<n.length;r++)if(n[r].intersectsMesh(e,t,!0))return!0;return!1},M.prototype.intersectsPoint=function(e){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(e)},Object.defineProperty(M.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(e){this._meshCollisionData._checkCollisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),M.prototype.moveWithCollisions=function(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var t=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=t.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._meshCollisionData._oldPositionForCollisions,e,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},M.prototype._collideForSubMesh=function(e,t,i){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var r=e.verticesStart,n=e.verticesStart+e.verticesCount,o=r;o<n;o++)e._lastColliderWorldVertices.push(g.e.TransformCoordinates(this._positions[o],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this),this},M.prototype._processCollisionsForSubMeshes=function(e,t){for(var i=this._scene.getCollidingSubMeshCandidates(this,e),r=i.length,n=0;n<r;n++){var o=i.data[n];1<r&&!o._checkCollision(e)||this._collideForSubMesh(o,t,e)}return this},M.prototype._checkCollision=function(e){if(!this._boundingInfo||!this._boundingInfo._checkCollision(e))return this;var t=g.c.Matrix[0],i=g.c.Matrix[1];return g.a.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this},M.prototype._generatePointsArray=function(){return!1},M.prototype.intersects=function(e,t,i){var r=new v.a,n="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,o=this._boundingInfo;if(!(this.subMeshes&&o&&e.intersectsSphere(o.boundingSphere,n)&&e.intersectsBox(o.boundingBox,n)))return r;if(!this._generatePointsArray())return r;for(var s=null,a=this._scene.getIntersectingSubMeshCandidates(this,e),h=a.length,l=0;l<h;l++){var c=a.data[l];if(!(1<h)||c.canIntersects(e)){var u=c.intersects(e,this._positions,this.getIndices(),t,i);if(u&&(t||!s||u.distance<s.distance)&&((s=u).subMeshId=l,t))break}}if(s){var f=this.getWorldMatrix(),d=g.c.Vector3[0],p=g.c.Vector3[1];g.e.TransformCoordinatesToRef(e.origin,f,d),e.direction.scaleToRef(s.distance,p);var _=g.e.TransformNormal(p,f).addInPlace(d);return r.hit=!0,r.distance=g.e.Distance(d,_),r.pickedPoint=_,r.pickedMesh=this,r.bu=s.bu||0,r.bv=s.bv||0,r.faceId=s.faceId,r.subMeshId=s.subMeshId,r}return r},M.prototype.clone=function(e,t,i){return null},M.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},M.prototype.dispose=function(e,t){var i,n=this;for(void 0===t&&(t=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){var r=this._intersectionsInProgress[i],o=r._intersectionsInProgress.indexOf(this);r._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(e){var t=e.includedOnlyMeshes.indexOf(n);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(n))&&e.excludedMeshes.splice(t,1);var i=e.getShadowGenerator();if(i){var r=i.getShadowMap();r&&r.renderList&&-1!==(t=r.renderList.indexOf(n))&&r.renderList.splice(t,1)}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var s=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),t&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),a.prototype.dispose.call(this,e,t)},M.prototype.addChild=function(e){return e.setParent(this),this},M.prototype.removeChild=function(e){return e.setParent(null),this},M.prototype._initFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var t=0;t<e.facetNb;t++)e.facetNormals[t]=g.e.Zero(),e.facetPositions[t]=g.e.Zero();return e.facetDataEnabled=!0,this},M.prototype.updateFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var t=this.getVerticesData(m.b.PositionKind),i=this.getIndices(),r=this.getVerticesData(m.b.NormalKind),n=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,i instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(i);else{for(var o=!1,s=0;s<i.length;s++)if(65535<i[s]){o=!0;break}e.depthSortedIndices=new(o?Uint32Array:Uint16Array)(i)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){var a=this.getScene().activeCamera;e.facetDepthSortFrom=a?a.position:g.e.Zero()}e.depthSortedFacets=[];for(var h=0;h<e.facetNb;h++){var l={ind:3*h,sqDistance:0};e.depthSortedFacets.push(l)}e.invertedMatrix=g.a.Identity(),e.facetDepthSortOrigin=g.e.Zero()}e.bbSize.x=n.maximum.x-n.minimum.x>p.a?n.maximum.x-n.minimum.x:p.a,e.bbSize.y=n.maximum.y-n.minimum.y>p.a?n.maximum.y-n.minimum.y:p.a,e.bbSize.z=n.maximum.z-n.minimum.z>p.a?n.maximum.z-n.minimum.z:p.a;var c=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(c=c>e.bbSize.z?c:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/c),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/c),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/c),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=n,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),g.e.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,d.VertexData.ComputeNormals(t,i,r,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);var u=e.depthSortedIndices.length/3|0;for(h=0;h<u;h++){var f=e.depthSortedFacets[h].ind;e.depthSortedIndices[3*h]=i[f],e.depthSortedIndices[3*h+1]=i[f+1],e.depthSortedIndices[3*h+2]=i[f+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this},M.prototype.getFacetLocalNormals=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals},M.prototype.getFacetLocalPositions=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions},M.prototype.getFacetLocalPartitioning=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning},M.prototype.getFacetPosition=function(e){var t=g.e.Zero();return this.getFacetPositionToRef(e,t),t},M.prototype.getFacetPositionToRef=function(e,t){var i=this.getFacetLocalPositions()[e],r=this.getWorldMatrix();return g.e.TransformCoordinatesToRef(i,r,t),this},M.prototype.getFacetNormal=function(e){var t=g.e.Zero();return this.getFacetNormalToRef(e,t),t},M.prototype.getFacetNormalToRef=function(e,t){var i=this.getFacetLocalNormals()[e];return g.e.TransformNormalToRef(i,this.getWorldMatrix(),t),this},M.prototype.getFacetsAtLocalCoordinates=function(e,t,i){var r=this.getBoundingInfo(),n=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((e-r.minimum.x*n.partitioningBBoxRatio)*n.subDiv.X*n.partitioningBBoxRatio/n.bbSize.x),s=Math.floor((t-r.minimum.y*n.partitioningBBoxRatio)*n.subDiv.Y*n.partitioningBBoxRatio/n.bbSize.y),a=Math.floor((i-r.minimum.z*n.partitioningBBoxRatio)*n.subDiv.Z*n.partitioningBBoxRatio/n.bbSize.z);return o<0||o>n.subDiv.max||s<0||s>n.subDiv.max||a<0||a>n.subDiv.max?null:n.facetPartitioning[o+n.subDiv.max*s+n.subDiv.max*n.subDiv.max*a]},M.prototype.getClosestFacetAtCoordinates=function(e,t,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!0);var s=this.getWorldMatrix(),a=g.c.Matrix[5];s.invertToRef(a);var h=g.c.Vector3[8];g.e.TransformCoordinatesFromFloatsToRef(e,t,i,a,h);var l=this.getClosestFacetAtLocalCoordinates(h.x,h.y,h.z,r,n,o);return r&&g.e.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,s,r),l},M.prototype.getClosestFacetAtLocalCoordinates=function(e,t,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!0);var s=null,a=0,h=0,l=0,c=0,u=0,f=0,d=0,p=0,_=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(e,t,i);if(!m)return null;for(var v,b,y,x=Number.MAX_VALUE,T=x,M=0;M<m.length;M++)b=g[v=m[M]],c=(e-(y=_[v]).x)*b.x+(t-y.y)*b.y+(i-y.z)*b.z,(!n||n&&o&&0<=c||n&&!o&&c<=0)&&(c=b.x*y.x+b.y*y.y+b.z*y.z,u=-(b.x*e+b.y*t+b.z*i-c)/(b.x*b.x+b.y*b.y+b.z*b.z),(T=(a=(f=e+b.x*u)-e)*a+(h=(d=t+b.y*u)-t)*h+(l=(p=i+b.z*u)-i)*l)<x&&(x=T,s=v,r&&(r.x=f,r.y=d,r.z=p)));return s},M.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},M.prototype.disableFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this},M.prototype.updateIndices=function(e,t,i){return void 0===i&&(i=!1),this},M.prototype.createNormals=function(e){var t,i=this.getVerticesData(m.b.PositionKind),r=this.getIndices();return t=this.isVerticesDataPresent(m.b.NormalKind)?this.getVerticesData(m.b.NormalKind):[],d.VertexData.ComputeNormals(i,r,t,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(m.b.NormalKind,t,e),this},M.prototype.alignWithNormal=function(e,t){t=t||b.a.Y;var i=g.c.Vector3[0],r=g.c.Vector3[1];return g.e.CrossToRef(t,e,r),g.e.CrossToRef(e,r,i),this.rotationQuaternion?g.b.RotationQuaternionFromAxisToRef(i,e,r,this.rotationQuaternion):g.e.RotationFromAxisToRef(i,e,r,this.rotation),this},M.prototype._checkOcclusionQuery=function(){return!1},M.prototype.disableEdgesRendering=function(){throw c.a.WarnImport("EdgesRenderer")},M.prototype.enableEdgesRendering=function(e,t){throw c.a.WarnImport("EdgesRenderer")},M.OCCLUSION_TYPE_NONE=0,M.OCCLUSION_TYPE_OPTIMISTIC=1,M.OCCLUSION_TYPE_STRICT=2,M.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,M.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,M.CULLINGSTRATEGY_STANDARD=0,M.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,M.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,M.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,M);function M(e,t){void 0===t&&(t=null);var r=a.call(this,e,t,!1)||this;return r._internalAbstractMeshDataInfo=new x,r.cullingStrategy=M.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,r.onCollideObservable=new n.a,r.onCollisionPositionChangeObservable=new n.a,r.onMaterialChangedObservable=new n.a,r.definedFacingForward=!0,r._occlusionQuery=null,r._renderingGroup=null,r.alphaIndex=Number.MAX_VALUE,r.isVisible=!0,r.isPickable=!0,r.showSubMeshesBoundingBox=!1,r.isBlocker=!1,r.enablePointerMoveEvents=!1,r.renderingGroupId=0,r._material=null,r.outlineColor=f.a.Red(),r.outlineWidth=.02,r.overlayColor=f.a.Red(),r.overlayAlpha=.5,r.useOctreeForRenderingSelection=!0,r.useOctreeForPicking=!0,r.useOctreeForCollisions=!0,r.alwaysSelectAsActiveMesh=!1,r.doNotSyncBoundingInfo=!1,r.actionManager=null,r._meshCollisionData=new l,r.ellipsoid=new g.e(.5,1,.5),r.ellipsoidOffset=new g.e(0,0,0),r.edgesWidth=1,r.edgesColor=new f.b(1,0,0,1),r._edgesRenderer=null,r._masterMesh=null,r._boundingInfo=null,r._renderId=0,r._intersectionsInProgress=new Array,r._unIndexed=!1,r._lightSources=new Array,r._waitingData={lods:null,actions:null,freezeWorldMatrix:null},r._bonesTransformMatrices=null,r._transformMatrixTexture=null,r.onRebuildObservable=new n.a,r._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null),t.subtractToRef(r._meshCollisionData._oldPositionForCollisions,r._meshCollisionData._diffPositionForCollisions),r._meshCollisionData._diffPositionForCollisions.length()>o.Engine.CollisionsEpsilon&&r.position.addInPlace(r._meshCollisionData._diffPositionForCollisions),i&&r.onCollideObservable.notifyObservers(i),r.onCollisionPositionChangeObservable.notifyObservers(r.position)},r.getScene().addMesh(r),r._resyncLightSources(),r}},function(e,t,i){"use strict";i.d(t,"a",function(){return u});var n,r=i(1),a=i(3),o=i(0),l=i(7),h=i(34),s=i(59),c=i(10),u=(n=h.a,Object(r.c)(f,n),Object.defineProperty(f.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),f.prototype.transferTexturesToEffect=function(e,t){return this},f.prototype._bindLight=function(e,t,i,r,n){void 0===n&&(n=!1);var o=e.toString(),s=!1;if(!n||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(i,"Light"+o),this._renderId!==t.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId();var a=this.getScaledIntensity();this.transferToEffect(i,o),this.diffuse.scaleToRef(a,l.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",l.c.Color3[0],this.range,o),r&&(this.specular.scaleToRef(a,l.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",l.c.Color3[1],this.radius,o)),s=!0}if(this.transferTexturesToEffect(i,o),t.shadowsEnabled&&this.shadowEnabled){var h=this.getShadowGenerator();h&&(h.bindShadowLight(o,i),s=!0)}s&&this._uniformBuffer.update()}},f.prototype.getClassName=function(){return"Light"},f.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},f.prototype._syncParentEnabledState=function(){n.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},f.prototype.setEnabled=function(e){n.prototype.setEnabled.call(this,e),this._resyncMeshes()},f.prototype.getShadowGenerator=function(){return this._shadowGenerator},f.prototype.getAbsolutePosition=function(){return o.e.Zero()},f.prototype.canAffectMesh=function(e){return!(e&&(this.includedOnlyMeshes&&0<this.includedOnlyMeshes.length&&-1===this.includedOnlyMeshes.indexOf(e)||this.excludedMeshes&&0<this.excludedMeshes.length&&-1!==this.excludedMeshes.indexOf(e)||0!==this.includeOnlyWithLayerMask&&0==(this.includeOnlyWithLayerMask&e.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask))},f.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},f.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var i=0,r=this.getScene().meshes;i<r.length;i++)r[i]._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),n.prototype.dispose.call(this,e,t)},f.prototype.getTypeID=function(){return 0},f.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},f.prototype.clone=function(e){var t=f.GetConstructorFromName(this.getTypeID(),e,this.getScene());return t?a.a.Clone(t,this):null},f.prototype.serialize=function(){var t=a.a.Serialize(this);return t.type=this.getTypeID(),this.parent&&(t.parentId=this.parent.id),0<this.excludedMeshes.length&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach(function(e){t.excludedMeshesIds.push(e.id)})),0<this.includedOnlyMeshes.length&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(e){t.includedOnlyMeshesIds.push(e.id)})),a.a.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},f.GetConstructorFromName=function(e,t,i){var r=h.a.Construct("Light_Type_"+e,t,i);return r||null},f.Parse=function(e,t){var i=f.GetConstructorFromName(e.type,e.name,t);if(!i)return null;var r=a.a.Parse(i,e,t);if(e.excludedMeshesIds&&(r._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.falloffType&&(r.falloffType=e.falloffType),void 0!==e.lightmapMode&&(r.lightmapMode=e.lightmapMode),e.animations){for(var n=0;n<e.animations.length;n++){var o=e.animations[n],s=c.a.GetClass("BABYLON.Animation");s&&r.animations.push(s.Parse(o))}h.a.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),r},f.prototype._hookArrayForExcluded=function(o){var s=this,a=o.push;o.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=a.apply(o,e),r=0,n=e;r<n.length;r++)n[r]._resyncLightSource(s);return i};var h=o.splice;o.splice=function(e,t){for(var i=h.apply(o,[e,t]),r=0,n=i;r<n.length;r++)n[r]._resyncLightSource(s);return i};for(var e=0,t=o;e<t.length;e++)t[e]._resyncLightSource(this)},f.prototype._hookArrayForIncludedOnly=function(r){var n=this,o=r.push;r.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=o.apply(r,e);return n._resyncMeshes(),i};var s=r.splice;r.splice=function(e,t){var i=s.apply(r,[e,t]);return n._resyncMeshes(),i},this._resyncMeshes()},f.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++)t[e]._resyncLightSource(this)},f.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];-1!==i.lightSources.indexOf(this)&&i._markSubMeshesAsLightDirty()}},f.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},f.prototype._getPhotometricScale=function(){var e=0,t=this.getTypeID(),i=this.intensityMode;switch(i===f.INTENSITYMODE_AUTOMATIC&&(i=t===f.LIGHTTYPEID_DIRECTIONALLIGHT?f.INTENSITYMODE_ILLUMINANCE:f.INTENSITYMODE_LUMINOUSINTENSITY),t){case f.LIGHTTYPEID_POINTLIGHT:case f.LIGHTTYPEID_SPOTLIGHT:switch(i){case f.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case f.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case f.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case f.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case f.INTENSITYMODE_ILLUMINANCE:e=1;break;case f.INTENSITYMODE_LUMINANCE:var r=this.radius;r=Math.max(r,.001),e=2*Math.PI*(1-Math.cos(r))}break;case f.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},f.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},f.FALLOFF_DEFAULT=0,f.FALLOFF_PHYSICAL=1,f.FALLOFF_GLTF=2,f.FALLOFF_STANDARD=3,f.LIGHTMAP_DEFAULT=0,f.LIGHTMAP_SPECULAR=1,f.LIGHTMAP_SHADOWSONLY=2,f.INTENSITYMODE_AUTOMATIC=0,f.INTENSITYMODE_LUMINOUSPOWER=1,f.INTENSITYMODE_LUMINOUSINTENSITY=2,f.INTENSITYMODE_ILLUMINANCE=3,f.INTENSITYMODE_LUMINANCE=4,f.LIGHTTYPEID_POINTLIGHT=0,f.LIGHTTYPEID_DIRECTIONALLIGHT=1,f.LIGHTTYPEID_SPOTLIGHT=2,f.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(r.b)([Object(a.d)()],f.prototype,"diffuse",void 0),Object(r.b)([Object(a.d)()],f.prototype,"specular",void 0),Object(r.b)([Object(a.c)()],f.prototype,"falloffType",void 0),Object(r.b)([Object(a.c)()],f.prototype,"intensity",void 0),Object(r.b)([Object(a.c)()],f.prototype,"range",null),Object(r.b)([Object(a.c)()],f.prototype,"intensityMode",null),Object(r.b)([Object(a.c)()],f.prototype,"radius",null),Object(r.b)([Object(a.c)()],f.prototype,"_renderPriority",void 0),Object(r.b)([Object(a.b)("_reorderLightsInScene")],f.prototype,"renderPriority",void 0),Object(r.b)([Object(a.c)("shadowEnabled")],f.prototype,"_shadowEnabled",void 0),Object(r.b)([Object(a.c)("excludeWithLayerMask")],f.prototype,"_excludeWithLayerMask",void 0),Object(r.b)([Object(a.c)("includeOnlyWithLayerMask")],f.prototype,"_includeOnlyWithLayerMask",void 0),Object(r.b)([Object(a.c)("lightmapMode")],f.prototype,"_lightmapMode",void 0),f);function f(e,t){var i=n.call(this,e,t)||this;return i.diffuse=new l.a(1,1,1),i.specular=new l.a(1,1,1),i.falloffType=f.FALLOFF_DEFAULT,i.intensity=1,i._range=Number.MAX_VALUE,i._inverseSquaredRange=0,i._photometricScale=1,i._intensityMode=f.INTENSITYMODE_AUTOMATIC,i._radius=1e-5,i.renderPriority=0,i._shadowEnabled=!0,i._excludeWithLayerMask=0,i._includeOnlyWithLayerMask=0,i._lightmapMode=0,i._excludedMeshesIds=new Array,i._includedOnlyMeshesIds=new Array,i._isLight=!0,i.getScene().addLight(i),i._uniformBuffer=new s.a(i.getScene().getEngine()),i._buildUniformLayout(),i.includedOnlyMeshes=new Array,i.excludedMeshes=new Array,i._resyncMeshes(),i}},function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return a}),i.d(t,"c",function(){return h});var r=i(1),n=(o.KEYDOWN=1,o.KEYUP=2,o);function o(){}var s,a=function(e,t){this.type=e,this.event=t},h=(s=a,Object(r.c)(l,s),l);function l(e,t){var i=s.call(this,e,t)||this;return i.type=e,i.event=t,i.skipOnPointerObservable=!1,i}},function(e,t,i){"use strict";i.d(t,"a",function(){return r}),i.d(t,"b",function(){return o});var r=(n.COPY=1,n.CUT=2,n.PASTE=3,n);function n(){}var o=(s.GetTypeFromCharacter=function(e){switch(e){case 67:return r.COPY;case 86:return r.PASTE;case 88:return r.CUT;default:return-1}},s);function s(e,t){this.type=e,this.event=t}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},n.prototype.getClassName=function(){return"Size"},n.prototype.getHashCode=function(){var e=0|this.width;return e=397*e^(0|this.height)},n.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},n.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},n.prototype.set=function(e,t){return this.copyFromFloats(e,t)},n.prototype.multiplyByFloats=function(e,t){return new n(this.width*e,this.height*t)},n.prototype.clone=function(){return new n(this.width,this.height)},n.prototype.equals=function(e){return!!e&&this.width===e.width&&this.height===e.height},Object.defineProperty(n.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),n.Zero=function(){return new n(0,0)},n.prototype.add=function(e){return new n(this.width+e.width,this.height+e.height)},n.prototype.subtract=function(e){return new n(this.width-e.width,this.height-e.height)},n.Lerp=function(e,t,i){return new n(e.width+(t.width-e.width)*i,e.height+(t.height-e.height)*i)},n);function n(e,t){this.width=e,this.height=t}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var _=i(0),g=i(2),r=(n.prototype.getNormal=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(g.b.NormalKind))return null;var i,r=this.pickedMesh.getIndices();if(!r)return null;if(t){var n=this.pickedMesh.getVerticesData(g.b.NormalKind),o=_.e.FromArray(n,3*r[3*this.faceId]),s=_.e.FromArray(n,3*r[3*this.faceId+1]),a=_.e.FromArray(n,3*r[3*this.faceId+2]);o=o.scale(this.bu),s=s.scale(this.bv),a=a.scale(1-this.bu-this.bv),i=new _.e(o.x+s.x+a.x,o.y+s.y+a.y,o.z+s.z+a.z)}else{var h=this.pickedMesh.getVerticesData(g.b.PositionKind),l=_.e.FromArray(h,3*r[3*this.faceId]),c=_.e.FromArray(h,3*r[3*this.faceId+1]),u=_.e.FromArray(h,3*r[3*this.faceId+2]),f=l.subtract(c),d=u.subtract(c);i=_.e.Cross(f,d)}if(e){var p=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(_.c.Matrix[0].copyFrom(p),(p=_.c.Matrix[0]).setTranslationFromFloats(0,0,0),p.invert(),p.transposeToRef(_.c.Matrix[1]),p=_.c.Matrix[1]),i=_.e.TransformNormal(i,p)}return i.normalize(),i},n.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(g.b.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(g.b.UVKind);if(!t)return null;var i=_.d.FromArray(t,2*e[3*this.faceId]),r=_.d.FromArray(t,2*e[3*this.faceId+1]),n=_.d.FromArray(t,2*e[3*this.faceId+2]);return i=i.scale(this.bu),r=r.scale(this.bv),n=n.scale(1-this.bu-this.bv),new _.d(i.x+r.x+n.x,i.y+r.y+n.y)},n);function n(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}},function(e,t,i){"use strict";i.r(t),i.d(t,"StandardMaterialDefines",function(){return we}),i.d(t,"StandardMaterial",function(){return Fe});var r,n=i(1),o=i(3),s=i(28),c=i(33),a=i(0),u=i(7),g=i(2),m=i(55),h=i(72),l=i(27),f=(r=l.a,Object(n.c)(d,r),d.prototype.getEffect=function(){return this._activeEffect},d.prototype.isReady=function(e,t){return!!e&&(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t))},d.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},d.prototype.bindOnlyNormalMatrix=function(e){this._activeEffect.setMatrix("normalMatrix",e)},d.prototype.bind=function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])},d.prototype._afterBind=function(e,t){void 0===t&&(t=null),r.prototype._afterBind.call(this,e),this.getScene()._cachedEffect=t},d.prototype._mustRebind=function(e,t,i){return void 0===i&&(i=1),e.isCachedMaterialInvalid(this,t,i)},d);function d(e,t){var i=r.call(this,e,t)||this;return i._normalMatrix=new a.a,i.allowShaderHotSwapping=!0,i._storeEffectOnSubMeshes=!0,i}var v=i(19),b=i(18),p=i(10),_=i(26),y=(Object.defineProperty(x,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,_.Engine.MarkAllMaterialsAsDirty(4))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,_.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),x._DiffuseTextureEnabled=!0,x._AmbientTextureEnabled=!0,x._OpacityTextureEnabled=!0,x._ReflectionTextureEnabled=!0,x._EmissiveTextureEnabled=!0,x._SpecularTextureEnabled=!0,x._BumpTextureEnabled=!0,x._LightmapTextureEnabled=!0,x._RefractionTextureEnabled=!0,x._ColorGradingTextureEnabled=!0,x._FresnelEnabled=!0,x._ClearCoatTextureEnabled=!0,x._ClearCoatBumpTextureEnabled=!0,x._ClearCoatTintTextureEnabled=!0,x._SheenTextureEnabled=!0,x._AnisotropicTextureEnabled=!0,x._ThicknessTextureEnabled=!0,x);function x(){}var T,M=i(6),E="defaultFragmentDeclaration",A="uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",O=(M.a.IncludesShadersStore[E]=A,"defaultUboDeclaration"),P="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nfloat visibility;\nvec4 vDiffuseColor;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};\n",C=(M.a.IncludesShadersStore[O]=P,i(75),"lightFragmentDeclaration"),S="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif",R=(M.a.IncludesShadersStore[C]=S,"lightUboDeclaration"),I="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif",w=(M.a.IncludesShadersStore[R]=I,"lightsFragmentFunctions"),D="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}",L=(M.a.IncludesShadersStore[w]=D,"shadowsFragmentFunctions"),F="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\n\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#ifdef WEBGL2\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\n#endif\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n#define GREATEST_LESS_THAN_ONE 0.99999994\n\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\n\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n",N=(M.a.IncludesShadersStore[L]=F,"fresnelFunction"),B="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",k=(M.a.IncludesShadersStore[N]=B,"reflectionFunction"),U="vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\nvec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0);\n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,0));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif",V=(M.a.IncludesShadersStore[k]=U,"imageProcessingDeclaration"),z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif",j=(M.a.IncludesShadersStore[V]=z,"imageProcessingFunctions"),W="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}",G=(M.a.IncludesShadersStore[j]=W,"bumpFragmentFunctions"),H="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\ntextureSample=textureSample*2.0-1.0;\n#ifdef NORMALXYSCALE\ntextureSample=normalize(textureSample*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*textureSample);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n#if defined(BUMP)\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nreturn perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);\n}\n#endif\n#if defined(BUMP) || defined(CLEARCOAT_BUMP)\nvec3 perturbNormal(mat3 cotangentFrame,vec3 color)\n{\nreturn perturbNormal(cotangentFrame,color,vBumpInfos.y);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nreturn cotangent_frame(normal,p,uv,vTangentSpaceParams);\n}\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif",X=(M.a.IncludesShadersStore[G]=H,i(80),"logDepthDeclaration"),K="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",Y=(M.a.IncludesShadersStore[X]=K,"fogFragmentDeclaration"),q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",Z=(M.a.IncludesShadersStore[Y]=q,i(81),"bumpFragment"),Q="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif",J=(M.a.IncludesShadersStore[Z]=Q,"depthPrePass"),$="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif",ee=(M.a.IncludesShadersStore[J]=$,"lightFragment"),te="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifdef PBR\n\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\n\npreInfo.roughness=sheenIntensity;\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef CLEARCOAT\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\n\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)\n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else\ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif",ie=(M.a.IncludesShadersStore[ee]=te,"logDepthFragment"),re="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",ne=(M.a.IncludesShadersStore[ie]=re,"fogFragment"),oe="#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",se=(M.a.IncludesShadersStore[ne]=oe,"defaultPixelShader"),ae="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n",he=(M.a.ShadersStore[se]=ae,"defaultVertexDeclaration"),le="\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",ce=(M.a.IncludesShadersStore[he]=le,i(82),i(83),"bumpVertexDeclaration"),ue="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n",fe=(M.a.IncludesShadersStore[ce]=ue,i(84),"fogVertexDeclaration"),de="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif",pe=(M.a.IncludesShadersStore[fe]=de,"morphTargetsVertexGlobalDeclaration"),_e="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif",ge=(M.a.IncludesShadersStore[pe]=_e,"morphTargetsVertexDeclaration"),me="#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif",ve=(M.a.IncludesShadersStore[ge]=me,"morphTargetsVertex"),be="#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif",ye=(M.a.IncludesShadersStore[ve]=be,i(85),i(86),"bumpVertex"),xe="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif",Te=(M.a.IncludesShadersStore[ye]=xe,i(87),"#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif"),Me=(M.a.IncludesShadersStore.fogVertex=Te,"shadowsVertex"),Ee="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\nvDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif",Ae=(M.a.IncludesShadersStore[Me]=Ee,"pointCloudVertex"),Oe="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",Pe=(M.a.IncludesShadersStore[Ae]=Oe,"logDepthVertex"),Ce="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",Se=(M.a.IncludesShadersStore[Pe]=Ce,"defaultVertexShader"),Re="#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",Ie=(M.a.ShadersStore[Se]=Re,i(73)),we=(T=h.a,Object(n.c)(De,T),De.prototype.setReflectionMode=function(e){for(var t=0,i=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<i.length;t++){var r=i[t];this[r]=r===e}},De);function De(){var e=T.call(this)||this;return e.MAINUV1=!1,e.MAINUV2=!1,e.DIFFUSE=!1,e.DIFFUSEDIRECTUV=0,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.OPACITY=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.REFLECTION=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.SPECULAR=!1,e.SPECULARDIRECTUV=0,e.BUMP=!1,e.BUMPDIRECTUV=0,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.SPECULAROVERALPHA=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHAFROMDIFFUSE=!1,e.POINTSIZE=!1,e.FOG=!1,e.SPECULARTERM=!1,e.DIFFUSEFRESNEL=!1,e.OPACITYFRESNEL=!1,e.REFLECTIONFRESNEL=!1,e.REFRACTIONFRESNEL=!1,e.EMISSIVEFRESNEL=!1,e.FRESNEL=!1,e.NORMAL=!1,e.UV1=!1,e.UV2=!1,e.VERTEXCOLOR=!1,e.VERTEXALPHA=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.INSTANCES=!1,e.GLOSSINESS=!1,e.ROUGHNESS=!1,e.EMISSIVEASILLUMINATION=!1,e.LINKEMISSIVEWITHDIFFUSE=!1,e.REFLECTIONFRESNELFROMSPECULAR=!1,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.USELIGHTMAPASSHADOWMAP=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.LOGARITHMICDEPTH=!1,e.REFRACTION=!1,e.REFRACTIONMAP_3D=!1,e.REFLECTIONOVERALPHA=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.NONUNIFORMSCALING=!1,e.PREMULTIPLYALPHA=!1,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.MULTIVIEW=!1,e.IS_REFLECTION_LINEAR=!1,e.IS_REFRACTION_LINEAR=!1,e.EXPOSURE=!1,e.rebuild(),e}var Le,Fe=(Le=f,Object(n.c)(Ne,Le),Object.defineProperty(Ne.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Ne.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(Ne.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"hasRenderTargetTextures",{get:function(){return!!(Ne.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(Ne.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),Ne.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(Ne.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),Ne.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},Ne.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},Ne.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},Ne.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},Ne.prototype.isReadyForSubMesh=function(e,t,i){if(void 0===i&&(i=!1),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new we);var r=this.getScene(),n=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&n._renderId===r.getRenderId())return!0;var o=r.getEngine();if(n._needNormals=v.a.PrepareDefinesForLights(r,e,n,!0,this._maxSimultaneousLights,this._disableLighting),v.a.PrepareDefinesForMultiview(r,n),n._areTexturesDirty){if(n._needUVs=!1,n.MAINUV1=!1,n.MAINUV2=!1,r.texturesEnabled){if(this._diffuseTexture&&Ne.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;v.a.PrepareDefinesForMergedUV(this._diffuseTexture,n,"DIFFUSE")}else n.DIFFUSE=!1;if(this._ambientTexture&&Ne.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;v.a.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT")}else n.AMBIENT=!1;if(this._opacityTexture&&Ne.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;v.a.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else n.OPACITY=!1;if(this._reflectionTexture&&Ne.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(n._needNormals=!0,n.REFLECTION=!0,n.ROUGHNESS=0<this._roughness,n.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,n.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===b.a.INVCUBIC_MODE,n.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case b.a.EXPLICIT_MODE:n.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case b.a.PLANAR_MODE:n.setReflectionMode("REFLECTIONMAP_PLANAR");break;case b.a.PROJECTION_MODE:n.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case b.a.SKYBOX_MODE:n.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case b.a.SPHERICAL_MODE:n.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case b.a.EQUIRECTANGULAR_MODE:n.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case b.a.FIXED_EQUIRECTANGULAR_MODE:n.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case b.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case b.a.CUBIC_MODE:case b.a.INVCUBIC_MODE:default:n.setReflectionMode("REFLECTIONMAP_CUBIC")}n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else n.REFLECTION=!1;if(this._emissiveTexture&&Ne.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;v.a.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE")}else n.EMISSIVE=!1;if(this._lightmapTexture&&Ne.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;v.a.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else n.LIGHTMAP=!1;if(this._specularTexture&&Ne.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;v.a.PrepareDefinesForMergedUV(this._specularTexture,n,"SPECULAR"),n.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else n.SPECULAR=!1;if(r.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Ne.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;v.a.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),n.PARALLAX=this._useParallax,n.PARALLAXOCCLUSION=this._useParallaxOcclusion,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else n.BUMP=!1;if(this._refractionTexture&&Ne.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;n._needUVs=!0,n.REFRACTION=!0,n.REFRACTIONMAP_3D=this._refractionTexture.isCube}else n.REFRACTION=!1;n.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else n.DIFFUSE=!1,n.AMBIENT=!1,n.OPACITY=!1,n.REFLECTION=!1,n.EMISSIVE=!1,n.LIGHTMAP=!1,n.BUMP=!1,n.REFRACTION=!1;n.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),n.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,n.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,n.SPECULAROVERALPHA=this._useSpecularOverAlpha,n.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode}if(n._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(n),n.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,n.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(n._areFresnelDirty&&(Ne.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(n.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,n.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,n.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,n.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,n.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,n.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,n._needNormals=!0,n.FRESNEL=!0):n.FRESNEL=!1),v.a.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),v.a.PrepareDefinesForAttributes(e,n,!0,!0,!0),v.a.PrepareDefinesForFrameBoundValues(r,o,n,i),n.isDirty){var s=n._areLightsDisposed;n.markAsProcessed();var a=new Ie.a;n.REFLECTION&&a.addFallback(0,"REFLECTION"),n.SPECULAR&&a.addFallback(0,"SPECULAR"),n.BUMP&&a.addFallback(0,"BUMP"),n.PARALLAX&&a.addFallback(1,"PARALLAX"),n.PARALLAXOCCLUSION&&a.addFallback(0,"PARALLAXOCCLUSION"),n.SPECULAROVERALPHA&&a.addFallback(0,"SPECULAROVERALPHA"),n.FOG&&a.addFallback(1,"FOG"),n.POINTSIZE&&a.addFallback(0,"POINTSIZE"),n.LOGARITHMICDEPTH&&a.addFallback(0,"LOGARITHMICDEPTH"),v.a.HandleFallbacksForShadows(n,a,this._maxSimultaneousLights),n.SPECULARTERM&&a.addFallback(0,"SPECULARTERM"),n.DIFFUSEFRESNEL&&a.addFallback(1,"DIFFUSEFRESNEL"),n.OPACITYFRESNEL&&a.addFallback(2,"OPACITYFRESNEL"),n.REFLECTIONFRESNEL&&a.addFallback(3,"REFLECTIONFRESNEL"),n.EMISSIVEFRESNEL&&a.addFallback(4,"EMISSIVEFRESNEL"),n.FRESNEL&&a.addFallback(4,"FRESNEL"),n.MULTIVIEW&&a.addFallback(0,"MULTIVIEW");var h=[g.b.PositionKind];n.NORMAL&&h.push(g.b.NormalKind),n.UV1&&h.push(g.b.UVKind),n.UV2&&h.push(g.b.UV2Kind),n.VERTEXCOLOR&&h.push(g.b.ColorKind),v.a.PrepareAttributesForBones(h,e,n,a),v.a.PrepareAttributesForInstances(h,n),v.a.PrepareAttributesForMorphTargets(h,e,n);var l="default",c=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],u=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],f=["Material","Scene"];m.a&&(m.a.PrepareUniforms(c,n),m.a.PrepareSamplers(u,n)),v.a.PrepareUniformsAndSamplersList({uniformsNames:c,uniformBuffersNames:f,samplers:u,defines:n,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(l=this.customShaderNameResolve(l,c,f,u,n));var d=n.toString(),p=t.effect,_=r.getEngine().createEffect(l,{attributes:h,uniformsNames:c,uniformBuffersNames:f,samplers:u,defines:d,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS}},o);if(_)if(this.allowShaderHotSwapping&&p&&!_.isReady()){if(_=p,this._rebuildInParallel=!0,n.markAsUnprocessed(),s)return!(n._areLightsDisposed=!0)}else this._rebuildInParallel=!1,r.resetCachedMaterial(),t.setEffect(_,n),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0)},Ne.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vDiffuseColor",4),e.create()},Ne.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}Le.prototype.unbind.call(this)},Ne.prototype.bindForSubMesh=function(e,t,i){var r=this.getScene(),n=i._materialDefines;if(n){var o=i.effect;if(o){this._activeEffect=o,n.INSTANCES||this.bindOnlyWorldMatrix(e),n.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var s=this._mustRebind(r,o,t.visibility);v.a.BindBonesParameters(t,o);var a=this._uniformBuffer;if(s){if(a.bindToEffect(o,"Material"),this.bindViewProjection(o),!a.useUbo||!this.isFrozen||!a.isSync){if(Ne.FresnelEnabled&&n.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(a.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),a.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&a.updateColor4("opacityParts",new u.a(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(a.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),a.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(a.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),a.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(a.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),a.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),r.texturesEnabled){if(this._diffuseTexture&&Ne.DiffuseTextureEnabled&&(a.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),v.a.BindTextureMatrix(this._diffuseTexture,a,"diffuse"),this._diffuseTexture.hasAlpha&&o.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&Ne.AmbientTextureEnabled&&(a.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),v.a.BindTextureMatrix(this._ambientTexture,a,"ambient")),this._opacityTexture&&Ne.OpacityTextureEnabled&&(a.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),v.a.BindTextureMatrix(this._opacityTexture,a,"opacity")),this._reflectionTexture&&Ne.ReflectionTextureEnabled&&(a.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),a.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var h=this._reflectionTexture;a.updateVector3("vReflectionPosition",h.boundingBoxPosition),a.updateVector3("vReflectionSize",h.boundingBoxSize)}if(this._emissiveTexture&&Ne.EmissiveTextureEnabled&&(a.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),v.a.BindTextureMatrix(this._emissiveTexture,a,"emissive")),this._lightmapTexture&&Ne.LightmapTextureEnabled&&(a.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),v.a.BindTextureMatrix(this._lightmapTexture,a,"lightmap")),this._specularTexture&&Ne.SpecularTextureEnabled&&(a.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),v.a.BindTextureMatrix(this._specularTexture,a,"specular")),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&Ne.BumpTextureEnabled&&(a.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),v.a.BindTextureMatrix(this._bumpTexture,a,"bump"),r._mirroredCameraPosition?a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&Ne.RefractionTextureEnabled){var l=1;this._refractionTexture.isCube||(a.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(l=this._refractionTexture.depth)),a.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,l,this.invertRefractionY?-1:1)}}this.pointsCloud&&a.updateFloat("pointSize",this.pointSize),n.SPECULARTERM&&a.updateColor4("vSpecularColor",this.specularColor,this.specularPower),a.updateColor3("vEmissiveColor",Ne.EmissiveTextureEnabled?this.emissiveColor:u.a.BlackReadOnly),a.updateFloat("visibility",t.visibility),a.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}r.texturesEnabled&&(this._diffuseTexture&&Ne.DiffuseTextureEnabled&&o.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&Ne.AmbientTextureEnabled&&o.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Ne.OpacityTextureEnabled&&o.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&Ne.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?o.setTexture("reflectionCubeSampler",this._reflectionTexture):o.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&Ne.EmissiveTextureEnabled&&o.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Ne.LightmapTextureEnabled&&o.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&Ne.SpecularTextureEnabled&&o.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&Ne.BumpTextureEnabled&&o.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&Ne.RefractionTextureEnabled)&&(l=1,this._refractionTexture.isCube?o.setTexture("refractionCubeSampler",this._refractionTexture):o.setTexture("refraction2DSampler",this._refractionTexture)),v.a.BindClipPlane(o,r),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),v.a.BindEyePosition(o,r),o.setColor3("vAmbientColor",this._globalAmbientColor)}!s&&this.isFrozen||(r.lightsEnabled&&!this._disableLighting&&v.a.BindLights(r,t,o,n,this._maxSimultaneousLights,this._rebuildInParallel),(r.fogEnabled&&t.applyFog&&r.fogMode!==c.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(o),v.a.BindFogParameters(r,t,o),n.NUM_MORPH_INFLUENCERS&&v.a.BindMorphTargetParameters(t,o),this.useLogarithmicDepth&&v.a.BindLogDepth(n,o,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),a.update(),this._afterBind(t,this._activeEffect)}}},Ne.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&0<this._diffuseTexture.animations.length&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&0<this._ambientTexture.animations.length&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&0<this._opacityTexture.animations.length&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&0<this._reflectionTexture.animations.length&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&0<this._emissiveTexture.animations.length&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&0<this._specularTexture.animations.length&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&0<this._bumpTexture.animations.length&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&0<this._lightmapTexture.animations.length&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&0<this._refractionTexture.animations.length&&e.push(this._refractionTexture),e},Ne.prototype.getActiveTextures=function(){var e=Le.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},Ne.prototype.hasTexture=function(e){return!!Le.prototype.hasTexture.call(this,e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e},Ne.prototype.dispose=function(e,t){t&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),Le.prototype.dispose.call(this,e,t)},Ne.prototype.clone=function(e){var t=this,i=o.a.Clone(function(){return new Ne(e,t.getScene())},this);return i.name=e,i.id=e,i},Ne.prototype.serialize=function(){return o.a.Serialize(this)},Ne.Parse=function(e,t,i){return o.a.Parse(function(){return new Ne(e.name,t)},e,t,i)},Object.defineProperty(Ne,"DiffuseTextureEnabled",{get:function(){return y.DiffuseTextureEnabled},set:function(e){y.DiffuseTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"AmbientTextureEnabled",{get:function(){return y.AmbientTextureEnabled},set:function(e){y.AmbientTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"OpacityTextureEnabled",{get:function(){return y.OpacityTextureEnabled},set:function(e){y.OpacityTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"ReflectionTextureEnabled",{get:function(){return y.ReflectionTextureEnabled},set:function(e){y.ReflectionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"EmissiveTextureEnabled",{get:function(){return y.EmissiveTextureEnabled},set:function(e){y.EmissiveTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"SpecularTextureEnabled",{get:function(){return y.SpecularTextureEnabled},set:function(e){y.SpecularTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"BumpTextureEnabled",{get:function(){return y.BumpTextureEnabled},set:function(e){y.BumpTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"LightmapTextureEnabled",{get:function(){return y.LightmapTextureEnabled},set:function(e){y.LightmapTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"RefractionTextureEnabled",{get:function(){return y.RefractionTextureEnabled},set:function(e){y.RefractionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"ColorGradingTextureEnabled",{get:function(){return y.ColorGradingTextureEnabled},set:function(e){y.ColorGradingTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne,"FresnelEnabled",{get:function(){return y.FresnelEnabled},set:function(e){y.FresnelEnabled=e},enumerable:!0,configurable:!0}),Object(n.b)([Object(o.j)("diffuseTexture")],Ne.prototype,"_diffuseTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],Ne.prototype,"diffuseTexture",void 0),Object(n.b)([Object(o.j)("ambientTexture")],Ne.prototype,"_ambientTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"ambientTexture",void 0),Object(n.b)([Object(o.j)("opacityTexture")],Ne.prototype,"_opacityTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],Ne.prototype,"opacityTexture",void 0),Object(n.b)([Object(o.j)("reflectionTexture")],Ne.prototype,"_reflectionTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"reflectionTexture",void 0),Object(n.b)([Object(o.j)("emissiveTexture")],Ne.prototype,"_emissiveTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"emissiveTexture",void 0),Object(n.b)([Object(o.j)("specularTexture")],Ne.prototype,"_specularTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"specularTexture",void 0),Object(n.b)([Object(o.j)("bumpTexture")],Ne.prototype,"_bumpTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"bumpTexture",void 0),Object(n.b)([Object(o.j)("lightmapTexture")],Ne.prototype,"_lightmapTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"lightmapTexture",void 0),Object(n.b)([Object(o.j)("refractionTexture")],Ne.prototype,"_refractionTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"refractionTexture",void 0),Object(n.b)([Object(o.d)("ambient")],Ne.prototype,"ambientColor",void 0),Object(n.b)([Object(o.d)("diffuse")],Ne.prototype,"diffuseColor",void 0),Object(n.b)([Object(o.d)("specular")],Ne.prototype,"specularColor",void 0),Object(n.b)([Object(o.d)("emissive")],Ne.prototype,"emissiveColor",void 0),Object(n.b)([Object(o.c)()],Ne.prototype,"specularPower",void 0),Object(n.b)([Object(o.c)("useAlphaFromDiffuseTexture")],Ne.prototype,"_useAlphaFromDiffuseTexture",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useAlphaFromDiffuseTexture",void 0),Object(n.b)([Object(o.c)("useEmissiveAsIllumination")],Ne.prototype,"_useEmissiveAsIllumination",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useEmissiveAsIllumination",void 0),Object(n.b)([Object(o.c)("linkEmissiveWithDiffuse")],Ne.prototype,"_linkEmissiveWithDiffuse",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"linkEmissiveWithDiffuse",void 0),Object(n.b)([Object(o.c)("useSpecularOverAlpha")],Ne.prototype,"_useSpecularOverAlpha",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useSpecularOverAlpha",void 0),Object(n.b)([Object(o.c)("useReflectionOverAlpha")],Ne.prototype,"_useReflectionOverAlpha",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useReflectionOverAlpha",void 0),Object(n.b)([Object(o.c)("disableLighting")],Ne.prototype,"_disableLighting",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsLightsDirty")],Ne.prototype,"disableLighting",void 0),Object(n.b)([Object(o.c)("useObjectSpaceNormalMap")],Ne.prototype,"_useObjectSpaceNormalMap",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useObjectSpaceNormalMap",void 0),Object(n.b)([Object(o.c)("useParallax")],Ne.prototype,"_useParallax",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useParallax",void 0),Object(n.b)([Object(o.c)("useParallaxOcclusion")],Ne.prototype,"_useParallaxOcclusion",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useParallaxOcclusion",void 0),Object(n.b)([Object(o.c)()],Ne.prototype,"parallaxScaleBias",void 0),Object(n.b)([Object(o.c)("roughness")],Ne.prototype,"_roughness",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"roughness",void 0),Object(n.b)([Object(o.c)()],Ne.prototype,"indexOfRefraction",void 0),Object(n.b)([Object(o.c)()],Ne.prototype,"invertRefractionY",void 0),Object(n.b)([Object(o.c)()],Ne.prototype,"alphaCutOff",void 0),Object(n.b)([Object(o.c)("useLightmapAsShadowmap")],Ne.prototype,"_useLightmapAsShadowmap",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useLightmapAsShadowmap",void 0),Object(n.b)([Object(o.g)("diffuseFresnelParameters")],Ne.prototype,"_diffuseFresnelParameters",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsFresnelDirty")],Ne.prototype,"diffuseFresnelParameters",void 0),Object(n.b)([Object(o.g)("opacityFresnelParameters")],Ne.prototype,"_opacityFresnelParameters",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],Ne.prototype,"opacityFresnelParameters",void 0),Object(n.b)([Object(o.g)("reflectionFresnelParameters")],Ne.prototype,"_reflectionFresnelParameters",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsFresnelDirty")],Ne.prototype,"reflectionFresnelParameters",void 0),Object(n.b)([Object(o.g)("refractionFresnelParameters")],Ne.prototype,"_refractionFresnelParameters",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsFresnelDirty")],Ne.prototype,"refractionFresnelParameters",void 0),Object(n.b)([Object(o.g)("emissiveFresnelParameters")],Ne.prototype,"_emissiveFresnelParameters",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsFresnelDirty")],Ne.prototype,"emissiveFresnelParameters",void 0),Object(n.b)([Object(o.c)("useReflectionFresnelFromSpecular")],Ne.prototype,"_useReflectionFresnelFromSpecular",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsFresnelDirty")],Ne.prototype,"useReflectionFresnelFromSpecular",void 0),Object(n.b)([Object(o.c)("useGlossinessFromSpecularMapAlpha")],Ne.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Object(n.b)([Object(o.c)("maxSimultaneousLights")],Ne.prototype,"_maxSimultaneousLights",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsLightsDirty")],Ne.prototype,"maxSimultaneousLights",void 0),Object(n.b)([Object(o.c)("invertNormalMapX")],Ne.prototype,"_invertNormalMapX",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"invertNormalMapX",void 0),Object(n.b)([Object(o.c)("invertNormalMapY")],Ne.prototype,"_invertNormalMapY",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"invertNormalMapY",void 0),Object(n.b)([Object(o.c)("twoSidedLighting")],Ne.prototype,"_twoSidedLighting",void 0),Object(n.b)([Object(o.b)("_markAllSubMeshesAsTexturesDirty")],Ne.prototype,"twoSidedLighting",void 0),Object(n.b)([Object(o.c)()],Ne.prototype,"useLogarithmicDepth",null),Ne);function Ne(e,t){var i=Le.call(this,e,t)||this;return i._diffuseTexture=null,i._ambientTexture=null,i._opacityTexture=null,i._reflectionTexture=null,i._emissiveTexture=null,i._specularTexture=null,i._bumpTexture=null,i._lightmapTexture=null,i._refractionTexture=null,i.ambientColor=new u.a(0,0,0),i.diffuseColor=new u.a(1,1,1),i.specularColor=new u.a(1,1,1),i.emissiveColor=new u.a(0,0,0),i.specularPower=64,i._useAlphaFromDiffuseTexture=!1,i._useEmissiveAsIllumination=!1,i._linkEmissiveWithDiffuse=!1,i._useSpecularOverAlpha=!1,i._useReflectionOverAlpha=!1,i._disableLighting=!1,i._useObjectSpaceNormalMap=!1,i._useParallax=!1,i._useParallaxOcclusion=!1,i.parallaxScaleBias=.05,i._roughness=0,i.indexOfRefraction=.98,i.invertRefractionY=!0,i.alphaCutOff=.4,i._useLightmapAsShadowmap=!1,i._useReflectionFresnelFromSpecular=!1,i._useGlossinessFromSpecularMapAlpha=!1,i._maxSimultaneousLights=4,i._invertNormalMapX=!1,i._invertNormalMapY=!1,i._twoSidedLighting=!1,i._renderTargets=new s.a(16),i._worldViewProjectionMatrix=a.a.Zero(),i._globalAmbientColor=new u.a(0,0,0),i._rebuildInParallel=!1,i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),Ne.ReflectionTextureEnabled&&i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),Ne.RefractionTextureEnabled&&i._refractionTexture&&i._refractionTexture.isRenderTarget&&i._renderTargets.push(i._refractionTexture),i._renderTargets},i}p.a.RegisteredTypes["BABYLON.StandardMaterial"]=Fe,c.Scene.DefaultMaterialFactory=function(e){return new Fe("default material",e)}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var a=i(0),r=(h.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},h.prototype.clone=function(){return new h(this.normal.x,this.normal.y,this.normal.z,this.d)},h.prototype.getClassName=function(){return"Plane"},h.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=397*e^(0|this.d)},h.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},h.prototype.transform=function(e){var t=h._TmpMatrix;a.a.TransposeToRef(e,t);var i=t.m,r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d;return new h(r*i[0]+n*i[1]+o*i[2]+s*i[3],r*i[4]+n*i[5]+o*i[6]+s*i[7],r*i[8]+n*i[9]+o*i[10]+s*i[11],r*i[12]+n*i[13]+o*i[14]+s*i[15])},h.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},h.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,l=i.z-e.z,c=o*l-s*h,u=s*a-n*l,f=n*h-o*a,d=Math.sqrt(c*c+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=c*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},h.prototype.isFrontFacingTo=function(e,t){return a.e.Dot(this.normal,e)<=t},h.prototype.signedDistanceTo=function(e){return a.e.Dot(e,this.normal)+this.d},h.FromArray=function(e){return new h(e[0],e[1],e[2],e[3])},h.FromPoints=function(e,t,i){var r=new h(0,0,0,0);return r.copyFromPoints(e,t,i),r},h.FromPositionAndNormal=function(e,t){var i=new h(0,0,0,0);return t.normalize(),i.normal=t,i.d=-(t.x*e.x+t.y*e.y+t.z*e.z),i},h.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return a.e.Dot(i,t)+r},h._TmpMatrix=a.a.Identity(),h);function h(e,t,i,r){this.normal=new a.e(e,t,i),this.d=r}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=i(49),n=(o.GetPlanes=function(e){for(var t=[],i=0;i<6;i++)t.push(new r.a(0,0,0,0));return o.GetPlanesToRef(e,t),t},o.GetNearPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()},o.GetFarPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()},o.GetLeftPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()},o.GetRightPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()},o.GetTopPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()},o.GetBottomPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()},o.GetPlanesToRef=function(e,t){o.GetNearPlaneToRef(e,t[0]),o.GetFarPlaneToRef(e,t[1]),o.GetLeftPlaneToRef(e,t[2]),o.GetRightPlaneToRef(e,t[3]),o.GetTopPlaneToRef(e,t[4]),o.GetBottomPlaneToRef(e,t[5])},o);function o(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var r=i(1),n=(Object.defineProperty(o.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),o);function o(){this.references=0,this.capacity=0,this.is32Bits=!1}var s,a=(s=n,Object(r.c)(h,s),Object.defineProperty(h.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),h);function h(e){var t=s.call(this)||this;return t._buffer=e,t}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.prototype.toGlobal=function(e,t){return new n(this.x*e,this.y*t,this.width*e,this.height*t)},n.prototype.toGlobalToRef=function(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this},n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n);function n(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var i=document.createElement("canvas");return i.width=e,i.height=t,i},n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=i(37),n=(Object.defineProperty(o.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),o.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},o.prototype.addCount=function(e,t){o.Enabled&&(this._current+=e,t&&this._fetchResult())},o.prototype.beginMonitoring=function(){o.Enabled&&(this._startMonitoringTime=r.a.Now)},o.prototype.endMonitoring=function(e){if(void 0===e&&(e=!0),o.Enabled){e&&this.fetchNewFrame();var t=r.a.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}},o.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=r.a.Now;1e3<e-this._lastSecTime&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},o.Enabled=!0,o);function o(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}},function(e,t,i){"use strict";i.d(t,"a",function(){return d});var r=i(1),n=i(3),o=i(4),c=i(13),s=i(7),a=i(72),u=(Object.defineProperty(f.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),f.prototype.getClassName=function(){return"ColorCurves"},f.Bind=function(e,t,i,r,n){void 0===i&&(i="vCameraColorCurvePositive"),void 0===r&&(r="vCameraColorCurveNeutral"),void 0===n&&(n="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},f.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},f.prototype.getColorGradingDataToRef=function(e,t,i,r,n){null!=e&&(e=f.clamp(e,0,360),t=f.clamp(t,-100,100),i=f.clamp(i,-100,100),r=f.clamp(r,-100,100),t=f.applyColorGradingSliderNonlinear(t),t*=.5,r=f.applyColorGradingSliderNonlinear(r),t<0&&(t*=-1,e=(e+180)%360),f.fromHSBToRef(e,t,50+.25*r,n),n.scaleToRef(2,n),n.a=1+.01*i)},f.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},f.fromHSBToRef=function(e,t,i,r){var n=f.clamp(e,0,360),o=f.clamp(t/100,0,1),s=f.clamp(i/100,0,1);if(0===o)r.r=s,r.g=s,r.b=s;else{n/=60;var a=Math.floor(n),h=n-a,l=s*(1-o),c=s*(1-o*h),u=s*(1-o*(1-h));switch(a){case 0:r.r=s,r.g=u,r.b=l;break;case 1:r.r=c,r.g=s,r.b=l;break;case 2:r.r=l,r.g=s,r.b=u;break;case 3:r.r=l,r.g=c,r.b=s;break;case 4:r.r=u,r.g=l,r.b=s;break;default:r.r=s,r.g=l,r.b=c}}r.a=1},f.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},f.prototype.clone=function(){return n.a.Clone(function(){return new f},this)},f.prototype.serialize=function(){return n.a.Serialize(this)},f.Parse=function(e){return n.a.Parse(function(){return new f},e,null,null)},Object(r.b)([Object(n.c)()],f.prototype,"_globalHue",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_globalDensity",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_globalSaturation",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_globalExposure",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_highlightsHue",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_highlightsDensity",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_highlightsSaturation",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_highlightsExposure",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_midtonesHue",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_midtonesDensity",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_midtonesSaturation",void 0),Object(r.b)([Object(n.c)()],f.prototype,"_midtonesExposure",void 0),f);function f(){this._dirty=!0,this._tempColor=new s.b(0,0,0,0),this._globalCurve=new s.b(0,0,0,0),this._highlightsCurve=new s.b(0,0,0,0),this._midtonesCurve=new s.b(0,0,0,0),this._shadowsCurve=new s.b(0,0,0,0),this._positiveCurve=new s.b(0,0,0,0),this._negativeCurve=new s.b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}n.a._ColorCurvesParser=u.Parse;var h;h=a.a,Object(r.c)(l,h);function l(){var e=h.call(this)||this;return e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.rebuild(),e}var d=(Object.defineProperty(p.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),p.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},p.prototype.getClassName=function(){return"ImageProcessingConfiguration"},p.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&u.PrepareUniforms(e)},p.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},p.prototype.prepareDefines=function(e,t){if(void 0===t&&(t=!1),t!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===p._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case p.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0;break;default:e.TONEMAPPING_ACES=!1}e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},p.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},p.prototype.bind=function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&u.Bind(this.colorCurves,e),this._vignetteEnabled){var i=1/e.getEngine().getRenderWidth(),r=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",i,r);var n=null!=t?t:r/i,o=Math.tan(.5*this.vignetteCameraFov),s=o*n,a=Math.sqrt(s*o);s=c.b.Mix(s,a,this.vignetteStretch),o=c.b.Mix(o,a,this.vignetteStretch),e.setFloat4("vignetteSettings1",s,o,-s*this.vignetteCentreX,-o*this.vignetteCentreY);var h=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var l=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(l-1)/l,.5/l,l,this.colorGradingTexture.level)}},p.prototype.clone=function(){return n.a.Clone(function(){return new p},this)},p.prototype.serialize=function(){return n.a.Serialize(this)},p.Parse=function(e){return n.a.Parse(function(){return new p},e,null,null)},Object.defineProperty(p,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(p,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),p.TONEMAPPING_STANDARD=0,p.TONEMAPPING_ACES=1,p._VIGNETTEMODE_MULTIPLY=0,p._VIGNETTEMODE_OPAQUE=1,Object(r.b)([Object(n.f)()],p.prototype,"colorCurves",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_colorCurvesEnabled",void 0),Object(r.b)([Object(n.j)("colorGradingTexture")],p.prototype,"_colorGradingTexture",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_colorGradingEnabled",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_colorGradingWithGreenDepth",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_colorGradingBGR",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_exposure",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_toneMappingEnabled",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_toneMappingType",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_contrast",void 0),Object(r.b)([Object(n.c)()],p.prototype,"vignetteStretch",void 0),Object(r.b)([Object(n.c)()],p.prototype,"vignetteCentreX",void 0),Object(r.b)([Object(n.c)()],p.prototype,"vignetteCentreY",void 0),Object(r.b)([Object(n.c)()],p.prototype,"vignetteWeight",void 0),Object(r.b)([Object(n.e)()],p.prototype,"vignetteColor",void 0),Object(r.b)([Object(n.c)()],p.prototype,"vignetteCameraFov",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_vignetteBlendMode",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_vignetteEnabled",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_applyByPostProcess",void 0),Object(r.b)([Object(n.c)()],p.prototype,"_isEnabled",void 0),p);function p(){this.colorCurves=new u,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=p.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new s.b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=p.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new o.a}n.a._ImageProcessingConfigurationParser=d.Parse},function(e,t,i){"use strict";i.r(t),i.d(t,"Space",function(){return r.b}),i.d(t,"Axis",function(){return r.a}),i.d(t,"Color3",function(){return n.a}),i.d(t,"Color4",function(){return n.b}),i.d(t,"TmpColors",function(){return n.c}),i.d(t,"ToGammaSpace",function(){return o.b}),i.d(t,"ToLinearSpace",function(){return o.c}),i.d(t,"Epsilon",function(){return o.a}),i.d(t,"Frustum",function(){return s.a}),i.d(t,"Orientation",function(){return a.e}),i.d(t,"BezierCurve",function(){return a.c}),i.d(t,"Angle",function(){return a.a}),i.d(t,"Arc2",function(){return a.b}),i.d(t,"Path2",function(){return a.f}),i.d(t,"Path3D",function(){return a.g}),i.d(t,"Curve3",function(){return a.d}),i.d(t,"Plane",function(){return h.a}),i.d(t,"Size",function(){return l.a}),i.d(t,"Vector2",function(){return c.d}),i.d(t,"Vector3",function(){return c.e}),i.d(t,"Vector4",function(){return c.f}),i.d(t,"Quaternion",function(){return c.b}),i.d(t,"Matrix",function(){return c.a}),i.d(t,"TmpVectors",function(){return c.c}),i.d(t,"PositionNormalVertex",function(){return u}),i.d(t,"PositionNormalTextureVertex",function(){return d}),i.d(t,"Viewport",function(){return _.a});var r=i(35),n=i(7),o=i(15),s=i(50),a=i(69),h=i(49),l=i(46),c=i(0),u=(f.prototype.clone=function(){return new f(this.position.clone(),this.normal.clone())},f);function f(e,t){void 0===e&&(e=c.e.Zero()),void 0===t&&(t=c.e.Up()),this.position=e,this.normal=t}var d=(p.prototype.clone=function(){return new p(this.position.clone(),this.normal.clone(),this.uv.clone())},p);function p(e,t,i){void 0===e&&(e=c.e.Zero()),void 0===t&&(t=c.e.Up()),void 0===i&&(i=c.d.Zero()),this.position=e,this.normal=t,this.uv=i}var _=i(52)},function(e,t,i){"use strict";i.d(t,"a",function(){return r});function l(e,t){return!e||e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null}var c=i(40),r=(n.DeepCopy=function(e,t,i,r){for(var n in e)if(("_"!==n[0]||r&&-1!==r.indexOf(n))&&!(c.a.EndsWith(n,"Observable")||i&&-1!==i.indexOf(n))){var o=e[n],s=typeof o;if("function"!=s)try{if("object"==s)if(o instanceof Array){if(t[n]=[],0<o.length)if("object"==typeof o[0])for(var a=0;a<o.length;a++){var h=l(o[a],t);-1===t[n].indexOf(h)&&t[n].push(h)}else t[n]=o.slice(0)}else t[n]=l(o,t);else t[n]=o}catch(e){}}},n);function n(){}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return n});var f=i(0);function r(e,t,i,r,n){void 0===n&&(n=null);for(var o=new f.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new f.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=i;a<i+r;a++){var h=3*t[a],l=e[h],c=e[1+h],u=e[2+h];o.minimizeInPlaceFromFloats(l,c,u),s.maximizeInPlaceFromFloats(l,c,u)}return n&&(o.x-=o.x*n.x+n.y,o.y-=o.y*n.x+n.y,o.z-=o.z*n.x+n.y,s.x+=s.x*n.x+n.y,s.y+=s.y*n.x+n.y,s.z+=s.z*n.x+n.y),{minimum:o,maximum:s}}function n(e,t,i,r,n){void 0===r&&(r=null);for(var o=new f.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new f.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=t,h=t*(n=n||3);a<t+i;a++,h+=n){var l=e[h],c=e[h+1],u=e[h+2];o.minimizeInPlaceFromFloats(l,c,u),s.maximizeInPlaceFromFloats(l,c,u)}return r&&(o.x-=o.x*r.x+r.y,o.y-=o.y*r.x+r.y,o.z-=o.z*r.x+r.y,s.x+=s.x*r.x+r.y,s.y+=s.y*r.x+r.y,s.z+=s.z*r.x+r.y),{minimum:o,maximum:s}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var s=i(11),r=i(24),n=i(51);r.a.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var i=new n.a(t);return this.bindUniformBuffer(i),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),i.references=1,i},r.a.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var i=new n.a(t);return this.bindUniformBuffer(i),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),i.references=1,i},r.a.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},r.a.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},r.a.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},r.a.prototype.bindUniformBlock=function(e,t,i){var r=e.program,n=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,n,i)};var o=(Object.defineProperty(a.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),a.prototype.isDynamic=function(){return void 0!==this._dynamic},a.prototype.getData=function(){return this._bufferData},a.prototype.getBuffer=function(){return this._buffer},a.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var r=this._uniformLocationPointer-i,n=0;n<r;n++)this._data.push(0)}},a.prototype.addUniform=function(e,t){if(!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(t instanceof Array)t=(i=t).length;else{t=t,i=[];for(var r=0;r<t;r++)i.push(0)}for(this._fillAlignment(t),this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t,r=0;r<t;r++)this._data.push(i[r]);this._needSync=!0}},a.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},a.prototype.addFloat2=function(e,t,i){var r=[t,i];this.addUniform(e,r)},a.prototype.addFloat3=function(e,t,i,r){var n=[t,i,r];this.addUniform(e,n)},a.prototype.addColor3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},a.prototype.addColor4=function(e,t,i){var r=new Array;t.toArray(r),r.push(i),this.addUniform(e,r)},a.prototype.addVector3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},a.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},a.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},a.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},a.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},a.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},a.prototype.updateUniform=function(e,t,i){var r=this._uniformLocations[e];if(void 0===r){if(this._buffer)return void s.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,i),r=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(o=0;o<i;o++)this._bufferData[r+o]=t[o];else{for(var n=!1,o=0;o<i;o++)16!==i&&this._bufferData[r+o]===t[o]||(n=!0,this._bufferData[r+o]=t[o]);this._needSync=this._needSync||n}},a.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)},a.prototype._updateMatrix3x3ForUniform=function(e,t){for(var i=0;i<3;i++)a._tempBuffer[4*i]=t[3*i],a._tempBuffer[4*i+1]=t[3*i+1],a._tempBuffer[4*i+2]=t[3*i+2],a._tempBuffer[4*i+3]=0;this.updateUniform(e,a._tempBuffer,12)},a.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},a.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},a.prototype._updateMatrix2x2ForUniform=function(e,t){for(var i=0;i<2;i++)a._tempBuffer[4*i]=t[2*i],a._tempBuffer[4*i+1]=t[2*i+1],a._tempBuffer[4*i+2]=0,a._tempBuffer[4*i+3]=0;this.updateUniform(e,a._tempBuffer,8)},a.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},a.prototype._updateFloatForUniform=function(e,t){a._tempBuffer[0]=t,this.updateUniform(e,a._tempBuffer,1)},a.prototype._updateFloat2ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setFloat2(e+r,t,i)},a.prototype._updateFloat2ForUniform=function(e,t,i){a._tempBuffer[0]=t,a._tempBuffer[1]=i,this.updateUniform(e,a._tempBuffer,2)},a.prototype._updateFloat3ForEffect=function(e,t,i,r,n){void 0===n&&(n=""),this._currentEffect.setFloat3(e+n,t,i,r)},a.prototype._updateFloat3ForUniform=function(e,t,i,r){a._tempBuffer[0]=t,a._tempBuffer[1]=i,a._tempBuffer[2]=r,this.updateUniform(e,a._tempBuffer,3)},a.prototype._updateFloat4ForEffect=function(e,t,i,r,n,o){void 0===o&&(o=""),this._currentEffect.setFloat4(e+o,t,i,r,n)},a.prototype._updateFloat4ForUniform=function(e,t,i,r,n){a._tempBuffer[0]=t,a._tempBuffer[1]=i,a._tempBuffer[2]=r,a._tempBuffer[3]=n,this.updateUniform(e,a._tempBuffer,4)},a.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},a.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},a.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},a.prototype._updateVector3ForUniform=function(e,t){t.toArray(a._tempBuffer),this.updateUniform(e,a._tempBuffer,3)},a.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},a.prototype._updateVector4ForUniform=function(e,t){t.toArray(a._tempBuffer),this.updateUniform(e,a._tempBuffer,4)},a.prototype._updateColor3ForEffect=function(e,t,i){void 0===i&&(i=""),this._currentEffect.setColor3(e+i,t)},a.prototype._updateColor3ForUniform=function(e,t){t.toArray(a._tempBuffer),this.updateUniform(e,a._tempBuffer,3)},a.prototype._updateColor4ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setColor4(e+r,t,i)},a.prototype._updateColor4ForUniform=function(e,t,i){t.toArray(a._tempBuffer),a._tempBuffer[3]=i,this.updateUniform(e,a._tempBuffer,4)},a.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},a.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},a.prototype.bindToEffect=function(e,t){this._currentEffect=e,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,e.bindUniformBuffer(this._buffer,t))},a.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);-1!==t&&(e[t]=e[e.length-1],e.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},a._MAX_UNIFORM_SIZE=256,a._tempBuffer=new Float32Array(a._MAX_UNIFORM_SIZE),a);function a(e,t,i){this._alreadyBound=!1,this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=i,this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.prototype._injectCustomRequestHeaders=function(){for(var e in n.CustomRequestHeaders){var t=n.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}},Object.defineProperty(n.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!0,configurable:!0}),n.prototype.addEventListener=function(e,t,i){this._xhr.addEventListener(e,t,i)},n.prototype.removeEventListener=function(e,t,i){this._xhr.removeEventListener(e,t,i)},n.prototype.abort=function(){this._xhr.abort()},n.prototype.send=function(e){n.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)},n.prototype.open=function(e,t){for(var i=0,r=n.CustomRequestModifiers;i<r.length;i++)(0,r[i])(this._xhr,t);return t=(t=t.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(e,t,!0)},n.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},n.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},n.CustomRequestHeaders={},n.CustomRequestModifiers=new Array,n);function n(){this._xhr=new XMLHttpRequest}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var s=i(11),a=i(10),r=(n.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=a.a.GetClass(e);if(t)return t;s.a.Warn(e+" not found, you may have missed an import.");for(var i=e.split("."),r=window||this,n=0,o=i.length;n<o;n++)r=r[i[n]];return"function"!=typeof r?null:r},n.RegisteredExternalClasses={},n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return h});var s,r=i(1),n=i(27),o=i(21),a=i(10),h=(s=n.a,Object(r.c)(l,s),Object.defineProperty(l.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!0,configurable:!0}),l.prototype.getChildren=function(){return this.subMaterials},l.prototype._hookArray=function(r){var n=this,o=r.push;r.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=o.apply(r,e);return n._markAllSubMeshesAsTexturesDirty(),i};var s=r.splice;r.splice=function(e,t){var i=s.apply(r,[e,t]);return n._markAllSubMeshesAsTexturesDirty(),i}},l.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},l.prototype.getActiveTextures=function(){var e;return(e=s.prototype.getActiveTextures.call(this)).concat.apply(e,this.subMaterials.map(function(e){return e?e.getActiveTextures():[]}))},l.prototype.getClassName=function(){return"MultiMaterial"},l.prototype.isReadyForSubMesh=function(e,t,i){for(var r=0;r<this.subMaterials.length;r++){var n=this.subMaterials[r];if(n){if(n._storeEffectOnSubMeshes){if(!n.isReadyForSubMesh(e,t,i))return!1;continue}if(!n.isReady(e))return!1}}return!0},l.prototype.clone=function(e,t){for(var i=new l(e,this.getScene()),r=0;r<this.subMaterials.length;r++){var n=null,o=this.subMaterials[r];n=t&&o?o.clone(e+"-"+o.name):this.subMaterials[r],i.subMaterials.push(n)}return i},l.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,o.a&&(e.tags=o.a.GetTags(this)),e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var i=this.subMaterials[t];i?e.materials.push(i.id):e.materials.push(null)}return e},l.prototype.dispose=function(e,t,i){var r=this.getScene();if(r){if(i)for(var n=0;n<this.subMaterials.length;n++){var o=this.subMaterials[n];o&&o.dispose(e,t)}0<=(n=r.multiMaterials.indexOf(this))&&r.multiMaterials.splice(n,1),s.prototype.dispose.call(this,e,t)}},l.ParseMultiMaterial=function(e,t){var i=new l(e.name,t);i.id=e.id,o.a&&o.a.AddTagsTo(i,e.tags);for(var r=0;r<e.materials.length;r++){var n=e.materials[r];n?i.subMaterials.push(t.getLastMaterialByID(n)):i.subMaterials.push(null)}return i},l);function l(e,t){var i=s.call(this,e,t,!0)||this;return t.multiMaterials.push(i),i.subMaterials=new Array,i._storeEffectOnSubMeshes=!0,i}a.a.RegisteredTypes["BABYLON.MultiMaterial"]=h},function(e,O,t){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(O,"__esModule",{value:!0}),O.Plots=O.isValidPlot=O.PLOTTYPES=O.getUniqueVals=O.Plot=O.matrixMax=O.styleText=O.buttonSVGs=void 0;var n=t(33),o=t(26),s=t(98),a=t(90),p=t(56),_=t(79),b=t(89),y=t(88),r=t(99),P=i(t(76)),h=t(91),C=t(92);function S(e){var t=e.map(function(e){return Math.max.apply(Math,e)});return Math.max.apply(null,t)}O.buttonSVGs={logo:'<svg id="Ebene_1" data-name="Ebene 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1{fill:#752a10;}.cls-2{fill:#a33b16;}.cls-3{fill:#e95420;}</style></defs><path d="M16,6A10,10,0,1,1,6,16,10,10,0,0,1,16,6m0-5A15,15,0,1,0,31,16,15,15,0,0,0,16,1Z"/><path d="M16.52,27a5.65,5.65,0,0,1-2.83-.68,5.06,5.06,0,0,1-1.91-1.93v2.35H8V7.11h4.31V15a5.09,5.09,0,0,1,1.87-1.9A5.33,5.33,0,0,1,17,12.36a5.42,5.42,0,0,1,2.48.58,6,6,0,0,1,1.94,1.58,7.51,7.51,0,0,1,1.27,2.36,9.11,9.11,0,0,1,.45,2.89,8.2,8.2,0,0,1-.49,2.87A7.39,7.39,0,0,1,21.24,25,6.29,6.29,0,0,1,16.52,27Zm-1.21-3.63a3.47,3.47,0,0,0,1.38-.28,3.4,3.4,0,0,0,1.06-.77,3.62,3.62,0,0,0,.7-1.15,4,4,0,0,0,.26-1.44,4.12,4.12,0,0,0-.25-1.44,3.86,3.86,0,0,0-.66-1.2,3,3,0,0,0-1-.81,2.88,2.88,0,0,0-3.14.41,4.57,4.57,0,0,0-1.3,1.75v3a3.31,3.31,0,0,0,1.25,1.44A3.15,3.15,0,0,0,15.31,23.41Z"/><path class="cls-1" d="M17.83,26A5.6,5.6,0,0,1,15,25.31a5.06,5.06,0,0,1-1.92-1.92v2.34H9.34V6.06h4.31V13.9A5.17,5.17,0,0,1,15.52,12a5.43,5.43,0,0,1,2.76-.68,5.3,5.3,0,0,1,2.48.58,5.9,5.9,0,0,1,1.94,1.57A7.62,7.62,0,0,1,24,15.83a9.16,9.16,0,0,1,.46,2.89,8.12,8.12,0,0,1-.5,2.87,7.28,7.28,0,0,1-1.39,2.32,6.28,6.28,0,0,1-2.1,1.54A6.36,6.36,0,0,1,17.83,26Zm-1.22-3.64A3.27,3.27,0,0,0,18,22.08a3.4,3.4,0,0,0,1.06-.77,3.47,3.47,0,0,0,.7-1.14A4,4,0,0,0,20,18.72a4.12,4.12,0,0,0-.25-1.44,3.93,3.93,0,0,0-.66-1.19,2.85,2.85,0,0,0-1-.81,2.72,2.72,0,0,0-1.26-.3,2.85,2.85,0,0,0-1.87.7,4.57,4.57,0,0,0-1.31,1.75v3a3.37,3.37,0,0,0,1.25,1.44A3.14,3.14,0,0,0,16.61,22.36Z"/><path class="cls-2" d="M18.83,25A5.6,5.6,0,0,1,16,24.31a5.06,5.06,0,0,1-1.92-1.92v2.34H10.34V5.06h4.31V12.9A5.17,5.17,0,0,1,16.52,11a5.43,5.43,0,0,1,2.76-.68,5.3,5.3,0,0,1,2.48.58,5.9,5.9,0,0,1,1.94,1.57A7.62,7.62,0,0,1,25,14.83a9.16,9.16,0,0,1,.46,2.89,8.12,8.12,0,0,1-.5,2.87,7.28,7.28,0,0,1-1.39,2.32,6.28,6.28,0,0,1-2.1,1.54A6.36,6.36,0,0,1,18.83,25Zm-1.22-3.64A3.27,3.27,0,0,0,19,21.08a3.4,3.4,0,0,0,1.06-.77,3.47,3.47,0,0,0,.7-1.14A4,4,0,0,0,21,17.72a4.12,4.12,0,0,0-.25-1.44,3.93,3.93,0,0,0-.66-1.19,2.85,2.85,0,0,0-1-.81,2.72,2.72,0,0,0-1.26-.3,2.85,2.85,0,0,0-1.87.7,4.57,4.57,0,0,0-1.31,1.75v3a3.37,3.37,0,0,0,1.25,1.44A3.14,3.14,0,0,0,17.61,21.36Z"/><path class="cls-3" d="M19.83,24A5.6,5.6,0,0,1,17,23.31a5.06,5.06,0,0,1-1.92-1.92v2.34H11.34V4.06h4.31V11.9A5.17,5.17,0,0,1,17.52,10a5.43,5.43,0,0,1,2.76-.68,5.3,5.3,0,0,1,2.48.58,5.9,5.9,0,0,1,1.94,1.57A7.62,7.62,0,0,1,26,13.83a9.17,9.17,0,0,1,.45,2.9,8.11,8.11,0,0,1-.49,2.86,7.28,7.28,0,0,1-1.39,2.32,6.28,6.28,0,0,1-2.1,1.54A6.36,6.36,0,0,1,19.83,24Zm-1.22-3.64A3.27,3.27,0,0,0,20,20.08a3.4,3.4,0,0,0,1.06-.77,3.47,3.47,0,0,0,.7-1.14A4,4,0,0,0,22,16.73a4.13,4.13,0,0,0-.25-1.45,3.93,3.93,0,0,0-.66-1.19,2.85,2.85,0,0,0-1-.81,2.72,2.72,0,0,0-1.26-.3,2.85,2.85,0,0,0-1.87.7,4.57,4.57,0,0,0-1.31,1.75v3a3.37,3.37,0,0,0,1.25,1.44A3.14,3.14,0,0,0,18.61,20.36Z"/></svg>',toJson:'<svg id="Ebene_1" data-name="Ebene 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 80"><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:16px;}</style></defs><path d="M19.15,23.18V36.45a5.1,5.1,0,0,1-.3,1.53,3.51,3.51,0,0,1-1.15,1.63,3.42,3.42,0,0,1,1.15,1.65,5.29,5.29,0,0,1,.3,1.5V56.59h2.94v2.9h-5a1.31,1.31,0,0,1-.83-.33,1.52,1.52,0,0,1-.4-1.2V43.67a3.43,3.43,0,0,0-.53-1.85,2,2,0,0,0-1.55-.94V38.23a1.5,1.5,0,0,0,.93-.3,3,3,0,0,0,.67-.71,2.82,2.82,0,0,0,.38-.89,3.92,3.92,0,0,0,.1-.79V21.81c0-.65.16-1.06.48-1.25a1.8,1.8,0,0,1,.75-.28h5v2.9Z"/><path d="M68.32,23.18v-2.9h5a1.84,1.84,0,0,1,.75.28c.32.19.48.6.48,1.25V35.54a3.92,3.92,0,0,0,.1.79,3,3,0,0,0,.35.89,2.78,2.78,0,0,0,.62.71,1.47,1.47,0,0,0,1,.3v2.65a1.92,1.92,0,0,0-1.53.94,3.59,3.59,0,0,0-.5,1.85V58a1.52,1.52,0,0,1-.4,1.2,1.31,1.31,0,0,1-.83.33h-5v-2.9h2.94V42.76a5.81,5.81,0,0,1,.27-1.5,3.29,3.29,0,0,1,1.12-1.65A3.37,3.37,0,0,1,71.53,38a5.6,5.6,0,0,1-.27-1.53V23.18Z"/><path d="M83,57.91v-5h3.15v5Z"/><path d="M89.44,67.12a11.53,11.53,0,0,1-3.32-.46,7.35,7.35,0,0,1-2.78-1.52l1.77-2.34a4.7,4.7,0,0,0,1.87,1A8.25,8.25,0,0,0,89,64a4.83,4.83,0,0,0,1.84-.36,5.27,5.27,0,0,0,1.58-1,4.91,4.91,0,0,0,1.12-1.5A4.15,4.15,0,0,0,94,59.29V31.42h3.63V59.08a7.62,7.62,0,0,1-.69,3.26,8.24,8.24,0,0,1-1.84,2.54,8.42,8.42,0,0,1-2.62,1.65A8.12,8.12,0,0,1,89.44,67.12ZM94,25.88V20.79h3.63v5.09Z"/><path d="M114.88,58.42a20.44,20.44,0,0,1-6.36-1,15.51,15.51,0,0,1-5.35-2.95l1.66-2.34a18.34,18.34,0,0,0,4.78,2.74,14.73,14.73,0,0,0,5.22.92,9.75,9.75,0,0,0,5.37-1.3,4.14,4.14,0,0,0,2-3.69,3.11,3.11,0,0,0-.53-1.85,4.56,4.56,0,0,0-1.58-1.3,12.89,12.89,0,0,0-2.62-1c-1-.29-2.27-.58-3.66-.89-1.6-.37-3-.75-4.17-1.12a12.91,12.91,0,0,1-2.91-1.27A4.61,4.61,0,0,1,105,41.62a5.43,5.43,0,0,1-.56-2.62,7.07,7.07,0,0,1,3.07-6,10.46,10.46,0,0,1,3.31-1.5,15.53,15.53,0,0,1,4-.51,16.4,16.4,0,0,1,5.83,1,11.68,11.68,0,0,1,4.22,2.62l-1.76,2a10,10,0,0,0-3.77-2.29,14.1,14.1,0,0,0-4.63-.77,12.43,12.43,0,0,0-2.67.28,6.93,6.93,0,0,0-2.17.89,4.57,4.57,0,0,0-1.47,1.56,4.43,4.43,0,0,0-.53,2.21,3.5,3.5,0,0,0,.37,1.73,3.11,3.11,0,0,0,1.23,1.14,10.85,10.85,0,0,0,2.17.87q1.3.38,3.18.78c1.78.41,3.35.82,4.7,1.22a15.38,15.38,0,0,1,3.4,1.43,5.77,5.77,0,0,1,2.06,2,5.52,5.52,0,0,1,.69,2.85,6.81,6.81,0,0,1-2.94,5.8A13.22,13.22,0,0,1,114.88,58.42Z"/><path d="M143.53,58.42a13.58,13.58,0,0,1-9.92-4.07A13.41,13.41,0,0,1,130.75,50a13.88,13.88,0,0,1-1-5.24,13.71,13.71,0,0,1,3.93-9.66,14.19,14.19,0,0,1,4.35-3,14.16,14.16,0,0,1,11,0,14.14,14.14,0,0,1,4.39,3,13.79,13.79,0,0,1,2.88,4.37,13.53,13.53,0,0,1,1,5.29,13.7,13.7,0,0,1-1,5.24,13.41,13.41,0,0,1-2.86,4.37,13.55,13.55,0,0,1-4.38,3A14,14,0,0,1,143.53,58.42Zm-10.1-13.63a10.48,10.48,0,0,0,.8,4.15,11.15,11.15,0,0,0,2.16,3.35,9.7,9.7,0,0,0,7.14,3.08,9.37,9.37,0,0,0,3.93-.84,10.27,10.27,0,0,0,3.23-2.29,11,11,0,0,0,0-15.1,10.27,10.27,0,0,0-3.23-2.29,9.37,9.37,0,0,0-3.93-.84,9.17,9.17,0,0,0-3.9.84,10.3,10.3,0,0,0-3.21,2.32,11,11,0,0,0-3,7.62Z"/><path d="M186.88,57.91h-3.63V43.12q0-4.74-1.47-6.87a5.14,5.14,0,0,0-4.52-2.14,9.78,9.78,0,0,0-3.21.56,11.16,11.16,0,0,0-3,1.58,12.65,12.65,0,0,0-2.43,2.42,9.32,9.32,0,0,0-1.55,3V57.91h-3.63V31.42h3.31v6a12.82,12.82,0,0,1,4.89-4.68A13.92,13.92,0,0,1,178.6,31a8.58,8.58,0,0,1,3.9.81,6.59,6.59,0,0,1,2.56,2.29,10,10,0,0,1,1.39,3.61,23.81,23.81,0,0,1,.43,4.73Z"/><line class="cls-1" x1="45.23" y1="21.5" x2="45.23" y2="41.68"/><polygon points="64.67 39.07 25.8 39.07 45.23 58.5 64.67 39.07"/></svg>',labels:'<svg id="Ebene_1" data-name="Ebene 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 80"><path d="M48.8,20.79h3.64V51.91a3.1,3.1,0,0,0,.85,2.32,3.29,3.29,0,0,0,2.41.84,7,7,0,0,0,1.39-.16,9.26,9.26,0,0,0,1.49-.4l.64,2.79a11.19,11.19,0,0,1-2.48.66,15.26,15.26,0,0,1-2.54.26,5.58,5.58,0,0,1-4-1.35,4.94,4.94,0,0,1-1.44-3.79Z"/><path d="M70.18,58.42a10.34,10.34,0,0,1-3.66-.63A9.43,9.43,0,0,1,63.58,56a7.81,7.81,0,0,1-1.95-2.62,7.47,7.47,0,0,1-.7-3.23,6.27,6.27,0,0,1,.86-3.2,7.92,7.92,0,0,1,2.4-2.54,12,12,0,0,1,3.69-1.65,17.86,17.86,0,0,1,4.71-.59,26.72,26.72,0,0,1,4.33.36,19.09,19.09,0,0,1,3.9,1V41.18a7.49,7.49,0,0,0-2.09-5.57A7.86,7.86,0,0,0,73,33.55a12.87,12.87,0,0,0-4.38.82A21.4,21.4,0,0,0,64,36.71l-1.28-2.29A19.41,19.41,0,0,1,73.23,31q5.24,0,8.23,2.8a10,10,0,0,1,3,7.73V53.44c0,1,.45,1.42,1.34,1.42v3a8.37,8.37,0,0,1-1.39.16,3.25,3.25,0,0,1-2.17-.66,2.44,2.44,0,0,1-.82-1.83l-.11-2.09a12.6,12.6,0,0,1-4.84,3.66A15.46,15.46,0,0,1,70.18,58.42ZM71,55.78a13.12,13.12,0,0,0,5.21-1,8.58,8.58,0,0,0,3.61-2.69,3.21,3.21,0,0,0,.72-1,2.39,2.39,0,0,0,.24-1V45.76a23.52,23.52,0,0,0-3.77-1,22.83,22.83,0,0,0-4-.35,11.61,11.61,0,0,0-6.26,1.52,4.61,4.61,0,0,0-2.4,4,5.25,5.25,0,0,0,.51,2.29,5.6,5.6,0,0,0,1.39,1.85,6.32,6.32,0,0,0,2.11,1.25A7.33,7.33,0,0,0,71,55.78Z"/><path d="M105.94,58.42a12.2,12.2,0,0,1-10.37-5.64v5.13H92.31V20.79H96V37a15.6,15.6,0,0,1,4.49-4.35A11.15,11.15,0,0,1,106.53,31a11.53,11.53,0,0,1,5.26,1.17,12.25,12.25,0,0,1,4,3.13,14.4,14.4,0,0,1,2.51,4.42,14.89,14.89,0,0,1,.88,5.06,14,14,0,0,1-1,5.29,13.84,13.84,0,0,1-2.78,4.35,13.23,13.23,0,0,1-4.2,2.95A12.54,12.54,0,0,1,105.94,58.42Zm-.85-3.05a9.63,9.63,0,0,0,4.19-.89,10.12,10.12,0,0,0,3.26-2.39,11.36,11.36,0,0,0,2.14-3.41,10.29,10.29,0,0,0,.78-3.94,11.35,11.35,0,0,0-.73-4,10.9,10.9,0,0,0-2-3.44,9.82,9.82,0,0,0-3.15-2.39,9.23,9.23,0,0,0-4-.89,8.82,8.82,0,0,0-3.1.54A10.48,10.48,0,0,0,99.74,36a11.83,11.83,0,0,0-2.19,2.11A12.67,12.67,0,0,0,96,40.62v8.24a5.49,5.49,0,0,0,1.14,2.57,9.62,9.62,0,0,0,2.25,2.06,12,12,0,0,0,2.83,1.37A9.22,9.22,0,0,0,105.09,55.37Z"/><path d="M137.32,58.42a14,14,0,0,1-5.59-1.09,13.72,13.72,0,0,1-7.32-7.4,13.59,13.59,0,0,1-1-5.34,13.27,13.27,0,0,1,1-5.26A13.61,13.61,0,0,1,127.29,35a13.92,13.92,0,0,1,4.42-3,14.78,14.78,0,0,1,11.14,0,13.51,13.51,0,0,1,4.36,3A13.77,13.77,0,0,1,150,39.35a13.34,13.34,0,0,1,1,5.19v.81a1.79,1.79,0,0,1-.05.56H127.16a10.88,10.88,0,0,0,1,3.94A10.74,10.74,0,0,0,130.48,53,10.07,10.07,0,0,0,133.66,55a9.92,9.92,0,0,0,3.82.74,10.22,10.22,0,0,0,2.67-.36,11.14,11.14,0,0,0,2.46-1,9.12,9.12,0,0,0,2-1.5A6.46,6.46,0,0,0,146,51l3.15.81a8.65,8.65,0,0,1-1.81,2.67,13,13,0,0,1-2.73,2.09,13.67,13.67,0,0,1-3.42,1.37A15.66,15.66,0,0,1,137.32,58.42Zm10.26-15.15a10.27,10.27,0,0,0-1-3.89,10.69,10.69,0,0,0-2.25-3,9.89,9.89,0,0,0-3.15-2,10.13,10.13,0,0,0-3.82-.71,10.33,10.33,0,0,0-3.85.71,9.65,9.65,0,0,0-5.37,5,10.83,10.83,0,0,0-1,3.87Z"/><path d="M156.83,20.79h3.63V51.91a3.1,3.1,0,0,0,.86,2.32,3.28,3.28,0,0,0,2.4.84,6.89,6.89,0,0,0,1.39-.16,9.11,9.11,0,0,0,1.5-.4l.64,2.79a11.34,11.34,0,0,1-2.48.66,15.26,15.26,0,0,1-2.54.26,5.56,5.56,0,0,1-4-1.35,4.94,4.94,0,0,1-1.44-3.79Z"/><path d="M180.45,58.42a20.53,20.53,0,0,1-6.36-1,15.47,15.47,0,0,1-5.34-2.95l1.65-2.34a18.39,18.39,0,0,0,4.79,2.74,14.68,14.68,0,0,0,5.21.92,9.7,9.7,0,0,0,5.37-1.3,4.13,4.13,0,0,0,2-3.69,3,3,0,0,0-.54-1.85,4.52,4.52,0,0,0-1.57-1.3,13.12,13.12,0,0,0-2.62-1c-1.05-.29-2.28-.58-3.67-.89-1.6-.37-3-.75-4.17-1.12a13.32,13.32,0,0,1-2.91-1.27,4.76,4.76,0,0,1-1.71-1.75A5.55,5.55,0,0,1,170,39a7.13,7.13,0,0,1,3.07-6,10.52,10.52,0,0,1,3.32-1.5,15.45,15.45,0,0,1,4-.51,16.4,16.4,0,0,1,5.83,1,11.6,11.6,0,0,1,4.22,2.62l-1.76,2A9.81,9.81,0,0,0,185,34.32a14.08,14.08,0,0,0-4.62-.77,12.46,12.46,0,0,0-2.68.28,6.77,6.77,0,0,0-2.16.89A4.57,4.57,0,0,0,174,36.28a4.33,4.33,0,0,0-.54,2.21,3.49,3.49,0,0,0,.38,1.73,3.11,3.11,0,0,0,1.23,1.14,10.73,10.73,0,0,0,2.16.87q1.32.38,3.18.78c1.79.41,3.35.82,4.71,1.22a15.49,15.49,0,0,1,3.39,1.43,5.69,5.69,0,0,1,2.06,2,5.52,5.52,0,0,1,.69,2.85,6.82,6.82,0,0,1-2.93,5.8A13.25,13.25,0,0,1,180.45,58.42Z"/><rect x="17.72" y="19.19" width="5.75" height="33.16" transform="translate(-16.58 17.83) rotate(-34.3)"/><path d="M28.23,52.06a14,14,0,0,0,7,5.15A14.78,14.78,0,0,0,33,48.82Z"/></svg>',publish:'<svg id="Ebene_1" data-name="Ebene 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 80"><path d="M29.14,58.42a11.34,11.34,0,0,1-6.22-1.7,13.88,13.88,0,0,1-4.36-4.3V68.75H14.92V31.42h3.26v5.14a13.3,13.3,0,0,1,4.44-4.05A11.85,11.85,0,0,1,28.55,31a12.1,12.1,0,0,1,5.3,1.15,13.61,13.61,0,0,1,4.17,3,14.16,14.16,0,0,1,2.75,4.4,13.77,13.77,0,0,1,1,5.13A15.2,15.2,0,0,1,40.85,50a13.4,13.4,0,0,1-2.59,4.37,12.44,12.44,0,0,1-4,3A11.83,11.83,0,0,1,29.14,58.42Zm-1-3.05a9.09,9.09,0,0,0,4.09-.91A10,10,0,0,0,35.37,52a10.93,10.93,0,0,0,2-3.41,11.47,11.47,0,0,0,.69-3.94,10.62,10.62,0,0,0-.8-4.07,11.4,11.4,0,0,0-2.19-3.4,10.28,10.28,0,0,0-3.29-2.34A9.72,9.72,0,0,0,27.7,34a8.66,8.66,0,0,0-2.91.54A12.17,12.17,0,0,0,22,36a9.71,9.71,0,0,0-2.24,2.09,5.35,5.35,0,0,0-1.15,2.51v8.14a12,12,0,0,0,1.63,2.64,11.17,11.17,0,0,0,2.24,2.11,10.83,10.83,0,0,0,2.7,1.4A9,9,0,0,0,28.13,55.37Z"/><path d="M56.62,58.42c-3,0-5.29-1-6.76-2.87S47.64,50.78,47.64,47V31.42h3.63V46.37q0,9,6.47,9a10.24,10.24,0,0,0,6-2,12.47,12.47,0,0,0,2.36-2.29,11.51,11.51,0,0,0,1.68-3V31.42h3.63v22c0,1,.43,1.42,1.29,1.42v3a6.94,6.94,0,0,1-1,.11H71.1A3,3,0,0,1,69,57.15a3,3,0,0,1-.8-2.19V51.91a12.71,12.71,0,0,1-4.95,4.81A13.63,13.63,0,0,1,56.62,58.42Z"/><path d="M93.29,58.42a12,12,0,0,1-6.07-1.57,11.87,11.87,0,0,1-4.3-4.07v5.13H79.66V20.79h3.63V37a15.73,15.73,0,0,1,4.49-4.35A11.2,11.2,0,0,1,93.87,31a11.57,11.57,0,0,1,5.27,1.17,12.1,12.1,0,0,1,4,3.13,14.43,14.43,0,0,1,2.52,4.42,14.89,14.89,0,0,1,.88,5.06,13.81,13.81,0,0,1-1,5.29,13.67,13.67,0,0,1-2.78,4.35,13.07,13.07,0,0,1-4.19,2.95A12.54,12.54,0,0,1,93.29,58.42Zm-.86-3.05a9.7,9.7,0,0,0,4.2-.89,10.23,10.23,0,0,0,3.26-2.39A11.36,11.36,0,0,0,102,48.68a10.47,10.47,0,0,0,.77-3.94,11.34,11.34,0,0,0-.72-4,11.09,11.09,0,0,0-2-3.44,10,10,0,0,0-3.16-2.39,9.16,9.16,0,0,0-4-.89,8.74,8.74,0,0,0-3.1.54A10.48,10.48,0,0,0,87.09,36a12.2,12.2,0,0,0-2.2,2.11,13.14,13.14,0,0,0-1.6,2.51v8.24a5.51,5.51,0,0,0,1.15,2.57,9.38,9.38,0,0,0,2.24,2.06,12,12,0,0,0,2.84,1.37A9.11,9.11,0,0,0,92.43,55.37Z"/><path d="M112.8,20.79h3.63V51.91a3.1,3.1,0,0,0,.86,2.32,3.28,3.28,0,0,0,2.4.84,7,7,0,0,0,1.39-.16,9.11,9.11,0,0,0,1.5-.4l.64,2.79a11.44,11.44,0,0,1-2.49.66,15.16,15.16,0,0,1-2.53.26,5.56,5.56,0,0,1-4-1.35,4.94,4.94,0,0,1-1.44-3.79Z"/><path d="M127.17,25.88V20.79h3.64v5.09Zm0,32V31.42h3.64V57.91Z"/><path d="M148.08,58.42a20.55,20.55,0,0,1-6.37-1,15.56,15.56,0,0,1-5.34-2.95L138,52.12a18.18,18.18,0,0,0,4.78,2.74,14.68,14.68,0,0,0,5.21.92,9.7,9.7,0,0,0,5.37-1.3,4.13,4.13,0,0,0,2-3.69,3,3,0,0,0-.54-1.85,4.52,4.52,0,0,0-1.57-1.3,13.12,13.12,0,0,0-2.62-1c-1-.29-2.27-.58-3.66-.89-1.61-.37-3-.75-4.17-1.12a13.21,13.21,0,0,1-2.92-1.27,4.76,4.76,0,0,1-1.71-1.75,5.55,5.55,0,0,1-.56-2.62,7.13,7.13,0,0,1,3.07-6,10.52,10.52,0,0,1,3.32-1.5,15.47,15.47,0,0,1,4-.51,16.34,16.34,0,0,1,5.82,1,11.6,11.6,0,0,1,4.22,2.62l-1.76,2a9.81,9.81,0,0,0-3.77-2.29,14.08,14.08,0,0,0-4.62-.77,12.53,12.53,0,0,0-2.68.28,6.87,6.87,0,0,0-2.16.89,4.57,4.57,0,0,0-1.47,1.56,4.33,4.33,0,0,0-.53,2.21,3.5,3.5,0,0,0,.37,1.73,3.11,3.11,0,0,0,1.23,1.14,10.73,10.73,0,0,0,2.16.87c.88.25,1.94.51,3.19.78,1.78.41,3.34.82,4.7,1.22a15.49,15.49,0,0,1,3.39,1.43,5.69,5.69,0,0,1,2.06,2,5.52,5.52,0,0,1,.7,2.85,6.81,6.81,0,0,1-2.94,5.8A13.22,13.22,0,0,1,148.08,58.42Z"/><path d="M188.27,57.91h-3.63V43.12c0-3-.55-5.28-1.63-6.77a5.56,5.56,0,0,0-4.79-2.24,8.53,8.53,0,0,0-3.07.59,11.52,11.52,0,0,0-5.19,4,10.21,10.21,0,0,0-1.47,3V57.91h-3.63V20.79h3.63V37.42a12.5,12.5,0,0,1,11-6.46,8.87,8.87,0,0,1,4.06.84,7.36,7.36,0,0,1,2.73,2.34,10,10,0,0,1,1.55,3.61,21,21,0,0,1,.48,4.65Z"/></svg>',replay:'<svg id="Ebene_1" data-name="Ebene 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 80"><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:2px;}</style></defs><path d="M59.46,34.47a11.82,11.82,0,0,0-6.41,1.93,9.78,9.78,0,0,0-3.85,5V57.91H45.56V31.42H49v6.36A12.26,12.26,0,0,1,53.15,33a10,10,0,0,1,5.62-1.73,3.36,3.36,0,0,1,.69.05Z"/><path d="M75,58.42a13.92,13.92,0,0,1-5.58-1.09,13.58,13.58,0,0,1-4.41-3,13.92,13.92,0,0,1-2.92-4.4,13.78,13.78,0,0,1-1-5.34,13.45,13.45,0,0,1,1-5.26A13.64,13.64,0,0,1,64.94,35a13.87,13.87,0,0,1,4.41-3,14.8,14.8,0,0,1,11.15,0,13.36,13.36,0,0,1,4.35,3,13.79,13.79,0,0,1,2.84,4.32,13.52,13.52,0,0,1,1,5.19v.81a2.18,2.18,0,0,1,0,.56H64.81a10.49,10.49,0,0,0,1,3.94A10.71,10.71,0,0,0,68.12,53,10.3,10.3,0,0,0,71.3,55a10,10,0,0,0,3.82.74,10.35,10.35,0,0,0,2.68-.36,10.87,10.87,0,0,0,2.45-1,9.42,9.42,0,0,0,2-1.5,6.64,6.64,0,0,0,1.39-2l3.15.81A8.86,8.86,0,0,1,85,54.48a12.67,12.67,0,0,1-2.72,2.09,14,14,0,0,1-3.42,1.37A15.69,15.69,0,0,1,75,58.42ZM85.23,43.27a10.28,10.28,0,0,0-1-3.89,10.47,10.47,0,0,0-2.24-3,9.89,9.89,0,0,0-3.15-2A10.18,10.18,0,0,0,75,33.66a10.4,10.4,0,0,0-3.85.71,9.81,9.81,0,0,0-3.18,2,9.94,9.94,0,0,0-2.19,3,11.26,11.26,0,0,0-1,3.87Z"/><path d="M108.53,58.42a11.39,11.39,0,0,1-6.23-1.7A13.85,13.85,0,0,1,98,52.42V68.75H94.31V31.42h3.26v5.14A13.2,13.2,0,0,1,102,32.51,11.82,11.82,0,0,1,107.94,31a12.1,12.1,0,0,1,5.3,1.15,13.45,13.45,0,0,1,4.16,3,14,14,0,0,1,2.76,4.4,13.77,13.77,0,0,1,1,5.13,15.43,15.43,0,0,1-.91,5.29,13.4,13.4,0,0,1-2.59,4.37,12.44,12.44,0,0,1-4,3A11.86,11.86,0,0,1,108.53,58.42Zm-1-3.05a9.09,9.09,0,0,0,4.09-.91A10.28,10.28,0,0,0,114.76,52a10.72,10.72,0,0,0,2-3.41,11.25,11.25,0,0,0,.7-3.94,10.62,10.62,0,0,0-.8-4.07,11.24,11.24,0,0,0-2.2-3.4,10.13,10.13,0,0,0-3.28-2.34,9.72,9.72,0,0,0-4.09-.87,8.76,8.76,0,0,0-2.92.54A12.1,12.1,0,0,0,101.34,36a9.71,9.71,0,0,0-2.24,2.09A5.35,5.35,0,0,0,98,40.57v8.14a12,12,0,0,0,1.63,2.64,11.17,11.17,0,0,0,2.24,2.11,10.83,10.83,0,0,0,2.7,1.4A8.92,8.92,0,0,0,107.52,55.37Z"/><path d="M127.45,20.79h3.64V51.91a3.1,3.1,0,0,0,.85,2.32,3.29,3.29,0,0,0,2.41.84,7,7,0,0,0,1.39-.16,9.26,9.26,0,0,0,1.49-.4l.65,2.79a11.44,11.44,0,0,1-2.49.66,15.26,15.26,0,0,1-2.54.26,5.55,5.55,0,0,1-3.95-1.35,4.91,4.91,0,0,1-1.45-3.79Z"/><path d="M148.83,58.42a10.38,10.38,0,0,1-3.66-.63A9.43,9.43,0,0,1,142.23,56a7.81,7.81,0,0,1-1.95-2.62,7.61,7.61,0,0,1-.69-3.23,6.26,6.26,0,0,1,.85-3.2,7.85,7.85,0,0,1,2.41-2.54,11.79,11.79,0,0,1,3.69-1.65,17.73,17.73,0,0,1,4.7-.59,26.72,26.72,0,0,1,4.33.36,19.09,19.09,0,0,1,3.9,1V41.18a7.48,7.48,0,0,0-2.08-5.57,7.89,7.89,0,0,0-5.78-2.06,12.91,12.91,0,0,0-4.38.82,21.11,21.11,0,0,0-4.54,2.34l-1.29-2.29A19.41,19.41,0,0,1,151.88,31c3.49,0,6.24.93,8.23,2.8a10,10,0,0,1,3,7.73V53.44c0,1,.44,1.42,1.33,1.42v3a8.26,8.26,0,0,1-1.39.16,3.22,3.22,0,0,1-2.16-.66,2.42,2.42,0,0,1-.83-1.83L160,53.49a12.57,12.57,0,0,1-4.83,3.66A15.54,15.54,0,0,1,148.83,58.42Zm.86-2.64a13.09,13.09,0,0,0,5.21-1,8.52,8.52,0,0,0,3.61-2.69,3.21,3.21,0,0,0,.72-1,2.39,2.39,0,0,0,.24-1V45.76a23.52,23.52,0,0,0-3.77-1,22.83,22.83,0,0,0-4-.35,11.54,11.54,0,0,0-6.25,1.52,4.6,4.6,0,0,0-2.41,4,5.25,5.25,0,0,0,.51,2.29A5.74,5.74,0,0,0,145,54.07a6.42,6.42,0,0,0,2.11,1.25A7.33,7.33,0,0,0,149.69,55.78Z"/><path d="M171.87,66.05l.83.08.78,0A3.73,3.73,0,0,0,175,65.9a2.73,2.73,0,0,0,1.1-1.12,19.72,19.72,0,0,0,1.2-2.49c.44-1.09,1.08-2.54,1.9-4.38L167.06,31.42h3.74l10.32,23.29,9.57-23.29h3.47L179.73,65.59a6.17,6.17,0,0,1-1.95,2.57,5.78,5.78,0,0,1-3.72,1.09c-.35,0-.69,0-1,0s-.71-.06-1.18-.13Z"/><polygon points="8.34 44.91 23.84 32.12 23.84 56.55 8.34 44.91"/><polygon points="22.52 44.91 38.02 32.12 38.02 56.55 22.52 44.91"/><line class="cls-1" x1="8.34" y1="56.55" x2="8.34" y2="32.12"/></svg>'},O.styleText=[".bbp.button-bar { position: absolute; z-index: 2; overflow: hidden; padding: 0 10px 4px 0; }",".bbp.button-bar > .button { float: right; width: 75px; height: 30px; cursor: pointer; border-radius: 2px; background-color: #f0f0f0; margin: 0 4px 0 0; }",".bbp.button-bar > .button:hover { background-color: #ddd; }",".bbp.button-bar > .button > svg { width: 75px; height: 30px; }",".bbp.label-control { position: absolute; z-index: 3; font-family: sans-serif; width: 200px; background-color: #f0f0f0; padding: 5px; border-radius: 2px; }",".bbp.label-control > label { font-size: 11pt; }",".bbp.label-control > .edit-container { overflow: auto; }",".bbp.label-control > .edit-container > .label-form { margin-top: 5px; padding-top: 20px; border-top: solid thin #ccc; }",".bbp.label-control .label-form > input { width: 100%; box-sizing: border-box; }",".bbp.label-control .label-form > button { border: none; font-weight: bold; background-color: white; padding: 5px 10px; margin: 5px 0 2px 0; width: 100%; cursor: pointer; }",".bbp.label-control .label-form > button:hover { background-color: #ddd; }"].join(" "),O.matrixMax=S;var l=(c.prototype.updateSize=function(){},c.prototype.update=function(){return!1},c.prototype.resetAnimation=function(){},c);function c(e,t,i,r,n){this._size=1,this._scene=e,this._coords=t,this._coordColors=i,this._size=r,this.legendData=n}function R(e){for(var t=e.length,i=[],r=new Set,n=0;n<t;n++){var o=e[n];r.has(o)||(r.add(o),i.push(o))}return i}O.Plot=l,Array.prototype.min=function(){if(65536<this.length){var r=this[0];return this.forEach(function(e,t,i){e<r&&(r=e)}),r}return Math.min.apply(null,this)},Array.prototype.max=function(){if(65536<this.length){var r=this[0];return this.forEach(function(e,t,i){r<e&&(r=e)}),r}return Math.max.apply(null,this)},O.getUniqueVals=R;var u=t(93),I=t(94),w=t(96),D=t(97);O.PLOTTYPES={pointCloud:["coordinates","colorBy","colorVar"],surface:["coordinates","colorBy","colorVar"],heatMap:["coordinates","colorBy","colorVar"],imgStack:["values","indices","attributes"]},O.isValidPlot=function(e){if(e.plotType){var t=e.plotType;if(O.PLOTTYPES.hasOwnProperty(t)){for(var i=0;i<O.PLOTTYPES[t].length;i++){if(void 0===e[r=O.PLOTTYPES[t][i]])return console.log("missing "+r),!1}return!0}return console.log("unrecognized plot type"),!1}for(i=0;i<O.PLOTTYPES.imgStack.length;i++){var r;if(void 0===e[r=O.PLOTTYPES.imgStack[i]])return console.log("missing "+r),!1}return!0};var f=(d.prototype.fromJSON=function(e){if(void 0!==e.turntable&&(this.turntable=e.turntable),void 0!==e.rotationRate&&(this.rotationRate=e.rotationRate),e.backgroundColor&&(this._backgroundColor=e.backgroundColor,this.scene.clearColor=p.Color4.FromHexString(this._backgroundColor)),e.coordinates&&e.plotType&&e.colorBy?this.addPlot(e.coordinates,e.plotType,e.colorBy,e.colorVar,{size:e.size,colorScale:e.colorScale,customColorScale:e.customColorScale,colorScaleInverted:e.colorScaleInverted,sortedCategories:e.sortedCategories,showLegend:e.showLegend,fontSize:e.fontSize,fontColor:e.fontColor,legendTitle:e.legendTitle,legendTitleFontSize:e.legendTitleFontSize,showAxes:e.showAxes,axisLabels:e.axisLabels,axisColors:e.axisColors,tickBreaks:e.tickBreaks,showTickLines:e.showTickLines,tickLineColors:e.tickLineColors,folded:e.folded,foldedEmbedding:e.foldedEmbedding,foldAnimDelay:e.foldAnimDelay,foldAnimDuration:e.foldAnimDuration,colnames:e.colnames,rownames:e.rownames}):e.values&&e.indices&&e.attributes&&this.addImgStack(e.values,e.indices,e.attributes,{size:e.size,colorScale:e.colorScale,showLegend:e.showLegend,fontSize:e.fontSize,fontColor:e.fontColor,legendTitle:e.legendTitle,legendTitleFontSize:e.legendTitleFontSize,showAxes:e.showAxes,axisLabels:e.axisLabels,axisColors:e.axisColors,tickBreaks:e.tickBreaks,showTickLines:e.showTickLines,tickLineColors:e.tickLineColors,intensityMode:e.intensityMode}),e.labels){this._labelManager.fixed=!0;for(var t=e.labels,i=0;i<t.length;i++){var r=t[i];r.text&&r.position&&this._labelManager.addLabel(r.text,r.position)}}},d.prototype.createButtons=function(e){if(void 0===e&&(e=["json","label","publish"]),-1!==e.indexOf("json")){var t=document.createElement("div");t.className="button",t.onclick=this._downloadJson.bind(this),t.innerHTML=O.buttonSVGs.toJson,this._buttonBar.appendChild(t)}if(-1!==e.indexOf("label")){var i=document.createElement("div");i.className="button",i.onclick=this._labelManager.toggleLabelControl.bind(this._labelManager),i.innerHTML=O.buttonSVGs.labels,this._buttonBar.appendChild(i)}},d.prototype._downloadJson=function(){var e=document.createElement("a");this._downloadObj.labels=this._labelManager.exportLabels();var t=encodeURIComponent(JSON.stringify(this._downloadObj));e.setAttribute("href","data:text/plain;charset=utf-8,"+t),e.setAttribute("download","babyplots_export.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},d.prototype._resetAnimation=function(){this._hasAnim=!0,this.plots[0].resetAnimation();var e=this.plots[0].mesh.getBoundingInfo().boundingBox,t=[e.minimumWorld.x,e.maximumWorld.x],i=[e.minimumWorld.y,e.maximumWorld.y],r=[e.minimumWorld.z,e.maximumWorld.z];this._axes.axisData.range=[t,i,r],this._axes.update(this.camera,!0)},d.prototype._prepRender=function(){if(this.turntable&&(this.camera.alpha+=this.rotationRate),this._hasAnim&&(this._hasAnim=this.plots[0].update(),!this._hasAnim)){var e=this.plots[0].mesh.getBoundingInfo().boundingBox,t=[e.minimumWorld.x,e.maximumWorld.x],i=[e.minimumWorld.y,e.maximumWorld.y],r=[e.minimumWorld.z,e.maximumWorld.z];this._axes.axisData.range=[t,i,r],this._axes.update(this.camera,!0)}this._axes&&this._axes.update(this.camera),this._labelManager.update()},d.prototype._afterRender=function(){},d.prototype._cameraFitPlot=function(e,t,i){var r=e[1]-e[0],n=t[1]-t[0],o=i[1]-i[0],s=_.BoxBuilder.CreateBox("bdbx",{width:r,height:n,depth:o},this.scene),a=e[1]-r/2,h=t[1]-n/2,l=i[1]-o/2;s.position=new p.Vector3(a,h,l),this.camera.position=new p.Vector3(a,n,l),this.camera.target=new p.Vector3(a,h,l);var c=s.getBoundingInfo().boundingSphere.radiusWorld,u=this._engine.getAspectRatio(this.camera),f=this.camera.fov/2;u<1&&(f=Math.atan(u*Math.tan(this.camera.fov/2)));var d=Math.abs(c/Math.sin(f));this.camera.radius=d,s.dispose(),this.camera.alpha=0,this.camera.beta=1,this.ymax=t[1]},d.prototype.addImgStack=function(e,t,i,r){var n={size:1,colorScale:null,showLegend:!0,fontSize:11,fontColor:"black",legendTitle:null,legendTitleFontSize:16,showAxes:[!1,!1,!1],axisLabels:["X","Y","Z"],axisColors:["#666666","#666666","#666666"],tickBreaks:[2,2,2],showTickLines:[[!1,!1],[!1,!1],[!1,!1]],tickLineColors:[["#aaaaaa","#aaaaaa"],["#aaaaaa","#aaaaaa"],["#aaaaaa","#aaaaaa"]],intensityMode:"alpha"};Object.assign(n,r);var o={showLegend:!(this._downloadObj={values:e,indices:t,attributes:i,size:n.size,colorScale:n.colorScale,showLegend:n.showLegend,fontSize:n.fontSize,fontColor:n.fontColor,legendTitle:n.legendTitle,legendTitleFontSize:n.legendTitleFontSize,showAxes:n.showAxes,axisLabels:n.axisLabels,axisColors:n.axisColors,tickBreaks:n.tickBreaks,showTickLines:n.showTickLines,tickLineColors:n.tickLineColors,turntable:this.turntable,rotationRate:this.rotationRate,labels:[],backgroundColor:this._backgroundColor,intensityMode:n.intensityMode}),discrete:!1,breaks:[],colorScale:"",inverted:!1};o.fontSize=n.fontSize,o.fontColor=n.fontColor,o.legendTitle=n.legendTitle,o.legendTitleFontSize=n.legendTitleFontSize;var s=new u.ImgStack(this.scene,e,t,i,o,n.size,this._backgroundColor,n.intensityMode);return this.plots.push(s),this._updateLegend(),this._cameraFitPlot([0,i.dim[2]],[0,i.dim[0]],[0,i.dim[1]]),this.camera.wheelPrecision=1,this},d.prototype.addPlot=function(e,t,i,r,n){void 0===n&&(n={});var o={size:1,colorScale:"Oranges",customColorScale:[],colorScaleInverted:!1,sortedCategories:[],showLegend:!0,fontSize:11,fontColor:"black",legendTitle:null,legendTitleFontSize:16,showAxes:[!1,!1,!1],axisLabels:["X","Y","Z"],axisColors:["#666666","#666666","#666666"],tickBreaks:[2,2,2],showTickLines:[[!1,!1],[!1,!1],[!1,!1]],tickLineColors:[["#aaaaaa","#aaaaaa"],["#aaaaaa","#aaaaaa"],["#aaaaaa","#aaaaaa"]],folded:!1,foldedEmbedding:null,foldAnimDelay:null,foldAnimDuration:null,colnames:null,rownames:null};Object.assign(o,n),console.log(o),this._downloadObj={coordinates:e,plotType:t,colorBy:i,colorVar:r,size:o.size,colorScale:o.colorScale,customColorScale:o.customColorScale,colorScaleInverted:o.colorScaleInverted,sortedCategories:o.sortedCategories,showLegend:o.showLegend,fontSize:o.fontSize,fontColor:o.fontColor,legendTitle:o.legendTitle,legendTitleFontSize:o.legendTitleFontSize,showAxes:o.showAxes,axisLabels:o.axisLabels,axisColors:o.axisColors,tickBreaks:o.tickBreaks,showTickLines:o.showTickLines,tickLineColors:o.tickLineColors,folded:o.folded,foldedEmbedding:o.foldedEmbedding,foldAnimDelay:o.foldAnimDelay,foldAnimDuration:o.foldAnimDuration,turntable:this.turntable,rotationRate:this.rotationRate,colnames:o.colnames,rownames:o.rownames,labels:[],backgroundColor:this._backgroundColor};var s,a,h,l,c,u,f=[];if(this._hasAnim=o.folded,o.folded){var d=document.createElement("div");d.className="button",d.innerHTML=O.buttonSVGs.replay,d.onclick=this._resetAnimation.bind(this),this._buttonBar.appendChild(d)}switch(i){case"categories":var p=r,_=R(p);_.sort(),o.sortedCategories&&_.length===o.sortedCategories.length&&JSON.stringify(_)===JSON.stringify(o.sortedCategories.slice(0).sort())&&(_=o.sortedCategories);var g=_.length,m=P.default.scale(P.default.brewer.Paired).mode("lch").colors(g);"custom"===o.colorScale?void 0!==o.customColorScale&&0!==o.customColorScale.length?m=o.colorScaleInverted?P.default.scale(o.customColorScale).domain([1,0]).mode("lch").colors(g):P.default.scale(o.customColorScale).mode("lch").colors(g):o.colorScale="Paired":o.colorScale&&P.default.brewer.hasOwnProperty(o.colorScale)?m=o.colorScaleInverted?P.default.scale(P.default.brewer[o.colorScale]).domain([1,0]).mode("lch").colors(g):P.default.scale(P.default.brewer[o.colorScale]).mode("lch").colors(g):o.colorScale="Paired";for(var v=0;v<g;v++)m[v]+="ff";for(v=0;v<r.length;v++){var b=_.indexOf(p[v]);f.push(m[b])}s={showLegend:o.showLegend,discrete:!0,breaks:_,colorScale:o.colorScale,customColorScale:o.customColorScale,inverted:!1};break;case"values":var y=r.min(),x=r.max(),T=P.default.scale(P.default.brewer.Oranges).mode("lch");"custom"===o.colorScale?void 0!==o.customColorScale&&0!==o.customColorScale.length?T=o.colorScaleInverted?P.default.scale(o.customColorScale).domain([1,0]).mode("lch"):P.default.scale(o.customColorScale).mode("lch"):o.colorScale="Oranges":o.colorScale&&P.default.brewer.hasOwnProperty(o.colorScale)?T=o.colorScaleInverted?P.default.scale(P.default.brewer[o.colorScale]).domain([1,0]).mode("lch"):P.default.scale(P.default.brewer[o.colorScale]).mode("lch"):o.colorScale="Oranges",f=r.slice().map(function(e){return(e-y)/(x-y)}).map(function(e){return T(e).alpha(1).hex("rgba")}),s={showLegend:o.showLegend,discrete:!1,breaks:[y.toString(),x.toString()],colorScale:o.colorScale,customColorScale:o.customColorScale,inverted:o.colorScaleInverted};break;case"direct":for(v=0;v<r.length;v++){var M=r[v];7==(M=P.default(M).hex()).length&&(M+="ff"),f.push(M)}s={showLegend:!1,discrete:!1,breaks:[],colorScale:"",customColorScale:o.customColorScale,inverted:!1}}switch(s.fontSize=o.fontSize,s.fontColor=o.fontColor,s.legendTitle=o.legendTitle,s.legendTitleFontSize=o.legendTitleFontSize,t){case"pointCloud":var E=(c=new I.PointCloud(this.scene,e,f,o.size,s,o.folded,o.foldedEmbedding,o.foldAnimDelay,o.foldAnimDuration)).mesh.getBoundingInfo().boundingBox;a=[E.minimumWorld.x,E.maximumWorld.x],h=[E.minimumWorld.y,E.maximumWorld.y],l=[E.minimumWorld.z,E.maximumWorld.z],u=[1,1,1];break;case"surface":c=new w.Surface(this.scene,e,f,o.size,s),a=[0,e.length],l=[0,e[0].length],h=[0,o.size],u=[1,S(e)/o.size,1];break;case"heatMap":c=new D.HeatMap(this.scene,e,f,o.size,s),a=[0,e.length],l=[0,e[0].length],h=[0,o.size],u=[1,S(e)/o.size,1]}this.plots.push(c),this._updateLegend();var A={showAxes:o.showAxes,static:!0,axisLabels:o.axisLabels,range:[a,h,l],color:o.axisColors,scale:u,tickBreaks:o.tickBreaks,showTickLines:o.showTickLines,tickLineColor:o.tickLineColors,showPlanes:[!1,!1,!1],planeColor:["#cccccc88","#cccccc88","#cccccc88"],plotType:t,colnames:o.colnames,rownames:o.rownames};return this._axes=new C.Axes(A,this.scene,"heatMap"==t),this._cameraFitPlot(a,h,l),this},d.prototype._updateLegend=function(){this._legend&&this._legend.dispose();var e,t=this.plots[0].legendData;if(t.showLegend){var i=b.AdvancedDynamicTexture.CreateFullscreenUI("UI"),r=new y.Grid;i.addControl(r);var n=.2;if(t.discrete&&(40<(e=t.breaks.length)?n=.4:20<e&&(n=.3)),r.addColumnDefinition(1-n),r.addColumnDefinition(n),t.legendTitle&&""!==t.legendTitle?(r.addRowDefinition(.1),r.addRowDefinition(.85)):(r.addRowDefinition(.05),r.addRowDefinition(.9)),r.addRowDefinition(.05),t.legendTitle){var o=new y.TextBlock;o.text=t.legendTitle,o.color=t.fontColor,o.fontWeight="bold",t.legendTitleFontSize?o.fontSize=t.legendTitleFontSize+"px":o.fontSize="20px",o.verticalAlignment=y.Control.VERTICAL_ALIGNMENT_BOTTOM,o.horizontalAlignment=y.Control.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(o,0,1)}if(t.discrete){var s=new y.Grid;for(40<e?(s.addColumnDefinition(.1),s.addColumnDefinition(.4),s.addColumnDefinition(.1),s.addColumnDefinition(.4),s.addColumnDefinition(.1),s.addColumnDefinition(.4)):20<e?(s.addColumnDefinition(.1),s.addColumnDefinition(.4),s.addColumnDefinition(.1),s.addColumnDefinition(.4)):(s.addColumnDefinition(.2),s.addColumnDefinition(.8)),p=0;p<e&&p<20;p++)20<e?s.addRowDefinition(.05):s.addRowDefinition(1/e);for(r.addControl(s,1,1),f=void 0,f="custom"===t.colorScale?P.default.scale(t.customColorScale).mode("lch").colors(e):P.default.scale(P.default.brewer[t.colorScale]).mode("lch").colors(e),p=0;p<e;p++){var a=new y.Rectangle;a.background=f[p],a.thickness=0,a.width=t.fontSize+"px",a.height=t.fontSize+"px",39<p?s.addControl(a,p-40,4):19<p?s.addControl(a,p-20,2):s.addControl(a,p,0);var h=new y.TextBlock;h.text=t.breaks[p].toString(),h.color=t.fontColor,h.fontSize=t.fontSize+"px",h.textHorizontalAlignment=y.Control.HORIZONTAL_ALIGNMENT_LEFT,39<p&&s.addControl(h,p-40,5),19<p?s.addControl(h,p-20,3):s.addControl(h,p,1)}}else{var l=new y.Grid;l.addColumnDefinition(.2),l.addColumnDefinition(.8),l.addRowDefinition(1),r.addControl(l,1,1);var c=265,u=.05;this.canvas.height<70?(c=10,u=.45):this.canvas.height<130?(c=50,u=.3):this.canvas.height<350&&(c=100,u=.15);var f=void 0;f="custom"===t.colorScale?P.default.scale(t.customColorScale).mode("lch").colors(c):P.default.scale(P.default.brewer[t.colorScale]).mode("lch").colors(c);for(var d=new y.Grid,p=0;p<c;p++){d.addRowDefinition(1/c);var _=new y.Rectangle;t.inverted?_.background=f[p]:_.background=f[f.length-p-1],_.thickness=0,_.width=.5,_.height=1,d.addControl(_,p,0)}l.addControl(d,0,0);var g=new y.Grid;g.addColumnDefinition(1),g.addRowDefinition(u),g.addRowDefinition(1-2*u),g.addRowDefinition(u),l.addControl(g,0,1);var m=new y.TextBlock;m.text=parseFloat(t.breaks[0]).toFixed(4).toString(),m.color=t.fontColor,m.fontSize=t.fontSize+"px",m.textHorizontalAlignment=y.Control.HORIZONTAL_ALIGNMENT_LEFT,g.addControl(m,2,0);var v=new y.TextBlock;v.text=parseFloat(t.breaks[1]).toFixed(4).toString(),v.color=t.fontColor,v.fontSize=t.fontSize+"px",v.textHorizontalAlignment=y.Control.HORIZONTAL_ALIGNMENT_LEFT,g.addControl(v,0,0)}this._legend=i}},d.prototype.doRender=function(){var e=this;return this._engine.runRenderLoop(function(){e.scene.render()}),this},d.prototype.resize=function(e,t){if(void 0!==e&&void 0!==t)if(this.R){var i=parseInt(document.body.style.padding.substring(0,document.body.style.padding.length-2));this.canvas.width=e-2*i,this.canvas.height=t-2*i}else this.canvas.width=e,this.canvas.height=t;return this._updateLegend(),this._engine.resize(),this},d.prototype.thumbnail=function(e,t){r.ScreenshotTools.CreateScreenshot(this._engine,this.camera,e,t)},d.prototype.dispose=function(){this.scene.dispose(),this._engine.dispose()},d);function d(e,t){void 0===t&&(t="#ffffffff"),this._showLegend=!0,this._hasAnim=!1,this._downloadObj={},this.plots=[],this.turntable=!1,this.rotationRate=.01,this.fixedSize=!1,this.ymax=0,this.R=!1,this._backgroundColor=t,this.canvas=document.getElementById(e),this._engine=new o.Engine(this.canvas,!0,{preserveDrawingBuffer:!0,stencil:!0}),this.scene=new n.Scene(this._engine),this.camera=new s.ArcRotateCamera("Camera",0,0,10,p.Vector3.Zero(),this.scene),this.camera.attachControl(this.canvas,!0),this.scene.activeCamera=this.camera,this.camera.inputs.attached.keyboard.detachControl(this.canvas),this.camera.wheelPrecision=50,this.scene.clearColor=p.Color4.FromHexString(t),this._hl1=new a.HemisphericLight("HemiLight",new p.Vector3(0,1,0),this.scene),this._hl1.diffuse=new p.Color3(1,1,1),this._hl1.specular=new p.Color3(0,0,0),this._hl2=new a.HemisphericLight("HemiLight",new p.Vector3(0,-1,0),this.scene),this._hl2.diffuse=new p.Color3(.8,.8,.8),this._hl2.specular=new p.Color3(0,0,0),this._labelManager=new h.LabelManager(this.canvas,this.scene,this.ymax,this.camera),this.scene.registerBeforeRender(this._prepRender.bind(this)),this.scene.registerAfterRender(this._afterRender.bind(this));var i=document.createElement("style");i.appendChild(document.createTextNode(O.styleText)),document.getElementsByTagName("head")[0].appendChild(i);var r=document.createElement("div");r.className="bbp button-bar",r.style.top=this.canvas.clientTop+5+"px",r.style.left=this.canvas.clientLeft+5+"px",this.canvas.parentNode.appendChild(r),this._buttonBar=r}O.Plots=f},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=i(25),n=(o.SetImmediate=function(e){r.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},o);function o(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var r=i(30),n=i(0),o=(s.prototype.reConstruct=function(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var r=n.e.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*r,this._update(i||n.a.IdentityReadOnly)},s.prototype.scale=function(e){var t=this.radius*e,i=s.TmpVector3,r=i[0].setAll(t),n=this.center.subtractToRef(r,i[1]),o=this.center.addToRef(r,i[2]);return this.reConstruct(n,o,this._worldMatrix),this},s.prototype.getWorldMatrix=function(){return this._worldMatrix},s.prototype._update=function(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{n.e.TransformCoordinatesToRef(this.center,e,this.centerWorld);var t=s.TmpVector3[0];n.e.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}},s.prototype.isInFrustum=function(e){for(var t=this.centerWorld,i=this.radiusWorld,r=0;r<6;r++)if(e[r].dotCoordinate(t)<=-i)return!1;return!0},s.prototype.isCenterInFrustum=function(e){for(var t=this.centerWorld,i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0},s.prototype.intersectsPoint=function(e){var t=n.e.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)},s.Intersects=function(e,t){var i=n.e.DistanceSquared(e.centerWorld,t.centerWorld),r=e.radiusWorld+t.radiusWorld;return!(r*r<i)},s.TmpVector3=r.a.BuildArray(3,n.e.Zero),s);function s(e,t,i){this.center=n.e.Zero(),this.centerWorld=n.e.Zero(),this.minimum=n.e.Zero(),this.maximum=n.e.Zero(),this.reConstruct(e,t,i)}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var u=i(27),r=i(2),n=(o.prototype._prepareBuffers=function(){if(!this._vertexBuffers[r.b.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[r.b.PositionKind]=new r.b(this._scene.getEngine(),e,r.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},o.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},o.prototype._rebuild=function(){var e=this._vertexBuffers[r.b.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},o.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i=this._scene.activeCamera;return!(!i||!(t=t||i._postProcesses.filter(function(e){return null!=e}))||0===t.length||!this._scene.postProcessesEnabled||(t[0].activate(i,e,null!=t),0))},o.prototype.directRender=function(e,t,i,r,n){void 0===t&&(t=null),void 0===i&&(i=!1),void 0===r&&(r=0),void 0===n&&(n=0);for(var o=this._scene.getEngine(),s=0;s<e.length;s++){s<e.length-1?e[s+1].activate(this._scene.activeCamera,t):t?o.bindFramebuffer(t,r,void 0,void 0,i,n):o.restoreDefaultFramebuffer();var a=e[s],h=a.apply();h&&(a.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,h),o.drawElementsType(u.a.TriangleFillMode,0,6),a.onAfterRenderObservable.notifyObservers(h))}o.setDepthBuffer(!0),o.setDepthWrite(!0)},o.prototype._finalizeFrame=function(e,t,i,r,n){void 0===n&&(n=!1);var o=this._scene.activeCamera;if(o&&0!==(r=r||o._postProcesses.filter(function(e){return null!=e})).length&&this._scene.postProcessesEnabled){for(var s=this._scene.getEngine(),a=0,h=r.length;a<h;a++){var l=r[a];if(a<h-1?l._outputTexture=r[a+1].activate(o,t):t?(s.bindFramebuffer(t,i,void 0,void 0,n),l._outputTexture=t):(s.restoreDefaultFramebuffer(),l._outputTexture=null),e)break;var c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),s.bindBuffers(this._vertexBuffers,this._indexBuffer,c),s.drawElementsType(u.a.TriangleFillMode,0,6),l.onAfterRenderObservable.notifyObservers(c))}s.setDepthBuffer(!0),s.setDepthWrite(!0),s.setAlphaMode(0)}},o.prototype.dispose=function(){var e=this._vertexBuffers[r.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[r.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},o);function o(e){this._vertexBuffers={},this._scene=e}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=function(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}},function(e,t,i){"use strict";i.d(t,"a",function(){return R});var o=i(40),h=(r.prototype.isValid=function(e){return!0},r.prototype.process=function(t,i){var r="";if(this.line){var e=this.line,n=i.processor;n&&(n.lineProcessor&&(e=n.lineProcessor(e,i.isFragment)),n.attributeProcessor&&o.a.StartsWith(this.line,"attribute")?e=n.attributeProcessor(this.line):n.varyingProcessor&&o.a.StartsWith(this.line,"varying")?e=n.varyingProcessor(this.line,i.isFragment):(n.uniformProcessor||n.uniformBufferProcessor)&&o.a.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?n.uniformProcessor&&(e=n.uniformProcessor(this.line,i.isFragment)):n.uniformBufferProcessor&&(e=n.uniformBufferProcessor(this.line,i.isFragment),i.lookForClosingBracketForUniformBuffer=!0)),n.endOfUniformBufferProcessor&&i.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(i.lookForClosingBracketForUniformBuffer=!1,e=n.endOfUniformBufferProcessor(this.line,i.isFragment))),r+=e+"\r\n"}return this.children.forEach(function(e){r+=e.process(t,i)}),this.additionalDefineKey&&(t[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},r);function r(){this.children=[]}var s=(Object.defineProperty(n.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,i=e;t<i.length;t++){var r=i[t];if("#"!==r[0])for(var n=r.split(";"),o=0;o<n.length;o++){var s=n[o];(s=s.trim())&&this._lines.push(s+(o!==n.length-1?";":""))}else this._lines.push(r)}},enumerable:!0,configurable:!0}),n);function n(){}var a,l=i(1),c=(a=h,Object(l.c)(u,a),u.prototype.process=function(e,t){for(var i=0;i<this.children.length;i++){var r=this.children[i];if(r.isValid(e))return r.process(e,t)}return""},u);function u(){return null!==a&&a.apply(this,arguments)||this}var f,d=(f=h,Object(l.c)(p,f),p.prototype.isValid=function(e){return this.testExpression.isTrue(e)},p);function p(){return null!==f&&f.apply(this,arguments)||this}var _=(g.prototype.isTrue=function(e){return!0},g);function g(){}var m,v=(m=_,Object(l.c)(b,m),b.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},b);function b(e,t){void 0===t&&(t=!1);var i=m.call(this)||this;return i.define=e,i.not=t,i}var y,x=(y=_,Object(l.c)(T,y),T.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},T);function T(){return null!==y&&y.apply(this,arguments)||this}var M,E=(M=_,Object(l.c)(A,M),A.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},A);function A(){return null!==M&&M.apply(this,arguments)||this}var O,P=(O=_,Object(l.c)(C,O),C.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var i=!1,r=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":i=n<r;break;case"<":i=r<n;break;case"<=":i=r<=n;break;case">=":i=n<=r;break;case"==":i=r===n}return i},C);function C(e,t,i){var r=O.call(this)||this;return r.define=e,r.operand=t,r.testValue=i,r}var S=i(8),R=(I.Process=function(e,i,r){var n=this;this._ProcessIncludes(e,i,function(e){var t=n._ProcessShaderConversion(e,i);r(t)})},I._ProcessPrecision=function(e,t){var i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e},I._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new v(t[1].trim(),"!"===e[0]);for(var i="",r=0,n=0,o=["==",">=","<=","<",">"];n<o.length&&(i=o[n],!(-1<(r=e.indexOf(i))));n++);if(-1===r)return new v(e);var s=e.substring(0,r).trim(),a=e.substring(r+i.length).trim();return new P(s,i,a)},I._BuildSubExpression=function(e){var t=e.indexOf("||");if(-1===t){var i=e.indexOf("&&");if(-1<i){var r=new E,n=e.substring(0,i).trim(),o=e.substring(i+2).trim();return r.leftOperand=this._BuildSubExpression(n),r.rightOperand=this._BuildSubExpression(o),r}return this._ExtractOperation(e)}var s=new x;return n=e.substring(0,t).trim(),o=e.substring(t+2).trim(),s.leftOperand=this._BuildSubExpression(n),s.rightOperand=this._BuildSubExpression(o),s},I._BuildExpression=function(e,t){var i=new d,r=e.substring(0,t),n=e.substring(t).trim();return i.testExpression="#ifdef"===r?new v(n):"#ifndef"===r?new v(n,!0):this._BuildSubExpression(n),i},I._MoveCursorWithinIf=function(e,t,i){for(var r=e.currentLine;this._MoveCursor(e,i);){var n=(r=e.currentLine).substring(0,5).toLowerCase();if("#else"===n){var o=new h;return t.children.push(o),void this._MoveCursor(e,o)}if("#elif"===n){var s=this._BuildExpression(r,5);t.children.push(s),i=s}}},I._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var i=e.currentLine,r=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(i);if(r&&r.length)switch(r[0]){case"#ifdef":var n=new c;t.children.push(n);var o=this._BuildExpression(i,6);n.children.push(o),this._MoveCursorWithinIf(e,n,o);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":n=new c,t.children.push(n),o=this._BuildExpression(i,7),n.children.push(o),this._MoveCursorWithinIf(e,n,o);break;case"#if":n=new c,o=this._BuildExpression(i,3),t.children.push(n),n.children.push(o),this._MoveCursorWithinIf(e,n,o)}else{var s=new h;if(s.line=i,t.children.push(s),"#"===i[0]&&"d"===i[1]){var a=i.replace(";","").split(" ");s.additionalDefineKey=a[1],3===a.length&&(s.additionalDefineValue=a[2])}}}return!1},I._EvaluatePreProcessors=function(e,t,i){var r=new h,n=new s;return n.lineIndex=-1,n.lines=e.split("\n"),this._MoveCursor(n,r),r.process(t,i)},I._PreparePreProcessors=function(e){for(var t={},i=0,r=e.defines;i<r.length;i++){var n=r[i].replace("#define","").replace(";","").trim().split(" ");t[n[0]]=1<n.length?n[1]:""}return t.GL_ES="true",t.__VERSION__=e.version,t[e.platformName]="true",t},I._ProcessShaderConversion=function(e,t){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var r=t.defines,n=this._PreparePreProcessors(t);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,r,t.isFragment)),i=this._EvaluatePreProcessors(i,n,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,r,t.isFragment)),i},I._ProcessIncludes=function(e,t,i){for(var r=this,n=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=n.exec(e),s=new String(e);null!=o;){var a=o[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(/__decl__/,""),t.supportsUniformBuffers&&(a=(a=a.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),a+="Declaration"),!t.includesShadersStore[a]){var h=t.shadersRepository+"ShadersInclude/"+a+".fx";return void I._FileToolsLoadFile(h,function(e){t.includesShadersStore[a]=e,r._ProcessIncludes(s,t,i)})}var l=t.includesShadersStore[a];if(o[2])for(var c=o[3].split(","),u=0;u<c.length;u+=2){var f=new RegExp(c[u],"g"),d=c[u+1];l=l.replace(f,d)}if(o[4]){var p=o[5];if(-1!==p.indexOf("..")){var _=p.split(".."),g=parseInt(_[0]),m=parseInt(_[1]),v=l.slice(0);l="",isNaN(m)&&(m=t.indexParameters[_[1]]);for(var b=g;b<m;b++)t.supportsUniformBuffers||(v=v.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),l+=v.replace(/\{X\}/g,b.toString())+"\n"}else t.supportsUniformBuffers||(l=l.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),l=l.replace(/\{X\}/g,p)}s=s.replace(o[0],l),o=n.exec(e)}i(s)},I._FileToolsLoadFile=function(e,t,i,r,n,o){throw S.a.WarnImport("FileTools")},I);function I(){}},function(e,t,i){"use strict";i.d(t,"e",function(){return p}),i.d(t,"c",function(){return n}),i.d(t,"a",function(){return c}),i.d(t,"b",function(){return g}),i.d(t,"f",function(){return l}),i.d(t,"g",function(){return f}),i.d(t,"d",function(){return m});var p,r,o=i(16),_=i(0),s=i(15);(r=p=p||{})[r.CW=0]="CW",r[r.CCW=1]="CCW";var n=(a.Interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,l=0;l<5;l++){var c=h*h;h-=1/(3*o*c+2*s*h+a)*(c*h*o+s*c+a*h-e),h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},a);function a(){}var c=(h.prototype.degrees=function(){return 180*this._radians/Math.PI},h.prototype.radians=function(){return this._radians},h.BetweenTwoPoints=function(e,t){var i=t.subtract(e);return new h(Math.atan2(i.y,i.x))},h.FromRadians=function(e){return new h(e)},h.FromDegrees=function(e){return new h(e*Math.PI/180)},h);function h(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}var g=function(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var r=Math.pow(t.x,2)+Math.pow(t.y,2),n=(Math.pow(e.x,2)+Math.pow(e.y,2)-r)/2,o=(r-Math.pow(i.x,2)-Math.pow(i.y,2))/2,s=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new _.d((n*(t.y-i.y)-o*(e.y-t.y))/s,((e.x-t.x)*o-(t.x-i.x)*n)/s),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var a=this.startAngle.degrees(),h=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();180<h-a&&(h-=360),h-a<-180&&(h+=360),180<l-h&&(l-=360),l-h<-180&&(l+=360),this.orientation=h-a<0?p.CW:p.CCW,this.angle=c.FromDegrees(this.orientation===p.CW?a-l:l-a)},l=(u.prototype.addLineTo=function(e,t){if(this.closed)return this;var i=new _.d(e,t),r=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(r).length(),this},u.prototype.addArcTo=function(e,t,i,r,n){if(void 0===n&&(n=36),this.closed)return this;var o=this._points[this._points.length-1],s=new _.d(e,t),a=new _.d(i,r),h=new g(o,s,a),l=h.angle.radians()/n;h.orientation===p.CW&&(l*=-1);for(var c=h.startAngle.radians()+l,u=0;u<n;u++){var f=Math.cos(c)*h.radius+h.centerPoint.x,d=Math.sin(c)*h.radius+h.centerPoint.y;this.addLineTo(f,d),c+=l}return this},u.prototype.close=function(){return this.closed=!0,this},u.prototype.length=function(){var e=this._length;if(this.closed){var t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e},u.prototype.getPoints=function(){return this._points},u.prototype.getPointAtLengthPosition=function(e){if(e<0||1<e)return _.d.Zero();for(var t=e*this.length(),i=0,r=0;r<this._points.length;r++){var n=(r+1)%this._points.length,o=this._points[r],s=this._points[n].subtract(o),a=s.length()+i;if(i<=t&&t<=a){var h=s.normalize(),l=t-i;return new _.d(o.x+h.x*l,o.y+h.y*l)}i=a}return _.d.Zero()},u.StartingAt=function(e,t){return new u(e,t)},u);function u(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new _.d(e,t))}var f=(d.prototype.getCurve=function(){return this._curve},d.prototype.getPoints=function(){return this._curve},d.prototype.length=function(){return this._distances[this._distances.length-1]},d.prototype.getTangents=function(){return this._tangents},d.prototype.getNormals=function(){return this._normals},d.prototype.getBinormals=function(){return this._binormals},d.prototype.getDistances=function(){return this._distances},d.prototype.getPointAt=function(e){return this._updatePointAtData(e).point},d.prototype.getTangentAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?_.e.TransformCoordinates(_.e.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},d.prototype.getNormalAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?_.e.TransformCoordinates(_.e.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},d.prototype.getBinormalAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?_.e.TransformCoordinates(_.e.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},d.prototype.getDistanceAt=function(e){return this.length()*e},d.prototype.getPreviousPointIndexAt=function(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex},d.prototype.getSubPositionAt=function(e){return this._updatePointAtData(e),this._pointAtData.subPosition},d.prototype.getClosestPositionTo=function(e){for(var t=Number.MAX_VALUE,i=0,r=0;r<this._curve.length-1;r++){var n=this._curve[r+0],o=this._curve[r+1].subtract(n).normalize(),s=this._distances[r+1]-this._distances[r+0],a=Math.min(Math.max(_.e.Dot(o,e.subtract(n).normalize()),0)*_.e.Distance(n,e)/s,1),h=_.e.Distance(n.add(o.scale(a*s)),e);h<t&&(t=h,i=(this._distances[r+0]+s*a)/this.length())}return i},d.prototype.slice=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=1),e<0&&(e=1- -1*e%1),t<0&&(t=1- -1*t%1),t<e){var i=e;e=t,t=i}var r=this.getCurve(),n=this.getPointAt(e),o=this.getPreviousPointIndexAt(e),s=this.getPointAt(t),a=this.getPreviousPointIndexAt(t)+1,h=[];return 0!==e&&(o++,h.push(n)),h.push.apply(h,r.slice(o,a)),1===t&&1!==e||h.push(s),new d(h,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)},d.prototype.update=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1);for(var r=0;r<e.length;r++)this._curve[r].x=e[r].x,this._curve[r].y=e[r].y,this._curve[r].z=e[r].z;return this._compute(t,i),this},d.prototype._compute=function(e,t){void 0===t&&(t=!1);var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var r,n,o,s,a,h=this._tangents[0],l=this._normalVector(h,e);this._normals[0]=l,this._raw||this._normals[0].normalize(),this._binormals[0]=_.e.Cross(h,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var c=1;c<i;c++)r=this._getLastNonNullVector(c),c<i-1&&(n=this._getFirstNonNullVector(c),this._tangents[c]=t?n:r.add(n),this._tangents[c].normalize()),this._distances[c]=this._distances[c-1]+r.length(),o=this._tangents[c],a=this._binormals[c-1],this._normals[c]=_.e.Cross(a,o),this._raw||(0===this._normals[c].length()?(s=this._normals[c-1],this._normals[c]=s.clone()):this._normals[c].normalize()),this._binormals[c]=_.e.Cross(o,this._normals[c]),this._raw||this._binormals[c].normalize();this._pointAtData.id=NaN},d.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},d.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0===i.length()&&t+1<e;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},d.prototype._normalVector=function(e,t){var i,r,n=e.length();return 0===n&&(n=1),null==t?(r=o.a.WithinEpsilon(Math.abs(e.y)/n,1,s.a)?o.a.WithinEpsilon(Math.abs(e.x)/n,1,s.a)?o.a.WithinEpsilon(Math.abs(e.z)/n,1,s.a)?_.e.Zero():new _.e(0,0,1):new _.e(1,0,0):new _.e(0,-1,0),i=_.e.Cross(e,r)):(i=_.e.Cross(e,t),_.e.CrossToRef(i,e,i)),i.normalize(),i},d.prototype._updatePointAtData=function(e,t){if(void 0===t&&(t=!1),this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;var i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(1<=e)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);for(var r,n=i[0],o=0,s=e*this.length(),a=1;a<i.length;a++){r=i[a];var h=_.e.Distance(n,r);if((o+=h)===s)return this._setPointAtData(e,1,r,a,t);if(s<o){var l=(o-s)/h,c=n.subtract(r),u=r.add(c.scaleInPlace(l));return this._setPointAtData(e,1-l,u,a-1,t)}n=r}return this._pointAtData},d.prototype._setPointAtData=function(e,t,i,r,n){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=r,(this._pointAtData.interpolateReady=n)&&this._updateInterpolationMatrix(),this._pointAtData},d.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=_.a.Identity();var e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){var t=e+1,i=this._tangents[e].clone(),r=this._normals[e].clone(),n=this._binormals[e].clone(),o=this._tangents[t].clone(),s=this._normals[t].clone(),a=this._binormals[t].clone(),h=_.b.RotationQuaternionFromAxis(r,n,i),l=_.b.RotationQuaternionFromAxis(s,a,o);_.b.Slerp(h,l,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},d);function d(e,t,i,r){void 0===t&&(t=null),void 0===r&&(r=!1),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:_.e.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:_.a.Identity()};for(var n=0;n<e.length;n++)this._curve[n]=e[n].clone();this._raw=i||!1,this._alignTangentsWithPath=r,this._compute(t,r)}var m=(v.CreateQuadraticBezier=function(e,t,i,r){r=2<r?r:3;for(var n=new Array,o=function(e,t,i,r){return(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r},s=0;s<=r;s++)n.push(new _.e(o(s/r,e.x,t.x,i.x),o(s/r,e.y,t.y,i.y),o(s/r,e.z,t.z,i.z)));return new v(n)},v.CreateCubicBezier=function(e,t,i,r,n){n=3<n?n:4;for(var o=new Array,s=function(e,t,i,r,n){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n},a=0;a<=n;a++)o.push(new _.e(s(a/n,e.x,t.x,i.x,r.x),s(a/n,e.y,t.y,i.y,r.y),s(a/n,e.z,t.z,i.z,r.z)));return new v(o)},v.CreateHermiteSpline=function(e,t,i,r,n){for(var o=new Array,s=1/n,a=0;a<=n;a++)o.push(_.e.Hermite(e,t,i,r,a*s));return new v(o)},v.CreateCatmullRomSpline=function(e,t,i){var r=new Array,n=1/t,o=0;if(i){for(var s=e.length,a=0;a<s;a++)for(var h=o=0;h<t;h++)r.push(_.e.CatmullRom(e[a%s],e[(a+1)%s],e[(a+2)%s],e[(a+3)%s],o)),o+=n;r.push(r[0])}else{var l=new Array;for(l.push(e[0].clone()),Array.prototype.push.apply(l,e),l.push(e[e.length-1].clone()),a=0;a<l.length-3;a++)for(h=o=0;h<t;h++)r.push(_.e.CatmullRom(l[a],l[a+1],l[a+2],l[a+3],o)),o+=n;a--,r.push(_.e.CatmullRom(l[a],l[a+1],l[a+2],l[a+3],o))}return new v(r)},v.prototype.getPoints=function(){return this._points},v.prototype.length=function(){return this._length},v.prototype.continue=function(e){for(var t=this._points[this._points.length-1],i=this._points.slice(),r=e.getPoints(),n=1;n<r.length;n++)i.push(r[n].subtract(r[0]).add(t));return new v(i)},v.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},v);function v(e){this._length=0,this._points=e,this._length=this._computeLength(e)}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=function(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},n);function n(){}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(Object.defineProperty(n.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),n.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},n.prototype.markAsUnprocessed=function(){this._isDirty=!0},n.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},n.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},n.prototype.markAsLightDirty=function(e){void 0===e&&(e=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0},n.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},n.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},n.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},n.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},n.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var i=t[e];"_"!==i[0]&&this._keys.push(i)}},n.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this[i]!==e[i])return!1}return!0},n.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[t];e[i]=this[i]}},n.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e];switch(typeof this[t]){case"number":this[t]=0;break;case"string":this[t]="";break;default:this[t]=!1}}},n.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[t],r=this[i];switch(typeof r){case"number":case"string":e+="#define "+i+" "+r+"\n";break;default:r&&(e+="#define "+i+"\n")}}return e},n);function n(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r=(n.prototype.unBindMesh=function(){this._mesh=null},n.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},n.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(n.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),n.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&0<this._mesh.numBoneInfluencers){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var i=this._mesh.getScene(),r=0;r<i.meshes.length;r++){var n=i.meshes[r];if(n.material){if(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers)if(n.material.getEffect()===t)n.computeBonesUsingShaders=!1;else if(n.subMeshes)for(var o=0,s=n.subMeshes;o<s.length;o++)if(s[o].effect===t){n.computeBonesUsingShaders=!1;break}}else!this._mesh.material&&n.computeBonesUsingShaders&&0<n.numBoneInfluencers&&(n.computeBonesUsingShaders=!1)}}else{var a=this._defines[this._currentRank];if(a)for(r=0;r<a.length;r++)e=e.replace("#define "+a[r],"");this._currentRank++}return e},n);function n(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var o=i(28),c=i(0),r=(Object.defineProperty(u.prototype,"opaqueSortCompareFn",{set:function(e){this._opaqueSortCompareFn=e,this._renderOpaque=e?this.renderOpaqueSorted:u.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"alphaTestSortCompareFn",{set:function(e){this._alphaTestSortCompareFn=e,this._renderAlphaTest=e?this.renderAlphaTestSorted:u.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"transparentSortCompareFn",{set:function(e){this._transparentSortCompareFn=e||u.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),u.prototype.render=function(e,t,i,r){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var n=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(n.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),n.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var o=n.getStencilBuffer();if(n.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),n.setAlphaMode(0)),n.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();n.setAlphaMode(0)}n.setStencilBuffer(o)}},u.prototype.renderOpaqueSorted=function(e){return u.renderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},u.prototype.renderAlphaTestSorted=function(e){return u.renderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},u.prototype.renderTransparentSorted=function(e){return u.renderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},u.renderSorted=function(e,t,i,r){for(var n,o=0,s=i?i.globalPosition:u._zeroVector;o<e.length;o++)(n=e.data[o])._alphaIndex=n.getMesh().alphaIndex,n._distanceToCamera=c.e.Distance(n.getBoundingInfo().boundingSphere.centerWorld,s);var a=e.data.slice(0,e.length);for(t&&a.sort(t),o=0;o<a.length;o++){if(n=a[o],r){var h=n.getMaterial();if(h&&h.needDepthPrePass){var l=h.getScene().getEngine();l.setColorWrite(!1),l.setAlphaMode(0),n.render(!1),l.setColorWrite(!0)}}n.render(r)}},u.renderUnsorted=function(e){for(var t=0;t<e.length;t++)e.data[t].render(!1)},u.defaultTransparentSortCompare=function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:u.backToFrontSortCompare(e,t)},u.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},u.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},u.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},u.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},u.prototype.dispatch=function(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!=i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.push(t._edgesRenderer))},u.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},u.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},u.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._particleSystems.length;i++){var r=this._particleSystems.data[i];if(0!==(t&&t.layerMask&r.layerMask)){var n=r.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(r.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},u.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},u._zeroVector=c.e.Zero(),u);function u(e,t,i,r,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),this.index=e,this._opaqueSubMeshes=new o.a(256),this._transparentSubMeshes=new o.a(256),this._alphaTestSubMeshes=new o.a(256),this._depthOnlySubMeshes=new o.a(256),this._particleSystems=new o.a(256),this._spriteManagers=new o.a(256),this._edgesRenderers=new o.a(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=n}var n=function(){},s=(p.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},p.prototype.render=function(e,t,i,r){var n=this._renderingGroupInfo;if(n.scene=this._scene,n.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(var o=0;o<this._scene.spriteManagers.length;o++){var s=this._scene.spriteManagers[o];this.dispatchSprites(s)}for(o=p.MIN_RENDERINGGROUPS;o<p.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===p.MIN_RENDERINGGROUPS;var a=this._renderingGroups[o];if(a){var h=Math.pow(2,o);if(n.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(n,h),p.AUTOCLEAR){var l=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[o];l&&l.autoClear&&this._clearDepthStencilBuffer(l.depth,l.stencil)}for(var c=0,u=this._scene._beforeRenderingGroupDrawStage;c<u.length;c++)u[c].action(o);a.render(e,r,i,t);for(var f=0,d=this._scene._afterRenderingGroupDrawStage;f<d.length;f++)d[f].action(o);this._scene.onAfterRenderingGroupObservable.notifyObservers(n,h)}}},p.prototype.reset=function(){for(var e=p.MIN_RENDERINGGROUPS;e<p.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.prepare()}},p.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},p.prototype.freeRenderingGroups=function(){for(var e=p.MIN_RENDERINGGROUPS;e<p.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.dispose()}},p.prototype._prepareRenderingGroup=function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new r(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},p.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},p.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},p.prototype.dispatch=function(e,t,i){void 0===t&&(t=e.getMesh());var r=t.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatch(e,t,i)},p.prototype.setRenderingOrder=function(e,t,i,r){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]){var n=this._renderingGroups[e];n.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],n.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],n.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},p.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:r}},p.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},p.MAX_RENDERINGGROUPS=4,p.MIN_RENDERINGGROUPS=0,p.AUTOCLEAR=!0,p);function p(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new n,this._scene=e;for(var t=p.MIN_RENDERINGGROUPS;t<p.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}},function(e,t,i){"use strict";var r="helperFunctions",n="const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat toGammaSpace(float color)\n{\nreturn pow(color,GammaEncodePowerApprox);\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}\n";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){
/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */
e.exports=function(){"use strict";for(var i=function(e,t,i){if(t===void 0)t=0;if(i===void 0)i=1;return e<t?t:e>i?i:e},e=function(e){e._clipped=false;e._unclipped=e.slice(0);for(var t=0;t<=3;t++){if(t<3){if(e[t]<0||e[t]>255){e._clipped=true}e[t]=i(e[t],0,255)}else if(t===3){e[t]=i(e[t],0,1)}}return e},t={},r=0,n=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];r<n.length;r+=1){var o=n[r];t["[object "+o+"]"]=o.toLowerCase()}var j=function(e){return t[Object.prototype.toString.call(e)]||"object"},s=function(t,e){if(e===void 0)e=null;if(t.length>=3){return Array.prototype.slice.call(t)}if(j(t[0])=="object"&&e){return e.split("").filter(function(e){return t[0][e]!==undefined}).map(function(e){return t[0][e]})}return t[0]},a=function(e){if(e.length<2){return null}var t=e.length-1;if(j(e[t])=="string"){return e[t].toLowerCase()}return null},h=Math.PI,l={clip_rgb:e,limit:i,type:j,unpack:s,last:a,PI:h,TWOPI:h*2,PITHIRD:h/3,DEG2RAD:h/180,RAD2DEG:180/h},p={format:{},autodetect:[]},c=l.last,u=l.clip_rgb,f=l.type,d=function e(){var t=[],i=arguments.length;while(i--)t[i]=arguments[i];var r=this;if(f(t[0])==="object"&&t[0].constructor&&t[0].constructor===this.constructor){return t[0]}var n=c(t);var o=false;if(!n){o=true;if(!p.sorted){p.autodetect=p.autodetect.sort(function(e,t){return t.p-e.p});p.sorted=true}for(var s=0,a=p.autodetect;s<a.length;s+=1){var h=a[s];n=h.test.apply(h,t);if(n){break}}}if(p.format[n]){var l=p.format[n].apply(null,o?t:t.slice(0,-1));r._rgb=u(l)}else{throw new Error("unknown format: "+t)}if(r._rgb.length===3){r._rgb.push(1)}};d.prototype.toString=function e(){if(f(this.hex)=="function"){return this.hex()}return"["+this._rgb.join(",")+"]"};var S=d,_=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(_.Color,[null].concat(e)))};_.Color=S,_.version="2.1.0";var O=_,g=l.unpack,m=Math.max,v,b=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=g(e,"rgb");var r=i[0];var n=i[1];var o=i[2];r=r/255;n=n/255;o=o/255;var s=1-m(r,m(n,o));var a=s<1?1/(1-s):0;var h=(1-r-s)*a;var l=(1-n-s)*a;var c=(1-o-s)*a;return[h,l,c,s]},y=l.unpack,x,T=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=y(e,"cmyk");var i=e[0];var r=e[1];var n=e[2];var o=e[3];var s=e.length>4?e[4]:1;if(o===1){return[0,0,0,s]}return[i>=1?0:255*(1-i)*(1-o),r>=1?0:255*(1-r)*(1-o),n>=1?0:255*(1-n)*(1-o),s]},M=l.unpack,E=l.type;S.prototype.cmyk=function(){return b(this._rgb)},O.cmyk=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["cmyk"])))},p.format.cmyk=T,p.autodetect.push({p:2,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=M(e,"cmyk");if(E(e)==="array"&&e.length===4){return"cmyk"}}});var A=l.unpack,P=l.last,C=function(e){return Math.round(e*100)/100},R,I=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=A(e,"hsla");var r=P(e)||"lsa";i[0]=C(i[0]||0);i[1]=C(i[1]*100)+"%";i[2]=C(i[2]*100)+"%";if(r==="hsla"||i.length>3&&i[3]<1){i[3]=i.length>3?i[3]:1;r="hsla"}else{i.length=3}return r+"("+i.join(",")+")"},w=l.unpack,D,L=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=w(e,"rgba");var i=e[0];var r=e[1];var n=e[2];i/=255;r/=255;n/=255;var o=Math.min(i,r,n);var s=Math.max(i,r,n);var a=(s+o)/2;var h,l;if(s===o){h=0;l=Number.NaN}else{h=a<.5?(s-o)/(s+o):(s-o)/(2-s-o)}if(i==s){l=(r-n)/(s-o)}else if(r==s){l=2+(n-i)/(s-o)}else if(n==s){l=4+(i-r)/(s-o)}l*=60;if(l<0){l+=360}if(e.length>3&&e[3]!==undefined){return[l,h,a,e[3]]}return[l,h,a]},F=l.unpack,N=l.last,B=Math.round,k,U=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=F(e,"rgba");var r=N(e)||"rgb";if(r.substr(0,3)=="hsl"){return I(L(i),r)}i[0]=B(i[0]);i[1]=B(i[1]);i[2]=B(i[2]);if(r==="rgba"||i.length>3&&i[3]<1){i[3]=i.length>3?i[3]:1;r="rgba"}return r+"("+i.slice(0,r==="rgb"?3:4).join(",")+")"},V=l.unpack,z=Math.round,W,G=function(){var e;var t=[],i=arguments.length;while(i--)t[i]=arguments[i];t=V(t,"hsl");var r=t[0];var n=t[1];var o=t[2];var s,a,h;if(n===0){s=a=h=o*255}else{var l=[0,0,0];var c=[0,0,0];var u=o<.5?o*(1+n):o+n-o*n;var f=2*o-u;var d=r/360;l[0]=d+1/3;l[1]=d;l[2]=d-1/3;for(var p=0;p<3;p++){if(l[p]<0){l[p]+=1}if(l[p]>1){l[p]-=1}if(6*l[p]<1){c[p]=f+(u-f)*6*l[p]}else if(2*l[p]<1){c[p]=u}else if(3*l[p]<2){c[p]=f+(u-f)*(2/3-l[p])*6}else{c[p]=f}}e=[z(c[0]*255),z(c[1]*255),z(c[2]*255)],s=e[0],a=e[1],h=e[2]}if(t.length>3){return[s,a,h,t[3]]}return[s,a,h,1]},H=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,X=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,K=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Y=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,q=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Z=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Q=Math.round,J=function(e){e=e.toLowerCase().trim();var t;if(p.format.named){try{return p.format.named(e)}catch(e){}}if(t=e.match(H)){var i=t.slice(1,4);for(var r=0;r<3;r++){i[r]=+i[r]}i[3]=1;return i}if(t=e.match(X)){var n=t.slice(1,5);for(var o=0;o<4;o++){n[o]=+n[o]}return n}if(t=e.match(K)){var s=t.slice(1,4);for(var a=0;a<3;a++){s[a]=Q(s[a]*2.55)}s[3]=1;return s}if(t=e.match(Y)){var h=t.slice(1,5);for(var l=0;l<3;l++){h[l]=Q(h[l]*2.55)}h[3]=+h[3];return h}if(t=e.match(q)){var c=t.slice(1,4);c[1]*=.01;c[2]*=.01;var u=G(c);u[3]=1;return u}if(t=e.match(Z)){var f=t.slice(1,4);f[1]*=.01;f[2]*=.01;var d=G(f);d[3]=+t[4];return d}};J.test=function(e){return H.test(e)||X.test(e)||K.test(e)||Y.test(e)||q.test(e)||Z.test(e)};var $=J,ee=l.type;S.prototype.css=function(e){return U(this._rgb,e)},O.css=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["css"])))},p.format.css=$,p.autodetect.push({p:5,test:function(e){var t=[],i=arguments.length-1;while(i-- >0)t[i]=arguments[i+1];if(!t.length&&ee(e)==="string"&&$.test(e)){return"css"}}});var te=l.unpack;p.format.gl=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=te(e,"rgba");i[0]*=255;i[1]*=255;i[2]*=255;return i},O.gl=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["gl"])))},S.prototype.gl=function(){var e=this._rgb;return[e[0]/255,e[1]/255,e[2]/255,e[3]]};var ie=l.unpack,re,ne=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=ie(e,"rgb");var r=i[0];var n=i[1];var o=i[2];var s=Math.min(r,n,o);var a=Math.max(r,n,o);var h=a-s;var l=h*100/255;var c=s/(255-h)*100;var u;if(h===0){u=Number.NaN}else{if(r===a){u=(n-o)/h}if(n===a){u=2+(o-r)/h}if(o===a){u=4+(r-n)/h}u*=60;if(u<0){u+=360}}return[u,l,c]},oe=l.unpack,se=Math.floor,ae,he=function(){var e,t,i,r,n,o;var s=[],a=arguments.length;while(a--)s[a]=arguments[a];s=oe(s,"hcg");var h=s[0];var l=s[1];var c=s[2];var u,f,d;c=c*255;var p=l*255;if(l===0){u=f=d=c}else{if(h===360){h=0}if(h>360){h-=360}if(h<0){h+=360}h/=60;var _=se(h);var g=h-_;var m=c*(1-l);var v=m+p*(1-g);var b=m+p*g;var y=m+p;switch(_){case 0:e=[y,b,m],u=e[0],f=e[1],d=e[2];break;case 1:t=[v,y,m],u=t[0],f=t[1],d=t[2];break;case 2:i=[m,y,b],u=i[0],f=i[1],d=i[2];break;case 3:r=[m,v,y],u=r[0],f=r[1],d=r[2];break;case 4:n=[b,m,y],u=n[0],f=n[1],d=n[2];break;case 5:o=[y,m,v],u=o[0],f=o[1],d=o[2];break}}return[u,f,d,s.length>3?s[3]:1]},le=l.unpack,ce=l.type;S.prototype.hcg=function(){return ne(this._rgb)},O.hcg=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["hcg"])))},p.format.hcg=he,p.autodetect.push({p:1,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=le(e,"hcg");if(ce(e)==="array"&&e.length===3){return"hcg"}}});var ue=l.unpack,fe=l.last,de=Math.round,pe,_e=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=ue(e,"rgba");var r=i[0];var n=i[1];var o=i[2];var s=i[3];var a=fe(e)||"auto";if(s===undefined){s=1}if(a==="auto"){a=s<1?"rgba":"rgb"}r=de(r);n=de(n);o=de(o);var h=r<<16|n<<8|o;var l="000000"+h.toString(16);l=l.substr(l.length-6);var c="0"+de(s*255).toString(16);c=c.substr(c.length-2);switch(a.toLowerCase()){case"rgba":return"#"+l+c;case"argb":return"#"+c+l;default:return"#"+l}},ge=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,me=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,ve,be=function(e){if(e.match(ge)){if(e.length===4||e.length===7){e=e.substr(1)}if(e.length===3){e=e.split("");e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}var t=parseInt(e,16);var i=t>>16;var r=t>>8&255;var n=t&255;return[i,r,n,1]}if(e.match(me)){if(e.length===5||e.length===9){e=e.substr(1)}if(e.length===4){e=e.split("");e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]}var o=parseInt(e,16);var s=o>>24&255;var a=o>>16&255;var h=o>>8&255;var l=Math.round((o&255)/255*100)/100;return[s,a,h,l]}throw new Error("unknown hex color: "+e)},ye=l.type;S.prototype.hex=function(e){return _e(this._rgb,e)},O.hex=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["hex"])))},p.format.hex=be,p.autodetect.push({p:4,test:function(e){var t=[],i=arguments.length-1;while(i-- >0)t[i]=arguments[i+1];if(!t.length&&ye(e)==="string"&&[3,4,5,6,7,8,9].indexOf(e.length)>=0){return"hex"}}});var xe=l.unpack,Te=l.TWOPI,Me=Math.min,Ee=Math.sqrt,Ae=Math.acos,Oe,Pe=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=xe(e,"rgb");var r=i[0];var n=i[1];var o=i[2];r/=255;n/=255;o/=255;var s;var a=Me(r,n,o);var h=(r+n+o)/3;var l=h>0?1-a/h:0;if(l===0){s=NaN}else{s=(r-n+(r-o))/2;s/=Ee((r-n)*(r-n)+(r-o)*(n-o));s=Ae(s);if(o>n){s=Te-s}s/=Te}return[s*360,l,h]},Ce=l.unpack,Se=l.limit,Re=l.TWOPI,Ie=l.PITHIRD,we=Math.cos,De,Le=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Ce(e,"hsi");var i=e[0];var r=e[1];var n=e[2];var o,s,a;if(isNaN(i)){i=0}if(isNaN(r)){r=0}if(i>360){i-=360}if(i<0){i+=360}i/=360;if(i<1/3){a=(1-r)/3;o=(1+r*we(Re*i)/we(Ie-Re*i))/3;s=1-(a+o)}else if(i<2/3){i-=1/3;o=(1-r)/3;s=(1+r*we(Re*i)/we(Ie-Re*i))/3;a=1-(o+s)}else{i-=2/3;s=(1-r)/3;a=(1+r*we(Re*i)/we(Ie-Re*i))/3;o=1-(s+a)}o=Se(n*o*3);s=Se(n*s*3);a=Se(n*a*3);return[o*255,s*255,a*255,e.length>3?e[3]:1]},Fe=l.unpack,Ne=l.type;S.prototype.hsi=function(){return Pe(this._rgb)},O.hsi=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["hsi"])))},p.format.hsi=Le,p.autodetect.push({p:2,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Fe(e,"hsi");if(Ne(e)==="array"&&e.length===3){return"hsi"}}});var Be=l.unpack,ke=l.type;S.prototype.hsl=function(){return L(this._rgb)},O.hsl=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["hsl"])))},p.format.hsl=G,p.autodetect.push({p:2,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Be(e,"hsl");if(ke(e)==="array"&&e.length===3){return"hsl"}}});var Ue=l.unpack,Ve=Math.min,ze=Math.max,je,We=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Ue(e,"rgb");var i=e[0];var r=e[1];var n=e[2];var o=Ve(i,r,n);var s=ze(i,r,n);var a=s-o;var h,l,c;c=s/255;if(s===0){h=Number.NaN;l=0}else{l=a/s;if(i===s){h=(r-n)/a}if(r===s){h=2+(n-i)/a}if(n===s){h=4+(i-r)/a}h*=60;if(h<0){h+=360}}return[h,l,c]},Ge=l.unpack,He=Math.floor,Xe,Ke=function(){var e,t,i,r,n,o;var s=[],a=arguments.length;while(a--)s[a]=arguments[a];s=Ge(s,"hsv");var h=s[0];var l=s[1];var c=s[2];var u,f,d;c*=255;if(l===0){u=f=d=c}else{if(h===360){h=0}if(h>360){h-=360}if(h<0){h+=360}h/=60;var p=He(h);var _=h-p;var g=c*(1-l);var m=c*(1-l*_);var v=c*(1-l*(1-_));switch(p){case 0:e=[c,v,g],u=e[0],f=e[1],d=e[2];break;case 1:t=[m,c,g],u=t[0],f=t[1],d=t[2];break;case 2:i=[g,c,v],u=i[0],f=i[1],d=i[2];break;case 3:r=[g,m,c],u=r[0],f=r[1],d=r[2];break;case 4:n=[v,g,c],u=n[0],f=n[1],d=n[2];break;case 5:o=[c,g,m],u=o[0],f=o[1],d=o[2];break}}return[u,f,d,s.length>3?s[3]:1]},Ye=l.unpack,qe=l.type;S.prototype.hsv=function(){return We(this._rgb)},O.hsv=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["hsv"])))},p.format.hsv=Ke,p.autodetect.push({p:2,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Ye(e,"hsv");if(qe(e)==="array"&&e.length===3){return"hsv"}}});var Ze={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Qe=l.unpack,Je=Math.pow,$e=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=Qe(e,"rgb");var r=i[0];var n=i[1];var o=i[2];var s=it(r,n,o);var a=s[0];var h=s[1];var l=s[2];var c=116*h-16;return[c<0?0:c,500*(a-h),200*(h-l)]},et=function(e){if((e/=255)<=.04045){return e/12.92}return Je((e+.055)/1.055,2.4)},tt=function(e){if(e>Ze.t3){return Je(e,1/3)}return e/Ze.t2+Ze.t0},it=function(e,t,i){e=et(e);t=et(t);i=et(i);var r=tt((.4124564*e+.3575761*t+.1804375*i)/Ze.Xn);var n=tt((.2126729*e+.7151522*t+.072175*i)/Ze.Yn);var o=tt((.0193339*e+.119192*t+.9503041*i)/Ze.Zn);return[r,n,o]},rt=$e,nt=l.unpack,ot=Math.pow,st=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=nt(e,"lab");var i=e[0];var r=e[1];var n=e[2];var o,s,a,h,l,c;s=(i+16)/116;o=isNaN(r)?s:s+r/500;a=isNaN(n)?s:s-n/200;s=Ze.Yn*ht(s);o=Ze.Xn*ht(o);a=Ze.Zn*ht(a);h=at(3.2404542*o-1.5371385*s-.4985314*a);l=at(-.969266*o+1.8760108*s+.041556*a);c=at(.0556434*o-.2040259*s+1.0572252*a);return[h,l,c,e.length>3?e[3]:1]},at=function(e){return 255*(e<=.00304?12.92*e:1.055*ot(e,1/2.4)-.055)},ht=function(e){return e>Ze.t1?e*e*e:Ze.t2*(e-Ze.t0)},lt=st,ct=l.unpack,ut=l.type;S.prototype.lab=function(){return rt(this._rgb)},O.lab=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["lab"])))},p.format.lab=lt,p.autodetect.push({p:2,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=ct(e,"lab");if(ut(e)==="array"&&e.length===3){return"lab"}}});var ft=l.unpack,dt=l.RAD2DEG,pt=Math.sqrt,_t=Math.atan2,gt=Math.round,mt,vt=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=ft(e,"lab");var r=i[0];var n=i[1];var o=i[2];var s=pt(n*n+o*o);var a=(_t(o,n)*dt+360)%360;if(gt(s*1e4)===0){a=Number.NaN}return[r,s,a]},bt=l.unpack,yt,xt=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=bt(e,"rgb");var r=i[0];var n=i[1];var o=i[2];var s=rt(r,n,o);var a=s[0];var h=s[1];var l=s[2];return vt(a,h,l)},Tt=l.unpack,Mt=l.DEG2RAD,Et=Math.sin,At=Math.cos,Ot,Pt=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=Tt(e,"lch");var r=i[0];var n=i[1];var o=i[2];if(isNaN(o)){o=0}o=o*Mt;return[r,At(o)*n,Et(o)*n]},Ct=l.unpack,St,Rt=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Ct(e,"lch");var i=e[0];var r=e[1];var n=e[2];var o=Pt(i,r,n);var s=o[0];var a=o[1];var h=o[2];var l=lt(s,a,h);var c=l[0];var u=l[1];var f=l[2];return[c,u,f,e.length>3?e[3]:1]},It=l.unpack,wt,Dt=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=It(e,"hcl").reverse();return Rt.apply(void 0,i)},Lt=l.unpack,Ft=l.type;S.prototype.lch=function(){return xt(this._rgb)},S.prototype.hcl=function(){return xt(this._rgb).reverse()},O.lch=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["lch"])))},O.hcl=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["hcl"])))},p.format.lch=Rt,p.format.hcl=Dt,["lch","hcl"].forEach(function(i){return p.autodetect.push({p:2,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Lt(e,i);if(Ft(e)==="array"&&e.length===3){return i}}})});var Nt,Bt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},kt=l.type;S.prototype.name=function(){var e=_e(this._rgb,"rgb");for(var t=0,i=Object.keys(Bt);t<i.length;t+=1){var r=i[t];if(Bt[r]===e){return r.toLowerCase()}}return e},p.format.named=function(e){e=e.toLowerCase();if(Bt[e]){return be(Bt[e])}throw new Error("unknown color name: "+e)},p.autodetect.push({p:5,test:function(e){var t=[],i=arguments.length-1;while(i-- >0)t[i]=arguments[i+1];if(!t.length&&kt(e)==="string"&&Bt[e.toLowerCase()]){return"named"}}});var Ut=l.unpack,Vt,zt=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=Ut(e,"rgb");var r=i[0];var n=i[1];var o=i[2];return(r<<16)+(n<<8)+o},jt=l.type,Wt,Gt=function(e){if(jt(e)=="number"&&e>=0&&e<=16777215){var t=e>>16;var i=e>>8&255;var r=e&255;return[t,i,r,1]}throw new Error("unknown num color: "+e)},Ht=l.type;S.prototype.num=function(){return zt(this._rgb)},O.num=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["num"])))},p.format.num=Gt,p.autodetect.push({p:5,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];if(e.length===1&&Ht(e[0])==="number"&&e[0]>=0&&e[0]<=16777215){return"num"}}});var Xt=l.unpack,Kt=l.type,Yt=Math.round;S.prototype.rgb=function(e){if(e===void 0)e=true;if(e===false){return this._rgb.slice(0,3)}return this._rgb.slice(0,3).map(Yt)},S.prototype.rgba=function(i){if(i===void 0)i=true;return this._rgb.slice(0,4).map(function(e,t){return t<3?i===false?e:Yt(e):e})},O.rgb=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["rgb"])))},p.format.rgb=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=Xt(e,"rgba");if(i[3]===undefined){i[3]=1}return i},p.autodetect.push({p:3,test:function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];e=Xt(e,"rgba");if(Kt(e)==="array"&&(e.length===3||e.length===4&&Kt(e[3])=="number"&&e[3]>=0&&e[3]<=1)){return"rgb"}}});var qt=Math.log,Zt,Qt=function(e){var t=e/100;var i,r,n;if(t<66){i=255;r=-155.25485562709179-.44596950469579133*(r=t-2)+104.49216199393888*qt(r);n=t<20?0:-254.76935184120902+.8274096064007395*(n=t-10)+115.67994401066147*qt(n)}else{i=351.97690566805693+.114206453784165*(i=t-55)-40.25366309332127*qt(i);r=325.4494125711974+.07943456536662342*(r=t-50)-28.0852963507957*qt(r);n=255}return[i,r,n,1]},Jt=l.unpack,$t=Math.round,ei,ti=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];var i=Jt(e,"rgb");var r=i[0],n=i[2];var o=1e3;var s=4e4;var a=.4;var h;while(s-o>a){h=(s+o)*.5;var l=Qt(h);if(l[2]/l[0]>=n/r){s=h}else{o=h}}return $t(h)};S.prototype.temp=S.prototype.kelvin=S.prototype.temperature=function(){return ti(this._rgb)},O.temp=O.kelvin=O.temperature=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return new(Function.prototype.bind.apply(S,[null].concat(e,["temp"])))},p.format.temp=p.format.kelvin=p.format.temperature=Qt;var ii=l.type;S.prototype.alpha=function(e,t){if(t===void 0)t=false;if(e!==undefined&&ii(e)==="number"){if(t){this._rgb[3]=e;return this}return new S([this._rgb[0],this._rgb[1],this._rgb[2],e],"rgb")}return this._rgb[3]},S.prototype.clipped=function(){return this._rgb._clipped||false},S.prototype.darken=function(e){if(e===void 0)e=1;var t=this;var i=t.lab();i[0]-=Ze.Kn*e;return new S(i,"lab").alpha(t.alpha(),true)},S.prototype.brighten=function(e){if(e===void 0)e=1;return this.darken(-e)},S.prototype.darker=S.prototype.darken,S.prototype.brighter=S.prototype.brighten,S.prototype.get=function(e){var t=e.split(".");var i=t[0];var r=t[1];var n=this[i]();if(r){var o=i.indexOf(r);if(o>-1){return n[o]}throw new Error("unknown channel "+r+" in mode "+i)}else{return n}};var ri=l.type,ni=Math.pow,oi=1e-7,si=20;S.prototype.luminance=function(n){if(n!==undefined&&ri(n)==="number"){if(n===0){return new S([0,0,0,this._rgb[3]],"rgb")}if(n===1){return new S([255,255,255,this._rgb[3]],"rgb")}var e=this.luminance();var o="rgb";var s=si;var a=function(e,t){var i=e.interpolate(t,.5,o);var r=i.luminance();if(Math.abs(n-r)<oi||!s--){return i}return r>n?a(e,i):a(i,t)};var t=(e>n?a(new S([0,0,0]),this):a(this,new S([255,255,255]))).rgb();return new S(t.concat([this._rgb[3]]))}return ai.apply(void 0,this._rgb.slice(0,3))};var ai=function(e,t,i){e=hi(e);t=hi(t);i=hi(i);return.2126*e+.7152*t+.0722*i},hi=function(e){e/=255;return e<=.03928?e/12.92:ni((e+.055)/1.055,2.4)},li={},ci=l.type,ui=function(e,t,i){if(i===void 0)i=.5;var r=[],n=arguments.length-3;while(n-- >0)r[n]=arguments[n+3];var o=r[0]||"lrgb";if(!li[o]&&!r.length){o=Object.keys(li)[0]}if(!li[o]){throw new Error("interpolation mode "+o+" is not defined")}if(ci(e)!=="object"){e=new S(e)}if(ci(t)!=="object"){t=new S(t)}return li[o](e,t,i).alpha(e.alpha()+i*(t.alpha()-e.alpha()))};S.prototype.mix=S.prototype.interpolate=function(e,t){if(t===void 0)t=.5;var i=[],r=arguments.length-2;while(r-- >0)i[r]=arguments[r+2];return ui.apply(void 0,[this,e,t].concat(i))},S.prototype.premultiply=function(e){if(e===void 0)e=false;var t=this._rgb;var i=t[3];if(e){this._rgb=[t[0]*i,t[1]*i,t[2]*i,i];return this}else{return new S([t[0]*i,t[1]*i,t[2]*i,i],"rgb")}},S.prototype.saturate=function(e){if(e===void 0)e=1;var t=this;var i=t.lch();i[1]+=Ze.Kn*e;if(i[1]<0){i[1]=0}return new S(i,"lch").alpha(t.alpha(),true)},S.prototype.desaturate=function(e){if(e===void 0)e=1;return this.saturate(-e)};var fi=l.type;S.prototype.set=function(e,t,i){if(i===void 0)i=false;var r=e.split(".");var n=r[0];var o=r[1];var s=this[n]();if(o){var a=n.indexOf(o);if(a>-1){if(fi(t)=="string"){switch(t.charAt(0)){case"+":s[a]+=+t;break;case"-":s[a]+=+t;break;case"*":s[a]*=+t.substr(1);break;case"/":s[a]/=+t.substr(1);break;default:s[a]=+t}}else if(fi(t)==="number"){s[a]=t}else{throw new Error("unsupported value for Color.set")}var h=new S(s,n);if(i){this._rgb=h._rgb;return this}return h}throw new Error("unknown channel "+o+" in mode "+n)}else{return s}};var di=function(e,t,i){var r=e._rgb;var n=t._rgb;return new S(r[0]+i*(n[0]-r[0]),r[1]+i*(n[1]-r[1]),r[2]+i*(n[2]-r[2]),"rgb")};li.rgb=di;var pi=Math.sqrt,_i=Math.pow,gi=function(e,t,i){var r=e._rgb;var n=r[0];var o=r[1];var s=r[2];var a=t._rgb;var h=a[0];var l=a[1];var c=a[2];return new S(pi(_i(n,2)*(1-i)+_i(h,2)*i),pi(_i(o,2)*(1-i)+_i(l,2)*i),pi(_i(s,2)*(1-i)+_i(c,2)*i),"rgb")};li.lrgb=gi;var mi=function(e,t,i){var r=e.lab();var n=t.lab();return new S(r[0]+i*(n[0]-r[0]),r[1]+i*(n[1]-r[1]),r[2]+i*(n[2]-r[2]),"lab")};li.lab=mi;var vi=function(e,t,i,r){var n,o;var s,a;if(r==="hsl"){s=e.hsl();a=t.hsl()}else if(r==="hsv"){s=e.hsv();a=t.hsv()}else if(r==="hcg"){s=e.hcg();a=t.hcg()}else if(r==="hsi"){s=e.hsi();a=t.hsi()}else if(r==="lch"||r==="hcl"){r="hcl";s=e.hcl();a=t.hcl()}var h,l,c,u,f,d;if(r.substr(0,1)==="h"){n=s,h=n[0],c=n[1],f=n[2];o=a,l=o[0],u=o[1],d=o[2]}var p,_,g,m;if(!isNaN(h)&&!isNaN(l)){if(l>h&&l-h>180){m=l-(h+360)}else if(l<h&&h-l>180){m=l+360-h}else{m=l-h}_=h+i*m}else if(!isNaN(h)){_=h;if((d==1||d==0)&&r!="hsv"){p=c}}else if(!isNaN(l)){_=l;if((f==1||f==0)&&r!="hsv"){p=u}}else{_=Number.NaN}if(p===undefined){p=c+i*(u-c)}g=f+i*(d-f);return new S([_,p,g],r)},bi=function(e,t,i){return vi(e,t,i,"lch")};li.lch=bi,li.hcl=bi;var yi=function(e,t,i){var r=e.num();var n=t.num();return new S(r+i*(n-r),"num")};li.num=yi;var xi=function(e,t,i){return vi(e,t,i,"hcg")};li.hcg=xi;var Ti=function(e,t,i){return vi(e,t,i,"hsi")};li.hsi=Ti;var Mi=function(e,t,i){return vi(e,t,i,"hsl")};li.hsl=Mi;var Ei=function(e,t,i){return vi(e,t,i,"hsv")};li.hsv=Ei;var Ai=l.clip_rgb,Oi=Math.pow,Pi=Math.sqrt,Ci=Math.PI,Si=Math.cos,Ri=Math.sin,Ii=Math.atan2,wi=function(e,o,s){if(o===void 0)o="lrgb";if(s===void 0)s=null;var t=e.length;if(!s){s=Array.from(new Array(t)).map(function(){return 1})}var i=t/s.reduce(function(e,t){return e+t});if(s.forEach(function(e,t){s[t]*=i}),e=e.map(function(e){return new S(e)}),o==="lrgb"){return Di(e,s)}for(var r=e.shift(),a=r.get(o),h=[],l=0,c=0,n=0;n<a.length;n++){a[n]=(a[n]||0)*s[0];h.push(isNaN(a[n])?0:s[0]);if(o.charAt(n)==="h"&&!isNaN(a[n])){var u=a[n]/180*Ci;l+=Si(u)*s[0];c+=Ri(u)*s[0]}}var f=r.alpha()*s[0];e.forEach(function(e,t){var i=e.get(o);f+=e.alpha()*s[t+1];for(var r=0;r<a.length;r++){if(!isNaN(i[r])){h[r]+=s[t+1];if(o.charAt(r)==="h"){var n=i[r]/180*Ci;l+=Si(n)*s[t+1];c+=Ri(n)*s[t+1]}else{a[r]+=i[r]*s[t+1]}}}});for(var d=0;d<a.length;d++){if(o.charAt(d)==="h"){var p=Ii(c/h[d],l/h[d])/Ci*180;while(p<0){p+=360}while(p>=360){p-=360}a[d]=p}else{a[d]=a[d]/h[d]}}return f/=t,new S(a,o).alpha(.99999<f?1:f,!0)},Di=function(e,t){var i=e.length;var r=[0,0,0,0];for(var n=0;n<e.length;n++){var o=e[n];var s=t[n]/i;var a=o._rgb;r[0]+=Oi(a[0],2)*s;r[1]+=Oi(a[1],2)*s;r[2]+=Oi(a[2],2)*s;r[3]+=a[3]*s}r[0]=Pi(r[0]);r[1]=Pi(r[1]);r[2]=Pi(r[2]);if(r[3]>.9999999){r[3]=1}return new S(Ai(r))},Li=l.type,Fi=Math.pow,Ni=function(l){var h="rgb";var c=O("#ccc");var t=0;var u=[0,1];var f=[];var d=[0,0];var p=false;var _=[];var i=false;var g=0;var m=1;var r=false;var v={};var b=true;var y=1;var n=function(e){e=e||["#fff","#000"];if(e&&Li(e)==="string"&&O.brewer&&O.brewer[e.toLowerCase()]){e=O.brewer[e.toLowerCase()]}if(Li(e)==="array"){if(e.length===1){e=[e[0],e[0]]}e=e.slice(0);for(var t=0;t<e.length;t++){e[t]=O(e[t])}f.length=0;for(var i=0;i<e.length;i++){f.push(i/(e.length-1))}}o();return _=e};var x=function(e){if(p!=null){var t=p.length-1;var i=0;while(i<t&&e>=p[i]){i++}return i-1}return 0};var T=function(e){return e};var M=function(e){return e};var E=function(e,t){var i,r;if(t==null){t=false}if(isNaN(e)||e===null){return c}if(!t){if(p&&p.length>2){var n=x(e);r=n/(p.length-2)}else if(m!==g){r=(e-g)/(m-g)}else{r=1}}else{r=e}r=M(r);if(!t){r=T(r)}if(y!==1){r=Fi(r,y)}r=d[0]+r*(1-d[0]-d[1]);r=Math.min(1,Math.max(0,r));var o=Math.floor(r*1e4);if(b&&v[o]){i=v[o]}else{if(Li(_)==="array"){for(var s=0;s<f.length;s++){var a=f[s];if(r<=a){i=_[s];break}if(r>=a&&s===f.length-1){i=_[s];break}if(r>a&&r<f[s+1]){r=(r-a)/(f[s+1]-a);i=O.interpolate(_[s],_[s+1],r,h);break}}}else if(Li(_)==="function"){i=_(r)}if(b){v[o]=i}}return i};var o=function(){return v={}};n(l);var A=function(e){var t=O(E(e));if(i&&t[i]){return t[i]()}else{return t}};A.classes=function(e){if(e!=null){if(Li(e)==="array"){p=e;u=[e[0],e[e.length-1]]}else{var t=O.analyze(u);if(e===0){p=[t.min,t.max]}else{p=O.limits(t,"e",e)}}return A}return p};A.domain=function(i){if(!arguments.length){return u}g=i[0];m=i[i.length-1];f=[];var e=_.length;if(i.length===e&&g!==m){for(var t=0,r=Array.from(i);t<r.length;t+=1){var n=r[t];f.push((n-g)/(m-g))}}else{for(var o=0;o<e;o++){f.push(o/(e-1))}if(i.length>2){var s=i.map(function(e,t){return t/(i.length-1)});var a=i.map(function(e){return(e-g)/(m-g)});if(!a.every(function(e,t){return s[t]===e})){M=function(e){if(e<=0||e>=1){return e}var t=0;while(e>=a[t+1]){t++}var i=(e-a[t])/(a[t+1]-a[t]);var r=s[t]+i*(s[t+1]-s[t]);return r}}}}u=[g,m];return A};A.mode=function(e){if(!arguments.length){return h}h=e;o();return A};A.range=function(e,t){n(e,t);return A};A.out=function(e){i=e;return A};A.spread=function(e){if(!arguments.length){return t}t=e;return A};A.correctLightness=function(e){if(e==null){e=true}r=e;o();if(r){T=function(e){var t=E(0,true).lab()[0];var i=E(1,true).lab()[0];var r=t>i;var n=E(e,true).lab()[0];var o=t+(i-t)*e;var s=n-o;var a=0;var h=1;var l=20;while(Math.abs(s)>.01&&l-- >0){(function(){if(r){s*=-1}if(s<0){a=e;e+=(h-e)*.5}else{h=e;e+=(a-e)*.5}n=E(e,true).lab()[0];return s=n-o})()}return e}}else{T=function(e){return e}}return A};A.padding=function(e){if(e!=null){if(Li(e)==="number"){e=[e,e]}d=e;return A}else{return d}};A.colors=function(t,i){if(arguments.length<2){i="hex"}var e=[];if(arguments.length===0){e=_.slice(0)}else if(t===1){e=[A(.5)]}else if(t>1){var r=u[0];var n=u[1]-r;e=Bi(0,t,false).map(function(e){return A(r+e/(t-1)*n)})}else{l=[];var o=[];if(p&&p.length>2){for(var s=1,a=p.length,h=1<=a;h?s<a:s>a;h?s++:s--){o.push((p[s-1]+p[s])*.5)}}else{o=u}e=o.map(function(e){return A(e)})}if(O[i]){e=e.map(function(e){return e[i]()})}return e};A.cache=function(e){if(e!=null){b=e;return A}else{return b}};A.gamma=function(e){if(e!=null){y=e;return A}else{return y}};A.nodata=function(e){if(e!=null){c=O(e);return A}else{return c}};return A};function Bi(e,t,i){var r=[];var n=e<t;var o=!i?t:n?t+1:t-1;for(var s=e;n?s<o:s>o;n?s++:s--){r.push(s)}return r}var ki=function(e){var t,i,r;var n,o,s,a;e=e.map(function(e){return new S(e)});if(e.length===2){t=e.map(function(e){return e.lab()}),o=t[0],s=t[1];n=function(t){var e=[0,1,2].map(function(e){return o[e]+t*(s[e]-o[e])});return new S(e,"lab")}}else if(e.length===3){i=e.map(function(e){return e.lab()}),o=i[0],s=i[1],a=i[2];n=function(t){var e=[0,1,2].map(function(e){return(1-t)*(1-t)*o[e]+2*(1-t)*t*s[e]+t*t*a[e]});return new S(e,"lab")}}else if(e.length===4){var h;r=e.map(function(e){return e.lab()}),o=r[0],s=r[1],a=r[2],h=r[3];n=function(t){var e=[0,1,2].map(function(e){return(1-t)*(1-t)*(1-t)*o[e]+3*(1-t)*(1-t)*t*s[e]+3*(1-t)*t*t*a[e]+t*t*t*h[e]});return new S(e,"lab")}}else if(e.length===5){var l=ki(e.slice(0,3));var c=ki(e.slice(2,5));n=function(e){if(e<.5){return l(e*2)}else{return c((e-.5)*2)}}}return n},Ui=function(e){var t=ki(e);return t.scale=function(){return Ni(t)},t},Vi=function(e,t,i){if(!Vi[i]){throw new Error("unknown blend mode "+i)}return Vi[i](e,t)},zi=function(n){return function(e,t){var i=O(t).rgb();var r=O(e).rgb();return O.rgb(n(i,r))}},ji=function(r){return function(e,t){var i=[];i[0]=r(e[0],t[0]);i[1]=r(e[1],t[1]);i[2]=r(e[2],t[2]);return i}},Wi=function(e){return e},Gi=function(e,t){return e*t/255},Hi=function(e,t){return e>t?t:e},Xi=function(e,t){return e>t?e:t},Ki=function(e,t){return 255*(1-(1-e/255)*(1-t/255))},Yi=function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))},qi=function(e,t){return 255*(1-(1-t/255)/(e/255))},Zi=function(e,t){if(e===255){return 255}e=255*(t/255)/(1-e/255);return e>255?255:e};Vi.normal=zi(ji(Wi)),Vi.multiply=zi(ji(Gi)),Vi.screen=zi(ji(Ki)),Vi.overlay=zi(ji(Yi)),Vi.darken=zi(ji(Hi)),Vi.lighten=zi(ji(Xi)),Vi.dodge=zi(ji(Zi)),Vi.burn=zi(ji(qi));for(var Qi=Vi,Ji=l.type,$i=l.clip_rgb,er=l.TWOPI,tr=Math.pow,ir=Math.sin,rr=Math.cos,nr=function(c,u,f,d,p){if(c===void 0)c=300;if(u===void 0)u=-1.5;if(f===void 0)f=1;if(d===void 0)d=1;if(p===void 0)p=[0,1];var _=0,g;if(Ji(p)==="array"){g=p[1]-p[0]}else{g=0;p=[p,p]}var t=function(e){var t=er*((c+120)/360+u*e);var i=tr(p[0]+g*e,d);var r=_!==0?f[0]+e*_:f;var n=r*i*(1-i)/2;var o=rr(t);var s=ir(t);var a=i+n*(-.14861*o+1.78277*s);var h=i+n*(-.29227*o-.90649*s);var l=i+n*(+1.97294*o);return O($i([a*255,h*255,l*255,1]))};return t.start=function(e){return null==e?c:(c=e,t)},t.rotations=function(e){return null==e?u:(u=e,t)},t.gamma=function(e){return null==e?d:(d=e,t)},t.hue=function(e){return null==e?f:("array"===Ji(f=e)?0===(_=f[1]-f[0])&&(f=f[1]):_=0,t)},t.lightness=function(e){return null==e?p:(g="array"===Ji(e)?(p=e)[1]-e[0]:(p=[e,e],0),t)},t.scale=function(){return O.scale(t)},t.hue(f),t},or="0123456789abcdef",sr=Math.floor,ar=Math.random,hr=function(){for(var e="#",t=0;t<6;t++){e+=or.charAt(sr(ar()*16))}return new S(e,"hex")},lr=Math.log,cr=Math.pow,ur=Math.floor,fr=Math.abs,dr=function(e,t){if(t===void 0)t=null;var i={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};if(j(e)==="object"){e=Object.values(e)}e.forEach(function(e){if(t&&j(e)==="object"){e=e[t]}if(e!==undefined&&e!==null&&!isNaN(e)){i.values.push(e);i.sum+=e;if(e<i.min){i.min=e}if(e>i.max){i.max=e}i.count+=1}});i.domain=[i.min,i.max];i.limits=function(e,t){return pr(i,e,t)};return i},pr=function(e,t,i){if(t===void 0)t="equal";if(i===void 0)i=7;if(j(e)=="array"){e=dr(e)}var r=e.min;var n=e.max;var o=e.values.sort(function(e,t){return e-t});if(i===1){return[r,n]}var s=[];if(t.substr(0,1)==="c"){s.push(r);s.push(n)}if(t.substr(0,1)==="e"){s.push(r);for(var a=1;a<i;a++){s.push(r+a/i*(n-r))}s.push(n)}else if(t.substr(0,1)==="l"){if(r<=0){throw new Error("Logarithmic scales are only possible for values > 0")}var h=Math.LOG10E*lr(r);var l=Math.LOG10E*lr(n);s.push(r);for(var c=1;c<i;c++){s.push(cr(10,h+c/i*(l-h)))}s.push(n)}else if(t.substr(0,1)==="q"){s.push(r);for(var u=1;u<i;u++){var f=(o.length-1)*u/i;var d=ur(f);if(d===f){s.push(o[d])}else{var p=f-d;s.push(o[d]*(1-p)+o[d+1]*p)}}s.push(n)}else if(t.substr(0,1)==="k"){var _;var g=o.length;var m=new Array(g);var v=new Array(i);var b=true;var y=0;var x=null;x=[];x.push(r);for(var T=1;T<i;T++){x.push(r+T/i*(n-r))}x.push(n);while(b){for(var M=0;M<i;M++){v[M]=0}for(var E=0;E<g;E++){var A=o[E];var O=Number.MAX_VALUE;var P=void 0;for(var C=0;C<i;C++){var S=fr(x[C]-A);if(S<O){O=S;P=C}v[P]++;m[E]=P}}var R=new Array(i);for(var I=0;I<i;I++){R[I]=null}for(var w=0;w<g;w++){_=m[w];if(R[_]===null){R[_]=o[w]}else{R[_]+=o[w]}}for(var D=0;D<i;D++){R[D]*=1/v[D]}b=false;for(var L=0;L<i;L++){if(R[L]!==x[L]){b=true;break}}x=R;y++;if(y>200){b=false}}var F={};for(var N=0;N<i;N++){F[N]=[]}for(var B=0;B<g;B++){_=m[B];F[_].push(o[B])}var k=[];for(var U=0;U<i;U++){k.push(F[U][0]);k.push(F[U][F[U].length-1])}k=k.sort(function(e,t){return e-t});s.push(k[0]);for(var V=1;V<k.length;V+=2){var z=k[V];if(!isNaN(z)&&s.indexOf(z)===-1){s.push(z)}}}return s},_r={analyze:dr,limits:pr},gr=function(e,t){e=new S(e),t=new S(t);var i=e.luminance(),r=t.luminance();return i>r?(i+.05)/(r+.05):(r+.05)/(i+.05)},mr=Math.sqrt,vr=Math.atan2,br=Math.abs,yr=Math.cos,xr=Math.PI,Tr=function(e,t,i,r){if(i===void 0)i=1;if(r===void 0)r=1;e=new S(e),t=new S(t);var n=Array.from(e.lab()),o=n[0],s=n[1],a=n[2],h=Array.from(t.lab()),l=h[0],c=h[1],u=h[2],f=mr(s*s+a*a),d=mr(c*c+u*u),p=o<16?.511:.040975*o/(1+.01765*o),_=.0638*f/(1+.0131*f)+.638,g=f<1e-6?0:vr(a,s)*180/xr;while(g<0){g+=360}while(g>=360){g-=360}var m=g>=164&&g<=345?.56+br(.2*yr(xr*(g+168)/180)):.36+br(.4*yr(xr*(g+35)/180)),v=f*f*f*f,b=mr(v/(v+1900)),y=_*(b*m+1-b),x,T=f-d,M=s-c,E=a-u,A,O=(o-l)/(i*p),P=T/(r*_),C=y;return mr(O*O+P*P+(M*M+E*E-T*T)/(y*y))},Mr=function(e,t,i){if(i===void 0)i="lab";e=new S(e),t=new S(t);var r=e.get(i),n=t.get(i),o=0;for(var s in r){var a=(r[s]||0)-(n[s]||0);o+=a*a}return Math.sqrt(o)},Er=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];try{new(Function.prototype.bind.apply(S,[null].concat(e)));return true}catch(e){return false}},Ar={cool:function e(){return Ni([O.hsl(180,1,.9),O.hsl(250,.7,.4)])},hot:function e(){return Ni(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")}},Or={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pr=0,Cr=Object.keys(Or);Pr<Cr.length;Pr+=1){var Sr=Cr[Pr];Or[Sr.toLowerCase()]=Or[Sr]}var Rr=Or,Ir;return O.average=function(e,o,s){if(o===void 0)o="lrgb";if(s===void 0)s=null;var t=e.length;if(!s){s=Array.from(new Array(t)).map(function(){return 1})}var i=t/s.reduce(function(e,t){return e+t});if(s.forEach(function(e,t){s[t]*=i}),e=e.map(function(e){return new S(e)}),o==="lrgb"){return Di(e,s)}for(var r=e.shift(),a=r.get(o),h=[],l=0,c=0,n=0;n<a.length;n++){a[n]=(a[n]||0)*s[0];h.push(isNaN(a[n])?0:s[0]);if(o.charAt(n)==="h"&&!isNaN(a[n])){var u=a[n]/180*Ci;l+=Si(u)*s[0];c+=Ri(u)*s[0]}}var f=r.alpha()*s[0];e.forEach(function(e,t){var i=e.get(o);f+=e.alpha()*s[t+1];for(var r=0;r<a.length;r++){if(!isNaN(i[r])){h[r]+=s[t+1];if(o.charAt(r)==="h"){var n=i[r]/180*Ci;l+=Si(n)*s[t+1];c+=Ri(n)*s[t+1]}else{a[r]+=i[r]*s[t+1]}}}});for(var d=0;d<a.length;d++){if(o.charAt(d)==="h"){var p=Ii(c/h[d],l/h[d])/Ci*180;while(p<0){p+=360}while(p>=360){p-=360}a[d]=p}else{a[d]=a[d]/h[d]}}return f/=t,new S(a,o).alpha(.99999<f?1:f,!0)},O.bezier=function(e){var t=ki(e);return t.scale=function(){return Ni(t)},t},O.blend=Qi,O.cubehelix=function(c,u,f,d,p){if(c===void 0)c=300;if(u===void 0)u=-1.5;if(f===void 0)f=1;if(d===void 0)d=1;if(p===void 0)p=[0,1];var _=0,g;if(Ji(p)==="array"){g=p[1]-p[0]}else{g=0;p=[p,p]}var t=function(e){var t=er*((c+120)/360+u*e);var i=tr(p[0]+g*e,d);var r=_!==0?f[0]+e*_:f;var n=r*i*(1-i)/2;var o=rr(t);var s=ir(t);var a=i+n*(-.14861*o+1.78277*s);var h=i+n*(-.29227*o-.90649*s);var l=i+n*(+1.97294*o);return O($i([a*255,h*255,l*255,1]))};return t.start=function(e){return null==e?c:(c=e,t)},t.rotations=function(e){return null==e?u:(u=e,t)},t.gamma=function(e){return null==e?d:(d=e,t)},t.hue=function(e){return null==e?f:("array"===Ji(f=e)?0===(_=f[1]-f[0])&&(f=f[1]):_=0,t)},t.lightness=function(e){return null==e?p:(g="array"===Ji(e)?(p=e)[1]-e[0]:(p=[e,e],0),t)},t.scale=function(){return O.scale(t)},t.hue(f),t},O.mix=O.interpolate=ui,O.random=function(){for(var e="#",t=0;t<6;t++){e+=or.charAt(sr(ar()*16))}return new S(e,"hex")},O.scale=Ni,O.analyze=_r.analyze,O.contrast=function(e,t){e=new S(e),t=new S(t);var i=e.luminance(),r=t.luminance();return i>r?(i+.05)/(r+.05):(r+.05)/(i+.05)},O.deltaE=function(e,t,i,r){if(i===void 0)i=1;if(r===void 0)r=1;e=new S(e),t=new S(t);var n=Array.from(e.lab()),o=n[0],s=n[1],a=n[2],h=Array.from(t.lab()),l=h[0],c=h[1],u=h[2],f=mr(s*s+a*a),d=mr(c*c+u*u),p=o<16?.511:.040975*o/(1+.01765*o),_=.0638*f/(1+.0131*f)+.638,g=f<1e-6?0:vr(a,s)*180/xr;while(g<0){g+=360}while(g>=360){g-=360}var m=g>=164&&g<=345?.56+br(.2*yr(xr*(g+168)/180)):.36+br(.4*yr(xr*(g+35)/180)),v=f*f*f*f,b=mr(v/(v+1900)),y=_*(b*m+1-b),x,T=f-d,M=s-c,E=a-u,A,O=(o-l)/(i*p),P=T/(r*_),C=y;return mr(O*O+P*P+(M*M+E*E-T*T)/(y*y))},O.distance=function(e,t,i){if(i===void 0)i="lab";e=new S(e),t=new S(t);var r=e.get(i),n=t.get(i),o=0;for(var s in r){var a=(r[s]||0)-(n[s]||0);o+=a*a}return Math.sqrt(o)},O.limits=_r.limits,O.valid=function(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];try{new(Function.prototype.bind.apply(S,[null].concat(e)));return true}catch(e){return false}},O.scales=Ar,O.colors=Bt,O.brewer=Rr,O}()},function(e,t,i){"use strict";i.r(t),i.d(t,"PlaneBuilder",function(){return s});var n=i(17),u=i(12);u.VertexData.CreatePlane=function(e){var t=[],i=[],r=[],n=[],o=e.width||e.size||1,s=e.height||e.size||1,a=0===e.sideOrientation?0:e.sideOrientation||u.VertexData.DEFAULTSIDE,h=o/2,l=s/2;i.push(-h,-l,0),r.push(0,0,-1),n.push(0,0),i.push(h,-l,0),r.push(0,0,-1),n.push(1,0),i.push(h,l,0),r.push(0,0,-1),n.push(1,1),i.push(-h,l,0),r.push(0,0,-1),n.push(0,1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),u.VertexData._ComputeSides(a,i,t,r,n,e.frontUVs,e.backUVs);var c=new u.VertexData;return c.indices=t,c.positions=i,c.normals=r,c.uvs=n,c},n.Mesh.CreatePlane=function(e,t,i,r,n){var o={size:t,width:t,height:t,sideOrientation:n,updatable:r};return s.CreatePlane(e,o,i)};var s=(r.CreatePlane=function(e,t,i){void 0===i&&(i=null);var r=new n.Mesh(e,i);return t.sideOrientation=n.Mesh._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,u.VertexData.CreatePlane(t).applyToMesh(r,t.updatable),t.sourcePlane&&(r.translate(t.sourcePlane.normal,-t.sourcePlane.d),r.setDirection(t.sourcePlane.normal.scale(-1))),r},r);function r(){}},function(e,t,i){"use strict";i.r(t),i.d(t,"DynamicTexture",function(){return a});var r=i(1),n=i(11),h=i(18),o=i(24),s=i(38);o.a.prototype.createDynamicTexture=function(e,t,i,r){var n=new s.a(this,s.b.Dynamic);return n.baseWidth=e,n.baseHeight=t,i&&(e=this.needPOTTextures?o.a.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?o.a.GetExponentOfTwo(t,this._caps.maxTextureSize):t),n.width=e,n.height=t,n.isReady=!1,n.generateMipMaps=i,n.samplingMode=r,this.updateTextureSamplingMode(r,n),this._internalTexturesCache.push(n),n},o.a.prototype.updateDynamicTexture=function(e,t,i,r,n,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,o),this._unpackFlipY(i),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var s=n?this._getInternalFormat(n):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,s,s,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}};var l,c=i(53),a=(l=h.a,Object(r.c)(u,l),u.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(u.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),u.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)},u.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},u.prototype.scaleTo=function(e,t){var i=this.getSize();i.width=e,i.height=t,this._recreate(i)},u.prototype.getContext=function(){return this._context},u.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},u.prototype.update=function(e,t){void 0===t&&(t=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0)},u.prototype.drawText=function(e,t,i,r,n,o,s,a){void 0===a&&(a=!0);var h=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,h.width,h.height)),this._context.font=r,null==t){var l=this._context.measureText(e);t=(h.width-l.width)/2}if(null==i){var c=parseInt(r.replace(/\D/g,""));i=h.height/2+c/3.65}this._context.fillStyle=n,this._context.fillText(e,t,i),a&&this.update(s)},u.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),i=new u(this.name,t,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i},u.prototype.serialize=function(){var e=this.getScene();e&&!e.isReady()&&n.a.Warn("The scene must be ready before serializing the dynamic texture");var t=l.prototype.serialize.call(this);return this._canvas.toDataURL&&(t.base64String=this._canvas.toDataURL()),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t},u.prototype._rebuild=function(){this.update()},u);function u(e,t,i,r,n,o){void 0===i&&(i=null),void 0===n&&(n=3),void 0===o&&(o=5);var s=l.call(this,null,i,!r,void 0,n,void 0,void 0,void 0,void 0,o)||this;s.name=e,s._engine=s.getScene().getEngine(),s.wrapU=h.a.CLAMP_ADDRESSMODE,s.wrapV=h.a.CLAMP_ADDRESSMODE,s._generateMipMaps=r,t.getContext?(s._canvas=t,s._texture=s._engine.createDynamicTexture(t.width,t.height,r,n)):(s._canvas=c.a.CreateCanvas(1,1),t.width||0===t.width?s._texture=s._engine.createDynamicTexture(t.width,t.height,r,n):s._texture=s._engine.createDynamicTexture(t,t,r,n));var a=s.getSize();return s._canvas.width=a.width,s._canvas.height=a.height,s._context=s._canvas.getContext("2d"),s}},function(e,t,i){"use strict";i.r(t),i.d(t,"BoxBuilder",function(){return s});var C=i(0),S=i(7),n=i(17),R=i(12);R.VertexData.CreateBox=function(e){var t,i=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],r=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[],o=e.width||e.size||1,s=e.height||e.size||1,a=e.depth||e.size||1,h=e.wrap||!1,l=void 0===e.topBaseAt?1:e.topBaseAt,c=void 0===e.bottomBaseAt?0:e.bottomBaseAt,u=[2,0,3,1][l=(l+4)%4],f=[2,0,1,3][c=(c+4)%4],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){i=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var p=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],_=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],g=[17,18,19,16],m=[22,23,20,21];0<u;)p.unshift(p.pop()),g.unshift(g.pop()),u--;for(;0<f;)_.unshift(_.pop()),m.unshift(m.pop()),f--;p=p.flat(),_=_.flat(),d=d.concat(p).concat(_),i.push(g[0],g[2],g[3],g[0],g[1],g[2]),i.push(m[0],m[2],m[3],m[0],m[1],m[2])}var v=[o/2,s/2,a/2];t=d.reduce(function(e,t,i){return e.concat(t*v[i%3])},[]);for(var b=0===e.sideOrientation?0:e.sideOrientation||R.VertexData.DEFAULTSIDE,y=e.faceUV||new Array(6),x=e.faceColors,T=[],M=0;M<6;M++)void 0===y[M]&&(y[M]=new C.f(0,0,1,1)),x&&void 0===x[M]&&(x[M]=new S.b(1,1,1,1));for(var E=0;E<6;E++)if(n.push(y[E].z,y[E].w),n.push(y[E].x,y[E].w),n.push(y[E].x,y[E].y),n.push(y[E].z,y[E].y),x)for(var A=0;A<4;A++)T.push(x[E].r,x[E].g,x[E].b,x[E].a);R.VertexData._ComputeSides(b,t,i,r,n,e.frontUVs,e.backUVs);var O=new R.VertexData;if(O.indices=i,O.positions=t,O.normals=r,O.uvs=n,x){var P=b===R.VertexData.DOUBLESIDE?T.concat(T):T;O.colors=P}return O},n.Mesh.CreateBox=function(e,t,i,r,n){void 0===i&&(i=null);var o={size:t,sideOrientation:n,updatable:r};return s.CreateBox(e,o,i)};var s=(r.CreateBox=function(e,t,i){void 0===i&&(i=null);var r=new n.Mesh(e,i);return t.sideOrientation=n.Mesh._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,R.VertexData.CreateBox(t).applyToMesh(r,t.updatable),r},r);function r(){}},function(e,t,i){"use strict";var r="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";var r="clipPlaneFragment",n="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nif (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nif (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";var r="bonesDeclaration",n="#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";var r="instancesDeclaration",n="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";var r="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";var r="instancesVertex",n="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";var r="bonesVertex",n="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";var r="clipPlaneVertex",n="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif";i(6).a.IncludesShadersStore[r]=n},function(e,t,i){"use strict";i.r(t),i.d(t,"Button",function(){return Ue}),i.d(t,"Checkbox",function(){return E}),i.d(t,"ColorPicker",function(){return D}),i.d(t,"Container",function(){return c.a}),i.d(t,"Control",function(){return Be.a}),i.d(t,"Ellipse",function(){return F}),i.d(t,"Grid",function(){return ze}),i.d(t,"Image",function(){return g}),i.d(t,"InputText",function(){return Ve}),i.d(t,"InputPassword",function(){return k}),i.d(t,"Line",function(){return j}),i.d(t,"MultiLine",function(){return Y}),i.d(t,"RadioButton",function(){return Q}),i.d(t,"StackPanel",function(){return x}),i.d(t,"SelectorGroup",function(){return oe}),i.d(t,"CheckboxGroup",function(){return he}),i.d(t,"RadioGroup",function(){return ue}),i.d(t,"SliderGroup",function(){return pe}),i.d(t,"SelectionPanel",function(){return me}),i.d(t,"ScrollViewer",function(){return Re}),i.d(t,"TextWrapping",function(){return u}),i.d(t,"TextBlock",function(){return ke}),i.d(t,"KeyPropertySet",function(){return De}),i.d(t,"VirtualKeyboard",function(){return Le}),i.d(t,"Rectangle",function(){return Ne}),i.d(t,"DisplayGrid",function(){return He}),i.d(t,"BaseSlider",function(){return ee}),i.d(t,"Slider",function(){return re}),i.d(t,"ImageBasedSlider",function(){return Ye}),i.d(t,"ScrollBar",function(){return Ee}),i.d(t,"ImageScrollBar",function(){return Pe}),i.d(t,"name",function(){return Ze});var r,n=i(1),c=i(31),o=i(10),Ne=(r=c.a,Object(n.c)(s,r),Object.defineProperty(s.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"cornerRadius",{get:function(){return this._cornerRadius},set:function(e){e<0&&(e=0),this._cornerRadius!==e&&(this._cornerRadius=e,this._markAsDirty())},enumerable:!0,configurable:!0}),s.prototype._getTypeName=function(){return"Rectangle"},s.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._background&&(e.fillStyle=this._background,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},s.prototype._additionalProcessing=function(e,t){r.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},s.prototype._drawRoundedRect=function(e,t){void 0===t&&(t=0);var i=this._currentMeasure.left+t,r=this._currentMeasure.top+t,n=this._currentMeasure.width-2*t,o=this._currentMeasure.height-2*t,s=Math.min(o/2-2,Math.min(n/2-2,this._cornerRadius));e.beginPath(),e.moveTo(i+s,r),e.lineTo(i+n-s,r),e.quadraticCurveTo(i+n,r,i+n,r+s),e.lineTo(i+n,r+o-s),e.quadraticCurveTo(i+n,r+o,i+n-s,r+o),e.lineTo(i+s,r+o),e.quadraticCurveTo(i,r+o,i,r+o-s),e.lineTo(i,r+s),e.quadraticCurveTo(i,r,i+s,r),e.closePath()},s.prototype._clipForChildren=function(e){this._cornerRadius&&(this._drawRoundedRect(e,this._thickness),e.clip())},s);function s(e){var t=r.call(this,e)||this;return t.name=e,t._thickness=1,t._cornerRadius=0,t}o.a.RegisteredTypes["BABYLON.GUI.Rectangle"]=Ne;var u,a,Be=i(5),h=i(4),l=i(14);(a=u=u||{})[a.Clip=0]="Clip",a[a.WordWrap=1]="WordWrap",a[a.Ellipsis=2]="Ellipsis";var f,ke=(f=Be.a,Object(n.c)(d,f),Object.defineProperty(d.prototype,"lines",{get:function(){return this._lines},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(e){this._lineSpacing.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),d.prototype._getTypeName=function(){return"TextBlock"},d.prototype._processMeasures=function(e,t){this._fontOffset||(this._fontOffset=Be.a._GetFontOffset(t.font)),f.prototype._processMeasures.call(this,e,t),this._lines=this._breakLines(this._currentMeasure.width,t),this.onLinesReadyObservable.notifyObservers(this);for(var i=0,r=0;r<this._lines.length;r++){var n=this._lines[r];n.width>i&&(i=n.width)}if(this._resizeToFit){if(this._textWrapping===u.Clip){var o=this.paddingLeftInPixels+this.paddingRightInPixels+i;o!==this._width.internalValue&&(this._width.updateInPlace(o,l.a.UNITMODE_PIXEL),this._rebuildLayout=!0)}var s=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length;if(0<this._lines.length&&0!==this._lineSpacing.internalValue){var a=0;a=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),s+=(this._lines.length-1)*a}s!==this._height.internalValue&&(this._height.updateInPlace(s,l.a.UNITMODE_PIXEL),this._rebuildLayout=!0)}},d.prototype._drawText=function(e,t,i,r){var n=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case Be.a.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case Be.a.HORIZONTAL_ALIGNMENT_RIGHT:o=n-t;break;case Be.a.HORIZONTAL_ALIGNMENT_CENTER:o=(n-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&r.strokeText(e,this._currentMeasure.left+o,i),r.fillText(e,this._currentMeasure.left+o,i)},d.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._renderLines(e),e.restore()},d.prototype._applyStates=function(e){f.prototype._applyStates.call(this,e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor)},d.prototype._breakLines=function(e,t){var i=[],r=this.text.split("\n");if(this._textWrapping===u.Ellipsis)for(var n=0,o=r;n<o.length;n++){var s=o[n];i.push(this._parseLineEllipsis(s,e,t))}else if(this._textWrapping===u.WordWrap)for(var a=0,h=r;a<h.length;a++)s=h[a],i.push.apply(i,this._parseLineWordWrap(s,e,t));else for(var l=0,c=r;l<c.length;l++)s=c[l],i.push(this._parseLine(s,t));return i},d.prototype._parseLine=function(e,t){return void 0===e&&(e=""),{text:e,width:t.measureText(e).width}},d.prototype._parseLineEllipsis=function(e,t,i){void 0===e&&(e="");var r=i.measureText(e).width;for(t<r&&(e+="…");2<e.length&&t<r;)e=e.slice(0,-2)+"…",r=i.measureText(e).width;return{text:e,width:r}},d.prototype._parseLineWordWrap=function(e,t,i){void 0===e&&(e="");for(var r=[],n=e.split(" "),o=0,s=0;s<n.length;s++){var a=0<s?e+" "+n[s]:n[0],h=i.measureText(a).width;t<h&&0<s?(r.push({text:e,width:o}),e=n[s],o=i.measureText(e).width):(o=h,e=a)}return r.push({text:e,width:o}),r},d.prototype._renderLines=function(e){var t=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case Be.a.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case Be.a.VERTICAL_ALIGNMENT_BOTTOM:i=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case Be.a.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(var r=0;r<this._lines.length;r++){var n=this._lines[r];0!==r&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(n.text,n.width,i,e),i+=this._fontOffset.height}},d.prototype.computeExpectedHeight=function(){if(this.text&&this.widthInPixels){var e=document.createElement("canvas").getContext("2d");if(e){this._applyStates(e),this._fontOffset||(this._fontOffset=Be.a._GetFontOffset(e.font));var t=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,e),i=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*t.length;if(0<t.length&&0!==this._lineSpacing.internalValue){var r=0;r=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),i+=(t.length-1)*r}return i}}return 0},d.prototype.dispose=function(){f.prototype.dispose.call(this),this.onTextChangedObservable.clear()},d);function d(e,t){void 0===t&&(t="");var i=f.call(this,e)||this;return i.name=e,i._text="",i._textWrapping=u.Clip,i._textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_CENTER,i._textVerticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,i._resizeToFit=!1,i._lineSpacing=new l.a(0),i._outlineWidth=0,i._outlineColor="white",i.onTextChangedObservable=new h.a,i.onLinesReadyObservable=new h.a,i.text=t,i}o.a.RegisteredTypes["BABYLON.GUI.TextBlock"]=ke;var p,_=i(13),g=(p=Be.a,Object(n.c)(m,p),Object.defineProperty(m.prototype,"isLoaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"populateNinePatchSlicesFromImage",{get:function(){return this._populateNinePatchSlicesFromImage},set:function(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"detectPointerOnOpaqueOnly",{get:function(){return this._detectPointerOnOpaqueOnly},set:function(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sliceLeft",{get:function(){return this._sliceLeft},set:function(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sliceRight",{get:function(){return this._sliceRight},set:function(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sliceTop",{get:function(){return this._sliceTop},set:function(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sliceBottom",{get:function(){return this._sliceBottom},set:function(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sourceLeft",{get:function(){return this._sourceLeft},set:function(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sourceTop",{get:function(){return this._sourceTop},set:function(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sourceWidth",{get:function(){return this._sourceWidth},set:function(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"sourceHeight",{get:function(){return this._sourceHeight},set:function(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isSVG",{get:function(){return this._isSVG},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"svgAttributesComputationCompleted",{get:function(){return this._svgAttributesComputationCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"autoScale",{get:function(){return this._autoScale},set:function(e){this._autoScale!==e&&(this._autoScale=e)&&this._loaded&&this.synchronizeSizeWithContent()},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"stretch",{get:function(){return this._stretch},set:function(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())},enumerable:!0,configurable:!0}),m.prototype._rotate90=function(e,t){void 0===t&&(t=!1);var i=document.createElement("canvas"),r=i.getContext("2d"),n=this._domImage.width,o=this._domImage.height;i.width=o,i.height=n,r.translate(i.width/2,i.height/2),r.rotate(e*Math.PI/2),r.drawImage(this._domImage,0,0,n,o,-n/2,-o/2,n,o);var s=i.toDataURL("image/jpg"),a=new m(this.name+"rotated",s);return t&&(a._stretch=this._stretch,a._autoScale=this._autoScale,a._cellId=this._cellId,a._cellWidth=e%1?this._cellHeight:this._cellWidth,a._cellHeight=e%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,a,e),a},m.prototype._handleRotationForSVGImage=function(e,t,i){var r=this;e._isSVG&&(e._svgAttributesComputationCompleted?(this._rotate90SourceProperties(e,t,i),this._markAsDirty()):e.onSVGAttributesComputedObservable.addOnce(function(){r._rotate90SourceProperties(e,t,i),r._markAsDirty()}))},m.prototype._rotate90SourceProperties=function(e,t,i){var r,n,o=e.sourceLeft,s=e.sourceTop,a=e.domImage.width,h=e.domImage.height,l=o,c=s,u=e.sourceWidth,f=e.sourceHeight;if(0!=i){var d=i<0?-1:1;i%=4;for(var p=0;p<Math.abs(i);++p)l=-(s-h/2)*d+h/2,c=(o-a/2)*d+a/2,u=(r=[f,u])[0],f=r[1],i<0?c-=f:l-=u,o=l,s=c,a=(n=[h,a])[0],h=n[1]}t.sourceLeft=l,t.sourceTop=c,t.sourceWidth=u,t.sourceHeight=f},Object.defineProperty(m.prototype,"domImage",{get:function(){return this._domImage},set:function(e){var t=this;this._domImage=e,this._loaded=!1,this._domImage.width?this._onImageLoaded():this._domImage.onload=function(){t._onImageLoaded()}},enumerable:!0,configurable:!0}),m.prototype._onImageLoaded=function(){this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()},m.prototype._extractNinePatchSliceDataFromImage=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"));var e=this._workingCanvas,t=e.getContext("2d"),i=this._domImage.width,r=this._domImage.height;e.width=i,e.height=r,t.drawImage(this._domImage,0,0,i,r);var n=t.getImageData(0,0,i,r);this._sliceLeft=-1,this._sliceRight=-1;for(var o=0;o<i;o++)if(127<(a=n.data[4*o+3])&&-1===this._sliceLeft)this._sliceLeft=o;else if(a<127&&-1<this._sliceLeft){this._sliceRight=o;break}this._sliceTop=-1,this._sliceBottom=-1;for(var s=0;s<r;s++){var a;if(127<(a=n.data[s*i*4+3])&&-1===this._sliceTop)this._sliceTop=s;else if(a<127&&-1<this._sliceTop){this._sliceBottom=s;break}}},Object.defineProperty(m.prototype,"source",{set:function(e){var t=this;this._source!==e&&(this._loaded=!1,e=(this._source=e)&&this._svgCheck(e),this._domImage=document.createElement("img"),this._domImage.onload=function(){t._onImageLoaded()},e&&(_.b.SetCorsBehavior(e,this._domImage),this._domImage.src=e))},enumerable:!0,configurable:!0}),m.prototype._svgCheck=function(e){var t=this;if(window.SVGSVGElement&&-1!==e.search(/.svg#/gi)&&e.indexOf("#")===e.lastIndexOf("#")){this._isSVG=!0;var i=e.split("#")[0],r=e.split("#")[1],n=document.body.querySelector('object[data="'+i+'"]');if(n){var o=n.contentDocument;if(o&&o.documentElement){var s=o.documentElement.getAttribute("viewBox"),a=Number(o.documentElement.getAttribute("width")),h=Number(o.documentElement.getAttribute("height"));if(o.getElementById(r)&&s&&a&&h)return this._getSVGAttribs(n,r),e}n.addEventListener("load",function(){t._getSVGAttribs(n,r)})}else{var l=document.createElement("object");l.data=i,l.type="image/svg+xml",l.width="0%",l.height="0%",document.body.appendChild(l),l.onload=function(){var e=document.body.querySelector('object[data="'+i+'"]');e&&t._getSVGAttribs(e,r)}}return i}return e},m.prototype._getSVGAttribs=function(e,t){var i=e.contentDocument;if(i&&i.documentElement){var r=i.documentElement.getAttribute("viewBox"),n=Number(i.documentElement.getAttribute("width")),o=Number(i.documentElement.getAttribute("height")),s=i.getElementById(t);if(r&&n&&o&&s){var a=Number(r.split(" ")[2]),h=Number(r.split(" ")[3]),l=s.getBBox(),c=1,u=1,f=0,d=0;s.transform&&s.transform.baseVal.consolidate()&&(c=s.transform.baseVal.consolidate().matrix.a,u=s.transform.baseVal.consolidate().matrix.d,f=s.transform.baseVal.consolidate().matrix.e,d=s.transform.baseVal.consolidate().matrix.f),this.sourceLeft=(c*l.x+f)*n/a,this.sourceTop=(u*l.y+d)*o/h,this.sourceWidth=l.width*c*(n/a),this.sourceHeight=l.height*u*(o/h),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}},Object.defineProperty(m.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"cellId",{get:function(){return this._cellId},set:function(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())},enumerable:!0,configurable:!0}),m.prototype.contains=function(e,t){if(!p.prototype.contains.call(this,e,t))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;var i=this._workingCanvas.getContext("2d"),r=0|this._currentMeasure.width,n=0|this._currentMeasure.height;return 0<i.getImageData(0,0,r,n).data[4*((e=e-this._currentMeasure.left|0)+(t=t-this._currentMeasure.top|0)*this._currentMeasure.width)+3]},m.prototype._getTypeName=function(){return"Image"},m.prototype.synchronizeSizeWithContent=function(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")},m.prototype._processMeasures=function(e,t){if(this._loaded)switch(this._stretch){case m.STRETCH_NONE:case m.STRETCH_FILL:case m.STRETCH_UNIFORM:case m.STRETCH_NINE_PATCH:break;case m.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}p.prototype._processMeasures.call(this,e,t)},m.prototype._prepareWorkingCanvasForOpaqueDetection=function(){if(this._detectPointerOnOpaqueOnly){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"));var e=this._workingCanvas,t=this._currentMeasure.width,i=this._currentMeasure.height,r=e.getContext("2d");e.width=t,e.height=i,r.clearRect(0,0,t,i)}},m.prototype._drawImage=function(e,t,i,r,n,o,s,a,h){e.drawImage(this._domImage,t,i,r,n,o,s,a,h),this._detectPointerOnOpaqueOnly&&(e=this._workingCanvas.getContext("2d")).drawImage(this._domImage,t,i,r,n,o-this._currentMeasure.left,s-this._currentMeasure.top,a,h)},m.prototype._draw=function(e){var t,i,r,n;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)t=this._sourceLeft,i=this._sourceTop,r=this._sourceWidth?this._sourceWidth:this._imageWidth,n=this._sourceHeight?this._sourceHeight:this._imageHeight;else{var o=this._domImage.naturalWidth/this.cellWidth,s=this.cellId/o>>0,a=this.cellId%o;t=this.cellWidth*a,i=this.cellHeight*s,r=this.cellWidth,n=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case m.STRETCH_NONE:case m.STRETCH_FILL:this._drawImage(e,t,i,r,n,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case m.STRETCH_UNIFORM:var h=this._currentMeasure.width/r,l=this._currentMeasure.height/n,c=Math.min(h,l),u=(this._currentMeasure.width-r*c)/2,f=(this._currentMeasure.height-n*c)/2;this._drawImage(e,t,i,r,n,this._currentMeasure.left+u,this._currentMeasure.top+f,r*c,n*c);break;case m.STRETCH_EXTEND:this._drawImage(e,t,i,r,n,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case m.STRETCH_NINE_PATCH:this._renderNinePatch(e)}e.restore()},m.prototype._renderCornerPatch=function(e,t,i,r,n,o,s){this._drawImage(e,t,i,r,n,this._currentMeasure.left+o,this._currentMeasure.top+s,r,n)},m.prototype._renderNinePatch=function(e){var t=this._imageHeight,i=this._sliceLeft,r=this._sliceTop,n=this._imageHeight-this._sliceBottom,o=this._imageWidth-this._sliceRight,s=0,a=0;this._populateNinePatchSlicesFromImage&&(a=s=1,t-=2,--i,--r,--n,--o);var h=this._sliceRight-this._sliceLeft,l=this._currentMeasure.width-o-this.sliceLeft,c=this._currentMeasure.height-t+this._sliceBottom;this._renderCornerPatch(e,s,a,i,r,0,0),this._renderCornerPatch(e,s,this._sliceBottom,i,t-this._sliceBottom,0,c),this._renderCornerPatch(e,this._sliceRight,a,o,r,this._currentMeasure.width-o,0),this._renderCornerPatch(e,this._sliceRight,this._sliceBottom,o,t-this._sliceBottom,this._currentMeasure.width-o,c),this._drawImage(e,this._sliceLeft,this._sliceTop,h,this._sliceBottom-this._sliceTop,this._currentMeasure.left+i,this._currentMeasure.top+r,l,c-r),this._drawImage(e,s,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left,this._currentMeasure.top+r,i,c-r),this._drawImage(e,this._sliceRight,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left+this._currentMeasure.width-o,this._currentMeasure.top+r,i,c-r),this._drawImage(e,this._sliceLeft,a,h,r,this._currentMeasure.left+i,this._currentMeasure.top,l,r),this._drawImage(e,this._sliceLeft,this._sliceBottom,h,n,this._currentMeasure.left+i,this._currentMeasure.top+c,l,n)},m.prototype.dispose=function(){p.prototype.dispose.call(this),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear()},m.STRETCH_NONE=0,m.STRETCH_FILL=1,m.STRETCH_UNIFORM=2,m.STRETCH_EXTEND=3,m.STRETCH_NINE_PATCH=4,m);function m(e,t){void 0===t&&(t=null);var i=p.call(this,e)||this;return i.name=e,i._workingCanvas=null,i._loaded=!1,i._stretch=m.STRETCH_FILL,i._autoScale=!1,i._sourceLeft=0,i._sourceTop=0,i._sourceWidth=0,i._sourceHeight=0,i._svgAttributesComputationCompleted=!1,i._isSVG=!1,i._cellWidth=0,i._cellHeight=0,i._cellId=-1,i._populateNinePatchSlicesFromImage=!1,i.onImageLoadedObservable=new h.a,i.onSVGAttributesComputedObservable=new h.a,i.source=t,i}o.a.RegisteredTypes["BABYLON.GUI.Image"]=g;var v,Ue=(v=Ne,Object(n.c)(b,v),Object.defineProperty(b.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!0,configurable:!0}),b.prototype._getTypeName=function(){return"Button"},b.prototype._processPicking=function(e,t,i,r,n,o,s){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!v.prototype.contains.call(this,e,t))return!1;if(this.delegatePickingToChildren){for(var a=!1,h=this._children.length-1;0<=h;h--){var l=this._children[h];if(l.isEnabled&&l.isHitTestVisible&&l.isVisible&&!l.notRenderable&&l.contains(e,t)){a=!0;break}}if(!a)return!1}return this._processObservables(i,e,t,r,n,o,s),!0},b.prototype._onPointerEnter=function(e){return!!v.prototype._onPointerEnter.call(this,e)&&(this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},b.prototype._onPointerOut=function(e,t){void 0===t&&(t=!1),this.pointerOutAnimation&&this.pointerOutAnimation(),v.prototype._onPointerOut.call(this,e,t)},b.prototype._onPointerDown=function(e,t,i,r){return!!v.prototype._onPointerDown.call(this,e,t,i,r)&&(this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},b.prototype._onPointerUp=function(e,t,i,r,n){this.pointerUpAnimation&&this.pointerUpAnimation(),v.prototype._onPointerUp.call(this,e,t,i,r,n)},b.CreateImageButton=function(e,t,i){var r=new b(e),n=new ke(e+"_button",t);n.textWrapping=!0,n.textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_CENTER,n.paddingLeft="20%",r.addControl(n);var o=new g(e+"_icon",i);return o.width="20%",o.stretch=g.STRETCH_UNIFORM,o.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(o),r._image=o,r._textBlock=n,r},b.CreateImageOnlyButton=function(e,t){var i=new b(e),r=new g(e+"_icon",t);return r.stretch=g.STRETCH_FILL,r.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(r),i._image=r,i},b.CreateSimpleButton=function(e,t){var i=new b(e),r=new ke(e+"_button",t);return r.textWrapping=!0,r.textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(r),i._textBlock=r,i},b.CreateImageWithCenterTextButton=function(e,t,i){var r=new b(e),n=new g(e+"_icon",i);n.stretch=g.STRETCH_FILL,r.addControl(n);var o=new ke(e+"_button",t);return o.textWrapping=!0,o.textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_CENTER,r.addControl(o),r._image=n,r._textBlock=o,r},b);function b(e){var t=v.call(this,e)||this;t.name=e,t.delegatePickingToChildren=!1,t.thickness=1,t.isPointerBlocker=!0;var i=null;return t.pointerEnterAnimation=function(){i=t.alpha,t.alpha-=.1},t.pointerOutAnimation=function(){null!==i&&(t.alpha=i)},t.pointerDownAnimation=function(){t.scaleX-=.05,t.scaleY-=.05},t.pointerUpAnimation=function(){t.scaleX+=.05,t.scaleY+=.05},t}o.a.RegisteredTypes["BABYLON.GUI.Button"]=Ue;var y,x=(y=c.a,Object(n.c)(T,y),Object.defineProperty(T.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),T.prototype._getTypeName=function(){return"StackPanel"},T.prototype._preMeasure=function(e,t){for(var i=0,r=this._children;i<r.length;i++){var n=r[i];this._isVertical?n.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP:n.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT}y.prototype._preMeasure.call(this,e,t)},T.prototype._additionalProcessing=function(e,t){y.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.copyFrom(e),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)},T.prototype._postMeasure=function(){for(var e=0,t=0,i=0,r=this._children;i<r.length;i++){var n=r[i];n.isVisible&&!n.notRenderable&&(this._isVertical?(n.top!==t+"px"&&(n.top=t+"px",this._rebuildLayout=!0,n._top.ignoreAdaptiveScaling=!0),n._height.isPercentage&&!n._automaticSize?this.ignoreLayoutWarnings||_.b.Warn("Control (Name:"+n.name+", UniqueId:"+n.uniqueId+") is using height in percentage mode inside a vertical StackPanel"):t+=n._currentMeasure.height+n.paddingTopInPixels+n.paddingBottomInPixels):(n.left!==e+"px"&&(n.left=e+"px",this._rebuildLayout=!0,n._left.ignoreAdaptiveScaling=!0),n._width.isPercentage&&!n._automaticSize?this.ignoreLayoutWarnings||_.b.Warn("Control (Name:"+n.name+", UniqueId:"+n.uniqueId+") is using width in percentage mode inside a horizontal StackPanel"):e+=n._currentMeasure.width+n.paddingLeftInPixels+n.paddingRightInPixels))}var o=!(this._doNotTrackManualChanges=!0),s=!1;if(!this._manualHeight&&this._isVertical){var a=this.height;this.height=t+"px",s=a!==this.height||!this._height.ignoreAdaptiveScaling}if(!this._manualWidth&&!this._isVertical){var h=this.width;this.width=e+"px",o=h!==this.width||!this._width.ignoreAdaptiveScaling}s&&(this._height.ignoreAdaptiveScaling=!0),o&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(o||s)&&(this._rebuildLayout=!0),y.prototype._postMeasure.call(this)},T);function T(e){var t=y.call(this,e)||this;return t.name=e,t._isVertical=!0,t._manualWidth=!1,t._manualHeight=!1,t._doNotTrackManualChanges=!1,t.ignoreLayoutWarnings=!1,t}o.a.RegisteredTypes["BABYLON.GUI.StackPanel"]=x;var M,E=(M=Be.a,Object(n.c)(A,M),Object.defineProperty(A.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e))},enumerable:!0,configurable:!0}),A.prototype._getTypeName=function(){return"Checkbox"},A.prototype._draw=function(e,t){e.save(),this._applyStates(e);var i=this._currentMeasure.width-this._thickness,r=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColorItem;var n=i*this._checkSizeRatio,o=r*this._checkSizeRatio;e.fillRect(this._currentMeasure.left+this._thickness/2+(i-n)/2,this._currentMeasure.top+this._thickness/2+(r-o)/2,n,o)}e.strokeStyle=this.color,e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,r),e.restore()},A.prototype._onPointerDown=function(e,t,i,r){return!!M.prototype._onPointerDown.call(this,e,t,i,r)&&(this.isChecked=!this.isChecked,!0)},A.AddCheckBoxWithHeader=function(e,t){var i=new x;i.isVertical=!1,i.height="30px";var r=new A;r.width="20px",r.height="20px",r.isChecked=!0,r.color="green",r.onIsCheckedChangedObservable.add(t),i.addControl(r);var n=new ke;return n.text=e,n.width="180px",n.paddingLeft="5px",n.textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,n.color="white",i.addControl(n),i},A);function A(e){var t=M.call(this,e)||this;return t.name=e,t._isChecked=!1,t._background="black",t._checkSizeRatio=.8,t._thickness=1,t.onIsCheckedChangedObservable=new h.a,t.isPointerBlocker=!0,t}o.a.RegisteredTypes["BABYLON.GUI.Checkbox"]=E;var O,P=i(45),C=i(9),Ve=(O=Be.a,Object(n.c)(S,O),Object.defineProperty(S.prototype,"maxWidth",{get:function(){return this._maxWidth.toString(this._host)},set:function(e){this._maxWidth.toString(this._host)!==e&&this._maxWidth.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"maxWidthInPixels",{get:function(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"highligherOpacity",{get:function(){return this._highligherOpacity},set:function(e){this._highligherOpacity!==e&&(this._highligherOpacity=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"onFocusSelectAll",{get:function(){return this._onFocusSelectAll},set:function(e){this._onFocusSelectAll!==e&&(this._onFocusSelectAll=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"textHighlightColor",{get:function(){return this._textHighlightColor},set:function(e){this._textHighlightColor!==e&&(this._textHighlightColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"margin",{get:function(){return this._margin.toString(this._host)},set:function(e){this._margin.toString(this._host)!==e&&this._margin.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"marginInPixels",{get:function(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"autoStretchWidth",{get:function(){return this._autoStretchWidth},set:function(e){this._autoStretchWidth!==e&&(this._autoStretchWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"focusedBackground",{get:function(){return this._focusedBackground},set:function(e){this._focusedBackground!==e&&(this._focusedBackground=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"focusedColor",{get:function(){return this._focusedColor},set:function(e){this._focusedColor!==e&&(this._focusedColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"placeholderColor",{get:function(){return this._placeholderColor},set:function(e){this._placeholderColor!==e&&(this._placeholderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"placeholderText",{get:function(){return this._placeholderText},set:function(e){this._placeholderText!==e&&(this._placeholderText=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"deadKey",{get:function(){return this._deadKey},set:function(e){this._deadKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"highlightedText",{get:function(){return this._highlightedText},set:function(e){this._highlightedText!==e&&(this._highlightedText=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"addKey",{get:function(){return this._addKey},set:function(e){this._addKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"currentKey",{get:function(){return this._currentKey},set:function(e){this._currentKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"text",{get:function(){return this._text},set:function(e){var t=e.toString();this._text!==t&&(this._text=t,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&(this._width.fromString(e)&&this._markAsDirty(),this.autoStretchWidth=!1)},enumerable:!0,configurable:!0}),S.prototype.onBlur=function(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);var e=this._host.getScene();this._onPointerDblTapObserver&&e&&e.onPointerObservable.remove(this._onPointerDblTapObserver)},S.prototype.onFocus=function(){var t=this;if(this._isEnabled){if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),-1!==navigator.userAgent.indexOf("Mobile")&&!this.disableMobilePrompt){var e=prompt(this.promptMessage);return null!==e&&(this.text=e),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add(function(e){switch(e.type){case P.a.COPY:t._onCopyText(e.event),t.onTextCopyObservable.notifyObservers(t);break;case P.a.CUT:t._onCutText(e.event),t.onTextCutObservable.notifyObservers(t);break;case P.a.PASTE:t._onPasteText(e.event),t.onTextPasteObservable.notifyObservers(t);break;default:return}});var i=this._host.getScene();i&&(this._onPointerDblTapObserver=i.onPointerObservable.add(function(e){t._isFocused&&e.type===C.a.POINTERDOUBLETAP&&t._processDblClick(e)})),this._onFocusSelectAll&&this._selectAllText()}},S.prototype._getTypeName=function(){return"InputText"},S.prototype.keepsFocusWith=function(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null},S.prototype.processKey=function(e,t,i){if(!i||!i.ctrlKey&&!i.metaKey||67!==e&&86!==e&&88!==e){if(i&&(i.ctrlKey||i.metaKey)&&65===e)return this._selectAllText(),void i.preventDefault();switch(e){case 32:t=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._text&&0<this._text.length){if(this._isTextHighlightOn)return this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());0===this._cursorOffset?this.text=this._text.substr(0,this._text.length-1):0<(n=this._text.length-this._cursorOffset)&&(this.text=this._text.slice(0,n-1)+this._text.slice(n))}return void(i&&i.preventDefault());case 46:if(this._isTextHighlightOn){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex);for(var r=this._endHighlightIndex-this._startHighlightIndex;0<r&&0<this._cursorOffset;)this._cursorOffset--;return this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,void(i&&i.preventDefault())}if(this._text&&0<this._text.length&&0<this._cursorOffset){var n=this._text.length-this._cursorOffset;this.text=this._text.slice(0,n)+this._text.slice(n+1),this._cursorOffset--}return void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this._isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._text.length&&(this._cursorOffset=this._text.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(this._text.length===this._cursorOffset)return;this._endHighlightIndex=this._text.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=this._text.length,this._isTextHighlightOn=!0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._text.length:this._text.length-this._startHighlightIndex+1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._text.length?this._text.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._startHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this.text.length,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._text.length-this._cursorOffset-1}return this._endHighlightIndex=this._text.length,this._isTextHighlightOn=!0,this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=this._text.length===this._endHighlightIndex?0:this._text.length-this._endHighlightIndex-1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._endHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 222:i&&i.preventDefault(),this._cursorIndex=-1,this.deadKey=!0}if(t&&(-1===e||32===e||47<e&&e<64||64<e&&e<91||159<e&&e<193||218<e&&e<223||95<e&&e<112)&&(this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey))if(this._isTextHighlightOn)this.text=this._text.slice(0,this._startHighlightIndex)+t+this._text.slice(this._endHighlightIndex),this._cursorOffset=this.text.length-(this._startHighlightIndex+1),this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=t;else{var o=this._text.length-this._cursorOffset;this.text=this._text.slice(0,o)+t+this._text.slice(o)}}},S.prototype._updateValueFromCursorIndex=function(e){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=e;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this._isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex}this._isTextHighlightOn=!0,this._markAsDirty()},S.prototype._processDblClick=function(e){this._startHighlightIndex=this._text.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;for(var t,i=/\w+/g;t=this._endHighlightIndex<this._text.length&&-1!==this._text[this._endHighlightIndex].search(i)?++this._endHighlightIndex:0,0<this._startHighlightIndex&&-1!==this._text[this._startHighlightIndex-1].search(i)&&--this._startHighlightIndex||t;);this._cursorOffset=this.text.length-this._startHighlightIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()},S.prototype._selectAllText=function(){this._blinkIsEven=!0,this._isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._text.length,this._cursorOffset=this._text.length,this._cursorIndex=-1,this._markAsDirty()},S.prototype.processKeyboard=function(e){this.processKey(e.keyCode,e.key,e),this.onKeyboardEventProcessedObservable.notifyObservers(e)},S.prototype._onCopyText=function(e){this._isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText},S.prototype._onCutText=function(e){if(this._highlightedText){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}},S.prototype._onPasteText=function(e){var t="";t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData;var i=this._text.length-this._cursorOffset;this.text=this._text.slice(0,i)+t+this._text.slice(i)},S.prototype._draw=function(e,t){var i=this;e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._fontOffset||(this._fontOffset=Be.a._GetFontOffset(e.font));var r=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(e.fillStyle=this.color);var n=this._beforeRenderText(this._text);this._isFocused||this._text||!this._placeholderText||(n=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(n).width;var o=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+o)+"px");var s=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,a=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-o;if(e.save(),e.beginPath(),e.rect(r,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2+a,this._currentMeasure.height),e.clip(),this._isFocused&&this._textWidth>a){var h=r-this._textWidth+a;this._scrollLeft||(this._scrollLeft=h)}else this._scrollLeft=r;if(e.fillText(n,this._scrollLeft,this._currentMeasure.top+s),this._isFocused){if(this._clickedCoordinate){for(var l=this._scrollLeft+this._textWidth-this._clickedCoordinate,c=0,u=this._cursorOffset=0;this._cursorOffset&&(u=Math.abs(l-c)),this._cursorOffset++,(c=e.measureText(n.substr(n.length-this._cursorOffset,this._cursorOffset)).width)<l&&n.length>=this._cursorOffset;);Math.abs(l-c)>u&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){var f=this.text.substr(this._text.length-this._cursorOffset),d=e.measureText(f).width,p=this._scrollLeft+this._textWidth-d;p<r?(this._scrollLeft+=r-p,p=r,this._markAsDirty()):r+a<p&&(this._scrollLeft+=r+a-p,p=r+a,this._markAsDirty()),this._isTextHighlightOn||e.fillRect(p,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(function(){i._blinkIsEven=!i._blinkIsEven,i._markAsDirty()},500),this._isTextHighlightOn){clearTimeout(this._blinkTimeout);var _=e.measureText(this.text.substring(this._startHighlightIndex)).width,g=this._scrollLeft+this._textWidth-_;this._highlightedText=this.text.substring(this._startHighlightIndex,this._endHighlightIndex);var m=e.measureText(this.text.substring(this._startHighlightIndex,this._endHighlightIndex)).width;g<r&&(m=(m-=r-g)||e.measureText(this.text.charAt(this.text.length-this._cursorOffset)).width,g=r),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor,e.fillRect(g,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,m,this._fontOffset.height),e.globalAlpha=1}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},S.prototype._onPointerDown=function(e,t,i,r){return!(!O.prototype._onPointerDown.call(this,e,t,i,r)||(this._clickedCoordinate=t.x,this._isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,(this._host._capturingControl[i]=this)._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))},S.prototype._onPointerMove=function(e,t,i){this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinate=t.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),O.prototype._onPointerMove.call(this,e,t,i)},S.prototype._onPointerUp=function(e,t,i,r,n){this._isPointerDown=!1,delete this._host._capturingControl[i],O.prototype._onPointerUp.call(this,e,t,i,r,n)},S.prototype._beforeRenderText=function(e){return e},S.prototype.dispose=function(){O.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},S);function S(e,t){void 0===t&&(t="");var i=O.call(this,e)||this;return i.name=e,i._text="",i._placeholderText="",i._background="#222222",i._focusedBackground="#000000",i._focusedColor="white",i._placeholderColor="gray",i._thickness=1,i._margin=new l.a(10,l.a.UNITMODE_PIXEL),i._autoStretchWidth=!0,i._maxWidth=new l.a(1,l.a.UNITMODE_PERCENTAGE,!1),i._isFocused=!1,i._blinkIsEven=!1,i._cursorOffset=0,i._deadKey=!1,i._addKey=!0,i._currentKey="",i._isTextHighlightOn=!1,i._textHighlightColor="#d5e0ff",i._highligherOpacity=.4,i._highlightedText="",i._startHighlightIndex=0,i._endHighlightIndex=0,i._cursorIndex=-1,i._onFocusSelectAll=!1,i._isPointerDown=!1,i.promptMessage="Please enter text:",i.disableMobilePrompt=!1,i.onTextChangedObservable=new h.a,i.onBeforeKeyAddObservable=new h.a,i.onFocusObservable=new h.a,i.onBlurObservable=new h.a,i.onTextHighlightObservable=new h.a,i.onTextCopyObservable=new h.a,i.onTextCutObservable=new h.a,i.onTextPasteObservable=new h.a,i.onKeyboardEventProcessedObservable=new h.a,i.text=t,i.isPointerBlocker=!0,i}o.a.RegisteredTypes["BABYLON.GUI.InputText"]=Ve;var R,ze=(R=c.a,Object(n.c)(I,R),Object.defineProperty(I.prototype,"columnCount",{get:function(){return this._columnDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"rowCount",{get:function(){return this._rowDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"children",{get:function(){return this._childControls},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),I.prototype.getRowDefinition=function(e){return e<0||e>=this._rowDefinitions.length?null:this._rowDefinitions[e]},I.prototype.getColumnDefinition=function(e){return e<0||e>=this._columnDefinitions.length?null:this._columnDefinitions[e]},I.prototype.addRowDefinition=function(e,t){return void 0===t&&(t=!1),this._rowDefinitions.push(new l.a(e,t?l.a.UNITMODE_PIXEL:l.a.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},I.prototype.addColumnDefinition=function(e,t){return void 0===t&&(t=!1),this._columnDefinitions.push(new l.a(e,t?l.a.UNITMODE_PIXEL:l.a.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},I.prototype.setRowDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._rowDefinitions.length)return this;var r=this._rowDefinitions[e];return r&&r.isPixel===i&&r.internalValue===t||(this._rowDefinitions[e]=new l.a(t,i?l.a.UNITMODE_PIXEL:l.a.UNITMODE_PERCENTAGE),this._markAsDirty()),this},I.prototype.setColumnDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._columnDefinitions.length)return this;var r=this._columnDefinitions[e];return r&&r.isPixel===i&&r.internalValue===t||(this._columnDefinitions[e]=new l.a(t,i?l.a.UNITMODE_PIXEL:l.a.UNITMODE_PERCENTAGE),this._markAsDirty()),this},I.prototype.getChildrenAt=function(e,t){var i=this._cells[e+":"+t];return i?i.children:null},I.prototype.getChildCellInfo=function(e){return e._tag},I.prototype._removeCell=function(e,t){if(e){R.prototype.removeControl.call(this,e);for(var i=0,r=e.children;i<r.length;i++){var n=r[i],o=this._childControls.indexOf(n);-1!==o&&this._childControls.splice(o,1)}delete this._cells[t]}},I.prototype._offsetCell=function(e,t){if(this._cells[t]){this._cells[e]=this._cells[t];for(var i=0,r=this._cells[e].children;i<r.length;i++)r[i]._tag=e;delete this._cells[t]}},I.prototype.removeColumnDefinition=function(e){if(e<0||e>=this._columnDefinitions.length)return this;for(var t=0;t<this._rowDefinitions.length;t++){var i=t+":"+e,r=this._cells[i];this._removeCell(r,i)}for(t=0;t<this._rowDefinitions.length;t++)for(var n=e+1;n<this._columnDefinitions.length;n++){var o=t+":"+(n-1);i=t+":"+n,this._offsetCell(o,i)}return this._columnDefinitions.splice(e,1),this._markAsDirty(),this},I.prototype.removeRowDefinition=function(e){if(e<0||e>=this._rowDefinitions.length)return this;for(var t=0;t<this._columnDefinitions.length;t++){var i=e+":"+t,r=this._cells[i];this._removeCell(r,i)}for(t=0;t<this._columnDefinitions.length;t++)for(var n=e+1;n<this._rowDefinitions.length;n++){var o=n-1+":"+t;i=n+":"+t,this._offsetCell(o,i)}return this._rowDefinitions.splice(e,1),this._markAsDirty(),this},I.prototype.addControl=function(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(e))return _.b.Warn("Control (Name:"+e.name+", UniqueId:"+e.uniqueId+") is already associated with this grid. You must remove it before reattaching it"),this;var r=Math.min(t,this._rowDefinitions.length-1)+":"+Math.min(i,this._columnDefinitions.length-1),n=this._cells[r];return n||(n=new c.a(r),(this._cells[r]=n).horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,n.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,R.prototype.addControl.call(this,n)),n.addControl(e),this._childControls.push(e),e._tag=r,(e.parent=this)._markAsDirty(),this},I.prototype.removeControl=function(e){var t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1);var i=this._cells[e._tag];return i&&(i.removeControl(e),e._tag=null),this._markAsDirty(),this},I.prototype._getTypeName=function(){return"Grid"},I.prototype._getGridDefinitions=function(e){for(var t=[],i=[],r=[],n=[],o=this._currentMeasure.width,s=0,a=this._currentMeasure.height,h=0,l=0,c=0,u=this._rowDefinitions;c<u.length;c++)(g=u[c]).isPixel?(a-=_=g.getValue(this._host),i[l]=_):h+=g.internalValue,l++;for(var f=0,d=l=0,p=this._rowDefinitions;d<p.length;d++){var _,g=p[d];n.push(f),g.isPixel?f+=g.getValue(this._host):(f+=_=g.internalValue/h*a,i[l]=_),l++}for(var m=l=0,v=this._columnDefinitions;m<v.length;m++)(g=v[m]).isPixel?(o-=T=g.getValue(this._host),t[l]=T):s+=g.internalValue,l++;for(var b=0,y=l=0,x=this._columnDefinitions;y<x.length;y++){var T;g=x[y],r.push(b),g.isPixel?b+=g.getValue(this._host):(b+=T=g.internalValue/s*o,t[l]=T),l++}e(r,n,t,i)},I.prototype._additionalProcessing=function(e,t){var l=this;this._getGridDefinitions(function(e,t,i,r){for(var n in l._cells)if(l._cells.hasOwnProperty(n)){var o=n.split(":"),s=parseInt(o[0]),a=parseInt(o[1]),h=l._cells[n];h.left=e[a]+"px",h.top=t[s]+"px",h.width=i[a]+"px",h.height=r[s]+"px",h._left.ignoreAdaptiveScaling=!0,h._top.ignoreAdaptiveScaling=!0,h._width.ignoreAdaptiveScaling=!0,h._height.ignoreAdaptiveScaling=!0}}),R.prototype._additionalProcessing.call(this,e,t)},I.prototype._flagDescendantsAsMatrixDirty=function(){for(var e in this._cells)this._cells.hasOwnProperty(e)&&this._cells[e]._markMatrixAsDirty()},I.prototype._renderHighlightSpecific=function(a){var h=this;R.prototype._renderHighlightSpecific.call(this,a),this._getGridDefinitions(function(e,t,i,r){for(var n=0;n<e.length;n++){var o=h._currentMeasure.left+e[n]+i[n];a.beginPath(),a.moveTo(o,h._currentMeasure.top),a.lineTo(o,h._currentMeasure.top+h._currentMeasure.height),a.stroke()}for(n=0;n<t.length;n++){var s=h._currentMeasure.top+t[n]+r[n];a.beginPath(),a.moveTo(h._currentMeasure.left,s),a.lineTo(h._currentMeasure.left+h._currentMeasure.width,s),a.stroke()}}),a.restore()},I.prototype.dispose=function(){R.prototype.dispose.call(this);for(var e=0,t=this._childControls;e<t.length;e++)t[e].dispose();this._childControls=[]},I);function I(e){var t=R.call(this,e)||this;return t.name=e,t._rowDefinitions=new Array,t._columnDefinitions=new Array,t._cells={},t._childControls=new Array,t}o.a.RegisteredTypes["BABYLON.GUI.Grid"]=ze;var w,je=i(7),D=(w=Be.a,Object(n.c)(We,w),Object.defineProperty(We.prototype,"value",{get:function(){return this._value},set:function(e){this._value.equals(e)||(this._value.copyFrom(e),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=We._Epsilon&&(this._value.r=0),this._value.g<=We._Epsilon&&(this._value.g=0),this._value.b<=We._Epsilon&&(this._value.b=0),this._value.r>=1-We._Epsilon&&(this._value.r=1),this._value.g>=1-We._Epsilon&&(this._value.g=1),this._value.b>=1-We._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(We.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&(this._height.fromString(e),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(We.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&(this._width.fromString(e),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(We.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e},enumerable:!0,configurable:!0}),We.prototype._getTypeName=function(){return"ColorPicker"},We.prototype._preMeasure=function(e,t){e.width<e.height?this._currentMeasure.height=e.width:this._currentMeasure.width=e.height},We.prototype._updateSquareProps=function(){var e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),t=2*(e-.2*e)/Math.sqrt(2),i=e-.5*t;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=t},We.prototype._drawGradientSquare=function(e,t,i,r,n,o){var s=o.createLinearGradient(t,i,r+t,i);s.addColorStop(0,"#fff"),s.addColorStop(1,"hsl("+e+", 100%, 50%)"),o.fillStyle=s,o.fillRect(t,i,r,n);var a=o.createLinearGradient(t,i,t,n+i);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"#000"),o.fillStyle=a,o.fillRect(t,i,r,n)},We.prototype._drawCircle=function(e,t,i,r){r.beginPath(),r.arc(e,t,i+1,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#333333",r.stroke(),r.beginPath(),r.arc(e,t,i,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#ffffff",r.stroke()},We.prototype._createColorWheelCanvas=function(e,t){var i=document.createElement("canvas");i.width=2*e,i.height=2*e;for(var r=i.getContext("2d"),n=r.getImageData(0,0,2*e,2*e),o=n.data,s=this._tmpColor,a=e*e,h=e-t,l=h*h,c=-e;c<e;c++)for(var u=-e;u<e;u++){var f=c*c+u*u;if(!(a<f||f<l)){var d=Math.sqrt(f),p=Math.atan2(u,c);je.a.HSVtoRGBToRef(180*p/Math.PI+180,d/e,1,s);var _=4*(c+e+2*(u+e)*e);o[_]=255*s.r,o[1+_]=255*s.g,o[2+_]=255*s.b;var g=.2;g=e<50?.2:150<e?.04:-.16*(e-50)/100+.2;var m=(d-h)/(e-h);o[3+_]=m<g?m/g*255:1-g<m?255*(1-(m-(1-g))/g):255}}return r.putImageData(n,0,0),i},We.prototype._draw=function(e){e.save(),this._applyStates(e);var t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*t,r=this._currentMeasure.left,n=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*t||(this._colorWheelCanvas=this._createColorWheelCanvas(t,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),e.drawImage(this._colorWheelCanvas,r,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,e);var o=this._squareLeft+this._squareSize*this._s,s=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,s,.04*t,e);var a=t-.5*i;o=r+t+Math.cos((this._h-180)*Math.PI/180)*a,s=n+t+Math.sin((this._h-180)*Math.PI/180)*a,this._drawCircle(o,s,.35*i,e),e.restore()},We.prototype._updateValueFromPointer=function(e,t){if(this._pointerStartedOnWheel){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),r=i+this._currentMeasure.left,n=i+this._currentMeasure.top;this._h=180*Math.atan2(t-n,e-r)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(e-this._squareLeft)/this._squareSize,this._v=1-(t-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,We._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,We._Epsilon));je.a.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor},We.prototype._isPointOnSquare=function(e,t){this._updateSquareProps();var i=this._squareLeft,r=this._squareTop,n=this._squareSize;return i<=e&&e<=i+n&&r<=t&&t<=r+n},We.prototype._isPointOnWheel=function(e,t){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),r=i-.2*i,n=e-(i+this._currentMeasure.left),o=t-(i+this._currentMeasure.top),s=n*n+o*o;return s<=i*i&&r*r<=s},We.prototype._onPointerDown=function(e,t,i,r){if(!w.prototype._onPointerDown.call(this,e,t,i,r))return!1;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition);var n=this._transformedPosition.x,o=this._transformedPosition.y;return this._isPointOnSquare(n,o)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(n,o)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(n,o),(this._host._capturingControl[i]=this)._lastPointerDownID=i,!0},We.prototype._onPointerMove=function(e,t,i){if(i==this._lastPointerDownID){this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition);var r=this._transformedPosition.x,n=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(r,n),w.prototype._onPointerMove.call(this,e,t,i)}},We.prototype._onPointerUp=function(e,t,i,r,n){this._pointerIsDown=!1,delete this._host._capturingControl[i],w.prototype._onPointerUp.call(this,e,t,i,r,n)},We.ShowPickerDialogAsync=function(Le,Fe){return new Promise(function(t,e){Fe.pickerWidth=Fe.pickerWidth||"640px",Fe.pickerHeight=Fe.pickerHeight||"400px",Fe.headerHeight=Fe.headerHeight||"35px",Fe.lastColor=Fe.lastColor||"#000000",Fe.swatchLimit=Fe.swatchLimit||20,Fe.numSwatchesPerLine=Fe.numSwatchesPerLine||10;var i,r,n,o,s,a,d,p,h,l,c,u,f,_,g,m,v,b,y,x=Fe.swatchLimit/Fe.numSwatchesPerLine,T=parseFloat(Fe.pickerWidth)/Fe.numSwatchesPerLine,M=Math.floor(.25*T),E=M*(Fe.numSwatchesPerLine+1),A=Math.floor((parseFloat(Fe.pickerWidth)-E)/Fe.numSwatchesPerLine),O=A*x+M*(1+x),P=(parseInt(Fe.pickerHeight)+O+Math.floor(.25*A)).toString()+"px",C="#c0c0c0",S="#535353",R="#414141",I="515151",w="#555555",D="#454545",L=je.a.FromHexString("#dddddd"),F=L.r+L.g+L.b,N="#aaaaaa",B="#ffffff",k=["R","G","B"],U="#454545",V="#f0f0f0",z=!1;function j(e,t){y=t;var i=e.toHexString();if(v.background=i,l.name!=y&&(l.text=Math.floor(255*e.r).toString()),c.name!=y&&(c.text=Math.floor(255*e.g).toString()),u.name!=y&&(u.text=Math.floor(255*e.b).toString()),f.name!=y&&(f.text=e.r.toString()),_.name!=y&&(_.text=e.g.toString()),g.name!=y&&(g.text=e.b.toString()),m.name!=y){var r=i.split("#");m.text=r[1]}h.name!=y&&(h.value=e)}function W(e,t){var i=e.text;if(/[^0-9]/g.test(i))e.text=b;else if(""!=i&&(Math.floor(parseInt(i))<0?i="0":255<Math.floor(parseInt(i))?i="255":isNaN(parseInt(i))&&(i="0")),y==e.name&&(b=i),""!=i){i=parseInt(i).toString(),e.text=i;var r=je.a.FromHexString(v.background);y==e.name&&j("r"==t?new je.a(parseInt(i)/255,r.g,r.b):"g"==t?new je.a(r.r,parseInt(i)/255,r.b):new je.a(r.r,r.g,parseInt(i)/255),e.name)}}function G(e,t){var i=e.text;if(/[^0-9\.]/g.test(i))e.text=b;else{""!=i&&"."!=i&&0!=parseFloat(i)&&(parseFloat(i)<0?i="0.0":1<parseFloat(i)?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),y==e.name&&(b=i),""!=i&&"."!=i&&0!=parseFloat(i)?(i=parseFloat(i).toString(),e.text=i):i="0.0";var r=je.a.FromHexString(v.background);y==e.name&&j("r"==t?new je.a(parseFloat(i),r.g,r.b):"g"==t?new je.a(r.r,parseFloat(i),r.b):new je.a(r.r,r.g,parseFloat(i)),e.name)}}function H(){if(Fe.savedColors&&Fe.savedColors[d]){if(z)var e="b";else e="";var t=Ue.CreateSimpleButton("Swatch_"+d,e);t.fontFamily="BabylonJSglyphs";var i=je.a.FromHexString(Fe.savedColors[d]),r=i.r+i.g+i.b;t.color=F<r?N:B,t.fontSize=Math.floor(.7*A),t.textBlock.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,t.height=t.width=A.toString()+"px",t.background=Fe.savedColors[d],t.thickness=2;var n=d;return t.pointerDownAnimation=function(){t.thickness=4},t.pointerUpAnimation=function(){t.thickness=3},t.pointerEnterAnimation=function(){t.thickness=3},t.pointerOutAnimation=function(){t.thickness=2},t.onPointerClickObservable.add(function(){var e;z?(e=n,Fe.savedColors&&Fe.savedColors.splice(e,1),Fe.savedColors&&0==Fe.savedColors.length&&(Y(!1),z=!1),K("",Ce)):Fe.savedColors&&j(je.a.FromHexString(Fe.savedColors[n]),t.name)}),t}return null}function X(e){if(void 0!==e&&(z=e),z){for(var t=0;t<p.children.length;t++)p.children[t].textBlock.text="b";void 0!==n&&(n.textBlock.text="Done")}else{for(t=0;t<p.children.length;t++)p.children[t].textBlock.text="";void 0!==n&&(n.textBlock.text="Edit")}}function K(e,t){if(Fe.savedColors){""!=e&&Fe.savedColors.push(e),d=0,p.clearControls();var i=Math.ceil(Fe.savedColors.length/Fe.numSwatchesPerLine);if(0==i)var r=0;else r=i+1;if(p.rowCount!=i+r){for(var n=p.rowCount,o=0;o<n;o++)p.removeRowDefinition(0);for(o=0;o<i+r;o++)o%2?p.addRowDefinition(A,!0):p.addRowDefinition(M,!0)}p.height=(A*i+r*M).toString()+"px";for(var s=1,a=1;s<i+r;s+=2,a++){if(Fe.savedColors.length>a*Fe.numSwatchesPerLine)var h=Fe.numSwatchesPerLine;else h=Fe.savedColors.length-(a-1)*Fe.numSwatchesPerLine;for(var l=Math.min(Math.max(h,0),Fe.numSwatchesPerLine),c=0,u=1;c<l;c++)if(!(c>Fe.numSwatchesPerLine)){var f=H();null!=f&&(p.addControl(f,s,u),u+=2,d++)}}Fe.savedColors.length>=Fe.swatchLimit?q(t,!0):q(t,!1)}}function Y(e){e?((n=Ue.CreateSimpleButton("butEdit","Edit")).width=o,n.height=s,n.left=Math.floor(.1*parseInt(o)).toString()+"px",n.top=(-1*parseFloat(n.left)).toString()+"px",n.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_BOTTOM,n.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,n.thickness=2,n.color=C,n.fontSize=r,n.background=S,n.onPointerEnterObservable.add(function(){n.background=R}),n.onPointerOutObservable.add(function(){n.background=S}),n.pointerDownAnimation=function(){n.background=I},n.pointerUpAnimation=function(){n.background=R},n.onPointerClickObservable.add(function(){z=!z,X()}),ce.addControl(n,1,0)):ce.removeControl(n)}function q(e,t){t?(e.color=w,e.background=D):(e.color=C,e.background=S)}function Z(e){Fe.savedColors&&0<Fe.savedColors.length?t({savedColors:Fe.savedColors,pickedColor:e}):t({pickedColor:e}),Le.removeControl(Q)}var Q=new ze;if(Q.name="Dialog Container",Q.width=Fe.pickerWidth,Fe.savedColors){Q.height=P;var J=parseInt(Fe.pickerHeight)/parseInt(P);Q.addRowDefinition(J,!1),Q.addRowDefinition(1-J,!1)}else Q.height=Fe.pickerHeight,Q.addRowDefinition(1,!1);if(Le.addControl(Q),Fe.savedColors){(p=new ze).name="Swatch Drawer",p.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,p.background=S,p.width=Fe.pickerWidth;var $=Fe.savedColors.length/Fe.numSwatchesPerLine;if(0==$)var ee=0;else ee=1+$;p.height=(A*$+ee*M).toString()+"px",p.top=Math.floor(.25*A).toString()+"px";for(var te=0;te<2*Math.ceil(Fe.savedColors.length/Fe.numSwatchesPerLine)+1;te++)te%2!=0?p.addRowDefinition(A,!0):p.addRowDefinition(M,!0);for(te=0;te<2*Fe.numSwatchesPerLine+1;te++)te%2!=0?p.addColumnDefinition(A,!0):p.addColumnDefinition(M,!0);Q.addControl(p,1,0)}var ie=new ze;ie.name="Picker Panel",ie.height=Fe.pickerHeight;var re=parseInt(Fe.headerHeight)/parseInt(Fe.pickerHeight),ne=[re,1-re];ie.addRowDefinition(ne[0],!1),ie.addRowDefinition(ne[1],!1),Q.addControl(ie,0,0);var oe=new Ne;oe.name="Dialogue Header Bar",oe.background="#cccccc",oe.thickness=0,ie.addControl(oe,0,0);var se=Ue.CreateSimpleButton("closeButton","a");se.fontFamily="BabylonJSglyphs";var ae=je.a.FromHexString(oe.background);i=new je.a(1-ae.r,1-ae.g,1-ae.b),se.color=i.toHexString(),se.fontSize=Math.floor(.6*parseInt(Fe.headerHeight)),se.textBlock.textVerticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,se.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_RIGHT,se.height=se.width=Fe.headerHeight,se.background=oe.background,se.thickness=0,se.pointerDownAnimation=function(){},se.pointerUpAnimation=function(){se.background=oe.background},se.pointerEnterAnimation=function(){se.color=oe.background,se.background="red"},se.pointerOutAnimation=function(){se.color=i.toHexString(),se.background=oe.background},se.onPointerClickObservable.add(function(){Z(Te.background)}),ie.addControl(se,0,0);var he=new ze;he.name="Dialogue Body",he.background=S;var le=[.4375,.5625];he.addRowDefinition(1,!1),he.addColumnDefinition(le[0],!1),he.addColumnDefinition(le[1],!1),ie.addControl(he,1,0);var ce=new ze;ce.name="Picker Grid",ce.addRowDefinition(.85,!1),ce.addRowDefinition(.15,!1),he.addControl(ce,0,0),(h=new We).name="GUI Color Picker",Fe.pickerHeight<Fe.pickerWidth?h.width=.89:h.height=.89,h.value=je.a.FromHexString(Fe.lastColor),h.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_CENTER,h.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,h.onPointerDownObservable.add(function(){y=h.name,b="",X(!1)}),h.onValueChangedObservable.add(function(e){y==h.name&&j(e,h.name)}),ce.addControl(h,0,0);var ue=new ze;ue.name="Dialogue Right Half",ue.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT;var fe=[.514,.486];ue.addRowDefinition(fe[0],!1),ue.addRowDefinition(fe[1],!1),he.addControl(ue,1,1);var de=new ze;de.name="Swatches and Buttons";var pe=[.417,.583];de.addRowDefinition(1,!1),de.addColumnDefinition(pe[0],!1),de.addColumnDefinition(pe[1],!1),ue.addControl(de,0,0);var _e=new ze;_e.name="New and Current Swatches";var ge=[.04,.16,.64,.16];_e.addRowDefinition(ge[0],!1),_e.addRowDefinition(ge[1],!1),_e.addRowDefinition(ge[2],!1),_e.addRowDefinition(ge[3],!1),de.addControl(_e,0,0);var me=new ze;me.name="Active Swatches",me.width=.67,me.addRowDefinition(.5,!1),me.addRowDefinition(.5,!1),_e.addControl(me,2,0);var ve=Math.floor(parseInt(Fe.pickerWidth)*le[1]*pe[0]*.11),be=Math.floor(parseInt(Fe.pickerHeight)*ne[1]*fe[0]*ge[1]*.5);if(Fe.pickerWidth>Fe.pickerHeight)var ye=be;else ye=ve;var xe=new ke;xe.text="new",xe.name="New Color Label",xe.color=C,xe.fontSize=ye,_e.addControl(xe,1,0),(v=new Ne).name="New Color Swatch",v.background=Fe.lastColor,v.thickness=0,me.addControl(v,0,0);var Te=Ue.CreateSimpleButton("currentSwatch","");Te.background=Fe.lastColor,Te.thickness=0,Te.onPointerClickObservable.add(function(){j(je.a.FromHexString(Te.background),Te.name),X(!1)}),Te.pointerDownAnimation=function(){},Te.pointerUpAnimation=function(){},Te.pointerEnterAnimation=function(){},Te.pointerOutAnimation=function(){},me.addControl(Te,1,0);var Me=new Ne;Me.name="Swatch Outline",Me.width=.67,Me.thickness=2,Me.color="#404040",Me.isHitTestVisible=!1,_e.addControl(Me,2,0);var Ee=new ke;Ee.name="Current Color Label",Ee.text="current",Ee.color=C,Ee.fontSize=ye,_e.addControl(Ee,3,0);var Ae=new ze;Ae.name="Button Grid",Ae.height=.8,Ae.addRowDefinition(1/3,!1),Ae.addRowDefinition(1/3,!1),Ae.addRowDefinition(1/3,!1),de.addControl(Ae,0,1),o=Math.floor(parseInt(Fe.pickerWidth)*le[1]*pe[1]*.67).toString()+"px",s=Math.floor(parseInt(Fe.pickerHeight)*ne[1]*fe[0]*(parseFloat(Ae.height.toString())/100)*(1/3)*.7).toString()+"px",r=parseFloat(o)>parseFloat(s)?Math.floor(.45*parseFloat(s)):Math.floor(.11*parseFloat(o));var Oe=Ue.CreateSimpleButton("butOK","OK");Oe.width=o,Oe.height=s,Oe.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,Oe.thickness=2,Oe.color=C,Oe.fontSize=r,Oe.background=S,Oe.onPointerEnterObservable.add(function(){Oe.background=R}),Oe.onPointerOutObservable.add(function(){Oe.background=S}),Oe.pointerDownAnimation=function(){Oe.background=I},Oe.pointerUpAnimation=function(){Oe.background=R},Oe.onPointerClickObservable.add(function(){X(!1),Z(v.background)}),Ae.addControl(Oe,0,0);var Pe=Ue.CreateSimpleButton("butCancel","Cancel");if(Pe.width=o,Pe.height=s,Pe.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,Pe.thickness=2,Pe.color=C,Pe.fontSize=r,Pe.background=S,Pe.onPointerEnterObservable.add(function(){Pe.background=R}),Pe.onPointerOutObservable.add(function(){Pe.background=S}),Pe.pointerDownAnimation=function(){Pe.background=I},Pe.pointerUpAnimation=function(){Pe.background=R},Pe.onPointerClickObservable.add(function(){X(!1),Z(Te.background)}),Ae.addControl(Pe,1,0),Fe.savedColors){var Ce=Ue.CreateSimpleButton("butSave","Save");Ce.width=o,Ce.height=s,Ce.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,Ce.thickness=2,Ce.fontSize=r,Fe.savedColors.length<Fe.swatchLimit?(Ce.color=C,Ce.background=S):q(Ce,!0),Ce.onPointerEnterObservable.add(function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Ce.background=R)}),Ce.onPointerOutObservable.add(function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Ce.background=S)}),Ce.pointerDownAnimation=function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Ce.background=I)},Ce.pointerUpAnimation=function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Ce.background=R)},Ce.onPointerClickObservable.add(function(){Fe.savedColors&&(0==Fe.savedColors.length&&Y(!0),Fe.savedColors.length<Fe.swatchLimit&&K(v.background,Ce),X(!1))}),0<Fe.savedColors.length&&Y(!0),Ae.addControl(Ce,2,0)}var Se=new ze;Se.name="Dialog Lower Right",Se.addRowDefinition(.02,!1),Se.addRowDefinition(.63,!1),Se.addRowDefinition(.21,!1),Se.addRowDefinition(.14,!1),ue.addControl(Se,1,0),a=je.a.FromHexString(Fe.lastColor);var Re=new ze;for(Re.name="RGB Values",Re.width=.82,Re.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,Re.addRowDefinition(1/3,!1),Re.addRowDefinition(1/3,!1),Re.addRowDefinition(1/3,!1),Re.addColumnDefinition(.1,!1),Re.addColumnDefinition(.2,!1),Re.addColumnDefinition(.7,!1),Se.addControl(Re,1,0),te=0;te<k.length;te++)(Ie=new ke).text=k[te],Ie.color=C,Ie.fontSize=r,Re.addControl(Ie,te,0);(l=new Ve).width=.83,l.height=.72,l.name="rIntField",l.fontSize=r,l.text=(255*a.r).toString(),l.color=V,l.background=U,l.onFocusObservable.add(function(){y=l.name,b=l.text,X(!1)}),l.onBlurObservable.add(function(){""==l.text&&(l.text="0"),W(l,"r"),y==l.name&&(y="")}),l.onTextChangedObservable.add(function(){y==l.name&&W(l,"r")}),Re.addControl(l,0,1),(c=new Ve).width=.83,c.height=.72,c.name="gIntField",c.fontSize=r,c.text=(255*a.g).toString(),c.color=V,c.background=U,c.onFocusObservable.add(function(){y=c.name,b=c.text,X(!1)}),c.onBlurObservable.add(function(){""==c.text&&(c.text="0"),W(c,"g"),y==c.name&&(y="")}),c.onTextChangedObservable.add(function(){y==c.name&&W(c,"g")}),Re.addControl(c,1,1),(u=new Ve).width=.83,u.height=.72,u.name="bIntField",u.fontSize=r,u.text=(255*a.b).toString(),u.color=V,u.background=U,u.onFocusObservable.add(function(){y=u.name,b=u.text,X(!1)}),u.onBlurObservable.add(function(){""==u.text&&(u.text="0"),W(u,"b"),y==u.name&&(y="")}),u.onTextChangedObservable.add(function(){y==u.name&&W(u,"b")}),Re.addControl(u,2,1),(f=new Ve).width=.95,f.height=.72,f.name="rDecField",f.fontSize=r,f.text=a.r.toString(),f.color=V,f.background=U,f.onFocusObservable.add(function(){y=f.name,b=f.text,X(!1)}),f.onBlurObservable.add(function(){0!=parseFloat(f.text)&&""!=f.text||(f.text="0",G(f,"r")),y==f.name&&(y="")}),f.onTextChangedObservable.add(function(){y==f.name&&G(f,"r")}),Re.addControl(f,0,2),(_=new Ve).width=.95,_.height=.72,_.name="gDecField",_.fontSize=r,_.text=a.g.toString(),_.color=V,_.background=U,_.onFocusObservable.add(function(){y=_.name,b=_.text,X(!1)}),_.onBlurObservable.add(function(){0!=parseFloat(_.text)&&""!=_.text||(_.text="0",G(_,"g")),y==_.name&&(y="")}),_.onTextChangedObservable.add(function(){y==_.name&&G(_,"g")}),Re.addControl(_,1,2),(g=new Ve).width=.95,g.height=.72,g.name="bDecField",g.fontSize=r,g.text=a.b.toString(),g.color=V,g.background=U,g.onFocusObservable.add(function(){y=g.name,b=g.text,X(!1)}),g.onBlurObservable.add(function(){0!=parseFloat(g.text)&&""!=g.text||(g.text="0",G(g,"b")),y==g.name&&(y="")}),g.onTextChangedObservable.add(function(){y==g.name&&G(g,"b")}),Re.addControl(g,2,2);var Ie,we=new ze;we.name="Hex Value",we.width=.82,we.addRowDefinition(1,!1),we.addColumnDefinition(.1,!1),we.addColumnDefinition(.9,!1),Se.addControl(we,2,0),(Ie=new ke).text="#",Ie.color=C,Ie.fontSize=r,we.addControl(Ie,0,0),(m=new Ve).width=.96,m.height=.72,m.name="hexField",m.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_CENTER,m.fontSize=r;var De=Fe.lastColor.split("#");m.text=De[1],m.color=V,m.background=U,m.onFocusObservable.add(function(){y=m.name,b=m.text,X(!1)}),m.onBlurObservable.add(function(){if(3==m.text.length){var e=m.text.split("");m.text=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}""==m.text&&(m.text="000000",j(je.a.FromHexString(m.text),"b")),y==m.name&&(y="")}),m.onTextChangedObservable.add(function(){var e=m.text,t=/[^0-9A-F]/i.test(e);if((6<m.text.length||t)&&y==m.name)m.text=b;else{if(m.text.length<6)for(var i=6-m.text.length,r=0;r<i;r++)e="0"+e;if(3==m.text.length){var n=m.text.split("");e=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]}e="#"+e,y==m.name&&(b=m.text,j(je.a.FromHexString(e),m.name))}}),we.addControl(m,0,1),Fe.savedColors&&0<Fe.savedColors.length&&K("",Ce)})},We._Epsilon=1e-6,We);function We(e){var t=w.call(this,e)||this;return t.name=e,t._value=je.a.Red(),t._tmpColor=new je.a,t._pointerStartedOnSquare=!1,t._pointerStartedOnWheel=!1,t._squareLeft=0,t._squareTop=0,t._squareSize=0,t._h=360,t._s=1,t._v=1,t._lastPointerDownID=-1,t.onValueChangedObservable=new h.a,t._pointerIsDown=!1,t.value=new je.a(.88,.1,.1),t.size="200px",t.isPointerBlocker=!0,t}o.a.RegisteredTypes["BABYLON.GUI.ColorPicker"]=D;var L,F=(L=c.a,Object(n.c)(N,L),Object.defineProperty(N.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),N.prototype._getTypeName=function(){return"Ellipse"},N.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),Be.a.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),this._background&&(e.fillStyle=this._background,e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()},N.prototype._additionalProcessing=function(e,t){L.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},N.prototype._clipForChildren=function(e){Be.a.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,e),e.clip()},N);function N(e){var t=L.call(this,e)||this;return t.name=e,t._thickness=1,t}o.a.RegisteredTypes["BABYLON.GUI.Ellipse"]=F;var B,k=(B=Ve,Object(n.c)(U,B),U.prototype._beforeRenderText=function(e){for(var t="",i=0;i<e.length;i++)t+="•";return t},U);function U(){return null!==B&&B.apply(this,arguments)||this}o.a.RegisteredTypes["BABYLON.GUI.InputPassword"]=k;var V,z=i(0),j=(V=Be.a,Object(n.c)(W,V),Object.defineProperty(W.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"connectedControl",{get:function(){return this._connectedControl},set:function(e){var t=this;this._connectedControl!==e&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),e&&(this._connectedControlDirtyObserver=e.onDirtyObservable.add(function(){return t._markAsDirty()})),this._connectedControl=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"x1",{get:function(){return this._x1.toString(this._host)},set:function(e){this._x1.toString(this._host)!==e&&this._x1.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"y1",{get:function(){return this._y1.toString(this._host)},set:function(e){this._y1.toString(this._host)!==e&&this._y1.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"x2",{get:function(){return this._x2.toString(this._host)},set:function(e){this._x2.toString(this._host)!==e&&this._x2.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"y2",{get:function(){return this._y2.toString(this._host)},set:function(e){this._y2.toString(this._host)!==e&&this._y2.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"horizontalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"verticalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"_effectiveX2",{get:function(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"_effectiveY2",{get:function(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)},enumerable:!0,configurable:!0}),W.prototype._getTypeName=function(){return"Line"},W.prototype._draw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath(),e.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),e.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),e.stroke(),e.restore()},W.prototype._measure=function(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth},W.prototype._computeAlignment=function(e,t){this._currentMeasure.left=e.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=e.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2},W.prototype.moveToVector3=function(e,t,i){if(void 0===i&&(i=!1),this._host&&this.parent===this._host._rootContainer){var r=this._host._getGlobalViewport(t),n=z.e.Project(e,z.a.Identity(),t.getTransformMatrix(),r);this._moveToProjectedPosition(n,i),n.z<0||1<n.z?this.notRenderable=!0:this.notRenderable=!1}else _.b.Error("Cannot move a control to a vector3 if the control is not at root level")},W.prototype._moveToProjectedPosition=function(e,t){void 0===t&&(t=!1);var i=e.x+this._linkOffsetX.getValue(this._host)+"px",r=e.y+this._linkOffsetY.getValue(this._host)+"px";t?(this.x2=i,this.y2=r,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=r,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)},W);function W(e){var t=V.call(this,e)||this;return t.name=e,t._lineWidth=1,t._x1=new l.a(0),t._y1=new l.a(0),t._x2=new l.a(0),t._y2=new l.a(0),t._dash=new Array,t._automaticSize=!0,t.isHitTestVisible=!1,t._horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,t._verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,t}o.a.RegisteredTypes["BABYLON.GUI.Line"]=j;var G=i(42),H=(Object.defineProperty(X.prototype,"x",{get:function(){return this._x.toString(this._multiLine._host)},set:function(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"y",{get:function(){return this._y.toString(this._multiLine._host)},set:function(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"control",{get:function(){return this._control},set:function(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(X.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),X.prototype.resetLinks=function(){this.control=null,this.mesh=null},X.prototype.translate=function(){return this._point=this._translatePoint(),this._point},X.prototype._translatePoint=function(){if(null!=this._mesh)return this._multiLine._host.getProjectedPosition(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new z.d(this._control.centerX,this._control.centerY);var e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),i=this._y.getValueInPixel(e,Number(e._canvas.height));return new z.d(t,i)},X.prototype.dispose=function(){this.resetLinks()},X);function X(e){this._multiLine=e,this._x=new l.a(0),this._y=new l.a(0),this._point=new z.d(0,0)}var K,Y=(K=Be.a,Object(n.c)(q,K),Object.defineProperty(q.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!0,configurable:!0}),q.prototype.getAt=function(e){return this._points[e]||(this._points[e]=new H(this)),this._points[e]},q.prototype.add=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.map(function(e){return t.push(e)})},q.prototype.push=function(e){var t=this.getAt(this._points.length);return null==e||(e instanceof G.a?t.mesh=e:e instanceof Be.a?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y)),t},q.prototype.remove=function(e){var t;if(e instanceof H){if(-1===(t=this._points.indexOf(e)))return}else t=e;var i=this._points[t];i&&(i.dispose(),this._points.splice(t,1))},q.prototype.reset=function(){for(;0<this._points.length;)this.remove(this._points.length-1)},q.prototype.resetLinks=function(){this._points.forEach(function(e){null!=e&&e.resetLinks()})},Object.defineProperty(q.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"horizontalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"verticalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),q.prototype._getTypeName=function(){return"MultiLine"},q.prototype._draw=function(t,e){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath();var i=!0;this._points.forEach(function(e){e&&(i?(t.moveTo(e._point.x,e._point.y),i=!1):t.lineTo(e._point.x,e._point.y))}),t.stroke(),t.restore()},q.prototype._additionalProcessing=function(e,t){var i=this;this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach(function(e,t){e&&(e.translate(),(null==i._minX||e._point.x<i._minX)&&(i._minX=e._point.x),(null==i._minY||e._point.y<i._minY)&&(i._minY=e._point.y),(null==i._maxX||e._point.x>i._maxX)&&(i._maxX=e._point.x),(null==i._maxY||e._point.y>i._maxY)&&(i._maxY=e._point.y))}),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)},q.prototype._measure=function(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)},q.prototype._computeAlignment=function(e,t){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)},q.prototype.dispose=function(){this.reset(),K.prototype.dispose.call(this)},q);function q(e){var t=K.call(this,e)||this;return t.name=e,t._lineWidth=1,t.onPointUpdate=function(){t._markAsDirty()},t._automaticSize=!0,t.isHitTestVisible=!1,t._horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,t._verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,t._dash=[],t._points=[],t}o.a.RegisteredTypes["BABYLON.GUI.MultiLine"]=Y;var Z,Q=(Z=Be.a,Object(n.c)(J,Z),Object.defineProperty(J.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(J.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(J.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(J.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){var t=this;this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e),this._isChecked&&this._host&&this._host.executeOnAllControls(function(e){e!==t&&void 0!==e.group&&e.group===t.group&&(e.isChecked=!1)}))},enumerable:!0,configurable:!0}),J.prototype._getTypeName=function(){return"RadioButton"},J.prototype._draw=function(e){e.save(),this._applyStates(e);var t=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),Be.a.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.stroke(),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColor;var r=t*this._checkSizeRatio,n=i*this._checkSizeRatio;Be.a.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,r/2-this._thickness/2,n/2-this._thickness/2,e),e.fill()}e.restore()},J.prototype._onPointerDown=function(e,t,i,r){return!!Z.prototype._onPointerDown.call(this,e,t,i,r)&&(this.isChecked||(this.isChecked=!0),!0)},J.AddRadioButtonWithHeader=function(e,t,i,r){var n=new x;n.isVertical=!1,n.height="30px";var o=new J;o.width="20px",o.height="20px",o.isChecked=i,o.color="green",o.group=t,o.onIsCheckedChangedObservable.add(function(e){return r(o,e)}),n.addControl(o);var s=new ke;return s.text=e,s.width="180px",s.paddingLeft="5px",s.textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,s.color="white",n.addControl(s),n},J);function J(e){var t=Z.call(this,e)||this;return t.name=e,t._isChecked=!1,t._background="black",t._checkSizeRatio=.8,t._thickness=1,t.group="",t.onIsCheckedChangedObservable=new h.a,t.isPointerBlocker=!0,t}o.a.RegisteredTypes["BABYLON.GUI.RadioButton"]=Q;var $,ee=($=Be.a,Object(n.c)(te,$),Object.defineProperty(te.prototype,"displayThumb",{get:function(){return this._displayThumb},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"step",{get:function(){return this._step},set:function(e){this._step!==e&&(this._step=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"barOffset",{get:function(){return this._barOffset.toString(this._host)},set:function(e){this._barOffset.toString(this._host)!==e&&this._barOffset.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"barOffsetInPixels",{get:function(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"thumbWidth",{get:function(){return this._thumbWidth.toString(this._host)},set:function(e){this._thumbWidth.toString(this._host)!==e&&this._thumbWidth.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"thumbWidthInPixels",{get:function(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"minimum",{get:function(){return this._minimum},set:function(e){this._minimum!==e&&(this._minimum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum!==e&&(this._maximum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"value",{get:function(){return this._value},set:function(e){e=Math.max(Math.min(e,this._maximum),this._minimum),this._value!==e&&(this._value=e,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"isThumbClamped",{get:function(){return this._isThumbClamped},set:function(e){this._isThumbClamped!==e&&(this._isThumbClamped=e,this._markAsDirty())},enumerable:!0,configurable:!0}),te.prototype._getTypeName=function(){return"BaseSlider"},te.prototype._getThumbPosition=function(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength},te.prototype._getThumbThickness=function(e){var t=0;switch(e){case"circle":t=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":t=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return t},te.prototype._prepareRenderingData=function(e){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(e),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?console.error("Height should be greater than width"):(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))},te.prototype._updateValueFromPointer=function(e,t){var i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum);var r=1/this._step|0;this.value=this._step?(i*r|0)/r:i},te.prototype._onPointerDown=function(e,t,i,r){return!!$.prototype._onPointerDown.call(this,e,t,i,r)&&(this._pointerIsDown=!0,this._updateValueFromPointer(t.x,t.y),(this._host._capturingControl[i]=this)._lastPointerDownID=i,!0)},te.prototype._onPointerMove=function(e,t,i){i==this._lastPointerDownID&&(this._pointerIsDown&&this._updateValueFromPointer(t.x,t.y),$.prototype._onPointerMove.call(this,e,t,i))},te.prototype._onPointerUp=function(e,t,i,r,n){this._pointerIsDown=!1,delete this._host._capturingControl[i],$.prototype._onPointerUp.call(this,e,t,i,r,n)},te);function te(e){var t=$.call(this,e)||this;return t.name=e,t._thumbWidth=new l.a(20,l.a.UNITMODE_PIXEL,!1),t._minimum=0,t._maximum=100,t._value=50,t._isVertical=!1,t._barOffset=new l.a(5,l.a.UNITMODE_PIXEL,!1),t._isThumbClamped=!1,t._displayThumb=!0,t._step=0,t._lastPointerDownID=-1,t._effectiveBarOffset=0,t.onValueChangedObservable=new h.a,t._pointerIsDown=!1,t.isPointerBlocker=!0,t}var ie,re=(ie=ee,Object(n.c)(ne,ie),Object.defineProperty(ne.prototype,"displayValueBar",{get:function(){return this._displayValueBar},set:function(e){this._displayValueBar!==e&&(this._displayValueBar=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"isThumbCircle",{get:function(){return this._isThumbCircle},set:function(e){this._isThumbCircle!==e&&(this._isThumbCircle=e,this._markAsDirty())},enumerable:!0,configurable:!0}),ne.prototype._getTypeName=function(){return"Slider"},ne.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");var i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight,s=0;s=this.isThumbClamped&&this.isThumbCircle?(this.isVertical?r+=this._effectiveThumbThickness/2:i+=this._effectiveThumbThickness/2,this._backgroundBoxThickness/2):(this._effectiveThumbThickness-this._effectiveBarOffset)/2,(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY);var a=this._getThumbPosition();e.fillStyle=this._background,this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,r,s,Math.PI,2*Math.PI),e.fill(),e.fillRect(i,r,n,o)):e.fillRect(i,r,n,o+this._effectiveThumbThickness):e.fillRect(i,r,n,o):this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxLength,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),e.fillRect(i,r,n,o)):e.fillRect(i,r,n+this._effectiveThumbThickness,o):e.fillRect(i,r,n,o),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this.color,this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,r+this._backgroundBoxLength,s,0,2*Math.PI),e.fill(),e.fillRect(i,r+a,n,o-a)):e.fillRect(i,r+a,n,o-a+this._effectiveThumbThickness):e.fillRect(i,r+a,n,o-a):(this.isThumbClamped&&this.isThumbCircle&&(e.beginPath(),e.arc(i,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill()),e.fillRect(i,r,a,o))),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(e.beginPath(),this.isVertical?e.arc(i+this._backgroundBoxThickness/2,r+a,s,0,2*Math.PI):e.arc(i+a,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,e.stroke()):(this.isVertical?e.fillRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.fillRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,this.isVertical?e.strokeRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.strokeRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),e.restore()},ne);function ne(e){var t=ie.call(this,e)||this;return t.name=e,t._background="black",t._borderColor="white",t._isThumbCircle=!1,t._displayValueBar=!0,t}o.a.RegisteredTypes["BABYLON.GUI.Slider"]=re;var oe=(Object.defineProperty(se.prototype,"groupPanel",{get:function(){return this._groupPanel},enumerable:!0,configurable:!0}),Object.defineProperty(se.prototype,"selectors",{get:function(){return this._selectors},enumerable:!0,configurable:!0}),Object.defineProperty(se.prototype,"header",{get:function(){return this._groupHeader.text},set:function(e){"label"!==this._groupHeader.text&&(this._groupHeader.text=e)},enumerable:!0,configurable:!0}),se.prototype._addGroupHeader=function(e){var t=new ke("groupHead",e);return t.width=.9,t.height="30px",t.textWrapping=!0,t.color="black",t.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,t.textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,t.left="2px",this._groupPanel.addControl(t),t},se.prototype._getSelector=function(e){if(!(e<0||e>=this._selectors.length))return this._selectors[e]},se.prototype.removeSelector=function(e){e<0||e>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[e]),this._selectors.splice(e,1))},se);function se(e){this.name=e,this._groupPanel=new x,this._selectors=new Array,this._groupPanel.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(e)}var ae,he=(ae=oe,Object(n.c)(le,ae),le.prototype.addCheckbox=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1),i=i||!1;var r=new E;r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add(function(e){t(e)});var n=Be.a.AddHeader(r,e,"200px",{isHorizontal:!0,controlFirst:!0});n.height="30px",n.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,n.left="4px",this.groupPanel.addControl(n),this.selectors.push(n),r.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)},le.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},le.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},le.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},le.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t},le);function le(){return null!==ae&&ae.apply(this,arguments)||this}var ce,ue=(ce=oe,Object(n.c)(fe,ce),fe.prototype.addRadio=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1);var r=this._selectNb++,n=new Q;n.name=e,n.width="20px",n.height="20px",n.color="#364249",n.background="#CCCCCC",n.group=this.name,n.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,n.onIsCheckedChangedObservable.add(function(e){e&&t(r)});var o=Be.a.AddHeader(n,e,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),n.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(n.color=this.groupPanel.parent.parent.buttonColor,n.background=this.groupPanel.parent.parent.buttonBackground)},fe.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},fe.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},fe.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},fe.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t},fe);function fe(){var e=null!==ce&&ce.apply(this,arguments)||this;return e._selectNb=0,e}var de,pe=(de=oe,Object(n.c)(_e,de),_e.prototype.addSlider=function(e,t,i,r,n,o,s){void 0===t&&(t=function(e){}),void 0===i&&(i="Units"),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=function(e){return 0|e});var a=new re;a.name=i,a.value=o,a.minimum=r,a.maximum=n,a.width=.9,a.height="20px",a.color="#364249",a.background="#CCCCCC",a.borderColor="black",a.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,a.left="4px",a.paddingBottom="4px",a.onValueChangedObservable.add(function(e){a.parent.children[0].text=a.parent.children[0].name+": "+s(e)+" "+a.name,t(e)});var h=Be.a.AddHeader(a,e+": "+s(o)+" "+i,"30px",{isHorizontal:!1,controlFirst:!1});h.height="60px",h.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,h.left="4px",h.children[0].name=e,this.groupPanel.addControl(h),this.selectors.push(h),this.groupPanel.parent&&this.groupPanel.parent.parent&&(a.color=this.groupPanel.parent.parent.buttonColor,a.background=this.groupPanel.parent.parent.buttonBackground)},_e.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[0].name=t,this.selectors[e].children[0].text=t+": "+this.selectors[e].children[1].value+" "+this.selectors[e].children[1].name},_e.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[0].color=t},_e.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[1].color=t},_e.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[1].background=t},_e);function _e(){return null!==de&&de.apply(this,arguments)||this}var ge,me=(ge=Ne,Object(n.c)(ve,ge),ve.prototype._getTypeName=function(){return"SelectionPanel"},Object.defineProperty(ve.prototype,"headerColor",{get:function(){return this._headerColor},set:function(e){this._headerColor!==e&&(this._headerColor=e,this._setHeaderColor())},enumerable:!0,configurable:!0}),ve.prototype._setHeaderColor=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].groupPanel.children[0].color=this._headerColor},Object.defineProperty(ve.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(e){this._buttonColor!==e&&(this._buttonColor=e,this._setbuttonColor())},enumerable:!0,configurable:!0}),ve.prototype._setbuttonColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonColor(t,this._buttonColor)},Object.defineProperty(ve.prototype,"labelColor",{get:function(){return this._labelColor},set:function(e){this._labelColor!==e&&(this._labelColor=e,this._setLabelColor())},enumerable:!0,configurable:!0}),ve.prototype._setLabelColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorLabelColor(t,this._labelColor)},Object.defineProperty(ve.prototype,"buttonBackground",{get:function(){return this._buttonBackground},set:function(e){this._buttonBackground!==e&&(this._buttonBackground=e,this._setButtonBackground())},enumerable:!0,configurable:!0}),ve.prototype._setButtonBackground=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonBackground(t,this._buttonBackground)},Object.defineProperty(ve.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._setBarColor())},enumerable:!0,configurable:!0}),ve.prototype._setBarColor=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].background=this._barColor},Object.defineProperty(ve.prototype,"barHeight",{get:function(){return this._barHeight},set:function(e){this._barHeight!==e&&(this._barHeight=e,this._setBarHeight())},enumerable:!0,configurable:!0}),ve.prototype._setBarHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].height=this._barHeight},Object.defineProperty(ve.prototype,"spacerHeight",{get:function(){return this._spacerHeight},set:function(e){this._spacerHeight!==e&&(this._spacerHeight=e,this._setSpacerHeight())},enumerable:!0,configurable:!0}),ve.prototype._setSpacerHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].height=this._spacerHeight},ve.prototype._addSpacer=function(){var e=new c.a;e.width=1,e.height=this._spacerHeight,e.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT;var t=new Ne;t.width=1,t.height=this._barHeight,t.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,t.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,t.background=this._barColor,t.color="transparent",e.addControl(t),this._panel.addControl(e),this._bars.push(e)},ve.prototype.addGroup=function(e){0<this._groups.length&&this._addSpacer(),this._panel.addControl(e.groupPanel),this._groups.push(e),e.groupPanel.children[0].color=this._headerColor;for(var t=0;t<e.selectors.length;t++)e._setSelectorButtonColor(t,this._buttonColor),e._setSelectorButtonBackground(t,this._buttonBackground)},ve.prototype.removeGroup=function(e){if(!(e<0||e>=this._groups.length)){var t=this._groups[e];this._panel.removeControl(t.groupPanel),this._groups.splice(e,1),e<this._bars.length&&(this._panel.removeControl(this._bars[e]),this._bars.splice(e,1))}},ve.prototype.setHeaderName=function(e,t){t<0||t>=this._groups.length||(this._groups[t].groupPanel.children[0].text=e)},ve.prototype.relabel=function(e,t,i){if(!(t<0||t>=this._groups.length)){var r=this._groups[t];i<0||i>=r.selectors.length||r._setSelectorLabel(i,e)}},ve.prototype.removeFromGroupSelector=function(e,t){if(!(e<0||e>=this._groups.length)){var i=this._groups[e];t<0||t>=i.selectors.length||i.removeSelector(t)}},ve.prototype.addToGroupCheckbox=function(e,t,i,r){void 0===i&&(i=function(){}),void 0===r&&(r=!1),e<0||e>=this._groups.length||this._groups[e].addCheckbox(t,i,r)},ve.prototype.addToGroupRadio=function(e,t,i,r){void 0===i&&(i=function(){}),void 0===r&&(r=!1),e<0||e>=this._groups.length||this._groups[e].addRadio(t,i,r)},ve.prototype.addToGroupSlider=function(e,t,i,r,n,o,s,a){void 0===i&&(i=function(){}),void 0===r&&(r="Units"),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=function(e){return 0|e}),e<0||e>=this._groups.length||this._groups[e].addSlider(t,i,r,n,o,s,a)},ve);function ve(e,t){void 0===t&&(t=[]);var i=ge.call(this,e)||this;if(i.name=e,i.groups=t,i._buttonColor="#364249",i._buttonBackground="#CCCCCC",i._headerColor="black",i._barColor="white",i._barHeight="2px",i._spacerHeight="20px",i._bars=new Array,i._groups=t,i.thickness=2,i._panel=new x,i._panel.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,i._panel.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,i._panel.top=5,i._panel.left=5,i._panel.width=.95,0<t.length){for(var r=0;r<t.length-1;r++)i._panel.addControl(t[r].groupPanel),i._addSpacer();i._panel.addControl(t[t.length-1].groupPanel)}return i.addControl(i._panel),i}var be,ye=i(29),xe=(be=c.a,Object(n.c)(Te,be),Object.defineProperty(Te.prototype,"freezeControls",{get:function(){return this._freezeControls},set:function(e){if(this._freezeControls!==e){this._freezeControls=!1;var t=this.host.getSize(),i=t.width,r=t.height,n=this.host.getContext(),o=new ye.a(0,0,i,r);this.host._numLayoutCalls=0,this.host._rootContainer._layout(o,n),e&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=e,this.host.markAsDirty()}},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"bucketWidth",{get:function(){return this._bucketWidth},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"bucketHeight",{get:function(){return this._bucketHeight},enumerable:!0,configurable:!0}),Te.prototype.setBucketSizes=function(e,t){this._bucketWidth=e,this._bucketHeight=t,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}},Te.prototype._useBuckets=function(){return 0<this._bucketWidth&&0<this._bucketHeight},Te.prototype._makeBuckets=function(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children)},Te.prototype._dispatchInBuckets=function(e){for(var t=0;t<e.length;++t){for(var i=e[t],r=Math.max(0,Math.floor((i._currentMeasure.left-this._currentMeasure.left)/this._bucketWidth)),n=Math.floor((i._currentMeasure.left-this._currentMeasure.left+i._currentMeasure.width-1)/this._bucketWidth),o=Math.max(0,Math.floor((i._currentMeasure.top-this._currentMeasure.top)/this._bucketHeight)),s=Math.floor((i._currentMeasure.top-this._currentMeasure.top+i._currentMeasure.height-1)/this._bucketHeight);o<=s;){for(var a=r;a<=n;++a){var h=o*this._bucketLen+a,l=this._buckets[h];l||(l=[],this._buckets[h]=l),l.push(i)}o++}i instanceof c.a&&0<i._children.length&&this._dispatchInBuckets(i._children)}},Te.prototype._updateMeasures=function(){var e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left-=e,this._measureForChildren.top-=t,this._currentMeasure.left-=e,this._currentMeasure.top-=t,this._updateChildrenMeasures(this._children,e,t)},Te.prototype._updateChildrenMeasures=function(e,t,i){for(var r=0;r<e.length;++r){var n=e[r];n._currentMeasure.left-=t,n._currentMeasure.top-=i,n._customData._origLeft=n._currentMeasure.left,n._customData._origTop=n._currentMeasure.top,n instanceof c.a&&0<n._children.length&&this._updateChildrenMeasures(n._children,t,i)}},Te.prototype._getTypeName=function(){return"ScrollViewerWindow"},Te.prototype._additionalProcessing=function(e,t){be.prototype._additionalProcessing.call(this,e,t),this._parentMeasure=e,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=e.width,this._measureForChildren.height=e.height},Te.prototype._layout=function(e,t){return this._freezeControls?(this.invalidateRect(),!1):be.prototype._layout.call(this,e,t)},Te.prototype._scrollChildren=function(e,t,i){for(var r=0;r<e.length;++r){var n=e[r];n._currentMeasure.left=n._customData._origLeft+t,n._currentMeasure.top=n._customData._origTop+i,n._isClipped=!1,n instanceof c.a&&0<n._children.length&&this._scrollChildren(n._children,t,i)}},Te.prototype._scrollChildrenWithBuckets=function(e,t,i,r){for(var n=Math.max(0,Math.floor(-e/this._bucketWidth)),o=Math.floor((-e+this._parentMeasure.width-1)/this._bucketWidth),s=Math.max(0,Math.floor(-t/this._bucketHeight)),a=Math.floor((-t+this._parentMeasure.height-1)/this._bucketHeight);s<=a;){for(var h=n;h<=o;++h){var l=s*this._bucketLen+h,c=this._buckets[l];if(c)for(var u=0;u<c.length;++u){var f=c[u];f._currentMeasure.left=f._customData._origLeft+i,f._currentMeasure.top=f._customData._origTop+r,f._isClipped=!1}}s++}},Te.prototype._draw=function(e,t){if(this._freezeControls){this._localDraw(e),this.clipChildren&&this._clipForChildren(e);var i=this.leftInPixels,r=this.topInPixels;this._useBuckets()?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,i,r),this._scrollChildrenWithBuckets(i,r,i,r)):this._scrollChildren(this._children,i,r),this._oldLeft=i,this._oldTop=r;for(var n=0,o=this._children;n<o.length;n++){var s=o[n];s._intersectsRect(this._parentMeasure)&&s._render(e,this._parentMeasure)}}else be.prototype._draw.call(this,e,t)},Te.prototype._postMeasure=function(){if(this._freezeControls)be.prototype._postMeasure.call(this);else{for(var e=this.parentClientWidth,t=this.parentClientHeight,i=0,r=this.children;i<r.length;i++){var n=r[i];n.isVisible&&!n.notRenderable&&(n.horizontalAlignment===Be.a.HORIZONTAL_ALIGNMENT_CENTER&&n._offsetLeft(this._currentMeasure.left-n._currentMeasure.left),n.verticalAlignment===Be.a.VERTICAL_ALIGNMENT_CENTER&&n._offsetTop(this._currentMeasure.top-n._currentMeasure.top),e=Math.max(e,n._currentMeasure.left-this._currentMeasure.left+n._currentMeasure.width),t=Math.max(t,n._currentMeasure.top-this._currentMeasure.top+n._currentMeasure.height))}this._currentMeasure.width!==e&&(this._width.updateInPlace(e,l.a.UNITMODE_PIXEL),this._currentMeasure.width=e,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==t&&(this._height.updateInPlace(t,l.a.UNITMODE_PIXEL),this._currentMeasure.height=t,this._rebuildLayout=!0,this._isDirty=!0),be.prototype._postMeasure.call(this)}},Te);function Te(e){var t=be.call(this,e)||this;return t._freezeControls=!1,t._bucketWidth=0,t._bucketHeight=0,t._buckets={},t}var Me,Ee=(Me=ee,Object(n.c)(Ae,Me),Object.defineProperty(Ae.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Ae.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Ae.prototype._getTypeName=function(){return"Scrollbar"},Ae.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},Ae.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._renderLeft,i=this._getThumbPosition();e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.fillStyle=this.color,this.isVertical?(this._tempMeasure.left=t-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),e.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),e.restore()},Ae.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0;i=this.isVertical?-((t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},Ae.prototype._onPointerDown=function(e,t,i,r){return this._first=!0,Me.prototype._onPointerDown.call(this,e,t,i,r)},Ae);function Ae(e){var t=Me.call(this,e)||this;return t.name=e,t._background="black",t._borderColor="white",t._tempMeasure=new ye.a(0,0,0,0),t}var Oe,Pe=(Oe=ee,Object(n.c)(Ce,Oe),Object.defineProperty(Ce.prototype,"backgroundImage",{get:function(){return this._backgroundBaseImage},set:function(t){var i=this;this._backgroundBaseImage!==t&&(this._backgroundBaseImage=t,this.isVertical&&0!==this.num90RotationInVerticalMode?t.isLoaded?(this._backgroundImage=t._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce(function(){var e=t._rotate90(i.num90RotationInVerticalMode,!0);(i._backgroundImage=e).isLoaded||e.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),i._markAsDirty()}):((this._backgroundImage=t)&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),this._markAsDirty()))},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"thumbImage",{get:function(){return this._thumbBaseImage},set:function(t){var i=this;this._thumbBaseImage!==t&&(this._thumbBaseImage=t,this.isVertical&&0!==this.num90RotationInVerticalMode?t.isLoaded?(this._thumbImage=t._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce(function(){var e=t._rotate90(-i.num90RotationInVerticalMode,!0);(i._thumbImage=e).isLoaded||e.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),i._markAsDirty()}):((this._thumbImage=t)&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),this._markAsDirty()))},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){this._thumbLength!==e&&(this._thumbLength=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){this._thumbLength!==e&&(this._thumbHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){this._barImageHeight!==e&&(this._barImageHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Ce.prototype._getTypeName=function(){return"ImageScrollBar"},Ce.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},Ce.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._getThumbPosition(),i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,r,n,o),this.isVertical?(this._tempMeasure.copyFromFloats(i+n*(1-this._barImageHeight)*.5,this._currentMeasure.top,n*this._barImageHeight,o),this._tempMeasure.height+=this._effectiveThumbThickness):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,r+o*(1-this._barImageHeight)*.5,n,o*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+t,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},Ce.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0;i=this.isVertical?-((t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},Ce.prototype._onPointerDown=function(e,t,i,r){return this._first=!0,Oe.prototype._onPointerDown.call(this,e,t,i,r)},Ce);function Ce(e){var t=Oe.call(this,e)||this;return t.name=e,t._thumbLength=.5,t._thumbHeight=1,t._barImageHeight=1,t._tempMeasure=new ye.a(0,0,0,0),t.num90RotationInVerticalMode=1,t}var Se,Re=(Se=Ne,Object(n.c)(Ie,Se),Object.defineProperty(Ie.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!0,configurable:!0}),Ie.prototype.addControl=function(e){return e&&this._window.addControl(e),this},Ie.prototype.removeControl=function(e){return this._window.removeControl(e),this},Object.defineProperty(Ie.prototype,"children",{get:function(){return this._window.children},enumerable:!0,configurable:!0}),Ie.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this._children;e<t.length;e++)t[e]._markMatrixAsDirty()},Object.defineProperty(Ie.prototype,"freezeControls",{get:function(){return this._window.freezeControls},set:function(e){this._window.freezeControls=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"bucketWidth",{get:function(){return this._window.bucketWidth},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"bucketHeight",{get:function(){return this._window.bucketHeight},enumerable:!0,configurable:!0}),Ie.prototype.setBucketSizes=function(e,t){this._window.setBucketSizes(e,t)},Object.defineProperty(Ie.prototype,"forceHorizontalBar",{get:function(){return this._forceHorizontalBar},set:function(e){this._grid.setRowDefinition(1,e?this._barSize:0,!0),this._horizontalBar.isVisible=e,this._forceHorizontalBar=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"forceVerticalBar",{get:function(){return this._forceVerticalBar},set:function(e){this._grid.setColumnDefinition(1,e?this._barSize:0,!0),this._verticalBar.isVisible=e,this._forceVerticalBar=e},enumerable:!0,configurable:!0}),Ie.prototype.resetWindow=function(){this._window.width="100%",this._window.height="100%"},Ie.prototype._getTypeName=function(){return"ScrollViewer"},Ie.prototype._buildClientSizes=function(){var e=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*e:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*e:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight},Ie.prototype._additionalProcessing=function(e,t){Se.prototype._additionalProcessing.call(this,e,t),this._buildClientSizes()},Ie.prototype._postMeasure=function(){Se.prototype._postMeasure.call(this),this._updateScroller()},Object.defineProperty(Ie.prototype,"wheelPrecision",{get:function(){return this._wheelPrecision},set:function(e){this._wheelPrecision!==e&&(e<0&&(e=0),1<e&&(e=1),this._wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"scrollBackground",{get:function(){return this._horizontalBarSpace.background},set:function(e){this._horizontalBarSpace.background!==e&&(this._horizontalBarSpace.background=e,this._verticalBarSpace.background=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._horizontalBar.color=e,this._verticalBar.color=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"thumbImage",{get:function(){return this._barImage},set:function(e){if(this._barImage!==e){this._barImage=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbImage=e,i.thumbImage=e}},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"horizontalThumbImage",{get:function(){return this._horizontalBarImage},set:function(e){this._horizontalBarImage!==e&&(this._horizontalBarImage=e,this._horizontalBar.thumbImage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"verticalThumbImage",{get:function(){return this._verticalBarImage},set:function(e){this._verticalBarImage!==e&&(this._verticalBarImage=e,this._verticalBar.thumbImage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"barSize",{get:function(){return this._barSize},set:function(e){this._barSize!==e&&(this._barSize=e,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){if(this._thumbLength!==e){e<=0&&(e=.1),1<e&&(e=1),this._thumbLength=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbLength=e,i.thumbLength=e,this._markAsDirty()}},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){if(this._thumbHeight!==e){e<=0&&(e=.1),1<e&&(e=1),this._thumbHeight=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbHeight=e,i.thumbHeight=e,this._markAsDirty()}},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){if(this._barImageHeight!==e){e<=0&&(e=.1),1<e&&(e=1),this._barImageHeight=e;var t=this._horizontalBar,i=this._verticalBar;t.barImageHeight=e,i.barImageHeight=e,this._markAsDirty()}},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"horizontalBarImageHeight",{get:function(){return this._horizontalBarImageHeight},set:function(e){this._horizontalBarImageHeight!==e&&(e<=0&&(e=.1),1<e&&(e=1),this._horizontalBarImageHeight=e,this._horizontalBar.barImageHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"verticalBarImageHeight",{get:function(){return this._verticalBarImageHeight},set:function(e){this._verticalBarImageHeight!==e&&(e<=0&&(e=.1),1<e&&(e=1),this._verticalBarImageHeight=e,this._verticalBar.barImageHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"barBackground",{get:function(){return this._barBackground},set:function(e){if(this._barBackground!==e){this._barBackground=e;var t=this._horizontalBar,i=this._verticalBar;t.background=e,i.background=e,this._dragSpace.background=e}},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"barImage",{get:function(){return this._barBackgroundImage},set:function(e){this._barBackgroundImage,this._barBackgroundImage=e;var t=this._horizontalBar,i=this._verticalBar;t.backgroundImage=e,i.backgroundImage=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"horizontalBarImage",{get:function(){return this._horizontalBarBackgroundImage},set:function(e){this._horizontalBarBackgroundImage,this._horizontalBarBackgroundImage=e,this._horizontalBar.backgroundImage=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"verticalBarImage",{get:function(){return this._verticalBarBackgroundImage},set:function(e){this._verticalBarBackgroundImage,this._verticalBarBackgroundImage=e,this._verticalBar.backgroundImage=e},enumerable:!0,configurable:!0}),Ie.prototype._setWindowPosition=function(){var e=this.host.idealRatio,t=this._window._currentMeasure.width,i=this._window._currentMeasure.height,r=this._clientWidth-t,n=this._clientHeight-i,o=this._horizontalBar.value/e*r+"px",s=this._verticalBar.value/e*n+"px";o!==this._window.left&&(this._window.left=o,this.freezeControls||(this._rebuildLayout=!0)),s!==this._window.top&&(this._window.top=s,this.freezeControls||(this._rebuildLayout=!0))},Ie.prototype._updateScroller=function(){var e=this._window._currentMeasure.width,t=this._window._currentMeasure.height;this._horizontalBar.isVisible&&e<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(e>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&t<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(t>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();var i=this.host.idealRatio;this._horizontalBar.thumbWidth=.9*this._thumbLength*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*(this._clientHeight/i)+"px"},Ie.prototype._link=function(e){Se.prototype._link.call(this,e),this._attachWheel()},Ie.prototype._addBar=function(e,t,i,r){var n=this;e.paddingLeft=0,e.width="100%",e.height="100%",e.barOffset=0,e.value=0,e.maximum=1,e.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_CENTER,e.isVertical=i,e.rotation=r,e.isVisible=!1,t.addControl(e),e.onValueChangedObservable.add(function(e){n._setWindowPosition()})},Ie.prototype._attachWheel=function(){var t=this;this._host&&!this._onWheelObserver&&(this._onWheelObserver=this.onWheelObservable.add(function(e){t._pointerIsOver&&(1==t._verticalBar.isVisible&&(e.y<0&&0<t._verticalBar.value?t._verticalBar.value-=t._wheelPrecision:0<e.y&&t._verticalBar.value<t._verticalBar.maximum&&(t._verticalBar.value+=t._wheelPrecision)),1==t._horizontalBar.isVisible&&(e.x<0&&t._horizontalBar.value<t._horizontalBar.maximum?t._horizontalBar.value+=t._wheelPrecision:0<e.x&&0<t._horizontalBar.value&&(t._horizontalBar.value-=t._wheelPrecision)))}))},Ie.prototype._renderHighlightSpecific=function(e){this.isHighlighted&&(Se.prototype._renderHighlightSpecific.call(this,e),this._grid._renderHighlightSpecific(e),e.restore())},Ie.prototype.dispose=function(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,Se.prototype.dispose.call(this)},Ie);function Ie(e,t){var i=Se.call(this,e)||this;return i._barSize=20,i._pointerIsOver=!1,i._wheelPrecision=.05,i._thumbLength=.5,i._thumbHeight=1,i._barImageHeight=1,i._horizontalBarImageHeight=1,i._verticalBarImageHeight=1,i._forceHorizontalBar=!1,i._forceVerticalBar=!1,i._useImageBar=t||!1,i.onDirtyObservable.add(function(){i._horizontalBarSpace.color=i.color,i._verticalBarSpace.color=i.color,i._dragSpace.color=i.color}),i.onPointerEnterObservable.add(function(){i._pointerIsOver=!0}),i.onPointerOutObservable.add(function(){i._pointerIsOver=!1}),i._grid=new ze,i._useImageBar?(i._horizontalBar=new Pe,i._verticalBar=new Pe):(i._horizontalBar=new Ee,i._verticalBar=new Ee),i._window=new xe("scrollViewer_window"),i._window.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,i._window.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,i._grid.addColumnDefinition(1),i._grid.addColumnDefinition(0,!0),i._grid.addRowDefinition(1),i._grid.addRowDefinition(0,!0),Se.prototype.addControl.call(i,i._grid),i._grid.addControl(i._window,0,0),i._verticalBarSpace=new Ne,i._verticalBarSpace.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,i._verticalBarSpace.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,i._verticalBarSpace.thickness=1,i._grid.addControl(i._verticalBarSpace,0,1),i._addBar(i._verticalBar,i._verticalBarSpace,!0,Math.PI),i._horizontalBarSpace=new Ne,i._horizontalBarSpace.horizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,i._horizontalBarSpace.verticalAlignment=Be.a.VERTICAL_ALIGNMENT_TOP,i._horizontalBarSpace.thickness=1,i._grid.addControl(i._horizontalBarSpace,1,0),i._addBar(i._horizontalBar,i._horizontalBarSpace,!1,0),i._dragSpace=new Ne,i._dragSpace.thickness=1,i._grid.addControl(i._dragSpace,1,1),i._useImageBar||(i.barColor="grey",i.barBackground="transparent"),i}o.a.RegisteredTypes["BABYLON.GUI.ScrollViewer"]=Re;var we,De=function(){},Le=(we=x,Object(n.c)(Fe,we),Fe.prototype._getTypeName=function(){return"VirtualKeyboard"},Fe.prototype._createKey=function(e,t){var i=this,r=Ue.CreateSimpleButton(e,e);return r.width=t&&t.width?t.width:this.defaultButtonWidth,r.height=t&&t.height?t.height:this.defaultButtonHeight,r.color=t&&t.color?t.color:this.defaultButtonColor,r.background=t&&t.background?t.background:this.defaultButtonBackground,r.paddingLeft=t&&t.paddingLeft?t.paddingLeft:this.defaultButtonPaddingLeft,r.paddingRight=t&&t.paddingRight?t.paddingRight:this.defaultButtonPaddingRight,r.paddingTop=t&&t.paddingTop?t.paddingTop:this.defaultButtonPaddingTop,r.paddingBottom=t&&t.paddingBottom?t.paddingBottom:this.defaultButtonPaddingBottom,r.thickness=0,r.isFocusInvisible=!0,r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY,r.onPointerUpObservable.add(function(){i.onKeyPressObservable.notifyObservers(e)}),r},Fe.prototype.addKeysRow=function(e,t){var i=new x;i.isVertical=!1,i.isFocusInvisible=!0;for(var r=null,n=0;n<e.length;n++){var o=null;t&&t.length===e.length&&(o=t[n]);var s=this._createKey(e[n],o);(!r||s.heightInPixels>r.heightInPixels)&&(r=s),i.addControl(s)}i.height=r?r.height:this.defaultButtonHeight,this.addControl(i)},Fe.prototype.applyShiftState=function(e){if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i&&i.children)for(var r=i,n=0;n<r.children.length;n++){var o=r.children[n];if(o&&o.children[0]){var s=o.children[0];"⇧"===s.text&&(o.color=e?this.shiftButtonColor:this.defaultButtonColor,o.thickness=1<e?this.selectedShiftThickness:0),s.text=0<e?s.text.toUpperCase():s.text.toLowerCase()}}}},Object.defineProperty(Fe.prototype,"connectedInputText",{get:function(){return this._currentlyConnectedInputText},enumerable:!0,configurable:!0}),Fe.prototype.connect=function(t){var i=this;if(!this._connectedInputTexts.some(function(e){return e.input===t})){null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add(function(e){if(i._currentlyConnectedInputText){switch(i._currentlyConnectedInputText._host.focusedControl=i._currentlyConnectedInputText,e){case"⇧":return i.shiftState++,2<i.shiftState&&(i.shiftState=0),void i.applyShiftState(i.shiftState);case"←":return void i._currentlyConnectedInputText.processKey(8);case"↵":return void i._currentlyConnectedInputText.processKey(13)}i._currentlyConnectedInputText.processKey(-1,i.shiftState?e.toUpperCase():e),1===i.shiftState&&(i.shiftState=0,i.applyShiftState(i.shiftState))}})),this.isVisible=!1,(this._currentlyConnectedInputText=t)._connectedVirtualKeyboard=this;var e=t.onFocusObservable.add(function(){((i._currentlyConnectedInputText=t)._connectedVirtualKeyboard=i).isVisible=!0}),r=t.onBlurObservable.add(function(){t._connectedVirtualKeyboard=null,i._currentlyConnectedInputText=null,i.isVisible=!1});this._connectedInputTexts.push({input:t,onBlurObserver:r,onFocusObserver:e})}},Fe.prototype.disconnect=function(t){var i=this;if(t){var e=this._connectedInputTexts.filter(function(e){return e.input===t});1===e.length&&(this._removeConnectedInputObservables(e[0]),this._connectedInputTexts=this._connectedInputTexts.filter(function(e){return e.input!==t}),this._currentlyConnectedInputText===t&&(this._currentlyConnectedInputText=null))}else this._connectedInputTexts.forEach(function(e){i._removeConnectedInputObservables(e)}),this._connectedInputTexts=[];0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)},Fe.prototype._removeConnectedInputObservables=function(e){e.input._connectedVirtualKeyboard=null,e.input.onFocusObservable.remove(e.onFocusObserver),e.input.onBlurObservable.remove(e.onBlurObserver)},Fe.prototype.dispose=function(){we.prototype.dispose.call(this),this.disconnect()},Fe.CreateDefaultLayout=function(e){var t=new Fe(e);return t.addKeysRow(["1","2","3","4","5","6","7","8","9","0","←"]),t.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),t.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'","↵"]),t.addKeysRow(["⇧","z","x","c","v","b","n","m",",",".","/"]),t.addKeysRow([" "],[{width:"200px"}]),t},Fe);function Fe(){var e=null!==we&&we.apply(this,arguments)||this;return e.onKeyPressObservable=new h.a,e.defaultButtonWidth="40px",e.defaultButtonHeight="40px",e.defaultButtonPaddingLeft="2px",e.defaultButtonPaddingRight="2px",e.defaultButtonPaddingTop="2px",e.defaultButtonPaddingBottom="2px",e.defaultButtonColor="#DDD",e.defaultButtonBackground="#070707",e.shiftButtonColor="#7799FF",e.selectedShiftThickness=1,e.shiftState=0,e._currentlyConnectedInputText=null,e._connectedInputTexts=[],e._onKeyPressObserver=null,e}o.a.RegisteredTypes["BABYLON.GUI.VirtualKeyboard"]=Le;var Ge,He=(Ge=Be.a,Object(n.c)(Xe,Ge),Object.defineProperty(Xe.prototype,"displayMinorLines",{get:function(){return this._displayMinorLines},set:function(e){this._displayMinorLines!==e&&(this._displayMinorLines=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"displayMajorLines",{get:function(){return this._displayMajorLines},set:function(e){this._displayMajorLines!==e&&(this._displayMajorLines=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"minorLineTickness",{get:function(){return this._minorLineTickness},set:function(e){this._minorLineTickness=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"minorLineColor",{get:function(){return this._minorLineColor},set:function(e){this._minorLineColor=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"majorLineTickness",{get:function(){return this._majorLineTickness},set:function(e){this._majorLineTickness=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"majorLineColor",{get:function(){return this._majorLineColor},set:function(e){this._majorLineColor=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.prototype,"majorLineFrequency",{get:function(){return this._majorLineFrequency},set:function(e){this._majorLineFrequency=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Xe.prototype._draw=function(e,t){if(e.save(),this._applyStates(e),this._isEnabled){this._background&&(e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));var i=this._currentMeasure.width/this._cellWidth,r=this._currentMeasure.height/this._cellHeight,n=this._currentMeasure.left+this._currentMeasure.width/2,o=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){e.strokeStyle=this._minorLineColor,e.lineWidth=this._minorLineTickness;for(var s=-i/2;s<i/2;s++){var a=n+s*this.cellWidth;e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(var h=-r/2;h<r/2;h++){var l=o+h*this.cellHeight;e.beginPath(),e.moveTo(this._currentMeasure.left,l),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),e.stroke()}}if(this._displayMajorLines){for(e.strokeStyle=this._majorLineColor,e.lineWidth=this._majorLineTickness,s=-i/2+this._majorLineFrequency;s<i/2;s+=this._majorLineFrequency)a=n+s*this.cellWidth,e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke();for(h=-r/2+this._majorLineFrequency;h<r/2;h+=this._majorLineFrequency)l=o+h*this.cellHeight,e.moveTo(this._currentMeasure.left,l),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),e.closePath(),e.stroke()}}e.restore()},Xe.prototype._getTypeName=function(){return"DisplayGrid"},Xe);function Xe(e){var t=Ge.call(this,e)||this;return t.name=e,t._cellWidth=20,t._cellHeight=20,t._minorLineTickness=1,t._minorLineColor="DarkGray",t._majorLineTickness=2,t._majorLineColor="White",t._majorLineFrequency=5,t._background="Black",t._displayMajorLines=!0,t._displayMinorLines=!0,t}o.a.RegisteredTypes["BABYLON.GUI.DisplayGrid"]=He;var Ke,Ye=(Ke=ee,Object(n.c)(qe,Ke),Object.defineProperty(qe.prototype,"displayThumb",{get:function(){return this._displayThumb&&null!=this.thumbImage},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"backgroundImage",{get:function(){return this._backgroundImage},set:function(e){var t=this;this._backgroundImage!==e&&((this._backgroundImage=e)&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"valueBarImage",{get:function(){return this._valueBarImage},set:function(e){var t=this;this._valueBarImage!==e&&((this._valueBarImage=e)&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"thumbImage",{get:function(){return this._thumbImage},set:function(e){var t=this;this._thumbImage!==e&&((this._thumbImage=e)&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),qe.prototype._getTypeName=function(){return"ImageBasedSlider"},qe.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var i=this._getThumbPosition(),r=this._renderLeft,n=this._renderTop,o=this._renderWidth,s=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(r,n,o,s),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(r,n+i,o,s-i+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(r,n+i,o,s-i):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(r,n,i+this._effectiveThumbThickness/2,s):this._tempMeasure.copyFromFloats(r,n,i,s),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(e)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(r-this._effectiveBarOffset,this._currentMeasure.top+i,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+i,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},qe);function qe(e){var t=Ke.call(this,e)||this;return t.name=e,t._tempMeasure=new ye.a(0,0,0,0),t}o.a.RegisteredTypes["BABYLON.GUI.ImageBasedSlider"]=Ye;var Ze="Statics";Be.a.AddHeader=function(e,t,i,r){var n=new x("panel"),o=!r||r.isHorizontal,s=!r||r.controlFirst;n.isVertical=!o;var a=new ke("header");return a.text=t,a.textHorizontalAlignment=Be.a.HORIZONTAL_ALIGNMENT_LEFT,o?a.width=i:a.height=i,s?(n.addControl(e),n.addControl(a),a.paddingLeft="5px"):(n.addControl(a),n.addControl(e),a.paddingRight="5px"),a.shadowBlur=e.shadowBlur,a.shadowColor=e.shadowColor,a.shadowOffsetX=e.shadowOffsetX,a.shadowOffsetY=e.shadowOffsetY,n}},function(e,t,i){"use strict";i.r(t),i.d(t,"AdvancedDynamicTexture",function(){return N});var r=i(1),l=i(4),c=i(0),u=i(13),d=i(9),a=i(45),h=i(44),f=i(48),p=i(18),n=i(78),_=i(7),g=i(23),m=i(2),o=i(27),v=i(22),b=(s.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(v.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(v.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(v.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(v.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},s.prototype.rebuild=function(){for(var e=0,t=this.scene.layers;e<t.length;e++)t[e]._rebuild()},s.prototype.dispose=function(){for(var e=this.scene.layers;e.length;)e[0].dispose()},s.prototype._draw=function(e){var t=this.scene.layers;if(t.length){this._engine.setDepthBuffer(!1);for(var i=0,r=t;i<r.length;i++){var n=r[i];e(n)&&n.render()}this._engine.setDepthBuffer(!0)}},s.prototype._drawCameraPredicate=function(e,t,i){return!e.renderOnlyInRenderTargetTextures&&e.isBackground===t&&0!=(e.layerMask&i)},s.prototype._drawCameraBackground=function(t){var i=this;this._draw(function(e){return i._drawCameraPredicate(e,!0,t.layerMask)})},s.prototype._drawCameraForeground=function(t){var i=this;this._draw(function(e){return i._drawCameraPredicate(e,!1,t.layerMask)})},s.prototype._drawRenderTargetPredicate=function(e,t,i,r){return 0<e.renderTargetTextures.length&&e.isBackground===t&&-1<e.renderTargetTextures.indexOf(r)&&0!=(e.layerMask&i)},s.prototype._drawRenderTargetBackground=function(t){var i=this;this._draw(function(e){return i._drawRenderTargetPredicate(e,!0,i.scene.activeCamera.layerMask,t)})},s.prototype._drawRenderTargetForeground=function(t){var i=this;this._draw(function(e){return i._drawRenderTargetPredicate(e,!1,i.scene.activeCamera.layerMask,t)})},s.prototype.addFromContainer=function(e){var t=this;e.layers&&e.layers.forEach(function(e){t.scene.layers.push(e)})},s.prototype.removeFromContainer=function(e,i){var r=this;void 0===i&&(i=!1),e.layers&&e.layers.forEach(function(e){var t=r.scene.layers.indexOf(e);-1!==t&&r.scene.layers.splice(t,1),i&&e.dispose()})},s);function s(e){this.name=v.a.NAME_LAYER,this.scene=e,this._engine=e.getEngine(),e.layers=new Array}var y=i(6),x=(i(75),"layerPixelShader"),T="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\n\n#include<helperFunctions>\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef LINEAR\nbaseColor.rgb=toGammaSpace(baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",M=(y.a.ShadersStore[x]=T,"layerVertexShader"),E="\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",A=(y.a.ShadersStore[M]=E,Object.defineProperty(O.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),O.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},O.prototype._rebuild=function(){var e=this._vertexBuffers[m.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},O.prototype.render=function(){var e=this._scene.getEngine(),t="";this.alphaTest&&(t="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(t+="\r\n#define LINEAR"),this._previousDefines!==t&&(this._previousDefines=t,this._effect=e.createEffect("layer",[m.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],t));var i=this._effect;i&&i.isReady()&&this.texture&&this.texture.isReady()&&(e=this._scene.getEngine(),this.onBeforeRenderObservable.notifyObservers(this),e.enableEffect(i),e.setState(!1),i.setTexture("textureSampler",this.texture),i.setMatrix("textureMatrix",this.texture.getTextureMatrix()),i.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),i.setVector2("offset",this.offset),i.setVector2("scale",this.scale),e.bindBuffers(this._vertexBuffers,this._indexBuffer,i),this.alphaTest?e.drawElementsType(o.a.TriangleFillMode,0,6):(e.setAlphaMode(this.alphaBlendingMode),e.drawElementsType(o.a.TriangleFillMode,0,6),e.setAlphaMode(0)),this.onAfterRenderObservable.notifyObservers(this))},O.prototype.dispose=function(){var e=this._vertexBuffers[m.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[m.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var t=this._scene.layers.indexOf(this);this._scene.layers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},O);function O(e,t,i,r,n){this.name=e,this.scale=new c.d(1,1),this.offset=new c.d(0,0),this.alphaBlendingMode=2,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new l.a,this.onBeforeRenderObservable=new l.a,this.onAfterRenderObservable=new l.a,this.texture=t?new p.a(t,i,!0):null,this.isBackground=void 0===r||r,this.color=void 0===n?new _.b(1,1,1,1):n,this._scene=i||g.a.LastCreatedScene;var o=this._scene._getComponent(v.a.NAME_LAYER);o||(o=new b(this._scene),this._scene._addComponent(o)),this._scene.layers.push(this);var s=this._scene.getEngine(),a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1);var h=new m.b(s,a,m.b.PositionKind,!1,!1,2);this._vertexBuffers[m.b.PositionKind]=h,this._createIndexBuffer()}var P=i(31),C=i(14),S=(Object.defineProperty(R.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&this.onChangedObservable.notifyObservers(this)},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),R.prototype.dispose=function(){this.onChangedObservable.clear()},R);function R(e){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new C.a(18,C.a.UNITMODE_PIXEL,!1),this.onChangedObservable=new l.a,this._host=e}var I=i(29),w=(D.ALPHA_DISABLE=0,D.ALPHA_ADD=1,D.ALPHA_COMBINE=2,D.ALPHA_SUBTRACT=3,D.ALPHA_MULTIPLY=4,D.ALPHA_MAXIMIZED=5,D.ALPHA_ONEONE=6,D.ALPHA_PREMULTIPLIED=7,D.ALPHA_PREMULTIPLIED_PORTERDUFF=8,D.ALPHA_INTERPOLATE=9,D.ALPHA_SCREENMODE=10,D.ALPHA_ONEONE_ONEONE=11,D.ALPHA_ALPHATOCOLOR=12,D.ALPHA_REVERSEONEMINUS=13,D.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,D.ALPHA_ONEONE_ONEZERO=15,D.ALPHA_EXCLUSION=16,D.ALPHA_EQUATION_ADD=0,D.ALPHA_EQUATION_SUBSTRACT=1,D.ALPHA_EQUATION_REVERSE_SUBTRACT=2,D.ALPHA_EQUATION_MAX=3,D.ALPHA_EQUATION_MIN=4,D.ALPHA_EQUATION_DARKEN=5,D.DELAYLOADSTATE_NONE=0,D.DELAYLOADSTATE_LOADED=1,D.DELAYLOADSTATE_LOADING=2,D.DELAYLOADSTATE_NOTLOADED=4,D.NEVER=512,D.ALWAYS=519,D.LESS=513,D.EQUAL=514,D.LEQUAL=515,D.GREATER=516,D.GEQUAL=518,D.NOTEQUAL=517,D.KEEP=7680,D.REPLACE=7681,D.INCR=7682,D.DECR=7683,D.INVERT=5386,D.INCR_WRAP=34055,D.DECR_WRAP=34056,D.TEXTURE_CLAMP_ADDRESSMODE=0,D.TEXTURE_WRAP_ADDRESSMODE=1,D.TEXTURE_MIRROR_ADDRESSMODE=2,D.TEXTUREFORMAT_ALPHA=0,D.TEXTUREFORMAT_LUMINANCE=1,D.TEXTUREFORMAT_LUMINANCE_ALPHA=2,D.TEXTUREFORMAT_RGB=4,D.TEXTUREFORMAT_RGBA=5,D.TEXTUREFORMAT_RED=6,D.TEXTUREFORMAT_R=6,D.TEXTUREFORMAT_RG=7,D.TEXTUREFORMAT_RED_INTEGER=8,D.TEXTUREFORMAT_R_INTEGER=8,D.TEXTUREFORMAT_RG_INTEGER=9,D.TEXTUREFORMAT_RGB_INTEGER=10,D.TEXTUREFORMAT_RGBA_INTEGER=11,D.TEXTURETYPE_UNSIGNED_BYTE=0,D.TEXTURETYPE_UNSIGNED_INT=0,D.TEXTURETYPE_FLOAT=1,D.TEXTURETYPE_HALF_FLOAT=2,D.TEXTURETYPE_BYTE=3,D.TEXTURETYPE_SHORT=4,D.TEXTURETYPE_UNSIGNED_SHORT=5,D.TEXTURETYPE_INT=6,D.TEXTURETYPE_UNSIGNED_INTEGER=7,D.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,D.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,D.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,D.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,D.TEXTURETYPE_UNSIGNED_INT_24_8=12,D.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,D.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,D.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,D.TEXTURE_NEAREST_SAMPLINGMODE=1,D.TEXTURE_NEAREST_NEAREST=1,D.TEXTURE_BILINEAR_SAMPLINGMODE=2,D.TEXTURE_LINEAR_LINEAR=2,D.TEXTURE_TRILINEAR_SAMPLINGMODE=3,D.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,D.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,D.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,D.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,D.TEXTURE_NEAREST_LINEAR=7,D.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,D.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,D.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,D.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,D.TEXTURE_LINEAR_NEAREST=12,D.TEXTURE_EXPLICIT_MODE=0,D.TEXTURE_SPHERICAL_MODE=1,D.TEXTURE_PLANAR_MODE=2,D.TEXTURE_CUBIC_MODE=3,D.TEXTURE_PROJECTION_MODE=4,D.TEXTURE_SKYBOX_MODE=5,D.TEXTURE_INVCUBIC_MODE=6,D.TEXTURE_EQUIRECTANGULAR_MODE=7,D.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,D.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,D.SCALEMODE_FLOOR=1,D.SCALEMODE_NEAREST=2,D.SCALEMODE_CEILING=3,D.MATERIAL_TextureDirtyFlag=1,D.MATERIAL_LightDirtyFlag=2,D.MATERIAL_FresnelDirtyFlag=4,D.MATERIAL_AttributesDirtyFlag=8,D.MATERIAL_MiscDirtyFlag=16,D.MATERIAL_AllDirtyFlag=31,D.MATERIAL_TriangleFillMode=0,D.MATERIAL_WireFrameFillMode=1,D.MATERIAL_PointFillMode=2,D.MATERIAL_PointListDrawMode=3,D.MATERIAL_LineListDrawMode=4,D.MATERIAL_LineLoopDrawMode=5,D.MATERIAL_LineStripDrawMode=6,D.MATERIAL_TriangleStripDrawMode=7,D.MATERIAL_TriangleFanDrawMode=8,D.MATERIAL_ClockWiseSideOrientation=0,D.MATERIAL_CounterClockWiseSideOrientation=1,D.ACTION_NothingTrigger=0,D.ACTION_OnPickTrigger=1,D.ACTION_OnLeftPickTrigger=2,D.ACTION_OnRightPickTrigger=3,D.ACTION_OnCenterPickTrigger=4,D.ACTION_OnPickDownTrigger=5,D.ACTION_OnDoublePickTrigger=6,D.ACTION_OnPickUpTrigger=7,D.ACTION_OnPickOutTrigger=16,D.ACTION_OnLongPressTrigger=8,D.ACTION_OnPointerOverTrigger=9,D.ACTION_OnPointerOutTrigger=10,D.ACTION_OnEveryFrameTrigger=11,D.ACTION_OnIntersectionEnterTrigger=12,D.ACTION_OnIntersectionExitTrigger=13,D.ACTION_OnKeyDownTrigger=14,D.ACTION_OnKeyUpTrigger=15,D.PARTICLES_BILLBOARDMODE_Y=2,D.PARTICLES_BILLBOARDMODE_ALL=7,D.PARTICLES_BILLBOARDMODE_STRETCHED=8,D.MESHES_CULLINGSTRATEGY_STANDARD=0,D.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,D.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,D.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,D.SCENELOADER_NO_LOGGING=0,D.SCENELOADER_MINIMAL_LOGGING=1,D.SCENELOADER_SUMMARY_LOGGING=2,D.SCENELOADER_DETAILED_LOGGING=3,D);function D(){}var L,F=i(52),N=(L=n.DynamicTexture,Object(r.c)(B,L),Object.defineProperty(B.prototype,"numLayoutCalls",{get:function(){return this._numLayoutCalls},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"numRenderCalls",{get:function(){return this._numRenderCalls},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"renderScale",{get:function(){return this._renderScale},set:function(e){e!==this._renderScale&&(this._renderScale=e,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this.markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"idealWidth",{get:function(){return this._idealWidth},set:function(e){this._idealWidth!==e&&(this._idealWidth=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"idealHeight",{get:function(){return this._idealHeight},set:function(e){this._idealHeight!==e&&(this._idealHeight=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"useSmallestIdeal",{get:function(){return this._useSmallestIdeal},set:function(e){this._useSmallestIdeal!==e&&(this._useSmallestIdeal=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"renderAtIdealSize",{get:function(){return this._renderAtIdealSize},set:function(e){this._renderAtIdealSize!==e&&(this._renderAtIdealSize=e,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"idealRatio",{get:function(){var e=0,t=0;return this._idealWidth&&(e=this.getSize().width/this._idealWidth),this._idealHeight&&(t=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight?window.innerWidth<window.innerHeight?e:t:this._idealWidth?e:this._idealHeight?t:1},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"layer",{get:function(){return this._layerToDispose},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),B.prototype.getChildren=function(){return[this._rootContainer]},B.prototype.getDescendants=function(e,t){return this._rootContainer.getDescendants(e,t)},Object.defineProperty(B.prototype,"focusedControl",{get:function(){return this._focusedControl},set:function(e){this._focusedControl!=e&&(this._focusedControl&&this._focusedControl.onBlur(),e&&e.onFocus(),this._focusedControl=e)},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"isForeground",{get:function(){return!this.layer||!this.layer.isBackground},set:function(e){this.layer&&this.layer.isBackground!==!e&&(this.layer.isBackground=!e)},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"clipboardData",{get:function(){return this._clipboardData},set:function(e){this._clipboardData=e},enumerable:!0,configurable:!0}),B.prototype.getClassName=function(){return"AdvancedDynamicTexture"},B.prototype.executeOnAllControls=function(e,t){e(t=t||this._rootContainer);for(var i=0,r=t.children;i<r.length;i++){var n=r[i];n.children?this.executeOnAllControls(e,n):e(n)}},Object.defineProperty(B.prototype,"useInvalidateRectOptimization",{get:function(){return this._useInvalidateRectOptimization},set:function(e){this._useInvalidateRectOptimization=e},enumerable:!0,configurable:!0}),B.prototype.invalidateRect=function(e,t,i,r){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){var n=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),o=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,r));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,e)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,t)),this._invalidatedRectangle.width=n-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=o-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new I.a(e,t,i-e+1,r-t+1)},B.prototype.markAsDirty=function(){this._isDirty=!0},B.prototype.createStyle=function(){return new S(this)},B.prototype.addControl=function(e){return this._rootContainer.addControl(e),this},B.prototype.removeControl=function(e){return this._rootContainer.removeControl(e),this},B.prototype.dispose=function(){var e=this.getScene();e&&(this._rootElement=null,e.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&e.getEngine().onResizeObservable.remove(this._resizeObserver),this._pointerMoveObserver&&e.onPrePointerObservable.remove(this._pointerMoveObserver),this._pointerObserver&&e.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&e.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&e.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),L.prototype.dispose.call(this))},B.prototype._onResize=function(){var e=this.getScene();if(e){var t=e.getEngine(),i=this.getSize(),r=t.getRenderWidth()*this._renderScale,n=t.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(n=n*this._idealWidth/r,r=this._idealWidth):this._idealHeight&&(r=r*this._idealHeight/n,n=this._idealHeight)),i.width===r&&i.height===n||(this.scaleTo(r,n),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,i.width-1,i.height-1)}},B.prototype._getGlobalViewport=function(e){var t=e.getEngine();return this._fullscreenViewport.toGlobal(t.getRenderWidth(),t.getRenderHeight())},B.prototype.getProjectedPosition=function(e,t){var i=this.getScene();if(!i)return c.d.Zero();var r=this._getGlobalViewport(i),n=c.e.Project(e,t,i.getTransformMatrix(),r);return n.scaleInPlace(this.renderScale),new c.d(n.x,n.y)},B.prototype._checkUpdate=function(e){if(!this._layerToDispose||0!=(e.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){var t=this.getScene();if(!t)return;for(var i=this._getGlobalViewport(t),r=0,n=this._linkedControls;r<n.length;r++){var o=n[r];if(o.isVisible){var s=o._linkedMesh;if(s&&!s.isDisposed()){var a=s.getBoundingInfo?s.getBoundingInfo().boundingSphere.center:c.e.ZeroReadOnly,h=c.e.Project(a,s.getWorldMatrix(),t.getTransformMatrix(),i);h.z<0||1<h.z?o.notRenderable=!0:(o.notRenderable=!1,h.scaleInPlace(this.renderScale),o._moveToProjectedPosition(h))}else u.b.SetImmediate(function(){o.linkWithMesh(null)})}}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(),this.update(!0,this.premulAlpha))}},B.prototype._render=function(){var e=this.getSize(),t=e.width,i=e.height,r=this.getContext();r.font="18px Arial",r.strokeStyle="white",this.onBeginLayoutObservable.notifyObservers(this);var n=new I.a(0,0,t,i);this._numLayoutCalls=0,this._rootContainer._layout(n,r),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,t,i),r.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(r.save(),r.fillStyle=this._background,r.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),r.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(r,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null},B.prototype._changeCursor=function(e){this._rootElement&&(this._rootElement.style.cursor=e,this._cursorChanged=!0)},B.prototype._registerLastControlDown=function(e,t){this._lastControlDown[t]=e,this.onControlPickedObservable.notifyObservers(e)},B.prototype._doPicking=function(e,t,i,r,n,o,s){var a=this.getScene();if(a){var h=a.getEngine(),l=this.getSize();if(this._isFullscreen){var c=(a.cameraToUseForPointers||a.activeCamera).viewport;e*=l.width/(h.getRenderWidth()*c.width),t*=l.height/(h.getRenderHeight()*c.height)}this._capturingControl[r]?this._capturingControl[r]._processObservables(i,e,t,r,n):(this._cursorChanged=!1,this._rootContainer._processPicking(e,t,i,r,n,o,s)||(this._changeCursor(""),i===d.a.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r]),delete this._lastControlOver[r])),this._cursorChanged||this._changeCursor(""),this._manageFocus())}},B.prototype._cleanControlAfterRemovalFromList=function(e,t){for(var i in e)e.hasOwnProperty(i)&&e[i]===t&&delete e[i]},B.prototype._cleanControlAfterRemoval=function(e){this._cleanControlAfterRemovalFromList(this._lastControlDown,e),this._cleanControlAfterRemovalFromList(this._lastControlOver,e)},B.prototype.attach=function(){var a=this,h=this.getScene();if(h){var l=new F.a(0,0,0,0);this._pointerMoveObserver=h.onPrePointerObservable.add(function(e,t){if(!h.isPointerCaptured(e.event.pointerId)&&(e.type===d.a.POINTERMOVE||e.type===d.a.POINTERUP||e.type===d.a.POINTERDOWN||e.type===d.a.POINTERWHEEL)&&h){e.type===d.a.POINTERMOVE&&e.event.pointerId&&(a._defaultMousePointerId=e.event.pointerId);var i=h.cameraToUseForPointers||h.activeCamera,r=h.getEngine();i?i.viewport.toGlobalToRef(r.getRenderWidth(),r.getRenderHeight(),l):(l.x=0,l.y=0,l.width=r.getRenderWidth(),l.height=r.getRenderHeight());var n=h.pointerX/r.getHardwareScalingLevel()-l.x,o=h.pointerY/r.getHardwareScalingLevel()-(r.getRenderHeight()-l.y-l.height);a._shouldBlockPointer=!1;var s=e.event.pointerId||a._defaultMousePointerId;a._doPicking(n,o,e.type,s,e.event.button,e.event.deltaX,e.event.deltaY),a._shouldBlockPointer&&(e.skipOnPointerObservable=a._shouldBlockPointer)}}),this._attachToOnPointerOut(h)}},B.prototype.registerClipboardEvents=function(){self.addEventListener("copy",this.onClipboardCopy,!1),self.addEventListener("cut",this.onClipboardCut,!1),self.addEventListener("paste",this.onClipboardPaste,!1)},B.prototype.unRegisterClipboardEvents=function(){self.removeEventListener("copy",this.onClipboardCopy),self.removeEventListener("cut",this.onClipboardCut),self.removeEventListener("paste",this.onClipboardPaste)},B.prototype.attachToMesh=function(u,e){var f=this;void 0===e&&(e=!0);var t=this.getScene();t&&(this._pointerObserver=t.onPointerObservable.add(function(e,t){if(e.type===d.a.POINTERMOVE||e.type===d.a.POINTERUP||e.type===d.a.POINTERDOWN){var i=e.event.pointerId||f._defaultMousePointerId;if(e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh===u){var r=e.pickInfo.getTextureCoordinates();if(r){var n=f.getSize();f._doPicking(r.x*n.width,(1-r.y)*n.height,e.type,i,e.event.button)}}else if(e.type===d.a.POINTERUP){if(f._lastControlDown[i]&&f._lastControlDown[i]._forcePointerUp(i),delete f._lastControlDown[i],f.focusedControl){var o=f.focusedControl.keepsFocusWith(),s=!0;if(o)for(var a=0,h=o;a<h.length;a++){var l=h[a];if(f!==l._host){var c=l._host;if(c._lastControlOver[i]&&c._lastControlOver[i].isAscendant(l)){s=!1;break}}}s&&(f.focusedControl=null)}}else e.type===d.a.POINTERMOVE&&(f._lastControlOver[i]&&f._lastControlOver[i]._onPointerOut(f._lastControlOver[i],!0),delete f._lastControlOver[i])}}),u.enablePointerMoveEvents=e,this._attachToOnPointerOut(t))},B.prototype.moveFocusToControl=function(e){this.focusedControl=e,this._lastPickedControl=e,this._blockNextFocusCheck=!0},B.prototype._manageFocus=function(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}},B.prototype._attachToOnPointerOut=function(e){var t=this;this._canvasPointerOutObserver=e.getEngine().onCanvasPointerOutObservable.add(function(e){t._lastControlOver[e.pointerId]&&t._lastControlOver[e.pointerId]._onPointerOut(t._lastControlOver[e.pointerId]),delete t._lastControlOver[e.pointerId],t._lastControlDown[e.pointerId]&&t._lastControlDown[e.pointerId]!==t._capturingControl[e.pointerId]&&(t._lastControlDown[e.pointerId]._forcePointerUp(),delete t._lastControlDown[e.pointerId])})},B.CreateForMesh=function(e,t,i,r,n){void 0===t&&(t=1024),void 0===i&&(i=1024),void 0===r&&(r=!0),void 0===n&&(n=!1);var o=new B(e.name+" AdvancedDynamicTexture",t,i,e.getScene(),!0,p.a.TRILINEAR_SAMPLINGMODE),s=new f.StandardMaterial("AdvancedDynamicTextureMaterial",e.getScene());return s.backFaceCulling=!1,s.diffuseColor=_.a.Black(),s.specularColor=_.a.Black(),n?(s.diffuseTexture=o,(s.emissiveTexture=o).hasAlpha=!0):(s.emissiveTexture=o,s.opacityTexture=o),e.material=s,o.attachToMesh(e,r),o},B.CreateFullscreenUI=function(e,t,i,r){void 0===t&&(t=!0),void 0===i&&(i=null),void 0===r&&(r=p.a.BILINEAR_SAMPLINGMODE);var n=new B(e,0,0,i,!1,r),o=new A(e+"_layer",null,i,!t);return(o.texture=n)._layerToDispose=o,n._isFullscreen=!0,n.attach(),n},B);function B(e,t,i,r,n,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=!1),void 0===o&&(o=p.a.NEAREST_SAMPLINGMODE);var s=L.call(this,e,{width:t,height:i},r,n,o,w.TEXTUREFORMAT_RGBA)||this;return s._isDirty=!1,s._rootContainer=new P.a("root"),s._lastControlOver={},s._lastControlDown={},s._capturingControl={},s._linkedControls=new Array,s._isFullscreen=!1,s._fullscreenViewport=new F.a(0,0,1,1),s._idealWidth=0,s._idealHeight=0,s._useSmallestIdeal=!1,s._renderAtIdealSize=!1,s._blockNextFocusCheck=!1,s._renderScale=1,s._cursorChanged=!1,s._defaultMousePointerId=0,s._numLayoutCalls=0,s._numRenderCalls=0,s._clipboardData="",s.onClipboardObservable=new l.a,s.onControlPickedObservable=new l.a,s.onBeginLayoutObservable=new l.a,s.onEndLayoutObservable=new l.a,s.onBeginRenderObservable=new l.a,s.onEndRenderObservable=new l.a,s.premulAlpha=!1,s._useInvalidateRectOptimization=!0,s._invalidatedRectangle=null,s._clearMeasure=new I.a(0,0,0,0),s.onClipboardCopy=function(e){var t=e,i=new a.b(a.a.COPY,t);s.onClipboardObservable.notifyObservers(i),t.preventDefault()},s.onClipboardCut=function(e){var t=e,i=new a.b(a.a.CUT,t);s.onClipboardObservable.notifyObservers(i),t.preventDefault()},s.onClipboardPaste=function(e){var t=e,i=new a.b(a.a.PASTE,t);s.onClipboardObservable.notifyObservers(i),t.preventDefault()},(r=s.getScene())&&s._texture&&(s._rootElement=r.getEngine().getInputElement(),s._renderObserver=r.onBeforeCameraRenderObservable.add(function(e){return s._checkUpdate(e)}),s._preKeyboardObserver=r.onPreKeyboardObservable.add(function(e){s._focusedControl&&(e.type===h.a.KEYDOWN&&s._focusedControl.processKeyboard(e.event),e.skipOnPointerObservable=!0)}),s._rootContainer._link(s),s.hasAlpha=!0,t&&i||(s._resizeObserver=r.getEngine().onResizeObservable.add(function(){return s._onResize()}),s._onResize()),s._texture.isReady=!0),s}},function(e,t,i){"use strict";i.r(t),i.d(t,"HemisphericLight",function(){return c});var r=i(1),n=i(3),o=i(0),s=i(7),a=i(34),h=i(43);a.a.AddNodeConstructor("Light_Type_3",function(e,t){return function(){return new c(e,o.e.Zero(),t)}});var l,c=(l=h.a,Object(r.c)(u,l),u.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},u.prototype.getClassName=function(){return"HemisphericLight"},u.prototype.setDirectionToTarget=function(e){return this.direction=o.e.Normalize(e.subtract(o.e.Zero())),this.direction},u.prototype.getShadowGenerator=function(){return null},u.prototype.transferToEffect=function(e,t){var i=o.e.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this},u.prototype.transferToNodeMaterialEffect=function(e,t){var i=o.e.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this},u.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=o.a.Identity()),this._worldMatrix},u.prototype.getTypeID=function(){return h.a.LIGHTTYPEID_HEMISPHERICLIGHT},u.prototype.prepareLightSpecificDefines=function(e,t){e["HEMILIGHT"+t]=!0},Object(r.b)([Object(n.d)()],u.prototype,"groundColor",void 0),Object(r.b)([Object(n.k)()],u.prototype,"direction",void 0),u);function u(e,t,i){var r=l.call(this,e,i)||this;return r.groundColor=new s.a(0,0,0),r.direction=t||o.e.Up(),r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelManager=void 0;var _=i(56),g=i(77),m=i(102),v=i(89),b=i(88),r=(n.prototype._createLabelForms=function(){var e=document.createElement("div");e.className="bbp label-control",e.style.display="none",e.style.top=this._canvas.clientTop+40+"px",e.style.left=this._canvas.clientTop+5+"px";var t=document.createElement("div");t.className="label-form";var i=document.createElement("label");i.innerText="Label Text:",i.htmlFor="addLabelInput";var r=document.createElement("input");r.name="addLabelInput",r.type="text",this._addLabelTextInput=r;var n=document.createElement("button");n.innerText="Add Label",n.onclick=this._addLabelBtnClick.bind(this),t.appendChild(i),t.appendChild(r),t.appendChild(n),e.appendChild(t);var o=document.createElement("div");o.className="edit-container",o.style.maxHeight=(this._canvas.height-100).toString()+"px",e.appendChild(o),this._editLabelContainer=o,this._labelControlBox=e,this._canvas.parentNode.appendChild(e)},n.prototype.update=function(){if(this._showLabels){for(var e=_.Vector3.Cross(this._camera.position,_.Axis.Y),t=_.Vector3.Cross(e,this._camera.position),i=_.Vector3.Cross(e,t),r=0;r<this._labels.length;r++)this._labels[r].rotation=_.Vector3.RotationFromAxis(e,t,i);if(!this.fixed){var n=this._scene.meshUnderPointer,o=this._labels.indexOf(n);if(-1!=o){for(r=0;r<this._labelBackgrounds.length;r++)r!=o&&(this._labelBackgrounds[r].alpha=0);this._labelBackgrounds[o].alpha=1}else for(r=0;r<this._labelBackgrounds.length;r++)this._labelBackgrounds[r].alpha=0}}},n.prototype.toggleLabelControl=function(){"none"==this._labelControlBox.style.display?this._labelControlBox.style.display="block":this._labelControlBox.style.display="none"},n.prototype._addLabelBtnClick=function(e){e.preventDefault(),this.addLabel(this._addLabelTextInput.value)},n.prototype.addLabel=function(e,t,i){this._addLabelTextInput.value="";var r=this._labels.length,n=g.PlaneBuilder.CreatePlane("label_"+r,{width:5,height:5},this._scene);if(t){var o=_.Vector3.FromArray(t);n.position=o}else n.position.y=this._ymax+2;var s=v.AdvancedDynamicTexture.CreateForMesh(n),a=new b.Rectangle;a.color="red",a.alpha=0,s.addControl(a),this._labelBackgrounds.push(a);var h=new b.TextBlock;if(h.text=e,h.color="black",h.fontSize=this._labelSize,s.addControl(h),this._labelTexts.push(h),!this.fixed){var l=new m.PointerDragBehavior;l.onDragEndObservable.add(function(){i?i(n.position):console.log([n.position.x,n.position.y,n.position.z])}),n.addBehavior(l)}this._labels.push(n);var c=this._labels.length-1,u=document.createElement("div");u.className="label-form";var f=document.createElement("label");f.innerText="Edit Label Text:",f.htmlFor="editLabelInput",u.appendChild(f);var d=document.createElement("input");d.name="editLabelInput",d.type="text",d.value=e,d.dataset.labelnum=c.toString(),d.onkeyup=this._editLabelText.bind(this),u.appendChild(d);var p=document.createElement("button");return p.innerText="Remove Label",p.onclick=this._removeLabel.bind(this),p.dataset.labelnum=c.toString(),u.appendChild(p),u.dataset.labelnum=c.toString(),this._editLabelForms.push(u),this._editLabelContainer.appendChild(u),this._showLabels=!0,r},n.prototype._editLabelText=function(e){var t=e.target;this._labelTexts[parseInt(t.dataset.labelnum)].text=t.value},n.prototype._removeLabel=function(e){var r,t=e.target,n=parseInt(t.dataset.labelnum);this._labelTexts[n].dispose(),this._labelTexts.splice(n,1),this._labelBackgrounds[n].dispose(),this._labelBackgrounds.splice(n,1),this._labels[n].dispose(),this._labels.splice(n,1),this._editLabelForms.forEach(function(e){if(parseInt(e.dataset.labelnum)==n)r=e;else if(parseInt(e.dataset.labelnum)>n){var t=parseInt(e.dataset.labelnum),i=(t-1).toString();e.dataset.labelnum=i,e.querySelector('input[data-labelnum="'+t+'"]').dataset.labelnum=i,e.querySelector('button[data-labelnum="'+t+'"]').dataset.labelnum=i}}),r.parentNode.removeChild(r)},n.prototype.exportLabels=function(){for(var e=[],t=0;t<this._labelTexts.length;t++){var i=this._labelTexts[t].text,r=this._labels[t].position;e.push({text:i,position:[r.x,r.y,r.z]})}return e},n);function n(e,t,i,r){this._editLabelForms=[],this._labels=[],this._labelBackgrounds=[],this._labelTexts=[],this._showLabels=!1,this._labelSize=100,this.fixed=!1,this._canvas=e,this._scene=t,this._ymax=i,this._camera=r,this._createLabelForms()}t.LabelManager=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Axes=void 0;var s=i(17),O=i(100),P=i(56),a=i(78),h=i(48),r=(n.prototype._roundTicks=function(e,t){if(void 0===t&&(t=2),(""+e).includes("e")){var i=(""+e).split("e"),r="";return 0<+i[1]+t&&(r="+"),+(Math.round(parseFloat(+i[0].toString()+"e"+r.toString()+(+i[1].toString()+t.toString())))+"e-"+t)}return+(Math.round(parseFloat(e.toString()+"e+"+t.toString()))+"e-"+t)},n.prototype._createAxes=function(e){void 0===e&&(e=!1),e&&(this.axisData.tickBreaks[0]=1,this.axisData.tickBreaks[2]=1);var t=this.axisData.tickBreaks[0]/this.axisData.scale[0],i=this.axisData.tickBreaks[1]/this.axisData.scale[1],r=this.axisData.tickBreaks[2]/this.axisData.scale[2],n=Math.floor(this.axisData.range[0][0]/t)*t,o=Math.floor(this.axisData.range[1][0]/i)*i,s=Math.floor(this.axisData.range[2][0]/r)*r,a=Math.ceil(this.axisData.range[0][1]/t)*t,h=Math.ceil(this.axisData.range[1][1]/i)*i,l=Math.ceil(this.axisData.range[2][1]/r)*r;if(this.axisData.showAxes[0]){var c=O.LinesBuilder.CreateLines("axisX",{points:[new P.Vector3(n,o,s),new P.Vector3(a,o,s)]},this._scene);c.color=P.Color3.FromHexString(this.axisData.color[0]),this._axes.push(c);var u=this._makeTextPlane(this.axisData.axisLabels[0],1,this.axisData.color[0]);u.position=new P.Vector3(a/2,o-.5*h,s),this._axisLabels.push(u);for(var f=[],d=0;d<-Math.ceil(this.axisData.range[0][0]/t);d++)f.push(-(d+1)*t);for(d=0;d<=Math.ceil(this.axisData.range[0][1]/t);d++)f.push(d*t);var p=0;for(e&&(p=1),d=p;d<f.length;d++){var _=f[d];e&&(_-=.5),(M=O.LinesBuilder.CreateLines("xTicks",{points:[new P.Vector3(_,o,s+.05*a),new P.Vector3(_,o,s),new P.Vector3(_,o+.05*h,s)]},this._scene)).color=P.Color3.FromHexString(this.axisData.color[0]),this._ticks.push(M);var g=this._roundTicks(_*this.axisData.scale[0]).toString();e&&(g=this.axisData.colnames[d-1]),(E=this._makeTextPlane(g,.6,this.axisData.color[0])).position=new P.Vector3(_,o-.1*h,s),this._tickLabels.push(E),this.axisData.showTickLines[0][0]&&((A=O.LinesBuilder.CreateLines("xTickLines",{points:[new P.Vector3(_,h,s),new P.Vector3(_,o,s)]},this._scene)).color=P.Color3.FromHexString(this.axisData.tickLineColor[0][0]),this._tickLines.push(A)),this.axisData.showTickLines[0][1]&&((A=O.LinesBuilder.CreateLines("xTickLines",{points:[new P.Vector3(_,o,l),new P.Vector3(_,o,s)]},this._scene)).color=P.Color3.FromHexString(this.axisData.tickLineColor[0][1]),this._tickLines.push(A))}}if(this.axisData.showAxes[1]){var m=O.LinesBuilder.CreateLines("axisY",{points:[new P.Vector3(n,o,s),new P.Vector3(n,h,s)]},this._scene);m.color=P.Color3.FromHexString(this.axisData.color[1]),this._axes.push(m);var v=this._makeTextPlane(this.axisData.axisLabels[1],1,this.axisData.color[1]);v.position=new P.Vector3(n,h/2,s-.5*h),this._axisLabels.push(v);var b=[];for(d=0;d<-Math.ceil(this.axisData.range[1][0]/i);d++)b.push(-(d+1)*i);for(d=0;d<=Math.ceil(this.axisData.range[1][1]/i);d++)b.push(d*i);for(d=0;d<b.length;d++)_=b[d],(M=O.LinesBuilder.CreateLines("yTicks",{points:[new P.Vector3(n,_,s+.05*l),new P.Vector3(n,_,s),new P.Vector3(n+.05*a,_,s)]},this._scene)).color=P.Color3.FromHexString(this.axisData.color[1]),this._ticks.push(M),g=this._roundTicks(_*this.axisData.scale[1]),(E=this._makeTextPlane(g.toString(),.6,this.axisData.color[1])).position=new P.Vector3(n,_,s-.05*h),this._tickLabels.push(E),this.axisData.showTickLines[1][0]&&((A=O.LinesBuilder.CreateLines("yTicksLines",{points:[new P.Vector3(a,_,s),new P.Vector3(n,_,s)]},this._scene)).color=P.Color3.FromHexString(this.axisData.tickLineColor[1][0]),this._tickLines.push(A)),this.axisData.showTickLines[1][1]&&((A=O.LinesBuilder.CreateLines("yTickLines",{points:[new P.Vector3(n,_,l),new P.Vector3(n,_,s)]},this._scene)).color=P.Color3.FromHexString(this.axisData.tickLineColor[1][1]),this._tickLines.push(A))}if(this.axisData.showAxes[2]){var y=O.LinesBuilder.CreateLines("axisZ",{points:[new P.Vector3(n,o,s),new P.Vector3(n,o,l)]},this._scene);y.color=P.Color3.FromHexString(this.axisData.color[2]),this._axes.push(y);var x=this._makeTextPlane(this.axisData.axisLabels[2],1,this.axisData.color[2]);x.position=new P.Vector3(n,o-.5*h,l/2),this._axisLabels.push(x);var T=[];for(d=0;d<-Math.ceil(this.axisData.range[2][0]/r);d++)T.push(-(d+1)*r);for(d=0;d<=Math.ceil(this.axisData.range[2][1]/r);d++)T.push(d*r);for(p=0,e&&(p=1),d=p;d<T.length;d++){var M,E,A;_=T[d],e&&(_-=.5),(M=O.LinesBuilder.CreateLines("zTicks",{points:[new P.Vector3(n+.05*a,o,_),new P.Vector3(n,o,_),new P.Vector3(n,o+.05*h,_)]},this._scene)).color=P.Color3.FromHexString(this.axisData.color[2]),this._ticks.push(M),g=this._roundTicks(_*this.axisData.scale[2]).toString(),e&&(g=this.axisData.rownames[d-1]),(E=this._makeTextPlane(g,.6,this.axisData.color[2])).position=new P.Vector3(n,o-.1*h,_),this._tickLabels.push(E),this.axisData.showTickLines[2][0]&&((A=O.LinesBuilder.CreateLines("zTickLines",{points:[new P.Vector3(a,o,_),new P.Vector3(n,o,_)]},this._scene)).color=P.Color3.FromHexString(this.axisData.tickLineColor[2][0]),this._tickLines.push(A)),this.axisData.showTickLines[2][1]&&((A=O.LinesBuilder.CreateLines("zTickLines",{points:[new P.Vector3(n,h,_),new P.Vector3(n,o,_)]},this._scene)).color=P.Color3.FromHexString(this.axisData.tickLineColor[2][1]),this._tickLines.push(A))}}},n.prototype._makeTextPlane=function(e,t,i){var r=new a.DynamicTexture("DynamicTexture",75,this._scene,!0);r.hasAlpha=!0,r.drawText(e,5,40,40-4*e.length+"px Arial",i,"transparent",!0);var n=s.Mesh.CreatePlane("TextPlane",t,this._scene,!0),o=new h.StandardMaterial("TextPlaneMaterial",this._scene);return o.backFaceCulling=!1,o.specularColor=new P.Color3(0,0,0),o.diffuseTexture=r,n.material=o,n},n.prototype.update=function(e,t){if(t){for(var i=0;i<this._axes.length;i++)this._axes[i].dispose();for(i=0;i<this._axisLabels.length;i++)this._axisLabels[i].dispose();for(i=0;i<this._ticks.length;i++)this._ticks[i].dispose();for(i=0;i<this._tickLabels.length;i++)this._tickLabels[i].dispose();for(i=0;i<this._tickLines.length;i++)this._tickLines[i].dispose();this._createAxes()}if(this.axisData.showAxes){var r=P.Vector3.Cross(e.position,P.Axis.Y),n=P.Vector3.Cross(r,e.position),o=P.Vector3.Cross(r,n);for(i=0;i<this._axisLabels.length;i++)this._axisLabels[i].rotation=P.Vector3.RotationFromAxis(r,n,o);for(i=0;i<this._tickLabels.length;i++)this._tickLabels[i].rotation=P.Vector3.RotationFromAxis(r,n,o)}},n);function n(e,t,i){void 0===i&&(i=!1),this._axes=[],this._axisLabels=[],this._ticks=[],this._tickLabels=[],this._tickLines=[],this.axisData=e,this._scene=t,this._createAxes(i)}t.Axes=r},function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImgStack=void 0;var E,x=i(17),T=i(56),M=i(12),A=i(48),s=i(63),O=o(i(76)),a=(E=s.Plot,n(h,E),h.prototype._createImgStack=function(){for(var e=[],t=[],i=0;i<this._channelCoords.length;i++){var r=this._channelCoordIntensities[i];if(0!==r.length){var n=this._channelCoords[i],o=void 0;o=0==i?"#ff0000":1==i?"#00ff00":"#0000ff";var s=O.default(o).rgb();if(s[0]=s[0]/255,s[1]=s[1]/255,s[2]=s[2]/255,"alpha"===this._intensityMode){for(var a=r.min(),h=[],l=[],c=[],u=0;u<10;u++)h.push([]),l.push([]),c.push(.1*(u+1));for(var f=0;f<n.length;f++)for(var d=0;d<c.length;d++){var p=c[d];if((r[f]-a)/(1-a)<=p){h[d].push(n[f][2],n[f][0],n[f][1]),l[d].push(s[0],s[1],s[2],1);break}}for(var _=0;_<c.length;_++)if(!(l[_].length<=4)){var g=new x.Mesh("custom-"+i+"_"+_,this._scene),m=c[_];(b=new M.VertexData).positions=h[_],b.colors=l[_],b.applyToMesh(g,!0),(y=new A.StandardMaterial("mat-"+i+"_"+_,this._scene)).emissiveColor=new T.Color3(1,1,1),y.disableLighting=!0,y.pointsCloud=!0,y.pointSize=this._size,y.alpha=m,g.material=y,this.meshes.push(g)}}else{for(f=0;f<n.length;f++)if(e.push(n[f][2],n[f][0],n[f][1]),"mix"===this._intensityMode){var v=O.default.mix(this._backgroundColor,o,r[f]).rgb();t.push(v[0]/255,v[1]/255,v[2]/255,1)}else t.push(s[0],s[1],s[2],1);var b,y;g=new x.Mesh("custom-"+i,this._scene),(b=new M.VertexData).positions=e,b.colors=t,b.applyToMesh(g,!0),(y=new A.StandardMaterial("mat-"+i,this._scene)).emissiveColor=new T.Color3(1,1,1),y.disableLighting=!0,y.pointsCloud=!0,y.pointSize=this._size,g.material=y,this.meshes.push(g)}}}},h);function h(e,t,i,r,n,o,s,a){for(var h=this,l=r.dim[0],c=r.dim[1],u=r.dim[2],f=(r.dim[3],l*c),d=f*u,p=[],_=[],g=0;g<u;g++)p.push([]),_.push([]);for(g=0;g<i.length;g++){var m=i[g],v=Math.floor(m/d),b=m-d*v,y=Math.floor(b/f),x=b-f*y,T=Math.floor(x/l),M=x%l;p[y].push([M,T,v*o]),_[y].push(t[g])}return(h=E.call(this,e,[],[],1,n)||this)._channelCoords=p,h._channelCoordIntensities=_,h._backgroundColor=s,h._intensityMode=a,h.meshes=[],h._createImgStack(),h}t.ImgStack=a},function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PointCloud=void 0;var f,c=i(17),u=i(95),d=i(56),p=i(101),_=i(12),g=i(48),o=i(63),s=(f=o.Plot,n(a,f),a.prototype._createPointCloud=function(){if(1e4<this._coords.length){var e=new c.Mesh("custom",this._scene),t=[],i=[];if(this._folded)for(var r=0;r<this._coords.length;r++){t.push(this._foldedEmbedding[r][0],this._foldedEmbedding[r][2],this._foldedEmbedding[r][1]);var n=d.Color4.FromHexString(this._coordColors[r]);i.push(n.r,n.g,n.b,n.a)}else for(r=0;r<this._coords.length;r++)t.push(this._coords[r][0],this._coords[r][2],this._coords[r][1]),n=d.Color4.FromHexString(this._coordColors[r]),i.push(n.r,n.g,n.b,n.a);var o=new _.VertexData;o.positions=t,o.colors=i,o.applyToMesh(e,!0),(s=new g.StandardMaterial("mat",this._scene)).emissiveColor=new d.Color3(1,1,1),s.disableLighting=!0,s.pointsCloud=!0,s.pointSize=this._size,e.material=s,this.mesh=e}else{var s,a=u.SphereBuilder.CreateSphere("sphere",{segments:2,diameter:.1*this._size},this._scene),h=new p.SolidParticleSystem("SPS",this._scene,{updatable:!0,isPickable:!0});if(h.addShape(a,this._coords.length),this._folded)for(var l=0;l<h.nbParticles;l++)h.particles[l].position.x=this._foldedEmbedding[l][0],h.particles[l].position.z=this._foldedEmbedding[l][1],h.particles[l].position.y=this._foldedEmbedding[l][2],h.particles[l].color=d.Color4.FromHexString(this._coordColors[l]);else for(l=0;l<h.nbParticles;l++)h.particles[l].position.x=this._coords[l][0],h.particles[l].position.z=this._coords[l][1],h.particles[l].position.y=this._coords[l][2],h.particles[l].color=d.Color4.FromHexString(this._coordColors[l]);h.buildMesh(),h.computeBoundingBox=!0,a.dispose(),h.setParticles(),h.computeBoundingBox=!0,this._SPS=h,this.mesh=h.mesh,(s=new g.StandardMaterial("pointMat",this._scene)).alpha=1,this.mesh.material=s}Object.defineProperty(this,"alpha",{set:function(e){this.mesh.material.alpha=e}})},a.prototype.resetAnimation=function(){if(this._folded=!0,this._SPS){for(var e=0;e<this._SPS.particles.length;e++)this._SPS.particles[e].position=new d.Vector3(this._foldedEmbedding[e][0],this._foldedEmbedding[e][2],this._foldedEmbedding[e][1]);this._SPS.setParticles()}else this.mesh.updateMeshPositions(function(e){for(var t=e.length/3,i=0;i<t;i++)e[3*i]=this._foldedEmbedding[i][0],e[3*i+1]=this._foldedEmbedding[i][2],e[3*i+2]=this._foldedEmbedding[i][1]}.bind(this),!0);this.mesh.refreshBoundingInfo(),this._foldCounter=0},a.prototype.update=function(){if(this._SPS&&this._folded)if(this._foldCounter<this._foldDelay)this._foldCounter+=1;else if(this._foldCounter<this._foldAnimFrames+this._foldDelay){for(var e=0;e<this._SPS.particles.length;e++)this._SPS.particles[e].position.addInPlace(this._foldVectorFract[e]);this._foldCounter+=1,this._SPS.setParticles()}else{for(this._folded=!1,e=0;e<this._SPS.particles.length;e++)this._SPS.particles[e].position=new d.Vector3(this._coords[e][0],this._coords[e][2],this._coords[e][1]);this._SPS.setParticles(),this.mesh.refreshBoundingInfo()}else if(this.mesh&&this._folded)if(this._foldCounter<this._foldDelay)this._foldCounter+=1;else if(this._foldCounter<this._foldAnimFrames+this._foldDelay){var t=function(e){for(var t=e.length/3,i=0;i<t;i++){var r=new d.Vector3(e[3*i],e[3*i+1],e[3*i+2]).addInPlace(this._foldVectorFract[i]);e[3*i]=r.x,e[3*i+1]=r.y,e[3*i+2]=r.z}};this.mesh.updateMeshPositions(t.bind(this),!0),this._foldCounter+=1}else this._folded=!1,t=function(e){for(var t=e.length/3,i=0;i<t;i++)e[3*i]=this._coords[i][0],e[3*i+1]=this._coords[i][2],e[3*i+2]=this._coords[i][1]},this.mesh.updateMeshPositions(t.bind(this),!0),this.mesh.refreshBoundingInfo();return this._folded},a.prototype._pointPicker=function(e,t){if(this._pointPicking){var i=t.faceId;if(-1==i)return;for(var r=this._SPS.pickedParticles[i].idx,n=0;n<this._SPS.nbParticles;n++)this._SPS.particles[n].color=new d.Color4(.3,.3,.8,1);this._SPS.particles[r].color=new d.Color4(1,0,0,1),this._SPS.setParticles(),this.selection=[r],this._selectionCallback(this.selection)}},a.prototype.updateSize=function(){for(var e=0;e<this._SPS.nbParticles;e++)this._SPS.particles[e].scale.x=this._size,this._SPS.particles[e].scale.y=this._size,this._SPS.particles[e].scale.z=this._size;this._SPS.setParticles(),f.prototype.updateSize.call(this)},a);function a(e,t,i,r,n,o,s,a,h){var l=f.call(this,e,t,i,r,n)||this;if(l._pointPicking=!1,l._selectionCallback=function(e){return!1},l._foldVectors=[],l._foldCounter=0,l._foldAnimFrames=200,l._foldVectorFract=[],l._foldDelay=100,l._folded=o,a&&(l._foldDelay=a),h&&(l._foldAnimFrames=h),o)if(s){for(var c=0;c<s.length;c++){2==s[c].length&&s[c].push(0);var u=new d.Vector3(t[c][0],t[c][2],t[c][1]).subtractFromFloats(s[c][0],0,s[c][1]);l._foldVectors.push(u),l._foldVectorFract.push(u.divide(new d.Vector3(l._foldAnimFrames,l._foldAnimFrames,l._foldAnimFrames)))}l._foldedEmbedding=s}else{s=JSON.parse(JSON.stringify(t));for(c=0;c<s.length;c++){s[c][2]=0;u=new d.Vector3(t[c][0],t[c][2],t[c][1]).subtractFromFloats(s[c][0],0,s[c][1]);l._foldVectors.push(u),l._foldVectorFract.push(u.divide(new d.Vector3(l._foldAnimFrames,l._foldAnimFrames,l._foldAnimFrames)))}l._foldedEmbedding=s}return l._createPointCloud(),l}t.PointCloud=s},function(e,t,i){"use strict";i.r(t),i.d(t,"SphereBuilder",function(){return a});var R=i(0),n=i(17),I=i(12);I.VertexData.CreateSphere=function(e){for(var t=e.segments||32,i=e.diameterX||e.diameter||1,r=e.diameterY||e.diameter||1,n=e.diameterZ||e.diameter||1,o=(!e.arc||!(e.arc<=0||1<e.arc))&&e.arc||1,s=!(e.slice&&e.slice<=0)&&e.slice||1,a=0===e.sideOrientation?0:e.sideOrientation||I.VertexData.DEFAULTSIDE,h=new R.e(i/2,r/2,n/2),l=2+t,c=2*l,u=[],f=[],d=[],p=[],_=0;_<=l;_++){for(var g=_/l,m=g*Math.PI*s,v=0;v<=c;v++){var b=v/c,y=b*Math.PI*2*o,x=R.a.RotationZ(-m),T=R.a.RotationY(y),M=R.e.TransformCoordinates(R.e.Up(),x),E=R.e.TransformCoordinates(M,T),A=E.multiply(h),O=E.divide(h).normalize();f.push(A.x,A.y,A.z),d.push(O.x,O.y,O.z),p.push(b,g)}if(0<_)for(var P=f.length/3,C=P-2*(1+c);C+c+2<P;C++)u.push(C),u.push(C+1),u.push(C+c+1),u.push(C+c+1),u.push(C+1),u.push(C+c+2)}I.VertexData._ComputeSides(a,f,u,d,p,e.frontUVs,e.backUVs);var S=new I.VertexData;return S.indices=u,S.positions=f,S.normals=d,S.uvs=p,S},n.Mesh.CreateSphere=function(e,t,i,r,n,o){var s={segments:t,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:o,updatable:n};return a.CreateSphere(e,s,r)};var a=(r.CreateSphere=function(e,t,i){void 0===i&&(i=null);var r=new n.Mesh(e,i);return t.sideOrientation=n.Mesh._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,I.VertexData.CreateSphere(t).applyToMesh(r,t.updatable),r},r);function r(){}},function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Surface=void 0;var s,_=i(17),g=i(12),m=i(48),v=i(63),b=o(i(76)),a=(s=v.Plot,n(h,s),h.prototype._createSurface=function(){for(var e=v.matrixMax(this._coords),t=new _.Mesh("surface",this._scene),i=[],r=[],n=0;n<this._coords.length;n++)for(var o=this._coords[n],s=0;s<o.length;s++){var a=o[s];i.push(s,a/e*this._size,n),n<this._coords.length-1&&s<o.length-1&&r.push(s+n*o.length,o.length+n*o.length+s,s+n*o.length+1,s+n*o.length+1,o.length+n*o.length+s,o.length+n*o.length+s+1)}for(var h=[],l=0;l<this._coordColors.length;l++){var c=this._coordColors[l],u=b.default(c).rgba();h.push(u[0]/255,u[1]/255,u[2]/255,u[3])}var f=[],d=new g.VertexData;g.VertexData.ComputeNormals(i,r,f),d.positions=i,d.indices=r,d.colors=h,d.normals=f,d.applyToMesh(t);var p=new m.StandardMaterial("surfaceMat",this._scene);p.backFaceCulling=!1,p.alpha=1,t.material=p,this.mesh=t,Object.defineProperty(this,"alpha",{set:function(e){this.mesh.material.alpha=e}})},h);function h(e,t,i,r,n){var o=s.call(this,e,t,i,r,n)||this;return o._createSurface(),o}t.Surface=a},function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.HeatMap=void 0;var s,l=i(56),c=i(79),u=i(77),f=i(48),d=i(63),o=(s=d.Plot,n(a,s),a.prototype._createHeatMap=function(){for(var e=d.matrixMax(this._coords),t=[],i=0;i<this._coords.length;i++)for(var r=this._coords[i],n=0;n<r.length;n++){var o=r[n];if(0<o){var s=o/e*this._size;(a=c.BoxBuilder.CreateBox("box_"+i+"-"+n,{height:s,width:1,depth:1},this._scene)).position=new l.Vector3(i+.5,s/2,n+.5),(h=new f.StandardMaterial("box_"+i+"-"+n+"_color",this._scene)).alpha=1,h.diffuseColor=l.Color3.FromHexString(this._coordColors[n+i*r.length].substring(0,7)),a.material=h,t.push(a)}else{var a,h;(a=u.PlaneBuilder.CreatePlane("box_"+i+"-"+n,{size:1},this._scene)).position=new l.Vector3(i+.5,0,n+.5),a.rotation.x=Math.PI/2,(h=new f.StandardMaterial("box_"+i+"-"+n+"_color",this._scene)).alpha=1,h.diffuseColor=l.Color3.FromHexString(this._coordColors[n+i*r.length].substring(0,7)),h.backFaceCulling=!1,a.material=h,t.push(a)}}this.meshes=t,Object.defineProperty(this,"alpha",{set:function(e){for(var t=0;t<this.meshes.length;t++)this.meshes[t].material.alpha=e}})},a);function a(e,t,i,r,n){var o=s.call(this,e,t,i,r,n)||this;return o._createHeatMap(),o}t.HeatMap=o},function(e,t,i){"use strict";i.r(t),i.d(t,"ArcRotateCamera",function(){return Pe});var r=i(1),s=i(3),a=i(4),p=i(0),n=i(34),h=i(17),v=i(9),o=i(37),l=(Object.defineProperty(c.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationInProgress",{get:function(){return 0<Math.abs(this._cameraRotationSpeed)},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype.attach=function(e){var n=this;this._attachedCamera=e;var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver=t.onPrePointerObservable.add(function(e){e.type!==v.a.POINTERDOWN?e.type===v.a.POINTERUP&&(n._isPointerDown=!1):n._isPointerDown=!0}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){var e=o.a.Now,t=0;null!=n._lastFrameTime&&(t=e-n._lastFrameTime),n._lastFrameTime=e,n._applyUserInteraction();var i=e-n._lastInteractionTime-n._idleRotationWaitTime,r=Math.max(Math.min(i/n._idleRotationSpinupTime,1),0);n._cameraRotationSpeed=n._idleRotationSpeed*r,n._attachedCamera&&(n._attachedCamera.alpha-=n._cameraRotationSpeed*(t/1e3))})},c.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},c.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},c.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},c.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=o.a.Now)},c.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},c);function c(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}var u=i(69),f=(d.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},d.prototype.getEasingMode=function(){return this._easingMode},d.prototype.easeInCore=function(e){throw new Error("You must implement this method")},d.prototype.ease=function(e){switch(this._easingMode){case d.EASINGMODE_EASEIN:return this.easeInCore(e);case d.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return.5<=e?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)},d.EASINGMODE_EASEIN=0,d.EASINGMODE_EASEOUT=1,d.EASINGMODE_EASEINOUT=2,d);function d(){this._easingMode=d.EASINGMODE_EASEIN}var _;_=f,Object(r.c)(g,_),g.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)};function g(){return null!==_&&_.apply(this,arguments)||this}var m,b=(m=f,Object(r.c)(y,m),y.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},y);function y(e){void 0===e&&(e=1);var t=m.call(this)||this;return t.amplitude=e,t}var x;x=f,Object(r.c)(T,x),T.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),i=this.bounciness;i<=1&&(i=1.001);var r=Math.pow(i,t),n=1-i,o=(1-r)/n+.5*r,s=e*o,a=Math.log(-s*(1-i)+1)/Math.log(i),h=Math.floor(a),l=h+1,c=(1-Math.pow(i,h))/(n*o),u=.5*(c+(1-Math.pow(i,l))/(n*o)),f=e-u,d=u-c;return-Math.pow(1/i,t-h)/(d*d)*(f-d)*(f+d)};function T(e,t){void 0===e&&(e=3),void 0===t&&(t=2);var i=x.call(this)||this;return i.bounces=e,i.bounciness=t,i}var M;M=f,Object(r.c)(E,M),E.prototype.easeInCore=function(e){return e*e*e};function E(){return null!==M&&M.apply(this,arguments)||this}var A;A=f,Object(r.c)(O,A),O.prototype.easeInCore=function(e){var t=Math.max(0,this.oscillations),i=Math.max(0,this.springiness);return(0==i?e:(Math.exp(i*e)-1)/(Math.exp(i)-1))*Math.sin((6.283185307179586*t+1.5707963267948966)*e)};function O(e,t){void 0===e&&(e=3),void 0===t&&(t=3);var i=A.call(this)||this;return i.oscillations=e,i.springiness=t,i}var P,C=(P=f,Object(r.c)(S,P),S.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},S);function S(e){void 0===e&&(e=2);var t=P.call(this)||this;return t.exponent=e,t}var R;R=f,Object(r.c)(I,R),I.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)};function I(e){void 0===e&&(e=2);var t=R.call(this)||this;return t.power=e,t}var w;w=f,Object(r.c)(D,w),D.prototype.easeInCore=function(e){return e*e};function D(){return null!==w&&w.apply(this,arguments)||this}var L;L=f,Object(r.c)(F,L),F.prototype.easeInCore=function(e){return e*e*e*e};function F(){return null!==L&&L.apply(this,arguments)||this}var N;N=f,Object(r.c)(B,N),B.prototype.easeInCore=function(e){return e*e*e*e*e};function B(){return null!==N&&N.apply(this,arguments)||this}var k;k=f,Object(r.c)(U,k),U.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))};function U(){return null!==k&&k.apply(this,arguments)||this}var V;V=f,Object(r.c)(z,V),z.prototype.easeInCore=function(e){return u.c.Interpolate(e,this.x1,this.y1,this.x2,this.y2)};function z(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=1),void 0===r&&(r=1);var n=V.call(this)||this;return n.x1=e,n.y1=t,n.x2=i,n.y2=r,n}var j,W,G=i(7),H=i(16),X=i(10);(W=j=j||{})[W.STEP=1]="STEP";var K=(Y.prototype.clone=function(){return new Y(this.name,this.from,this.to)},Y);function Y(e,t,i){this.name=e,this.from=t,this.to=i}var q=i(46),Z=(Q._PrepareAnimation=function(e,t,i,r,n,o,s,a){var h=void 0;if(!isNaN(parseFloat(n))&&isFinite(n)?h=Q.ANIMATIONTYPE_FLOAT:n instanceof p.b?h=Q.ANIMATIONTYPE_QUATERNION:n instanceof p.e?h=Q.ANIMATIONTYPE_VECTOR3:n instanceof p.d?h=Q.ANIMATIONTYPE_VECTOR2:n instanceof G.a?h=Q.ANIMATIONTYPE_COLOR3:n instanceof G.b?h=Q.ANIMATIONTYPE_COLOR4:n instanceof q.a&&(h=Q.ANIMATIONTYPE_SIZE),null==h)return null;var l=new Q(e,t,i,h,s),c=[{frame:0,value:n},{frame:r,value:o}];return l.setKeys(c),void 0!==a&&l.setEasingFunction(a),l},Q.CreateAnimation=function(e,t,i,r){var n=new Q(e+"Animation",e,i,t,Q.ANIMATIONLOOPMODE_CONSTANT);return n.setEasingFunction(r),n},Q.CreateAndStartAnimation=function(e,t,i,r,n,o,s,a,h,l){var c=Q._PrepareAnimation(e,i,r,n,o,s,a,h);return c?t.getScene().beginDirectAnimation(t,[c],0,n,1===c.loopMode,1,l):null},Q.CreateAndStartHierarchyAnimation=function(e,t,i,r,n,o,s,a,h,l,c){var u=Q._PrepareAnimation(e,r,n,o,s,a,h,l);return u?t.getScene().beginDirectHierarchyAnimation(t,i,[u],0,o,1===u.loopMode,1,c):null},Q.CreateMergeAndStartAnimation=function(e,t,i,r,n,o,s,a,h,l){var c=Q._PrepareAnimation(e,i,r,n,o,s,a,h);return c?(t.animations.push(c),t.getScene().beginAnimation(t,0,n,1===c.loopMode,1,l)):null},Q.TransitionTo=function(e,t,i,r,n,o,s,a){if(void 0===a&&(a=null),s<=0)return i[e]=t,a&&a(),null;var h=n*(s/1e3);o.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:h,value:t}]),i.animations||(i.animations=[]),i.animations.push(o);var l=r.beginAnimation(i,0,h,!1);return l.onAnimationEnd=a,l},Object.defineProperty(Q.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++)if(!t[e].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),Q.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var r in this._ranges)i&&(t+=", ",i=!1),t+=r;t+="}"}return t},Q.prototype.addEvent=function(e){this._events.push(e)},Q.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},Q.prototype.getEvents=function(){return this._events},Q.prototype.createRange=function(e,t,i){this._ranges[e]||(this._ranges[e]=new K(e,t,i))},Q.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var i=this._ranges[e];if(i){if(t)for(var r=i.from,n=i.to,o=this._keys.length-1;0<=o;o--)this._keys[o].frame>=r&&this._keys[o].frame<=n&&this._keys.splice(o,1);this._ranges[e]=null}},Q.prototype.getRange=function(e){return this._ranges[e]},Q.prototype.getKeys=function(){return this._keys},Q.prototype.getHighestFrame=function(){for(var e=0,t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},Q.prototype.getEasingFunction=function(){return this._easingFunction},Q.prototype.setEasingFunction=function(e){this._easingFunction=e},Q.prototype.floatInterpolateFunction=function(e,t,i){return H.a.Lerp(e,t,i)},Q.prototype.floatInterpolateFunctionWithTangents=function(e,t,i,r,n){return H.a.Hermite(e,t,i,r,n)},Q.prototype.quaternionInterpolateFunction=function(e,t,i){return p.b.Slerp(e,t,i)},Q.prototype.quaternionInterpolateFunctionWithTangents=function(e,t,i,r,n){return p.b.Hermite(e,t,i,r,n).normalize()},Q.prototype.vector3InterpolateFunction=function(e,t,i){return p.e.Lerp(e,t,i)},Q.prototype.vector3InterpolateFunctionWithTangents=function(e,t,i,r,n){return p.e.Hermite(e,t,i,r,n)},Q.prototype.vector2InterpolateFunction=function(e,t,i){return p.d.Lerp(e,t,i)},Q.prototype.vector2InterpolateFunctionWithTangents=function(e,t,i,r,n){return p.d.Hermite(e,t,i,r,n)},Q.prototype.sizeInterpolateFunction=function(e,t,i){return q.a.Lerp(e,t,i)},Q.prototype.color3InterpolateFunction=function(e,t,i){return G.a.Lerp(e,t,i)},Q.prototype.color4InterpolateFunction=function(e,t,i){return G.b.Lerp(e,t,i)},Q.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},Q.prototype._interpolate=function(e,t){if(t.loopMode===Q.ANIMATIONLOOPMODE_CONSTANT&&0<t.repeatCount)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;var i=this._keys;if(1===i.length)return this._getKeyValue(i[0].value);var r=t.key;if(i[r].frame>=e)for(;0<=r-1&&i[r].frame>=e;)r--;for(var n=r;n<i.length;n++){var o=i[n+1];if(o.frame>=e){var s=i[t.key=n],a=this._getKeyValue(s.value);if(s.interpolation===j.STEP)return a;var h=this._getKeyValue(o.value),l=void 0!==s.outTangent&&void 0!==o.inTangent,c=o.frame-s.frame,u=(e-s.frame)/c,f=this.getEasingFunction();switch(null!=f&&(u=f.ease(u)),this.dataType){case Q.ANIMATIONTYPE_FLOAT:var d=l?this.floatInterpolateFunctionWithTangents(a,s.outTangent*c,h,o.inTangent*c,u):this.floatInterpolateFunction(a,h,u);switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:return d;case Q.ANIMATIONLOOPMODE_RELATIVE:return t.offsetValue*t.repeatCount+d}break;case Q.ANIMATIONTYPE_QUATERNION:var p=l?this.quaternionInterpolateFunctionWithTangents(a,s.outTangent.scale(c),h,o.inTangent.scale(c),u):this.quaternionInterpolateFunction(a,h,u);switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:return p;case Q.ANIMATIONLOOPMODE_RELATIVE:return p.addInPlace(t.offsetValue.scale(t.repeatCount))}return p;case Q.ANIMATIONTYPE_VECTOR3:var _=l?this.vector3InterpolateFunctionWithTangents(a,s.outTangent.scale(c),h,o.inTangent.scale(c),u):this.vector3InterpolateFunction(a,h,u);switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:return _;case Q.ANIMATIONLOOPMODE_RELATIVE:return _.add(t.offsetValue.scale(t.repeatCount))}case Q.ANIMATIONTYPE_VECTOR2:var g=l?this.vector2InterpolateFunctionWithTangents(a,s.outTangent.scale(c),h,o.inTangent.scale(c),u):this.vector2InterpolateFunction(a,h,u);switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:return g;case Q.ANIMATIONLOOPMODE_RELATIVE:return g.add(t.offsetValue.scale(t.repeatCount))}case Q.ANIMATIONTYPE_SIZE:switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(a,h,u);case Q.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(a,h,u).add(t.offsetValue.scale(t.repeatCount))}case Q.ANIMATIONTYPE_COLOR3:switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(a,h,u);case Q.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(a,h,u).add(t.offsetValue.scale(t.repeatCount))}case Q.ANIMATIONTYPE_COLOR4:switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(a,h,u);case Q.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(a,h,u).add(t.offsetValue.scale(t.repeatCount))}case Q.ANIMATIONTYPE_MATRIX:switch(t.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:if(Q.AllowMatricesInterpolation)return this.matrixInterpolateFunction(a,h,u,t.workValue);case Q.ANIMATIONLOOPMODE_RELATIVE:return a}}break}}return this._getKeyValue(i[i.length-1].value)},Q.prototype.matrixInterpolateFunction=function(e,t,i,r){return Q.AllowMatrixDecomposeForInterpolation?r?(p.a.DecomposeLerpToRef(e,t,i,r),r):p.a.DecomposeLerp(e,t,i):r?(p.a.LerpToRef(e,t,i,r),r):p.a.Lerp(e,t,i)},Q.prototype.clone=function(){var e=new Q(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges)for(var t in e._ranges={},this._ranges){var i=this._ranges[t];i&&(e._ranges[t]=i.clone())}return e},Q.prototype.setKeys=function(e){this._keys=e.slice(0)},Q.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var i=this.getKeys(),r=0;r<i.length;r++){var n=i[r],o={};switch(o.frame=n.frame,t){case Q.ANIMATIONTYPE_FLOAT:o.values=[n.value];break;case Q.ANIMATIONTYPE_QUATERNION:case Q.ANIMATIONTYPE_MATRIX:case Q.ANIMATIONTYPE_VECTOR3:case Q.ANIMATIONTYPE_COLOR3:case Q.ANIMATIONTYPE_COLOR4:o.values=n.value.asArray()}e.keys.push(o)}for(var s in e.ranges=[],this._ranges){var a=this._ranges[s];if(a){var h={};h.name=s,h.from=a.from,h.to=a.to,e.ranges.push(h)}}return e},Q._UniversalLerp=function(e,t,i){var r=e.constructor;return r.Lerp?r.Lerp(e,t,i):r.Slerp?r.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t},Q.Parse=function(e){var t,i,r=new Q(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),n=e.dataType,o=[];for(e.enableBlending&&(r.enableBlending=e.enableBlending),e.blendingSpeed&&(r.blendingSpeed=e.blendingSpeed),i=0;i<e.keys.length;i++){var s,a,h=e.keys[i];switch(n){case Q.ANIMATIONTYPE_FLOAT:t=h.values[0],1<=h.values.length&&(s=h.values[1]),2<=h.values.length&&(a=h.values[2]);break;case Q.ANIMATIONTYPE_QUATERNION:if(t=p.b.FromArray(h.values),8<=h.values.length){var l=p.b.FromArray(h.values.slice(4,8));l.equals(p.b.Zero())||(s=l)}if(12<=h.values.length){var c=p.b.FromArray(h.values.slice(8,12));c.equals(p.b.Zero())||(a=c)}break;case Q.ANIMATIONTYPE_MATRIX:t=p.a.FromArray(h.values);break;case Q.ANIMATIONTYPE_COLOR3:t=G.a.FromArray(h.values);break;case Q.ANIMATIONTYPE_COLOR4:t=G.b.FromArray(h.values);break;case Q.ANIMATIONTYPE_VECTOR3:default:t=p.e.FromArray(h.values)}var u={};u.frame=h.frame,u.value=t,null!=s&&(u.inTangent=s),null!=a&&(u.outTangent=a),o.push(u)}if(r.setKeys(o),e.ranges)for(i=0;i<e.ranges.length;i++)t=e.ranges[i],r.createRange(t.name,t.from,t.to);return r},Q.AppendSerializedAnimations=function(e,t){s.a.AppendSerializedAnimations(e,t)},Q.AllowMatricesInterpolation=!1,Q.AllowMatrixDecomposeForInterpolation=!0,Q.ANIMATIONTYPE_FLOAT=0,Q.ANIMATIONTYPE_VECTOR3=1,Q.ANIMATIONTYPE_QUATERNION=2,Q.ANIMATIONTYPE_MATRIX=3,Q.ANIMATIONTYPE_COLOR3=4,Q.ANIMATIONTYPE_COLOR4=7,Q.ANIMATIONTYPE_VECTOR2=5,Q.ANIMATIONTYPE_SIZE=6,Q.ANIMATIONLOOPMODE_RELATIVE=0,Q.ANIMATIONLOOPMODE_CYCLE=1,Q.ANIMATIONLOOPMODE_CONSTANT=2,Q);function Q(e,t,i,r,n,o){this.name=e,this.targetProperty=t,this.framePerSecond=i,this.dataType=r,this.loopMode=n,this.enableBlending=o,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=r,this.loopMode=void 0===n?Q.ANIMATIONLOOPMODE_CYCLE:n}X.a.RegisteredTypes["BABYLON.Animation"]=Z,n.a._AnimationRangeFactory=function(e,t,i){return new K(e,t,i)};var J=(Object.defineProperty($.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var i=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var t=this._attachedCamera;t&&(e?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(e){if(e){e.computeWorldMatrix(!0);var t=e.getBoundingInfo().diagonalLength;i.lowerRadiusTransitionRange=.05*t,i.upperRadiusTransitionRange=.05*t}}):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),$.prototype.init=function(){},$.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},$.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},$.prototype._isRadiusAtLimit=function(e){return!!this._attachedCamera&&this._attachedCamera.radius===e&&!this._radiusIsAnimating},$.prototype._applyBoundRadiusAnimation=function(e){var t=this;if(this._attachedCamera){this._radiusBounceTransition||($.EasingFunction.setEasingMode($.EasingMode),this._radiusBounceTransition=Z.CreateAnimation("radius",Z.ANIMATIONTYPE_FLOAT,60,$.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var i=Z.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return t._clearAnimationLocks()});i&&this._animatables.push(i)}},$.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},$.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},$.EasingFunction=new b(.3),$.EasingMode=f.EASINGMODE_EASEOUT,$);function $(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}var ee=(Object.defineProperty(te.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(te.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!0,configurable:!0}),te.prototype.init=function(){},te.prototype.attach=function(e){var t=this;this._attachedCamera=e;var i=this._attachedCamera.getScene();te.EasingFunction.setEasingMode(te.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add(function(e){e.type!==v.a.POINTERDOWN?e.type===v.a.POINTERUP&&(t._isPointerDown=!1):t._isPointerDown=!0}),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add(function(e){e&&t.zoomOnMesh(e)}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._applyUserInteraction(),t._maintainCameraAboveGround()})},te.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},te.prototype.zoomOnMesh=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,t,i)},te.prototype.zoomOnMeshHierarchy=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,t,i)},te.prototype.zoomOnMeshesHierarchy=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null);for(var r=new p.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new p.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=0;o<e.length;o++){var s=e[o].getHierarchyBoundingVectors(!0);p.e.CheckExtends(s.min,r,n),p.e.CheckExtends(s.max,r,n)}this.zoomOnBoundingInfo(r,n,t,i)},te.prototype.zoomOnBoundingInfo=function(e,t,i,r){var n,o=this;if(void 0===i&&(i=!1),void 0===r&&(r=null),this._attachedCamera){var s=e.y,a=s+(t.y-s)*this._positionScale,h=t.subtract(e).scale(.5);if(i)n=new p.e(0,a,0);else{var l=e.add(h);n=new p.e(l.x,a,l.z)}this._vectorTransition||(this._vectorTransition=Z.CreateAnimation("target",Z.ANIMATIONTYPE_VECTOR3,60,te.EasingFunction)),this._betaIsAnimating=!0;var c=Z.TransitionTo("target",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);c&&this._animatables.push(c);var u=0;if(this._mode===te.FitFrustumSidesMode){var f=this._calculateLowerRadiusFromModelBoundingSphere(e,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=h.length()+this._attachedCamera.minZ),u=f}else this._mode===te.IgnoreBoundsSizeMode&&(u=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var d=t.subtract(e).length();this._attachedCamera.panningSensibility=5e3/d,this._attachedCamera.wheelPrecision=100/u}this._radiusTransition||(this._radiusTransition=Z.CreateAnimation("radius",Z.ANIMATIONTYPE_FLOAT,60,te.EasingFunction)),(c=Z.TransitionTo("radius",u,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){o.stopAllAnimations(),r&&r(),o._attachedCamera&&o._attachedCamera.useInputToRestoreState&&o._attachedCamera.storeState()}))&&this._animatables.push(c)}},te.prototype._calculateLowerRadiusFromModelBoundingSphere=function(e,t){var i=t.subtract(e).length(),r=this._getFrustumSlope(),n=.5*i*this._radiusScale,o=n*Math.sqrt(1+1/(r.x*r.x)),s=n*Math.sqrt(1+1/(r.y*r.y)),a=Math.max(o,s),h=this._attachedCamera;return h?(h.lowerRadiusLimit&&this._mode===te.IgnoreBoundsSizeMode&&(a=a<h.lowerRadiusLimit?h.lowerRadiusLimit:a),h.upperRadiusLimit&&(a=a>h.upperRadiusLimit?h.upperRadiusLimit:a),a):0},te.prototype._maintainCameraAboveGround=function(){var e=this;if(!(this._elevationReturnTime<0)){var t=o.a.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,r=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Z.CreateAnimation("beta",Z.ANIMATIONTYPE_FLOAT,60,te.EasingFunction));var n=Z.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){e._clearAnimationLocks(),e.stopAllAnimations()});n&&this._animatables.push(n)}}},te.prototype._getFrustumSlope=function(){var e=this._attachedCamera;if(!e)return p.d.Zero();var t=e.getScene().getEngine().getAspectRatio(e),i=Math.tan(e.fov/2),r=i*t;return new p.d(r,i)},te.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},te.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=o.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},te.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(te.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),te.EasingFunction=new C,te.EasingMode=f.EASINGMODE_EASEINOUT,te.IgnoreBoundsSizeMode=0,te.FitFrustumSidesMode=1,te);function te(){this._mode=te.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}var ie,re=i(20),ne=i(15),oe=i(35),se=(ie=re.a,Object(r.c)(ae,ie),ae.prototype.getFrontPosition=function(e){this.getWorldMatrix();var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},ae.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},ae.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),ie.prototype.storeState.call(this)},ae.prototype._restoreStateValues=function(){return!!ie.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},ae.prototype._initCache=function(){ie.prototype._initCache.call(this),this._cache.lockedTarget=new p.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new p.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new p.b(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},ae.prototype._updateCache=function(e){e||ie.prototype._updateCache.call(this);var t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},ae.prototype._isSynchronizedViewMatrix=function(){if(!ie.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},ae.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},ae.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=ne.a),p.a.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var t=e.subtract(this.position);0<=t.x?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&p.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},ae.prototype.getTarget=function(){return this._currentTarget},ae.prototype._decideIfNeedsToMove=function(){return 0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z)},ae.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(p.c.Matrix[0]),p.e.TransformNormalToRef(this.cameraDirection,p.c.Matrix[0],p.c.Vector3[0]),void this.position.addInPlace(p.c.Vector3[0]);this.position.addInPlace(this.cameraDirection)},ae.prototype._checkInputs=function(){var e=this._decideIfNeedsToMove(),t=0<Math.abs(this.cameraRotation.x)||0<Math.abs(this.cameraRotation.y);if(e&&this._updatePosition(),t&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.rotationQuaternion||this.rotation.lengthSquared()&&p.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion),!this.noRotationConstraint)){var i=1.570796;this.rotation.x>i&&(this.rotation.x=i),this.rotation.x<-i&&(this.rotation.x=-i)}e&&(Math.abs(this.cameraDirection.x)<this.speed*ne.a&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*ne.a&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*ne.a&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),t&&(Math.abs(this.cameraRotation.x)<this.speed*ne.a&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*ne.a&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),ie.prototype._checkInputs.call(this)},ae.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):p.a.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},ae.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return p.e.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},ae.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),p.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?oe.a.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(p.b.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),oe.a.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},ae.prototype._computeViewMatrix=function(e,t,i){if(this.parent){var r=this.parent.getWorldMatrix();p.e.TransformCoordinatesToRef(e,r,this._globalPosition),p.e.TransformCoordinatesToRef(t,r,this._globalCurrentTarget),p.e.TransformNormalToRef(i,r,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._globalCurrentTarget.copyFrom(t),this._globalCurrentUpVector.copyFrom(i);this.getScene().useRightHandedSystem?p.a.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):p.a.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},ae.prototype.createRigCamera=function(e,t){if(this.cameraRigMode===re.a.RIG_MODE_NONE)return null;var i=new ae(e,this.position.clone(),this.getScene());return i.isRigCamera=!0,(i.rigParent=this).cameraRigMode!==re.a.RIG_MODE_VR&&this.cameraRigMode!==re.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new p.b),i._cameraRigParams={},i.rotationQuaternion=new p.b),i},ae.prototype._updateRigCameras=function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case re.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case re.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case re.a.RIG_MODE_STEREOSCOPIC_INTERLACED:var i=this.cameraRigMode===re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t);break;case re.a.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}ie.prototype._updateRigCameras.call(this)},ae.prototype._getRigCamPositionAndTarget=function(e,t){this.getTarget().subtractToRef(this.position,ae._TargetFocalPoint),ae._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var i=ae._TargetFocalPoint.addInPlace(this.position);p.a.TranslationToRef(-i.x,-i.y,-i.z,ae._TargetTransformMatrix),ae._TargetTransformMatrix.multiplyToRef(p.a.RotationY(e),ae._RigCamTransformMatrix),p.a.TranslationToRef(i.x,i.y,i.z,ae._TargetTransformMatrix),ae._RigCamTransformMatrix.multiplyToRef(ae._TargetTransformMatrix,ae._RigCamTransformMatrix),p.e.TransformCoordinatesToRef(this.position,ae._RigCamTransformMatrix,t.position),t.setTarget(i)},ae.prototype.getClassName=function(){return"TargetCamera"},ae._RigCamTransformMatrix=new p.a,ae._TargetTransformMatrix=new p.a,ae._TargetFocalPoint=new p.e,Object(r.b)([Object(s.k)()],ae.prototype,"rotation",void 0),Object(r.b)([Object(s.c)()],ae.prototype,"speed",void 0),Object(r.b)([Object(s.h)("lockedTargetId")],ae.prototype,"lockedTarget",void 0),ae);function ae(e,t,i,r){void 0===r&&(r=!0);var n=ie.call(this,e,t,i,r)||this;return n.cameraDirection=new p.e(0,0,0),n.cameraRotation=new p.d(0,0),n.updateUpVectorFromRotation=!1,n._tmpQuaternion=new p.b,n.rotation=new p.e(0,0,0),n.speed=2,n.noRotationConstraint=!1,n.lockedTarget=null,n._currentTarget=p.e.Zero(),n._initialFocalDistance=1,n._viewMatrix=p.a.Zero(),n._camMatrix=p.a.Zero(),n._cameraTransformMatrix=p.a.Zero(),n._cameraRotationMatrix=p.a.Zero(),n._referencePoint=new p.e(0,0,1),n._transformedReferencePoint=p.e.Zero(),n._globalCurrentTarget=p.e.Zero(),n._globalCurrentUpVector=p.e.Zero(),n._defaultUp=p.e.Up(),n._cachedRotationZ=0,n._cachedQuaternionRotationZ=0,n}var he=i(11),le={},ce=(ue.prototype.add=function(e){var t=e.getSimpleName();this.attached[t]?he.a.Warn("camera input of type "+t+" already exists on camera"):((this.attached[t]=e).camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedElement&&e.attachControl(this.attachedElement))},ue.prototype.remove=function(e){for(var t in this.attached){var i=this.attached[t];i===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},ue.prototype.removeByType=function(e){for(var t in this.attached){var i=this.attached[t];i.getClassName()===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},ue.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},ue.prototype.attachInput=function(e){this.attachedElement&&e.attachControl(this.attachedElement,this.noPreventDefault)},ue.prototype.attachElement=function(e,t){if(void 0===t&&(t=!1),!this.attachedElement)for(var i in t=!re.a.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedElement=e,this.noPreventDefault=t,this.attached)this.attached[i].attachControl(e,t)},ue.prototype.detachElement=function(e,t){if(void 0===t&&(t=!1),this.attachedElement===e){for(var i in this.attached)this.attached[i].detachControl(e),t&&(this.attached[i].camera=null);this.attachedElement=null}},ue.prototype.rebuildInputCheck=function(){for(var e in this.checkInputs=function(){},this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},ue.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},ue.prototype.serialize=function(e){var t={};for(var i in this.attached){var r=this.attached[i],n=s.a.Serialize(r);t[r.getClassName()]=n}e.inputsmgr=t},ue.prototype.parse=function(e){var t=e.inputsmgr;if(t){for(var i in this.clear(),t)if(o=le[i]){var r=t[i],n=s.a.Parse(function(){return new o},r,null);this.add(n)}}else for(var i in this.attached){var o;(o=le[this.attached[i].getClassName()])&&(n=s.a.Parse(function(){return new o},e,null),this.remove(this.attached[i]),this.add(n))}},ue);function ue(e){this.attached={},this.camera=e,this.checkInputs=function(){}}var fe=i(13),de=(pe.prototype.attachControl=function(f,d){var p=this,_=this.camera.getEngine(),g=0,m=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(e,t){var i=e.event,r="touch"===i.pointerType;if(!_.isInVRExclusivePointerMode&&(e.type===v.a.POINTERMOVE||-1!==p.buttons.indexOf(i.button))){var n=i.srcElement||i.target;if(p._altKey=i.altKey,p._ctrlKey=i.ctrlKey,p._metaKey=i.metaKey,p._shiftKey=i.shiftKey,p._buttonsPressed=i.buttons,_.isPointerLock){var o=i.movementX||i.mozMovementX||i.webkitMovementX||i.msMovementX||0,s=i.movementY||i.mozMovementY||i.webkitMovementY||i.msMovementY||0;p.onTouch(null,o,s),p.pointA=null,p.pointB=null}else if(e.type===v.a.POINTERDOWN&&n){try{n.setPointerCapture(i.pointerId)}catch(e){}null===p.pointA?p.pointA={x:i.clientX,y:i.clientY,pointerId:i.pointerId,type:i.pointerType}:null===p.pointB&&(p.pointB={x:i.clientX,y:i.clientY,pointerId:i.pointerId,type:i.pointerType}),p.onButtonDown(i),d||(i.preventDefault(),f.focus())}else if(e.type===v.a.POINTERDOUBLETAP)p.onDoubleTap(i.pointerType);else if(e.type===v.a.POINTERUP&&n){try{n.releasePointerCapture(i.pointerId)}catch(e){}r||(p.pointB=null),_._badOS?p.pointA=p.pointB=null:p.pointB&&p.pointA&&p.pointA.pointerId==i.pointerId?(p.pointA=p.pointB,p.pointB=null):p.pointA&&p.pointB&&p.pointB.pointerId==i.pointerId?p.pointB=null:p.pointA=p.pointB=null,0===g&&!m||(p.onMultiTouch(p.pointA,p.pointB,g,0,m,null),g=0,m=null),p.onButtonUp(i),d||i.preventDefault()}else if(e.type===v.a.POINTERMOVE)if(d||i.preventDefault(),p.pointA&&null===p.pointB)o=i.clientX-p.pointA.x,s=i.clientY-p.pointA.y,p.onTouch(p.pointA,o,s),p.pointA.x=i.clientX,p.pointA.y=i.clientY;else if(p.pointA&&p.pointB){var a=p.pointA.pointerId===i.pointerId?p.pointA:p.pointB;a.x=i.clientX,a.y=i.clientY;var h=p.pointA.x-p.pointB.x,l=p.pointA.y-p.pointB.y,c=h*h+l*l,u={x:(p.pointA.x+p.pointB.x)/2,y:(p.pointA.y+p.pointB.y)/2,pointerId:i.pointerId,type:e.type};p.onMultiTouch(p.pointA,p.pointB,g,c,m,u),m=u,g=c}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,v.a.POINTERDOWN|v.a.POINTERUP|v.a.POINTERMOVE),this._onLostFocus=function(){p.pointA=p.pointB=null,g=0,m=null,p.onLostFocus()},f.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var e=this.camera.getScene().getEngine().getHostWindow();e&&fe.b.RegisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])},pe.prototype.detachControl=function(e){if(this._onLostFocus){var t=this.camera.getScene().getEngine().getHostWindow();t&&fe.b.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&e.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},pe.prototype.getClassName=function(){return"BaseCameraPointersInput"},pe.prototype.getSimpleName=function(){return"pointers"},pe.prototype.onDoubleTap=function(e){},pe.prototype.onTouch=function(e,t,i){},pe.prototype.onMultiTouch=function(e,t,i,r,n,o){},pe.prototype.onContextMenu=function(e){e.preventDefault()},pe.prototype.onButtonDown=function(e){},pe.prototype.onButtonUp=function(e){},pe.prototype.onLostFocus=function(){},Object(r.b)([Object(s.c)()],pe.prototype,"buttons",void 0),pe);function pe(){this.buttons=[0,1,2]}var _e,ge=(_e=de,Object(r.c)(me,_e),me.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},me.prototype.onTouch=function(e,t,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)},me.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},me.prototype.onMultiTouch=function(e,t,i,r,n,o){if(!(0===i&&null===n||0===r&&null===o)){var s=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(i)/Math.sqrt(r):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-i)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-i)/(this.pinchPrecision*s*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&n&&o){var a=o.x-n.x,h=o.y-n.y;this.camera.inertialPanningX+=-a/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility}}else{this._twoFingerActivityCount++;var l=Math.sqrt(i),c=Math.sqrt(r);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(c-l)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-i)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-i)/(this.pinchPrecision*s*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):0!==this.panningSensibility&&this.multiTouchPanning&&o&&n&&(a=o.x-n.x,h=o.y-n.y,this.camera.inertialPanningX+=-a/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility)}}},me.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},me.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},me.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},Object(r.b)([Object(s.c)()],me.prototype,"buttons",void 0),Object(r.b)([Object(s.c)()],me.prototype,"angularSensibilityX",void 0),Object(r.b)([Object(s.c)()],me.prototype,"angularSensibilityY",void 0),Object(r.b)([Object(s.c)()],me.prototype,"pinchPrecision",void 0),Object(r.b)([Object(s.c)()],me.prototype,"pinchDeltaPercentage",void 0),Object(r.b)([Object(s.c)()],me.prototype,"useNaturalPinchZoom",void 0),Object(r.b)([Object(s.c)()],me.prototype,"panningSensibility",void 0),Object(r.b)([Object(s.c)()],me.prototype,"multiTouchPanning",void 0),Object(r.b)([Object(s.c)()],me.prototype,"multiTouchPanAndZoom",void 0),me);function me(){var e=null!==_e&&_e.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}le.ArcRotateCameraPointersInput=ge;var ve=i(44),be=(ye.prototype.attachControl=function(e,r){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var t,i=e.event;i.metaKey||(e.type===ve.a.KEYDOWN?(n._ctrlPressed=i.ctrlKey,n._altPressed=i.altKey,-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)&&-1===n.keysReset.indexOf(i.keyCode)||(-1===(t=n._keys.indexOf(i.keyCode))&&n._keys.push(i.keyCode),i.preventDefault&&(r||i.preventDefault()))):-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)&&-1===n.keysReset.indexOf(i.keyCode)||(0<=(t=n._keys.indexOf(i.keyCode))&&n._keys.splice(t,1),i.preventDefault&&(r||i.preventDefault())))}))},ye.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},ye.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}},ye.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},ye.prototype.getSimpleName=function(){return"keyboard"},Object(r.b)([Object(s.c)()],ye.prototype,"keysUp",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"keysDown",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"keysLeft",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"keysRight",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"keysReset",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"panningSensibility",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"zoomingSensibility",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"useAltToZoom",void 0),Object(r.b)([Object(s.c)()],ye.prototype,"angularSpeed",void 0),ye);function ye(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}le.ArcRotateCameraKeyboardMoveInput=be;var xe=(Te.prototype.computeDeltaFromMouseWheelLegacyEvent=function(e,t){var i=.01*e*this.wheelDeltaPercentage*t;return 0<e?i/(1+this.wheelDeltaPercentage):i*(1+this.wheelDeltaPercentage)},Te.prototype.attachControl=function(e,h){var l=this;this._wheel=function(e,t){if(e.type===v.a.POINTERWHEEL){var i=e.event,r=0,n=0;if(n=i.wheelDelta?i.wheelDelta:60*-(i.deltaY||i.detail),l.wheelDeltaPercentage){if(0<(r=l.computeDeltaFromMouseWheelLegacyEvent(n,l.camera.radius))){for(var o=l.camera.radius,s=l.camera.inertialRadiusOffset+r,a=0;a<20&&.001<Math.abs(s);a++)o-=s,s*=l.camera.inertia;o=H.a.Clamp(o,0,Number.MAX_VALUE),r=l.computeDeltaFromMouseWheelLegacyEvent(n,o)}}else r=n/(40*l.wheelPrecision);r&&(l.camera.inertialRadiusOffset+=r),i.preventDefault&&(h||i.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,v.a.POINTERWHEEL)},Te.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},Te.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},Te.prototype.getSimpleName=function(){return"mousewheel"},Object(r.b)([Object(s.c)()],Te.prototype,"wheelPrecision",void 0),Object(r.b)([Object(s.c)()],Te.prototype,"wheelDeltaPercentage",void 0),Te);function Te(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}le.ArcRotateCameraMouseWheelInput=xe;var Me,Ee=(Me=ce,Object(r.c)(Ae,Me),Ae.prototype.addMouseWheel=function(){return this.add(new xe),this},Ae.prototype.addPointers=function(){return this.add(new ge),this},Ae.prototype.addKeyboard=function(){return this.add(new be),this},Ae);function Ae(e){return Me.call(this,e)||this}n.a.AddNodeConstructor("ArcRotateCamera",function(e,t){return function(){return new Pe(e,0,0,1,p.e.Zero(),t)}});var Oe,Pe=(Oe=se,Object(r.c)(Ce,Oe),Object.defineProperty(Ce.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new p.a,this._upToYMatrix=new p.a,this._upVector=p.e.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!0,configurable:!0}),Ce.prototype.setMatUp=function(){p.a.RotationAlignToRef(p.e.UpReadOnly,this._upVector,this._YToUpMatrix),p.a.RotationAlignToRef(this._upVector,p.e.UpReadOnly,this._upToYMatrix)},Object.defineProperty(Ce.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"useNaturalPinchZoom",{get:function(){var e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom},set:function(e){var t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new J,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new ee,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new l,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),Ce.prototype._initCache=function(){Oe.prototype._initCache.call(this),this._cache._target=new p.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=p.d.Zero()},Ce.prototype._updateCache=function(e){e||Oe.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},Ce.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.absolutePosition;this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var t=this._getLockedTargetPosition();return t||this._target},Ce.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),Oe.prototype.storeState.call(this)},Ce.prototype._restoreStateValues=function(){return!(!Oe.prototype._restoreStateValues.call(this)||(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0))},Ce.prototype._isSynchronizedViewMatrix=function(){return!!Oe.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},Ce.prototype.attachControl=function(e,t,i,r){var n=this;void 0===i&&(i=!0),void 0===r&&(r=2),this._useCtrlForPanning=i,this._panningMouseButton=r,this.inputs.attachElement(e,t),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}},Ce.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},Ce.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<ne.a&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<ne.a&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*ne.a&&(this.inertialRadiusOffset=0)}0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=p.e.Zero(),this._transformedDirection=p.e.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),p.e.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),p.e.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*ne.a&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*ne.a&&(this.inertialPanningY=0)),this._checkLimits(),Oe.prototype._checkInputs.call(this)}},Ce.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},Ce.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.e.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},Ce.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},Ce.prototype.setTarget=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),e.getBoundingInfo)this._targetBoundingCenter=t?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var r=e,n=this._getTargetPosition();if(n&&!i&&n.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},Ce.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta),r=Math.sin(this.beta);0===r&&(r=1e-4);var n=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*r,this.radius*i,this.radius*t*r),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.e.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),n.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var o=this.getScene().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,o.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var s=this.upVector;this.allowUpsideDown&&r<0&&(s=s.negate()),this._computeViewMatrix(this._position,n,s),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=n,this._viewMatrix},Ce.prototype.zoomOn=function(e,t){void 0===t&&(t=!1),e=e||this.getScene().meshes;var i=h.Mesh.MinMax(e),r=p.e.Distance(i.min,i.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:r},t)},Ce.prototype.focusOn=function(e,t){var i,r;if(void 0===t&&(t=!1),void 0===e.min){var n=e||this.getScene().meshes;i=h.Mesh.MinMax(n),r=p.e.Distance(i.min,i.max)}else{var o=e;r=(i=o).distance}this._target=h.Mesh.Center(i),t||(this.maxZ=2*r)},Ce.prototype.createRigCamera=function(e,t){var i=0;switch(this.cameraRigMode){case re.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case re.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case re.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case re.a.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}var r=new Ce(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return r._cameraRigParams={},r.isRigCamera=!0,r.rigParent=this,r},Ce.prototype._updateRigCameras=function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case re.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case re.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case re.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case re.a.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case re.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}Oe.prototype._updateRigCameras.call(this)},Ce.prototype.dispose=function(){this.inputs.clear(),Oe.prototype.dispose.call(this)},Ce.prototype.getClassName=function(){return"ArcRotateCamera"},Object(r.b)([Object(s.c)()],Ce.prototype,"alpha",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"beta",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"radius",void 0),Object(r.b)([Object(s.k)("target")],Ce.prototype,"_target",void 0),Object(r.b)([Object(s.k)("upVector")],Ce.prototype,"_upVector",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"inertialAlphaOffset",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"inertialBetaOffset",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"inertialRadiusOffset",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"lowerAlphaLimit",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"upperAlphaLimit",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"lowerBetaLimit",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"upperBetaLimit",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"lowerRadiusLimit",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"upperRadiusLimit",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"inertialPanningX",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"inertialPanningY",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"pinchToPanMaxDistance",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"panningDistanceLimit",void 0),Object(r.b)([Object(s.k)()],Ce.prototype,"panningOriginTarget",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"panningInertia",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"zoomOnFactor",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"targetScreenOffset",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"allowUpsideDown",void 0),Object(r.b)([Object(s.c)()],Ce.prototype,"useInputToRestoreState",void 0),Ce);function Ce(e,t,i,r,n,o,s){void 0===s&&(s=!0);var l=Oe.call(this,e,p.e.Zero(),o,s)||this;return l._upVector=p.e.Up(),l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI-.01,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=p.e.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=p.d.Zero(),l.allowUpsideDown=!0,l.useInputToRestoreState=!0,l._viewMatrix=new p.a,l.panningAxis=new p.e(1,1,0),l.onMeshTargetChangedObservable=new a.a,l.checkCollisions=!1,l.collisionRadius=new p.e(.5,.5,.5),l._previousPosition=p.e.Zero(),l._collisionVelocity=p.e.Zero(),l._newPosition=p.e.Zero(),l._computationVector=p.e.Zero(),l._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null),i?(l.setPosition(t),l.onCollide&&l.onCollide(i)):l._previousPosition.copyFrom(l._position);var r=Math.cos(l.alpha),n=Math.sin(l.alpha),o=Math.cos(l.beta),s=Math.sin(l.beta);0===s&&(s=1e-4);var a=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*r*s,l.radius*o,l.radius*n*s),a.addToRef(l._computationVector,l._newPosition),l._position.copyFrom(l._newPosition);var h=l.upVector;l.allowUpsideDown&&l.beta<0&&(h=(h=h.clone()).negate()),l._computeViewMatrix(l._position,a,h),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},l._target=p.e.Zero(),n&&l.setTarget(n),l.alpha=t,l.beta=i,l.radius=r,l.getViewMatrix(),l.inputs=new Ee(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}},function(e,t,i){"use strict";i.r(t),i.d(t,"ScreenshotTools",function(){return I});var y=i(18),c=i(1),_=i(4),x=i(13),g=i(0),r=i(66),p=i(74),m=i(38),T=i(11),v=i(70),n=i(24);n.a.prototype.createRenderTargetTexture=function(e,t){var i=new v.a;void 0!==t&&"object"==typeof t?(i.generateMipMaps=t.generateMipMaps,i.generateDepthBuffer=!!t.generateDepthBuffer,i.generateStencilBuffer=!!t.generateStencilBuffer,i.type=void 0===t.type?0:t.type,i.samplingMode=void 0===t.samplingMode?3:t.samplingMode,i.format=void 0===t.format?5:t.format):(i.generateMipMaps=t,i.generateDepthBuffer=!0,i.generateStencilBuffer=!1,i.type=0,i.samplingMode=3,i.format=5),(1!==i.type||this._caps.textureFloatLinearFiltering)&&(2!==i.type||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=1),1!==i.type||this._caps.textureFloat||(i.type=0,T.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var r=this._gl,n=new m.a(this,m.b.RenderTarget),o=e.width||e,s=e.height||e,a=e.layers||0,h=this._getSamplingParameters(i.samplingMode,!!i.generateMipMaps),l=0!==a?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D,c=this._getRGBABufferInternalSizedFormat(i.type,i.format),u=this._getInternalFormat(i.format),f=this._getWebGLTextureType(i.type);this._bindTextureDirectly(l,n),0!==a?(n.is2DArray=!0,r.texImage3D(l,0,c,o,s,a,0,u,f,null)):r.texImage2D(l,0,c,o,s,0,u,f,null),r.texParameteri(l,r.TEXTURE_MAG_FILTER,h.mag),r.texParameteri(l,r.TEXTURE_MIN_FILTER,h.min),r.texParameteri(l,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(l,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i.generateMipMaps&&this._gl.generateMipmap(l),this._bindTextureDirectly(l,null);var d=r.createFramebuffer();return this._bindUnboundFramebuffer(d),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!i.generateStencilBuffer,i.generateDepthBuffer,o,s),n.is2DArray||r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n._webGLTexture,0),this._bindUnboundFramebuffer(null),n._framebuffer=d,n.baseWidth=o,n.baseHeight=s,n.width=o,n.height=s,n.depth=a,n.isReady=!0,n.samples=1,n.generateMipMaps=!!i.generateMipMaps,n.samplingMode=i.samplingMode,n.type=i.type,n.format=i.format,n._generateDepthBuffer=i.generateDepthBuffer,n._generateStencilBuffer=!!i.generateStencilBuffer,this._internalTexturesCache.push(n),n},n.a.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}return this._createDepthStencilTexture(e,t)},n.a.prototype._createDepthStencilTexture=function(e,t){var i=this._gl,r=e.layers||0,n=0!==r?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D,o=new m.a(this,m.b.Depth);if(!this._caps.depthTextureExtension)return T.a.Error("Depth texture is not supported by your browser or hardware."),o;var s=Object(c.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(n,o,!0),this._setupDepthStencilTexture(o,e,s.generateStencil,s.bilinearFiltering,s.comparisonFunction);var a=s.generateStencil?i.UNSIGNED_INT_24_8:i.UNSIGNED_INT,h=s.generateStencil?i.DEPTH_STENCIL:i.DEPTH_COMPONENT,l=h;return 1<this.webGLVersion&&(l=s.generateStencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24),o.is2DArray?i.texImage3D(n,0,l,o.width,o.height,r,0,h,a,null):i.texImage2D(n,0,l,o.width,o.height,0,h,a,null),this._bindTextureDirectly(n,null),o},n.a.prototype.createRenderTargetCubeTexture=function(e,t){var i=Object(c.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},t);i.generateStencilBuffer=i.generateDepthBuffer&&i.generateStencilBuffer,(1!==i.type||this._caps.textureFloatLinearFiltering)&&(2!==i.type||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=1);var r=this._gl,n=new m.a(this,m.b.RenderTarget);this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,n,!0);var o=this._getSamplingParameters(i.samplingMode,i.generateMipMaps);1!==i.type||this._caps.textureFloat||(i.type=0,T.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,o.mag),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,o.min),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(var s=0;s<6;s++)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,this._getRGBABufferInternalSizedFormat(i.type,i.format),e,e,0,this._getInternalFormat(i.format),this._getWebGLTextureType(i.type),null);var a=r.createFramebuffer();return this._bindUnboundFramebuffer(a),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(i.generateStencilBuffer,i.generateDepthBuffer,e,e),i.generateMipMaps&&r.generateMipmap(r.TEXTURE_CUBE_MAP),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),n._framebuffer=a,n.width=e,n.height=e,n.isReady=!0,n.isCube=!0,n.samples=1,n.generateMipMaps=i.generateMipMaps,n.samplingMode=i.samplingMode,n.type=i.type,n.format=i.format,n._generateDepthBuffer=i.generateDepthBuffer,n._generateStencilBuffer=i.generateStencilBuffer,this._internalTexturesCache.push(n),n};var b,M=i(26),E=(b=y.a,Object(c.c)(o,b),Object.defineProperty(o.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),o.prototype._hookArray=function(n){var o=this,s=n.push;n.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=0===n.length,r=s.apply(n,e);return i&&o.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),r};var r=n.splice;n.splice=function(e,t){var i=r.apply(n,[e,t]);return 0===n.length&&o.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),i}},Object.defineProperty(o.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),o.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(o.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"depthStencilTexture",{get:function(){var e;return(null===(e=this.getInternalTexture())||void 0===e?void 0:e._depthStencilTexture)||null},enumerable:!0,configurable:!0}),o.prototype.createDepthStencilTexture=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=!0),void 0===i&&(i=!1);var r=this.getInternalTexture();if(this.getScene()&&r){var n=this.getScene().getEngine();r._depthStencilTexture=n.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this.isCube})}},o.prototype._processSizeParameter=function(e){e.ratio?(this._sizeRatio=e.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=e},Object.defineProperty(o.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!0,configurable:!0}),o.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(o.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),o.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new r.a(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},o.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,i=this._postProcesses;t<i.length;t++)i[t].dispose();this._postProcesses=[]}},o.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),0<this._postProcesses.length&&(this._postProcesses[0].autoClear=!1))}},o.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},o.prototype.getRenderSize=function(){return this.getRenderWidth()},o.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},o.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},o.prototype.getRenderLayers=function(){var e=this._size.layers;return e||0},Object.defineProperty(o.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),o.prototype.scale=function(e){var t=Math.max(1,this.getRenderSize()*e);this.resize(t)},o.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:b.prototype.getReflectionTextureMatrix.call(this)},o.prototype.resize=function(e){var t=this.isCube;this.releaseInternalTexture();var i=this.getScene();i&&(this._processSizeParameter(e),this._texture=t?i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},o.prototype.render=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),a=this.getScene()){var i,r=a.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var n=0;n<this._waitingRenderList.length;n++){var o=this._waitingRenderList[n],s=a.getMeshByID(o);s&&this.renderList.push(s)}delete this._waitingRenderList}if(this.renderListPredicate){var a;if(this.renderList?this.renderList.length=0:this.renderList=[],!(a=this.getScene()))return;var h=a.meshes;for(n=0;n<h.length;n++){var l=h[n];this.renderListPredicate(l)&&this.renderList.push(l)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(i=this.activeCamera,r.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==a.activeCamera&&a.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(i=a.activeCamera)&&r.setViewport(i.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var c=0;c<this.getRenderLayers();c++)this.renderToTarget(0,e,t,c,i),a.incrementRenderId(),a.resetCachedMaterial();else if(this.isCube)for(var u=0;u<6;u++)this.renderToTarget(u,e,t,void 0,i),a.incrementRenderId(),a.resetCachedMaterial();else this.renderToTarget(0,e,t,void 0,i);this.onAfterUnbindObservable.notifyObservers(this),a.activeCamera&&((1<a.getEngine().scenes.length||this.activeCamera&&this.activeCamera!==a.activeCamera)&&a.setTransformMatrix(a.activeCamera.getViewMatrix(),a.activeCamera.getProjectionMatrix(!0)),r.setViewport(a.activeCamera.viewport)),a.resetCachedMaterial()}},o.prototype._bestReflectionRenderTargetDimension=function(e,t){var i=e*t,r=M.Engine.NearestPOT(i+16384/(128+i));return Math.min(M.Engine.FloorPOT(e),r)},o.prototype._prepareRenderingManager=function(e,t,i,r){var n=this.getScene();if(n){this._renderingManager.reset();for(var o=n.getRenderId(),s=0;s<t;s++){var a=e[s];if(a){if(!a.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}a._preActivateForIntermediateRendering(o);var h=void 0;if(h=!(!r||!i)&&0==(a.layerMask&i.layerMask),a.isEnabled()&&a.isVisible&&a.subMeshes&&!h&&a._activate(o,!0)&&a.subMeshes.length){a.isAnInstance?a=a.sourceMesh:a._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,a._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var l=0;l<a.subMeshes.length;l++){var c=a.subMeshes[l];this._renderingManager.dispatch(c,a)}}}}for(var u=0;u<n.particleSystems.length;u++){var f=n.particleSystems[u],d=f.emitter;f.isStarted()&&d&&d.position&&d.isEnabled()&&0<=e.indexOf(d)&&this._renderingManager.dispatchParticles(f)}}},o.prototype._bindFrameBuffer=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var i=this.getScene();if(i){var r=i.getEngine();this._texture&&r.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}},o.prototype.unbindFrameBuffer=function(e,t){var i=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){i.onAfterRenderObservable.notifyObservers(t)})},o.prototype.renderToTarget=function(e,t,i,r,n){void 0===r&&(r=0),void 0===n&&(n=null);var o=this.getScene();if(o){var s=o.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):t&&o.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(e,r),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(r):this.onBeforeRenderObservable.notifyObservers(e);var a=null,h=this.renderList?this.renderList:o.getActiveMeshes().data,l=this.renderList?this.renderList.length:o.getActiveMeshes().length;this.getCustomRenderList&&(a=this.getCustomRenderList(this.is2DArray?r:e,h,l)),a?this._prepareRenderingManager(a,a.length,n,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(h,l,n,!this.renderList),this._defaultRenderListPrepared=!0),a=h),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(s):s.clear(this.clearColor||o.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||o.updateTransformMatrix(!0);for(var c=0,u=o._beforeRenderTargetDrawStage;c<u.length;c++)u[c].action(this);this._renderingManager.render(this.customRenderFunction,a,this.renderParticles,this.renderSprites);for(var f=0,d=o._afterRenderTargetDrawStage;f<d.length;f++)d[f].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):t&&o.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||o.updateTransformMatrix(!0),i&&x.b.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),s),this.isCube&&5!==e?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&5===e&&s.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(s,e))}}},o.prototype.setRenderingOrder=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,i,r)},o.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},o.prototype.clone=function(){var e=this.getSize(),t=new o(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t},o.prototype.serialize=function(){if(!this.name)return null;var e=b.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e},o.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},o.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var t=e.customRenderTargets.indexOf(this);0<=t&&e.customRenderTargets.splice(t,1);for(var i=0,r=e.cameras;i<r.length;i++){var n=r[i];0<=(t=n.customRenderTargets.indexOf(this))&&n.customRenderTargets.splice(t,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),b.prototype.dispose.call(this)}},o.prototype._rebuild=function(){this.refreshRate===o.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=o.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},o.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},o.prototype.getViewCount=function(){return 1},o.REFRESHRATE_RENDER_ONCE=0,o.REFRESHRATE_RENDER_ONEVERYFRAME=1,o.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,o);function o(e,t,i,r,n,o,s,a,h,l,c,u,f){void 0===n&&(n=!0),void 0===o&&(o=0),void 0===s&&(s=!1),void 0===a&&(a=y.a.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=!0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=5),void 0===f&&(f=!1);var d=b.call(this,null,i,!r)||this;return d.isCube=s,d.renderParticles=!0,d.renderSprites=!1,d.coordinatesMode=y.a.PROJECTION_MODE,d.ignoreCameraViewport=!1,d.onBeforeBindObservable=new _.a,d.onAfterUnbindObservable=new _.a,d.onBeforeRenderObservable=new _.a,d.onAfterRenderObservable=new _.a,d.onClearObservable=new _.a,d.onResizeObservable=new _.a,d._currentRefreshId=-1,d._refreshRate=1,d._samples=1,d.boundingBoxPosition=g.e.Zero(),(i=d.getScene())?(d.renderList=new Array,d._engine=i.getEngine(),d.name=e,d.isRenderTarget=!0,d._initialSizeParameter=t,d._processSizeParameter(t),d._resizeObserver=d.getScene().getEngine().onResizeObservable.add(function(){}),d._generateMipMaps=!!r,d._doNotChangeAspectRatio=n,d._renderingManager=new p.a(i),d._renderingManager._useSceneAutoClearSetup=!0,c||(d._renderTargetOptions={generateMipMaps:r,type:o,format:u,samplingMode:a,generateDepthBuffer:h,generateStencilBuffer:l},a===y.a.NEAREST_SAMPLINGMODE&&(d.wrapU=y.a.CLAMP_ADDRESSMODE,d.wrapV=y.a.CLAMP_ADDRESSMODE),f||(s?(d._texture=i.getEngine().createRenderTargetCubeTexture(d.getRenderSize(),d._renderTargetOptions),d.coordinatesMode=y.a.INVCUBIC_MODE,d._textureMatrix=g.a.Identity()):d._texture=i.getEngine().createRenderTargetTexture(d._size,d._renderTargetOptions))),d):d}y.a._CreateRenderTargetTexture=function(e,t,i,r){return new E(e,t,i,r)};var A=i(28),s=i(6),a="postprocessVertexShader",h="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",l=(s.a.ShadersStore[a]=h,Object.defineProperty(u.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)})},enumerable:!0,configurable:!0}),u.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(u.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!0,configurable:!0}),u.prototype.getCamera=function(){return this._camera},Object.defineProperty(u.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),u.prototype.getClassName=function(){return"PostProcess"},u.prototype.getEngine=function(){return this._engine},u.prototype.getEffect=function(){return this._effect},u.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},u.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new A.a(2)),this._shareOutputWithPostProcess=null},u.prototype.updateEffect=function(e,t,i,r,n,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],t||this._parameters,i||this._samplers,null!==e?e:"",void 0,n,o,r||this._indexParameters)},u.prototype.isReusable=function(){return this._reusable},u.prototype.markTextureDirty=function(){this.width=-1},u.prototype.activate=function(e,t,i){var r=this;void 0===t&&(t=null);var n=(e=e||this._camera).getScene(),o=n.getEngine(),s=o.getCaps().maxTextureSize,a=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,h=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0,l=e.parent;!l||l.leftCamera!=e&&l.rightCamera!=e||(a/=2);var c,u=this._options.width||a,f=this._options.height||h,d=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var p=o.currentViewport;p&&(u*=p.width,f*=p.height)}if((d||this.alwaysForcePOT)&&(this._options.width||(u=o.needPOTTextures?M.Engine.GetExponentOfTwo(u,s,this.scaleMode):u),this._options.height||(f=o.needPOTTextures?M.Engine.GetExponentOfTwo(f,s,this.scaleMode):f)),this.width!==u||this.height!==f){if(0<this._textures.length){for(var _=0;_<this._textures.length;_++)this._engine._releaseTexture(this._textures.data[_]);this._textures.reset()}this.width=u,this.height=f;var g={width:this.width,height:this.height},m={generateMipMaps:d,generateDepthBuffer:i||0===e._postProcesses.indexOf(this),generateStencilBuffer:(i||0===e._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._engine.createRenderTargetTexture(g,m)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(g,m)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(e){e.samples!==r.samples&&r._engine.updateRenderTargetTextureSampleCount(e,r.samples)})}return this._shareOutputWithPostProcess?c=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(c=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):c=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(a/u,h/f),this._engine.bindFramebuffer(c,0,a,h,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(c,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(e),this.autoClear&&0===this.alphaMode&&this._engine.clear(this.clearColor?this.clearColor:n.clearColor,n._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),c},Object.defineProperty(u.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),u.prototype.isReady=function(){return this._effect&&this._effect.isReady()},u.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",e),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var e},u.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(0<this._textures.length)for(var e=0;e<this._textures.length;e++)this._engine._releaseTexture(this._textures.data[e]);this._textures.dispose()}},u.prototype.dispose=function(e){if(e=e||this._camera,this._disposeTextures(),this._scene){var t=this._scene.postProcesses.indexOf(this);-1!==t&&this._scene.postProcesses.splice(t,1)}else{var i=this._engine.postProcesses.indexOf(this);-1!==i&&this._engine.postProcesses.splice(i,1)}if(e){if(e.detachPostProcess(this),0===e._postProcesses.indexOf(this)&&0<e._postProcesses.length){var r=this._camera._getFirstPostProcess();r&&r.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},u);function u(e,t,i,r,n,o,s,a,h,l,c,u,f,d,p){void 0===s&&(s=1),void 0===l&&(l=null),void 0===c&&(c=0),void 0===u&&(u="postprocess"),void 0===d&&(d=!1),void 0===p&&(p=5),this.name=e,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=0,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new A.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new g.d(1,1),this._texelSize=g.d.Zero(),this.onActivateObservable=new _.a,this.onSizeChangedObservable=new _.a,this.onApplyObservable=new _.a,this.onBeforeRenderObservable=new _.a,this.onAfterRenderObservable=new _.a,null!=o?(this._camera=o,this._scene=o.getScene(),o.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):a&&(this._engine=a,this._engine.postProcesses.push(this)),this._options=n,this.renderTargetSamplingMode=s||1,this._reusable=h||!1,this._textureType=c,this._textureFormat=p,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=u,this._parameters=i||[],this._parameters.push("scale"),this._indexParameters=f,d||this.updateEffect(l)}var f,d="fxaaPixelShader",O="uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\n#ifndef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\nreturn;\n}\n#endif\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan)\n{\nlumaS=lumaE;\n}\nif (horzSpan)\n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan)\n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN)\n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN)\n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN)\n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP)\n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan)\n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\n#ifdef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\n}\nelse\n{\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}\n#else\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n#endif\n}",P=(s.a.ShadersStore[d]=O,"fxaaVertexShader"),C="\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}",S=(s.a.ShadersStore[P]=C,f=l,Object(c.c)(R,f),R.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var t=e.getGlInfo();return t&&t.renderer&&-1<t.renderer.toLowerCase().indexOf("mali")?"#define MALI 1\n":null},R);function R(e,t,i,r,n,o,s){void 0===i&&(i=null),void 0===s&&(s=0);var a=f.call(this,e,"fxaa",["texelSize"],null,t,i,r||y.a.BILINEAR_SAMPLINGMODE,n,o,null,s,"fxaa",void 0,!0)||this,h=a._getDefines();return a.updateEffect(h),a.onApplyObservable.add(function(e){var t=a.texelSize;e.setFloat2("texelSize",t.x,t.y)}),a}var I=(w.CreateScreenshot=function(e,t,i,r,n){void 0===n&&(n="image/png");var o=w._getScreenshotSize(e,t,i),s=o.height,a=o.width;if(s&&a){x.b._ScreenshotCanvas||(x.b._ScreenshotCanvas=document.createElement("canvas")),x.b._ScreenshotCanvas.width=a,x.b._ScreenshotCanvas.height=s;var h=x.b._ScreenshotCanvas.getContext("2d"),l=e.getRenderWidth()/e.getRenderHeight(),c=a,u=c/l;s<u&&(c=(u=s)*l);var f=Math.max(0,a-c)/2,d=Math.max(0,s-u)/2,p=e.getRenderingCanvas();h&&p&&h.drawImage(p,f,d,c,u),x.b.EncodeScreenshotCanvasData(r,n)}else T.a.Error("Invalid 'size' parameter !")},w.CreateScreenshotAsync=function(e,r,n,o){return void 0===o&&(o="image/png"),new Promise(function(t,i){w.CreateScreenshot(e,r,n,function(e){void 0!==e?t(e):i(new Error("Data is undefined"))},o)})},w.CreateScreenshotUsingRenderTarget=function(e,t,i,r,n,o,s,a,h){void 0===n&&(n="image/png"),void 0===o&&(o=1),void 0===s&&(s=!1),void 0===h&&(h=!1);var l=w._getScreenshotSize(e,t,i),c=l.height,u=l.width,f={width:u,height:c};if(c&&u){var d=t.getScene(),p=null;d.activeCamera!==t&&(p=d.activeCamera,d.activeCamera=t);var _=e.getRenderingCanvas();if(_){var g={width:_.width,height:_.height};e.setSize(u,c),d.render();var m=new E("screenShot",f,d,!1,!1,0,!1,y.a.NEAREST_SAMPLINGMODE);m.renderList=null,m.samples=o,m.renderSprites=h,m.onAfterRenderObservable.add(function(){x.b.DumpFramebuffer(u,c,e,r,n,a)});var v=function(){d.incrementRenderId(),d.resetCachedMaterial(),m.render(!0),m.dispose(),p&&(d.activeCamera=p),e.setSize(g.width,g.height),t.getProjectionMatrix(!0)};if(s){var b=new S("antialiasing",1,d.activeCamera);m.addPostProcess(b),b.getEffect().isReady()?v():b.getEffect().onCompiled=function(){v()}}else v()}else T.a.Error("No rendering canvas found !")}else T.a.Error("Invalid 'size' parameter !")},w.CreateScreenshotUsingRenderTargetAsync=function(e,r,n,o,s,a,h,l){return void 0===o&&(o="image/png"),void 0===s&&(s=1),void 0===a&&(a=!1),void 0===l&&(l=!1),new Promise(function(t,i){w.CreateScreenshotUsingRenderTarget(e,r,n,function(e){void 0!==e?t(e):i(new Error("Data is undefined"))},o,s,a,h,l)})},w._getScreenshotSize=function(e,t,i){var r=0,n=0;if("object"==typeof i){var o=i.precision?Math.abs(i.precision):1;i.width&&i.height?(r=i.height*o,n=i.width*o):i.width&&!i.height?(n=i.width*o,r=Math.round(n/e.getAspectRatio(t))):i.height&&!i.width?(r=i.height*o,n=Math.round(r*e.getAspectRatio(t))):(n=Math.round(e.getRenderWidth()*o),r=Math.round(n/e.getAspectRatio(t)))}else isNaN(i)||(n=r=i);return n=n&&Math.floor(n),{height:0|(r=r&&Math.floor(r)),width:0|n}},w);function w(){}x.b.CreateScreenshot=I.CreateScreenshot,x.b.CreateScreenshotAsync=I.CreateScreenshotAsync,x.b.CreateScreenshotUsingRenderTarget=I.CreateScreenshotUsingRenderTarget,x.b.CreateScreenshotUsingRenderTargetAsync=I.CreateScreenshotUsingRenderTargetAsync},function(e,t,i){"use strict";i.r(t),i.d(t,"LinesBuilder",function(){return N});var m=i(0),s=i(17),v=i(12),o=i(1),l=i(7),_=i(2),r=i(11),n=i(42),a=i(57),h=i(39);s.Mesh._instancedMeshFactory=function(e,t){var i=new u(e,t);if(t.instancedBuffers)for(var r in i.instancedBuffers={},t.instancedBuffers)i.instancedBuffers[r]=t.instancedBuffers[r];return i};var c,u=(c=n.a,Object(o.c)(f,c),f.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(f.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),f.prototype._resyncLightSources=function(){},f.prototype._resyncLightSource=function(e){},f.prototype._removeLightSource=function(e,t){},Object.defineProperty(f.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&r.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),f.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},f.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(f.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),f.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},f.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},f.prototype.setVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh},f.prototype.updateVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh},f.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},f.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},f.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(f.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),f.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},f.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},f.prototype._activate=function(e,t){if(this._sourceMesh.subMeshes||r.a.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(0<this._currentLOD._getWorldMatrixDeterminant()!=0<this._getWorldMatrixDeterminant())return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0}return!1},f.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},f.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==h.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,m.c.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),m.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(m.c.Vector3[7]),this._currentLOD._masterMesh=e,m.c.Matrix[0]}return c.prototype.getWorldMatrix.call(this)},Object.defineProperty(f.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),f.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},f.prototype._preActivateForIntermediateRendering=function(e){return this.sourceMesh._preActivateForIntermediateRendering(e)},f.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},f.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},f.prototype.clone=function(e,t,i){void 0===t&&(t=null);var r=this._sourceMesh.createInstance(e);if(a.a.DeepCopy(this,r,["name","subMeshes","uniqueId","parent"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(var n=0;n<this.getScene().meshes.length;n++){var o=this.getScene().meshes[n];o.parent===this&&o.clone(o.name,r)}return r.computeWorldMatrix(!0),r},f.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._sourceMesh.removeInstance(this),c.prototype.dispose.call(this,e,t)},f);function f(e,t){var i=c.call(this,e,t.getScene())||this;i._indexInSourceMeshInstanceArray=-1,t.addInstance(i),i._sourceMesh=t,i._unIndexed=t._unIndexed,i.position.copyFrom(t.position),i.rotation.copyFrom(t.rotation),i.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(i.rotationQuaternion=t.rotationQuaternion.clone()),i.animations=t.animations;for(var r=0,n=t.getAnimationRanges();r<n.length;r++){var o=n[r];null!=o&&i.createAnimationRange(o.name,o.from,o.to)}return i.infiniteDistance=t.infiniteDistance,i.setPivotMatrix(t.getPivotMatrix()),i.refreshBoundingInfo(),i._syncSubMeshes(),i}s.Mesh.prototype.registerInstancedBuffer=function(e,t){if(this.removeVerticesData(e),!this.instancedBuffers){this.instancedBuffers={};for(var i=0,r=this.instances;i<r.length;i++){r[i].instancedBuffers={}}this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new _.b(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[e]);for(var n=0,o=this.instances;n<o.length;n++){o[n].instancedBuffers[e]=null}},s.Mesh.prototype._processInstancedBuffers=function(e,t){var i=e.length;for(var r in this.instancedBuffers){for(var n=this._userInstancedBuffersStorage.sizes[r],o=this._userInstancedBuffersStorage.strides[r],s=(i+1)*o;n<s;)n*=2;this._userInstancedBuffersStorage.data[r].length!=n&&(this._userInstancedBuffersStorage.data[r]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[r]=n,this._userInstancedBuffersStorage.vertexBuffers[r]&&(this._userInstancedBuffersStorage.vertexBuffers[r].dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null));var a=this._userInstancedBuffersStorage.data[r],h=0;if(t)h+=o,(c=this.instancedBuffers[r]).toArray?c.toArray(a,h):c.copyToArray(a,h);for(var l=0;l<i;l++){var c;(c=e[l].instancedBuffers[r]).toArray?c.toArray(a,h):c.copyToArray(a,h),h+=o}this._userInstancedBuffersStorage.vertexBuffers[r]?this._userInstancedBuffersStorage.vertexBuffers[r].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[r]=new _.b(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,o,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[r]))}},s.Mesh.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this.instancedBuffers={}};var d,p=i(27),g=i(3),b=i(18),y=i(19),x=i(10),T=i(73),M=(d=p.a,Object(o.c)(E,d),Object.defineProperty(E.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(e){this._shaderPath=e},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),E.prototype.getClassName=function(){return"ShaderMaterial"},E.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},E.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},E.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},E.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},E.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},E.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},E.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},E.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},E.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},E.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(function(e,t){return t.toArray(e,e.length),e},[]),this},E.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},E.prototype.setColor4Array=function(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce(function(e,t){return t.toArray(e,e.length),e},[]),this},E.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},E.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},E.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},E.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},E.prototype.setMatrices=function(e,t){this._checkUniform(e);for(var i=new Float32Array(16*t.length),r=0;r<t.length;r++)t[r].copyToArray(i,16*r);return this._matrixArrays[e]=i,this},E.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},E.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},E.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this},E.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},E.prototype.setArray4=function(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this},E.prototype._checkCache=function(e,t){return!e||!this._effect||-1!==this._effect.defines.indexOf("#define INSTANCES")===t},E.prototype.isReadyForSubMesh=function(e,t,i){return this.isReady(e,i)},E.prototype.isReady=function(e,t){if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var i=this.getScene(),r=i.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===i.getRenderId()&&this._checkCache(e,t))return!0;var n=[],o=[],s=new T.a;r.getCaps().multiview&&i.activeCamera&&i.activeCamera.outputRenderTarget&&1<i.activeCamera.outputRenderTarget.getViewCount()&&(this._multiview=!0,n.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.push("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var a=0;a<this._options.defines.length;a++)n.push(this._options.defines[a]);for(a=0;a<this._options.attributes.length;a++)o.push(this._options.attributes[a]);if(e&&e.isVerticesDataPresent(_.b.ColorKind)&&(o.push(_.b.ColorKind),n.push("#define VERTEXCOLOR")),t&&(n.push("#define INSTANCES"),y.a.PushAttributesForInstances(o)),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){o.push(_.b.MatricesIndicesKind),o.push(_.b.MatricesWeightsKind),4<e.numBoneInfluencers&&(o.push(_.b.MatricesIndicesExtraKind),o.push(_.b.MatricesWeightsExtraKind));var h=e.skeleton;n.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),s.addCPUSkinningFallback(0,e),h.isUsingTextureForMatrices?(n.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(n.push("#define BonesPerMesh "+(h.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else n.push("#define NUM_BONE_INFLUENCERS 0");for(var l in this._textures)if(!this._textures[l].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&n.push("#define ALPHATEST");var c=this._effect,u=n.join("\n");return this._effect=r.createEffect(this._shaderPath,{attributes:o,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:u,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError},r),!!this._effect.isReady()&&(c!==this._effect&&i.resetCachedMaterial(),this._renderId=i.getRenderId(),this._effect._wasPreviouslyReady=!0)},E.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(e.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),this._effect.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},E.prototype.bind=function(e,t){if(this.bindOnlyWorldMatrix(e),this._effect&&this.getScene().getCachedMaterial()!==this){var i;for(i in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&(this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&this._effect.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&this._effect.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),y.a.BindBonesParameters(t,this._effect),this._textures)this._effect.setTexture(i,this._textures[i]);for(i in this._textureArrays)this._effect.setTextureArray(i,this._textureArrays[i]);for(i in this._ints)this._effect.setInt(i,this._ints[i]);for(i in this._floats)this._effect.setFloat(i,this._floats[i]);for(i in this._floatsArrays)this._effect.setArray(i,this._floatsArrays[i]);for(i in this._colors3)this._effect.setColor3(i,this._colors3[i]);for(i in this._colors3Arrays)this._effect.setArray3(i,this._colors3Arrays[i]);for(i in this._colors4){var r=this._colors4[i];this._effect.setFloat4(i,r.r,r.g,r.b,r.a)}for(i in this._colors4Arrays)this._effect.setArray4(i,this._colors4Arrays[i]);for(i in this._vectors2)this._effect.setVector2(i,this._vectors2[i]);for(i in this._vectors3)this._effect.setVector3(i,this._vectors3[i]);for(i in this._vectors4)this._effect.setVector4(i,this._vectors4[i]);for(i in this._matrices)this._effect.setMatrix(i,this._matrices[i]);for(i in this._matrixArrays)this._effect.setMatrices(i,this._matrixArrays[i]);for(i in this._matrices3x3)this._effect.setMatrix3x3(i,this._matrices3x3[i]);for(i in this._matrices2x2)this._effect.setMatrix2x2(i,this._matrices2x2[i]);for(i in this._vectors2Arrays)this._effect.setArray2(i,this._vectors2Arrays[i]);for(i in this._vectors3Arrays)this._effect.setArray3(i,this._vectors3Arrays[i]);for(i in this._vectors4Arrays)this._effect.setArray4(i,this._vectors4Arrays[i])}this._afterBind(t)},E.prototype.getActiveTextures=function(){var e=d.prototype.getActiveTextures.call(this);for(var t in this._textures)e.push(this._textures[t]);for(var t in this._textureArrays)for(var i=this._textureArrays[t],r=0;r<i.length;r++)e.push(i[r]);return e},E.prototype.hasTexture=function(e){if(d.prototype.hasTexture.call(this,e))return!0;for(var t in this._textures)if(this._textures[t]===e)return!0;for(var t in this._textureArrays)for(var i=this._textureArrays[t],r=0;r<i.length;r++)if(i[r]===e)return!0;return!1},E.prototype.clone=function(e){var i=this,t=g.a.Clone(function(){return new E(e,i.getScene(),i._shaderPath,i._options)},this);for(var r in t.name=e,t.id=e,"object"==typeof t._shaderPath&&(t._shaderPath=Object(o.a)({},t._shaderPath)),this._options=Object(o.a)({},this._options),Object.keys(this._options).forEach(function(e){var t=i._options[e];Array.isArray(t)&&(i._options[e]=t.slice(0))}),this._textures)t.setTexture(r,this._textures[r]);for(var r in this._floats)t.setFloat(r,this._floats[r]);for(var r in this._floatsArrays)t.setFloats(r,this._floatsArrays[r]);for(var r in this._colors3)t.setColor3(r,this._colors3[r]);for(var r in this._colors4)t.setColor4(r,this._colors4[r]);for(var r in this._vectors2)t.setVector2(r,this._vectors2[r]);for(var r in this._vectors3)t.setVector3(r,this._vectors3[r]);for(var r in this._vectors4)t.setVector4(r,this._vectors4[r]);for(var r in this._matrices)t.setMatrix(r,this._matrices[r]);for(var r in this._matrices3x3)t.setMatrix3x3(r,this._matrices3x3[r]);for(var r in this._matrices2x2)t.setMatrix2x2(r,this._matrices2x2[r]);return t},E.prototype.dispose=function(e,t,i){if(t){var r;for(r in this._textures)this._textures[r].dispose();for(r in this._textureArrays)for(var n=this._textureArrays[r],o=0;o<n.length;o++)n[o].dispose()}this._textures={},d.prototype.dispose.call(this,e,t,i)},E.prototype.serialize=function(){var e,t=g.a.Serialize(this);for(e in t.customType="BABYLON.ShaderMaterial",t.options=this._options,t.shaderPath=this._shaderPath,t.textures={},this._textures)t.textures[e]=this._textures[e].serialize();for(e in t.textureArrays={},this._textureArrays){t.textureArrays[e]=[];for(var i=this._textureArrays[e],r=0;r<i.length;r++)t.textureArrays[e].push(i[r].serialize())}for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];for(e in t.FloatArrays={},this._floatsArrays)t.FloatArrays[e]=this._floatsArrays[e];for(e in t.colors3={},this._colors3)t.colors3[e]=this._colors3[e].asArray();for(e in t.colors3Arrays={},this._colors3Arrays)t.colors3Arrays[e]=this._colors3Arrays[e];for(e in t.colors4={},this._colors4)t.colors4[e]=this._colors4[e].asArray();for(e in t.colors4Arrays={},this._colors4Arrays)t.colors4Arrays[e]=this._colors4Arrays[e];for(e in t.vectors2={},this._vectors2)t.vectors2[e]=this._vectors2[e].asArray();for(e in t.vectors3={},this._vectors3)t.vectors3[e]=this._vectors3[e].asArray();for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.matrices={},this._matrices)t.matrices[e]=this._matrices[e].asArray();for(e in t.matrixArray={},this._matrixArrays)t.matrixArray[e]=this._matrixArrays[e];for(e in t.matrices3x3={},this._matrices3x3)t.matrices3x3[e]=this._matrices3x3[e];for(e in t.matrices2x2={},this._matrices2x2)t.matrices2x2[e]=this._matrices2x2[e];for(e in t.vectors2Arrays={},this._vectors2Arrays)t.vectors2Arrays[e]=this._vectors2Arrays[e];for(e in t.vectors3Arrays={},this._vectors3Arrays)t.vectors3Arrays[e]=this._vectors3Arrays[e];for(e in t.vectors4Arrays={},this._vectors4Arrays)t.vectors4Arrays[e]=this._vectors4Arrays[e];return t},E.Parse=function(e,t,i){var r,n=g.a.Parse(function(){return new E(e.name,t,e.shaderPath,e.options)},e,t,i);for(r in e.textures)n.setTexture(r,b.a.Parse(e.textures[r],t,i));for(r in e.textureArrays){for(var o=e.textureArrays[r],s=new Array,a=0;a<o.length;a++)s.push(b.a.Parse(o[a],t,i));n.setTextureArray(r,s)}for(r in e.floats)n.setFloat(r,e.floats[r]);for(r in e.floatsArrays)n.setFloats(r,e.floatsArrays[r]);for(r in e.colors3)n.setColor3(r,l.a.FromArray(e.colors3[r]));for(r in e.colors3Arrays){var h=e.colors3Arrays[r].reduce(function(e,t,i){return i%3==0?e.push([t]):e[e.length-1].push(t),e},[]).map(function(e){return l.a.FromArray(e)});n.setColor3Array(r,h)}for(r in e.colors4)n.setColor4(r,l.b.FromArray(e.colors4[r]));for(r in e.colors4Arrays)h=e.colors4Arrays[r].reduce(function(e,t,i){return i%4==0?e.push([t]):e[e.length-1].push(t),e},[]).map(function(e){return l.b.FromArray(e)}),n.setColor4Array(r,h);for(r in e.vectors2)n.setVector2(r,m.d.FromArray(e.vectors2[r]));for(r in e.vectors3)n.setVector3(r,m.e.FromArray(e.vectors3[r]));for(r in e.vectors4)n.setVector4(r,m.f.FromArray(e.vectors4[r]));for(r in e.matrices)n.setMatrix(r,m.a.FromArray(e.matrices[r]));for(r in e.matrixArray)n._matrixArrays[r]=new Float32Array(e.matrixArray[r]);for(r in e.matrices3x3)n.setMatrix3x3(r,e.matrices3x3[r]);for(r in e.matrices2x2)n.setMatrix2x2(r,e.matrices2x2[r]);for(r in e.vectors2Arrays)n.setArray2(r,e.vectors2Arrays[r]);for(r in e.vectors3Arrays)n.setArray3(r,e.vectors3Arrays[r]);for(r in e.vectors4Arrays)n.setArray4(r,e.vectors4Arrays[r]);return n},E);function E(e,t,i,r){void 0===r&&(r={});var n=d.call(this,e,t)||this;return n._textures={},n._textureArrays={},n._floats={},n._ints={},n._floatsArrays={},n._colors3={},n._colors3Arrays={},n._colors4={},n._colors4Arrays={},n._vectors2={},n._vectors3={},n._vectors4={},n._matrices={},n._matrixArrays={},n._matrices3x3={},n._matrices2x2={},n._vectors2Arrays={},n._vectors3Arrays={},n._vectors4Arrays={},n._cachedWorldViewMatrix=new m.a,n._cachedWorldViewProjectionMatrix=new m.a,n._multiview=!1,n._shaderPath=i,n._options=Object(o.a)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},r),n}x.a.RegisteredTypes["BABYLON.ShaderMaterial"]=M;var A,O=i(6),P=(i(80),i(81),"colorPixelShader"),C="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}",S=(O.a.ShadersStore[P]=C,i(82),i(84),i(83),i(85),i(86),i(87),"colorVertexShader"),R="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}",I=(O.a.ShadersStore[S]=R,A=s.Mesh,Object(o.c)(w,A),w.prototype._addClipPlaneDefine=function(e){var t="#define "+e;-1===this._colorShader.options.defines.indexOf(t)&&this._colorShader.options.defines.push(t)},w.prototype._removeClipPlaneDefine=function(e){var t="#define "+e,i=this._colorShader.options.defines.indexOf(t);-1!==i&&this._colorShader.options.defines.splice(i,1)},w.prototype.isReady=function(){var e=this.getScene();return e.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),e.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),e.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),e.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),e.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),e.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady()&&A.prototype.isReady.call(this)},w.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(w.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),w.prototype._bind=function(e,t,i){if(!this._geometry)return this;var r=this._colorShader.getEffect(),n=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(r,n),!this.useVertexColor){var o=this.color,s=o.r,a=o.g,h=o.b;this.color4.set(s,a,h,this.alpha),this._colorShader.setColor4("color",this.color4)}return y.a.BindClipPlane(r,this.getScene()),this},w.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var r=this.getScene().getEngine();return this._unIndexed?r.drawArraysType(p.a.LineListDrawMode,e.verticesStart,e.verticesCount,i):r.drawElementsType(p.a.LineListDrawMode,e.indexStart,e.indexCount,i),this},w.prototype.dispose=function(e){this._colorShader.dispose(!1,!1,!0),A.prototype.dispose.call(this,e)},w.prototype.clone=function(e,t,i){return void 0===t&&(t=null),new w(e,this.getScene(),t,this,i)},w.prototype.createInstance=function(e){return new L(e,this)},w);function w(e,t,i,r,n,o,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null);var a=A.call(this,e,t,i,r,n)||this;a.useVertexColor=o,a.useVertexAlpha=s,a.color=new l.a(1,1,1),a.alpha=1,r&&(a.color=r.color.clone(),a.alpha=r.alpha,a.useVertexColor=r.useVertexColor,a.useVertexAlpha=r.useVertexAlpha),a.intersectionThreshold=.1;var h={attributes:[_.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===s&&(h.needAlphaBlending=!1),o?(h.defines.push("#define VERTEXCOLOR"),h.attributes.push(_.b.ColorKind)):(h.uniforms.push("color"),a.color4=new l.b),a._colorShader=new M("colorShader",a.getScene(),"color",h),a}var D,L=(D=u,Object(o.c)(F,D),F.prototype.getClassName=function(){return"InstancedLinesMesh"},F);function F(e,t){var i=D.call(this,e,t)||this;return i.intersectionThreshold=t.intersectionThreshold,i}v.VertexData.CreateLineSystem=function(e){for(var t=[],i=[],r=e.lines,n=e.colors,o=[],s=0,a=0;a<r.length;a++)for(var h=r[a],l=0;l<h.length;l++){if(i.push(h[l].x,h[l].y,h[l].z),n){var c=n[a];o.push(c[l].r,c[l].g,c[l].b,c[l].a)}0<l&&(t.push(s-1),t.push(s)),s++}var u=new v.VertexData;return u.indices=t,u.positions=i,n&&(u.colors=o),u},v.VertexData.CreateDashedLines=function(e){var t,i,r=e.dashSize||3,n=e.gapSize||1,o=e.dashNb||200,s=e.points,a=new Array,h=new Array,l=m.e.Zero(),c=0,u=0,f=0,d=0,p=0;for(p=0;p<s.length-1;p++)s[p+1].subtractToRef(s[p],l),c+=l.length();for(i=r*(t=c/o)/(r+n),p=0;p<s.length-1;p++){s[p+1].subtractToRef(s[p],l),u=Math.floor(l.length()/t),l.normalize();for(var _=0;_<u;_++)f=t*_,a.push(s[p].x+f*l.x,s[p].y+f*l.y,s[p].z+f*l.z),a.push(s[p].x+(f+i)*l.x,s[p].y+(f+i)*l.y,s[p].z+(f+i)*l.z),h.push(d,d+1),d+=2}var g=new v.VertexData;return g.positions=a,g.indices=h,g},s.Mesh.CreateLines=function(e,t,i,r,n){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=null);var o={points:t,updatable:r,instance:n};return N.CreateLines(e,o,i)},s.Mesh.CreateDashedLines=function(e,t,i,r,n,o,s,a){void 0===o&&(o=null);var h={points:t,dashSize:i,gapSize:r,dashNb:n,updatable:s,instance:a};return N.CreateDashedLines(e,h,o)};var N=(B.CreateLineSystem=function(e,t,i){var r=t.instance,n=t.lines,o=t.colors;if(r){var s,a,h=r.getVerticesData(_.b.PositionKind);o&&(s=r.getVerticesData(_.b.ColorKind));for(var l=0,c=0,u=0;u<n.length;u++)for(var f=n[u],d=0;d<f.length;d++)h[l]=f[d].x,h[l+1]=f[d].y,h[l+2]=f[d].z,o&&s&&(a=o[u],s[c]=a[d].r,s[c+1]=a[d].g,s[c+2]=a[d].b,s[c+3]=a[d].a,c+=4),l+=3;return r.updateVerticesData(_.b.PositionKind,h,!1,!1),o&&s&&r.updateVerticesData(_.b.ColorKind,s,!1,!1),r}var p=new I(e,i,null,void 0,void 0,!!o,t.useVertexAlpha);return v.VertexData.CreateLineSystem(t).applyToMesh(p,t.updatable),p},B.CreateLines=function(e,t,i){void 0===i&&(i=null);var r=t.colors?[t.colors]:null;return B.CreateLineSystem(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:r,useVertexAlpha:t.useVertexAlpha},i)},B.CreateDashedLines=function(e,t,i){void 0===i&&(i=null);var f=t.points,d=t.instance,r=t.gapSize||1,n=t.dashSize||3;if(d)return d.updateMeshPositions(function(e){var t,i,r=m.e.Zero(),n=e.length/6,o=0,s=0,a=0,h=0,l=0,c=0;for(l=0;l<f.length-1;l++)f[l+1].subtractToRef(f[l],r),o+=r.length();t=o/n;var u=d._creationDataStorage.dashSize;for(i=u*t/(u+d._creationDataStorage.gapSize),l=0;l<f.length-1;l++)for(f[l+1].subtractToRef(f[l],r),s=Math.floor(r.length()/t),r.normalize(),c=0;c<s&&h<e.length;)a=t*c,e[h]=f[l].x+a*r.x,e[h+1]=f[l].y+a*r.y,e[h+2]=f[l].z+a*r.z,e[h+3]=f[l].x+(a+i)*r.x,e[h+4]=f[l].y+(a+i)*r.y,e[h+5]=f[l].z+(a+i)*r.z,h+=6,c++;for(;h<e.length;)e[h]=f[l].x,e[h+1]=f[l].y,e[h+2]=f[l].z,h+=3},!1),d;var o=new I(e,i,null,void 0,void 0,void 0,t.useVertexAlpha);return v.VertexData.CreateDashedLines(t).applyToMesh(o,t.updatable),o._creationDataStorage=new s._CreationDataStorage,o._creationDataStorage.dashSize=n,o._creationDataStorage.gapSize=r,o},B);function B(){}},function(e,t,i){"use strict";i.r(t),i.d(t,"SolidParticleSystem",function(){return _});var Ue=i(0),c=i(7),Ve=i(2),ze=i(12),n=i(17);ze.VertexData.CreateDisc=function(e){var t=new Array,i=new Array,r=new Array,n=new Array,o=e.radius||.5,s=e.tessellation||64,a=(!e.arc||!(e.arc<=0||1<e.arc))&&e.arc||1,h=0===e.sideOrientation?0:e.sideOrientation||ze.VertexData.DEFAULTSIDE;t.push(0,0,0),n.push(.5,.5);for(var l=2*Math.PI*a,c=l/s,u=0;u<l;u+=c){var f=Math.cos(u),d=Math.sin(u),p=(f+1)/2,_=(1-d)/2;t.push(o*f,o*d,0),n.push(p,_)}1===a&&(t.push(t[3],t[4],t[5]),n.push(n[2],n[3]));for(var g=t.length/3,m=1;m<g-1;m++)i.push(m+1,0,m);ze.VertexData.ComputeNormals(t,i,r),ze.VertexData._ComputeSides(h,t,i,r,n,e.frontUVs,e.backUVs);var v=new ze.VertexData;return v.indices=i,v.positions=t,v.normals=r,v.uvs=n,v},n.Mesh.CreateDisc=function(e,t,i,r,n,o){void 0===r&&(r=null);var s={radius:t,tessellation:i,sideOrientation:o,updatable:n};return a.CreateDisc(e,s,r)};var a=(r.CreateDisc=function(e,t,i){void 0===i&&(i=null);var r=new n.Mesh(e,i);return t.sideOrientation=n.Mesh._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,ze.VertexData.CreateDisc(t).applyToMesh(r,t.updatable),r},r);function r(){}var o=i(23),je=i(32),s=i(65),u=i(42),f=(h.prototype.copyToRef=function(e){return e.position.copyFrom(this.position),e.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(e.rotationQuaternion?e.rotationQuaternion.copyFrom(this.rotationQuaternion):e.rotationQuaternion=this.rotationQuaternion.clone()),e.scaling.copyFrom(this.scaling),this.color&&(e.color?e.color.copyFrom(this.color):e.color=this.color.clone()),e.uvs.copyFrom(this.uvs),e.velocity.copyFrom(this.velocity),e.pivot.copyFrom(this.pivot),e.translateFromPivot=this.translateFromPivot,e.alive=this.alive,e.isVisible=this.isVisible,e.parentId=this.parentId,e.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(e.materialIndex=this.materialIndex),this},Object.defineProperty(h.prototype,"scale",{get:function(){return this.scaling},set:function(e){this.scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(e){this.rotationQuaternion=e},enumerable:!0,configurable:!0}),h.prototype.intersectsMesh=function(e){return!(!this._boundingInfo||!e._boundingInfo)&&(this._sps._bSphereOnly?s.a.Intersects(this._boundingInfo.boundingSphere,e._boundingInfo.boundingSphere):this._boundingInfo.intersects(e._boundingInfo,!1))},h.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},h.prototype.getRotationMatrix=function(e){var t;if(this.rotationQuaternion)t=this.rotationQuaternion;else{t=Ue.c.Quaternion[0];var i=this.rotation;Ue.b.RotationYawPitchRollToRef(i.y,i.x,i.z,t)}t.toRotationMatrix(e)},h);function h(e,t,i,r,n,o,s,a,h,l){void 0===h&&(h=null),void 0===l&&(l=null),this.idx=0,this.id=0,this.color=new c.b(1,1,1,1),this.position=Ue.e.Zero(),this.rotation=Ue.e.Zero(),this.scaling=Ue.e.One(),this.uvs=new Ue.f(0,0,1,1),this.velocity=Ue.e.Zero(),this.pivot=Ue.e.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.cullingStrategy=u.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=Ue.e.Zero(),this.idx=e,this.id=t,this._pos=i,this._ind=r,this._model=n,this.shapeId=o,this.idxInShape=s,this._sps=a,h&&(this._modelBoundingInfo=h,this._boundingInfo=new je.a(h.minimum,h.maximum)),null!==l&&(this.materialIndex=l)}var V=function(e,t,i,r,n,o,s,a,h){this._indicesLength=0,this.shapeID=e,this._shape=t,this._indices=i,this._indicesLength=i.length,this._shapeUV=o,this._shapeColors=n,this._normals=r,this._positionFunction=s,this._vertexFunction=a,this._material=h},N=function(e,t,i){this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.ind=e,this.indicesLength=t,this.materialIndex=i},We=i(35),d=i(41),l=i(48),p=i(62),_=(g.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){var e=a.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(e,1),e.dispose()}if(this._indices32=new(this._needs32Bits?Uint32Array:Uint16Array)(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var t=new n.Mesh(this.name,this._scene);this.mesh=t}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&ze.VertexData.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var i=new ze.VertexData;return i.indices=this._depthSort?this._indices:this._indices32,i.set(this._positions32,Ve.b.PositionKind),i.set(this._normals32,Ve.b.NormalKind),0<this._uvs32.length&&i.set(this._uvs32,Ve.b.UVKind),0<this._colors32.length&&i.set(this._colors32,Ve.b.ColorKind),i.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},g.prototype.digest=function(e,t){var i=t&&t.facetNb||1,r=t&&t.number||0,n=t&&t.delta||0,o=e.getVerticesData(Ve.b.PositionKind),s=e.getIndices(),a=e.getVerticesData(Ve.b.UVKind),h=e.getVerticesData(Ve.b.ColorKind),l=e.getVerticesData(Ve.b.NormalKind),c=t&&t.storage?t.storage:null,u=0,f=s.length/3;r?(r=f<r?f:r,i=Math.round(f/r),n=0):i=f<i?f:i;for(var d=[],p=[],_=[],g=[],m=[],v=Ue.e.Zero(),b=i;u<f;){f-(i=b+Math.floor((1+n)*Math.random()))<u&&(i=f-u),d.length=0,p.length=0,_.length=0,g.length=0;for(var y=m.length=0,x=3*u;x<3*(u+i);x++){_.push(y);var T=s[x],M=3*T;if(d.push(o[M],o[1+M],o[2+M]),p.push(l[M],l[1+M],l[2+M]),a){var E=2*T;g.push(a[E],a[1+E])}if(h){var A=4*T;m.push(h[A],h[1+A],h[2+A],h[3+A])}y++}var O,P=this.nbParticles,C=this._posToShape(d),S=this._uvsToShapeUV(g),R=Array.from(_),I=Array.from(m),w=Array.from(p);for(v.copyFromFloats(0,0,0),O=0;O<C.length;O++)v.addInPlace(C[O]);v.scaleInPlace(1/C.length);var D,L=new Ue.e(1/0,1/0,1/0),F=new Ue.e(-1/0,-1/0,-1/0);for(O=0;O<C.length;O++)C[O].subtractInPlace(v),L.minimizeInPlaceFromFloats(C[O].x,C[O].y,C[O].z),F.maximizeInPlaceFromFloats(C[O].x,C[O].y,C[O].z);this._particlesIntersect&&(D=new je.a(L,F));var N=null;this._useModelMaterial&&(N=e.material?e.material:this._setDefaultMaterial());var B=new V(this._shapeCounter,C,R,w,I,S,null,null,N),k=this._positions.length,U=this._indices.length;this._meshBuilder(this._index,U,C,this._positions,R,this._indices,g,this._uvs,I,this._colors,w,this._normals,P,0,null,B),this._addParticle(P,this._lastParticleId,k,U,B,this._shapeCounter,0,D,c),this.particles[this.nbParticles].position.addInPlace(v),c||(this._index+=C.length,P++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,u+=i}return this._isNotBuilt=!0,this},g.prototype._unrotateFixedNormals=function(){for(var e=0,t=0,i=Ue.c.Vector3[0],r=Ue.c.Quaternion[0],n=Ue.c.Matrix[0],o=0;o<this.particles.length;o++){var s=this.particles[o],a=s._model._shape;if(s.rotationQuaternion)s.rotationQuaternion.conjugateToRef(r);else{var h=s.rotation;Ue.b.RotationYawPitchRollToRef(h.y,h.x,h.z,r),r.conjugateInPlace()}r.toRotationMatrix(n);for(var l=0;l<a.length;l++)t=e+3*l,Ue.e.TransformNormalFromFloatsToRef(this._normals32[t],this._normals32[t+1],this._normals32[t+2],n,i),i.toArray(this._fixedNormal32,t);e=t+3}},g.prototype._resetCopy=function(){var e=this._copy;e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.copyFromFloats(0,0,1,1),e.color=null,e.translateFromPivot=!1,e.materialIndex=null},g.prototype._meshBuilder=function(e,t,i,r,n,o,s,a,h,l,c,u,f,d,p,_){var g,m=0,v=0,b=0;this._resetCopy();var y=this._copy,x=!(!p||!p.storage);if(y.idx=f,y.idxInShape=d,this._useModelMaterial){var T=_._material.uniqueId,M=this._materialIndexesById;M.hasOwnProperty(T)||(M[T]=this._materials.length,this._materials.push(_._material));var E=M[T];y.materialIndex=E}if(p&&p.positionFunction&&(p.positionFunction(y,f,d),this._mustUnrotateFixedNormals=!0),x)return y;var A=Ue.c.Matrix[0],O=Ue.c.Vector3[0],P=Ue.c.Vector3[1],C=Ue.c.Vector3[2],S=Ue.c.Vector3[3];Ue.a.IdentityToRef(A),y.getRotationMatrix(A),y.pivot.multiplyToRef(y.scaling,S),y.translateFromPivot?C.setAll(0):C.copyFrom(S);var R=p&&p.vertexFunction;for(g=0;g<i.length;g++){if(O.copyFrom(i[g]),R&&p.vertexFunction(y,O,g),O.multiplyInPlace(y.scaling).subtractInPlace(S),Ue.e.TransformCoordinatesToRef(O,A,P),P.addInPlace(C).addInPlace(y.position),r.push(P.x,P.y,P.z),s){var I=y.uvs;a.push((I.z-I.x)*s[m]+I.x,(I.w-I.y)*s[m+1]+I.y),m+=2}if(y.color)this._color=y.color;else{var w=this._color;h&&void 0!==h[v]?(w.r=h[v],w.g=h[v+1],w.b=h[v+2],w.a=h[v+3]):(w.r=1,w.g=1,w.b=1,w.a=1)}l.push(this._color.r,this._color.g,this._color.b,this._color.a),v+=4,!this.recomputeNormals&&c&&(Ue.e.TransformNormalFromFloatsToRef(c[b],c[b+1],c[b+2],A,O),u.push(O.x,O.y,O.z),b+=3)}for(g=0;g<n.length;g++){var D=e+n[g];o.push(D),65535<D&&(this._needs32Bits=!0)}if(this._pickable){var L=n.length/3;for(g=0;g<L;g++)this.pickedParticles.push({idx:f,faceId:g})}if(this._depthSort||this._multimaterialEnabled){var F=null!==y.materialIndex?y.materialIndex:0;this.depthSortedParticles.push(new N(t,n.length,F))}return y},g.prototype._posToShape=function(e){for(var t=[],i=0;i<e.length;i+=3)t.push(Ue.e.FromArray(e,i));return t},g.prototype._uvsToShapeUV=function(e){var t=[];if(e)for(var i=0;i<e.length;i++)t.push(e[i]);return t},g.prototype._addParticle=function(e,t,i,r,n,o,s,a,h){void 0===a&&(a=null),void 0===h&&(h=null);var l=new f(e,t,i,r,n,o,s,this,a);return(h||this.particles).push(l),l},g.prototype.addShape=function(e,t,i){var r=e.getVerticesData(Ve.b.PositionKind),n=e.getIndices(),o=e.getVerticesData(Ve.b.UVKind),s=e.getVerticesData(Ve.b.ColorKind),a=e.getVerticesData(Ve.b.NormalKind);this.recomputeNormals=!a;var h=Array.from(n),l=Array.from(a),c=s?Array.from(s):[],u=i&&i.storage?i.storage:null,f=null;this._particlesIntersect&&(f=e.getBoundingInfo());var d=this._posToShape(r),p=this._uvsToShapeUV(o),_=i?i.positionFunction:null,g=i?i.vertexFunction:null,m=null;this._useModelMaterial&&(m=e.material?e.material:this._setDefaultMaterial());for(var v=new V(this._shapeCounter,d,h,l,c,p,_,g,m),b=0;b<t;b++)this._insertNewParticle(this.nbParticles,b,v,d,n,o,s,a,f,u,i);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},g.prototype._rebuildParticle=function(e,t){void 0===t&&(t=!1),this._resetCopy();var i=this._copy;e._model._positionFunction&&e._model._positionFunction(i,e.idx,e.idxInShape);var r=Ue.c.Matrix[0],n=Ue.c.Vector3[0],o=Ue.c.Vector3[1],s=Ue.c.Vector3[2],a=Ue.c.Vector3[3];i.getRotationMatrix(r),e.pivot.multiplyToRef(e.scaling,a),i.translateFromPivot?s.copyFromFloats(0,0,0):s.copyFrom(a);for(var h=e._model._shape,l=0;l<h.length;l++)n.copyFrom(h[l]),e._model._vertexFunction&&e._model._vertexFunction(i,n,l),n.multiplyInPlace(i.scaling).subtractInPlace(a),Ue.e.TransformCoordinatesToRef(n,r,o),o.addInPlace(s).addInPlace(i.position).toArray(this._positions32,e._pos+3*l);t&&(e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.setAll(0),e.pivot.setAll(0),e.translateFromPivot=!1,e.parentId=null)},g.prototype.rebuildMesh=function(e){void 0===e&&(e=!1);for(var t=0;t<this.particles.length;t++)this._rebuildParticle(this.particles[t],e);return this.mesh.updateVerticesData(Ve.b.PositionKind,this._positions32,!1,!1),this},g.prototype.removeParticles=function(e,t){var i=t-e+1;if(!this._expandable||i<=0||i>=this.nbParticles||!this._updatable)return[];var r=this.particles,n=this.nbParticles;if(t<n-1)for(var o=t+1,s=r[o]._pos-r[e]._pos,a=r[o]._ind-r[e]._ind,h=o;h<n;h++){var l=r[h];l._pos-=s,l._ind-=a}var c=r.splice(e,i);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var u=0,f=r.length,d=0;d<f;d++){var p=r[d],_=p._model,g=_._shape,m=_._indices,v=_._normals,b=_._shapeColors,y=_._shapeUV;p.idx=d,this._idxOfId[p.id]=d,this._meshBuilder(this._index,u,g,this._positions,m,this._indices,y,this._uvs,b,this._colors,v,this._normals,p.idx,p.idxInShape,null,_),this._index+=g.length,u+=m.length}return this.nbParticles-=i,this._isNotBuilt=!0,c},g.prototype.insertParticlesFromArray=function(e){if(!this._expandable)return this;for(var t=0,i=e[0].shapeId,r=e.length,n=0;n<r;n++){var o=e[n],s=o._model,a=s._shape,h=s._indices,l=s._shapeUV,c=s._shapeColors,u=s._normals,f=!u;this.recomputeNormals=f||this.recomputeNormals;var d=o._boundingInfo,p=this._insertNewParticle(this.nbParticles,t,s,a,h,l,c,u,d,null,null);o.copyToRef(p),t++,i!=o.shapeId&&(i=o.shapeId,t=0)}return this._isNotBuilt=!0,this},g.prototype._insertNewParticle=function(e,t,i,r,n,o,s,a,h,l,c){var u=this._positions.length,f=this._indices.length,d=this._meshBuilder(this._index,f,r,this._positions,n,this._indices,o,this._uvs,s,this._colors,a,this._normals,e,t,c,i),p=null;return this._updatable&&((p=this._addParticle(this.nbParticles,this._lastParticleId,u,f,i,this._shapeCounter,t,h,l)).position.copyFrom(d.position),p.rotation.copyFrom(d.rotation),d.rotationQuaternion&&(p.rotationQuaternion?p.rotationQuaternion.copyFrom(d.rotationQuaternion):p.rotationQuaternion=d.rotationQuaternion.clone()),d.color&&(p.color?p.color.copyFrom(d.color):p.color=d.color.clone()),p.scaling.copyFrom(d.scaling),p.uvs.copyFrom(d.uvs),null!==d.materialIndex&&(p.materialIndex=d.materialIndex),this.expandable&&(this._idxOfId[p.id]=p.idx)),l||(this._index+=r.length,this.nbParticles++,this._lastParticleId++),p},g.prototype.setParticles=function(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=this.nbParticles-1),void 0===i&&(i=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(e,t,i);var r=Ue.c.Matrix[0],n=Ue.c.Matrix[1],o=this.mesh,s=this._colors32,a=this._positions32,h=this._normals32,l=this._uvs32,c=this._indices32,u=this._indices,f=this._fixedNormal32,d=Ue.c.Vector3,p=d[5].copyFromFloats(1,0,0),_=d[6].copyFromFloats(0,1,0),g=d[7].copyFromFloats(0,0,1),m=d[8].setAll(Number.MAX_VALUE),v=d[9].setAll(-Number.MAX_VALUE),b=d[10].setAll(0);if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(n)),this.billboard){var y=d[0];this._camera.getDirectionToRef(We.a.Z,y),Ue.e.TransformNormalToRef(y,n,g),g.normalize();var x=this._camera.getViewMatrix(!0);Ue.e.TransformNormalFromFloatsToRef(x.m[1],x.m[5],x.m[9],n,_),Ue.e.CrossToRef(_,g,p),_.normalize(),p.normalize()}this._depthSort&&Ue.e.TransformCoordinatesToRef(this._camera.globalPosition,n,b),Ue.a.IdentityToRef(r);var T=0,M=0,E=0,A=0,O=0,P=0,C=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),t=t>=this.nbParticles?this.nbParticles-1:t,this._computeBoundingBox&&(0!=e||t!=this.nbParticles-1)){var S=this.mesh._boundingInfo;S&&(m.copyFrom(S.minimum),v.copyFrom(S.maximum))}var R=(M=this.particles[e]._pos)/3|0;A=4*R,P=2*R;for(var I=e;I<=t;I++){var w=this.particles[I];this.updateParticle(w);var D=w._model._shape,L=w._model._shapeUV,F=w._rotationMatrix,N=w.position,B=w.rotation,k=w.scaling,U=w._globalPosition;if(this._depthSort&&this._depthSortParticles){var V=this.depthSortedParticles[I];V.ind=w._ind,V.indicesLength=w._model._indicesLength,V.sqDistance=Ue.e.DistanceSquared(w.position,b)}if(!w.alive||w._stillInvisible&&!w.isVisible)M+=3*(C=D.length),A+=4*C,P+=2*C;else{if(w.isVisible){w._stillInvisible=!1;var z=d[12];if(w.pivot.multiplyToRef(k,z),this.billboard&&(B.x=0,B.y=0),(this._computeParticleRotation||this.billboard)&&w.getRotationMatrix(r),null!==w.parentId){var j=this.getParticleById(w.parentId);if(j){var W=j._rotationMatrix,G=j._globalPosition,H=N.x*W[1]+N.y*W[4]+N.z*W[7],X=N.x*W[0]+N.y*W[3]+N.z*W[6],K=N.x*W[2]+N.y*W[5]+N.z*W[8];if(U.x=G.x+X,U.y=G.y+H,U.z=G.z+K,this._computeParticleRotation||this.billboard){var Y=r.m;F[0]=Y[0]*W[0]+Y[1]*W[3]+Y[2]*W[6],F[1]=Y[0]*W[1]+Y[1]*W[4]+Y[2]*W[7],F[2]=Y[0]*W[2]+Y[1]*W[5]+Y[2]*W[8],F[3]=Y[4]*W[0]+Y[5]*W[3]+Y[6]*W[6],F[4]=Y[4]*W[1]+Y[5]*W[4]+Y[6]*W[7],F[5]=Y[4]*W[2]+Y[5]*W[5]+Y[6]*W[8],F[6]=Y[8]*W[0]+Y[9]*W[3]+Y[10]*W[6],F[7]=Y[8]*W[1]+Y[9]*W[4]+Y[10]*W[7],F[8]=Y[8]*W[2]+Y[9]*W[5]+Y[10]*W[8]}}else w.parentId=null}else U.x=N.x,U.y=N.y,U.z=N.z,(this._computeParticleRotation||this.billboard)&&(Y=r.m,F[0]=Y[0],F[1]=Y[1],F[2]=Y[2],F[3]=Y[4],F[4]=Y[5],F[5]=Y[6],F[6]=Y[8],F[7]=Y[9],F[8]=Y[10]);var q=d[11];for(w.translateFromPivot?q.setAll(0):q.copyFrom(z),C=0;C<D.length;C++){T=M+3*C,E=A+4*C,O=P+2*C,(y=d[0]).copyFrom(D[C]),this._computeParticleVertex&&this.updateParticleVertex(w,y,C);var Z=y.x*k.x-z.x,Q=y.y*k.y-z.y,J=y.z*k.z-z.z;X=Z*F[0]+Q*F[3]+J*F[6],H=Z*F[1]+Q*F[4]+J*F[7],K=Z*F[2]+Q*F[5]+J*F[8],X+=q.x,H+=q.y,K+=q.z;var $=a[T]=U.x+p.x*X+_.x*H+g.x*K,ee=a[T+1]=U.y+p.y*X+_.y*H+g.y*K,te=a[T+2]=U.z+p.z*X+_.z*H+g.z*K;if(this._computeBoundingBox&&(m.minimizeInPlaceFromFloats($,ee,te),v.maximizeInPlaceFromFloats($,ee,te)),!this._computeParticleVertex){var ie=f[T],re=f[T+1],ne=f[T+2],oe=ie*F[0]+re*F[3]+ne*F[6],se=ie*F[1]+re*F[4]+ne*F[7],ae=ie*F[2]+re*F[5]+ne*F[8];h[T]=p.x*oe+_.x*se+g.x*ae,h[T+1]=p.y*oe+_.y*se+g.y*ae,h[T+2]=p.z*oe+_.z*se+g.z*ae}if(this._computeParticleColor&&w.color){var he=w.color,le=this._colors32;le[E]=he.r,le[E+1]=he.g,le[E+2]=he.b,le[E+3]=he.a}if(this._computeParticleTexture){var ce=w.uvs;l[O]=L[2*C]*(ce.z-ce.x)+ce.x,l[O+1]=L[2*C+1]*(ce.w-ce.y)+ce.y}}}else for(w._stillInvisible=!0,C=0;C<D.length;C++)E=A+4*C,O=P+2*C,a[T=M+3*C]=a[T+1]=a[T+2]=0,h[T]=h[T+1]=h[T+2]=0,this._computeParticleColor&&w.color&&(he=w.color,s[E]=he.r,s[E+1]=he.g,s[E+2]=he.b,s[E+3]=he.a),this._computeParticleTexture&&(ce=w.uvs,l[O]=L[2*C]*(ce.z-ce.x)+ce.x,l[O+1]=L[2*C+1]*(ce.w-ce.y)+ce.y);if(this._particlesIntersect){var ue=w._boundingInfo,fe=ue.boundingBox,de=ue.boundingSphere,pe=w._modelBoundingInfo;if(!this._bSphereOnly){var _e=pe.boundingBox.vectors,ge=d[1],me=d[2];ge.setAll(Number.MAX_VALUE),me.setAll(-Number.MAX_VALUE);for(var ve=0;ve<8;ve++){var be=_e[ve].x*k.x,ye=_e[ve].y*k.y,xe=_e[ve].z*k.z,Te=(X=be*F[0]+ye*F[3]+xe*F[6],H=be*F[1]+ye*F[4]+xe*F[7],K=be*F[2]+ye*F[5]+xe*F[8],N.x+p.x*X+_.x*H+g.x*K),Me=N.y+p.y*X+_.y*H+g.y*K,Ee=N.z+p.z*X+_.z*H+g.z*K;ge.minimizeInPlaceFromFloats(Te,Me,Ee),me.maximizeInPlaceFromFloats(Te,Me,Ee)}fe.reConstruct(ge,me,o._worldMatrix)}var Ae=pe.minimum.multiplyToRef(k,d[1]),Oe=pe.maximum.multiplyToRef(k,d[2]),Pe=Oe.addToRef(Ae,d[3]).scaleInPlace(.5).addInPlace(U),Ce=Oe.subtractToRef(Ae,d[4]).scaleInPlace(.5*this._bSphereRadiusFactor),Se=Pe.subtractToRef(Ce,d[1]),Re=Pe.addToRef(Ce,d[2]);de.reConstruct(Se,Re,o._worldMatrix)}M=T+3,A=E+4,P=O+2}}if(i){if(this._computeParticleColor&&o.updateVerticesData(Ve.b.ColorKind,s,!1,!1),this._computeParticleTexture&&o.updateVerticesData(Ve.b.UVKind,l,!1,!1),o.updateVerticesData(Ve.b.PositionKind,a,!1,!1),!o.areNormalsFrozen||o.isFacetDataEnabled){if(this._computeParticleVertex||o.isFacetDataEnabled){var Ie=o.isFacetDataEnabled?o.getFacetDataParameters():null;ze.VertexData.ComputeNormals(a,c,h,Ie);for(var we=0;we<h.length;we++)f[we]=h[we]}o.areNormalsFrozen||o.updateVerticesData(Ve.b.NormalKind,h,!1,!1)}if(this._depthSort&&this._depthSortParticles){var De=this.depthSortedParticles;De.sort(this._depthSortFunction);for(var Le=De.length,Fe=0,Ne=0;Ne<Le;Ne++){var Be=De[Ne].indicesLength,ke=De[Ne].ind;for(we=0;we<Be;we++)c[Fe]=u[ke+we],Fe++}o.updateIndices(c)}}return this._computeBoundingBox&&(o._boundingInfo?o._boundingInfo.reConstruct(m,v,o._worldMatrix):o._boundingInfo=new je.a(m,v,o._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(e,t,i),this},g.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},g.prototype.getParticleById=function(e){var t=this.particles[e];if(t&&t.id==e)return t;var i=this.particles,r=this._idxOfId[e];if(void 0!==r)return i[r];for(var n=0,o=this.nbParticles;n<o;){var s=i[n];if(s.id==e)return s;n++}return null},g.prototype.getParticlesByShapeId=function(e){var t=[];return this.getParticlesByShapeIdToRef(e,t),t},g.prototype.getParticlesByShapeIdToRef=function(e,t){for(var i=t.length=0;i<this.nbParticles;i++){var r=this.particles[i];r.shapeId==e&&t.push(r)}return this},g.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var e=this.depthSortedParticles;if(0<this.particles.length)for(var t=0;t<this.particles.length;t++){var i=this.particles[t];i.materialIndex||(i.materialIndex=0);var r=e[t];r.materialIndex=i.materialIndex,r.ind=i._ind,r.indicesLength=i._model._indicesLength}this._sortParticlesByMaterial();var n=this._indicesByMaterial,o=this._materialIndexes,s=this.mesh;s.subMeshes=[];for(var a=s.getTotalVertices(),h=0;h<o.length;h++){var l=n[h],c=n[h+1]-l,u=o[h];new d.b(u,0,a,l,c,s)}return this},g.prototype._sortParticlesByMaterial=function(){var e=[0];this._indicesByMaterial=e;var t=[];this._materialIndexes=t;var i=this.depthSortedParticles;i.sort(this._materialSortFunction);var r=i.length,n=this._indices32,o=this._indices,s=0,a=i[0].materialIndex;t.push(a);for(var h=0;h<r;h++){var l=i[h],c=l.indicesLength,u=l.ind;l.materialIndex!==a&&(a=l.materialIndex,e.push(s),t.push(a));for(var f=0;f<c;f++)n[s]=o[u+f],s++}return e.push(n.length),this._updatable&&this.mesh.updateIndices(n),this},g.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var e=0;e<this._materials.length;e++){var t=this._materials[e].uniqueId;this._materialIndexesById[t]=e}},g.prototype._filterUniqueMaterialId=function(e){return e.filter(function(e,t,i){return i.indexOf(e)===t})},g.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new l.StandardMaterial(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},g.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},g.prototype.setVisibilityBox=function(e){var t=e/2;this.mesh._boundingInfo=new je.a(new Ue.e(-t,-t,-t),new Ue.e(t,t,t))},Object.defineProperty(g.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(e){this._isVisibilityBoxLocked=e,this.mesh.getBoundingInfo().isLocked=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(e){this._computeParticleRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(e){this._computeParticleColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(e){this._computeParticleTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(e){this._computeParticleVertex=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(e){this._computeBoundingBox=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(e){this._depthSortParticles=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"expandable",{get:function(){return this._expandable},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"materials",{get:function(){return this._materials},enumerable:!0,configurable:!0}),g.prototype.setMultiMaterial=function(e){this._materials=this._filterUniqueMaterialId(e),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new p.a(this.name+"MultiMaterial",this._scene);for(var t=0;t<this._materials.length;t++)this._multimaterial.subMaterials.push(this._materials[t]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(g.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(e){this._multimaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(e){this._autoUpdateSubMeshes=e},enumerable:!0,configurable:!0}),g.prototype.initParticles=function(){},g.prototype.recycleParticle=function(e){return e},g.prototype.updateParticle=function(e){return e},g.prototype.updateParticleVertex=function(e,t,i){return t},g.prototype.beforeUpdateParticles=function(e,t,i){},g.prototype.afterUpdateParticles=function(e,t,i){},g);function g(e,t,i){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new f(0,0,0,0,null,0,0,this),this._color=new c.b(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},this._materialSortFunction=function(e,t){return e.materialIndex-t.materialIndex},this._autoUpdateSubMeshes=!1,this.name=e,this._scene=t||o.a.LastCreatedScene,this._camera=t.activeCamera,this._pickable=!!i&&i.isPickable,this._depthSort=!!i&&i.enableDepthSort,this._multimaterialEnabled=!!i&&i.enableMultiMaterial,this._useModelMaterial=!!i&&i.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!i&&i.expandable,this._particlesIntersect=!!i&&i.particleIntersection,this._bSphereOnly=!!i&&i.boundingSphereOnly,this._bSphereRadiusFactor=i&&i.bSphereRadiusFactor?i.bSphereRadiusFactor:1,i&&void 0!==i.updatable?this._updatable=i.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new p.a(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={})}},function(e,t,i){"use strict";i.r(t),i.d(t,"PointerDragBehavior",function(){return p});var o=i(17),s=i(33),r=i(4),M=i(0),a=i(9),n=i(30),l=i(47),d=i(67),h=i(20),c=(E.prototype.intersectsBoxMinMax=function(e,t,i){void 0===i&&(i=0);var r,n,o,s,a=E.TmpVector3[0].copyFromFloats(e.x-i,e.y-i,e.z-i),h=E.TmpVector3[1].copyFromFloats(t.x+i,t.y+i,t.z+i),l=0,c=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<a.x||this.origin.x>h.x)return!1}else if(r=1/this.direction.x,n=(a.x-this.origin.x)*r,(o=(h.x-this.origin.x)*r)==-1/0&&(o=1/0),o<n&&(s=n,n=o,o=s),l=Math.max(n,l),(c=Math.min(o,c))<l)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<a.y||this.origin.y>h.y)return!1}else if(r=1/this.direction.y,n=(a.y-this.origin.y)*r,(o=(h.y-this.origin.y)*r)==-1/0&&(o=1/0),o<n&&(s=n,n=o,o=s),l=Math.max(n,l),(c=Math.min(o,c))<l)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<a.z||this.origin.z>h.z)return!1}else if(r=1/this.direction.z,n=(a.z-this.origin.z)*r,(o=(h.z-this.origin.z)*r)==-1/0&&(o=1/0),o<n&&(s=n,n=o,o=s),l=Math.max(n,l),(c=Math.min(o,c))<l)return!1;return!0},E.prototype.intersectsBox=function(e,t){return void 0===t&&(t=0),this.intersectsBoxMinMax(e.minimum,e.maximum,t)},E.prototype.intersectsSphere=function(e,t){void 0===t&&(t=0);var i=e.center.x-this.origin.x,r=e.center.y-this.origin.y,n=e.center.z-this.origin.z,o=i*i+r*r+n*n,s=e.radius+t,a=s*s;if(o<=a)return!0;var h=i*this.direction.x+r*this.direction.y+n*this.direction.z;return!(h<0)&&o-h*h<=a},E.prototype.intersectsTriangle=function(e,t,i){var r=E.TmpVector3[0],n=E.TmpVector3[1],o=E.TmpVector3[2],s=E.TmpVector3[3],a=E.TmpVector3[4];t.subtractToRef(e,r),i.subtractToRef(e,n),M.e.CrossToRef(this.direction,n,o);var h=M.e.Dot(r,o);if(0===h)return null;var l=1/h;this.origin.subtractToRef(e,s);var c=M.e.Dot(s,o)*l;if(c<0||1<c)return null;M.e.CrossToRef(s,r,a);var u=M.e.Dot(this.direction,a)*l;if(u<0||1<c+u)return null;var f=M.e.Dot(n,a)*l;return f>this.length?null:new d.a(1-c-u,c,f)},E.prototype.intersectsPlane=function(e){var t,i=M.e.Dot(e.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;var r=M.e.Dot(e.normal,this.origin);return(t=(-e.d-r)/i)<0?t<-9.99999997475243e-7?null:0:t},E.prototype.intersectsAxis=function(e,t){switch(void 0===t&&(t=0),e){case"y":return 0<(i=(this.origin.y-t)/this.direction.y)?null:new M.e(this.origin.x+this.direction.x*-i,t,this.origin.z+this.direction.z*-i);case"x":return 0<(i=(this.origin.x-t)/this.direction.x)?null:new M.e(t,this.origin.y+this.direction.y*-i,this.origin.z+this.direction.z*-i);case"z":var i;return 0<(i=(this.origin.z-t)/this.direction.z)?null:new M.e(this.origin.x+this.direction.x*-i,this.origin.y+this.direction.y*-i,t);default:return null}},E.prototype.intersectsMesh=function(e,t){var i=M.c.Matrix[0];return e.getWorldMatrix().invertToRef(i),this._tmpRay?E.TransformToRef(this,i,this._tmpRay):this._tmpRay=E.Transform(this,i),e.intersects(this._tmpRay,t)},E.prototype.intersectsMeshes=function(e,t,i){i?i.length=0:i=[];for(var r=0;r<e.length;r++){var n=this.intersectsMesh(e[r],t);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i},E.prototype._comparePickingInfo=function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0},E.prototype.intersectionSegment=function(e,t,i){var r=this.origin,n=M.c.Vector3[0],o=M.c.Vector3[1],s=M.c.Vector3[2],a=M.c.Vector3[3];t.subtractToRef(e,n),this.direction.scaleToRef(E.rayl,s),r.addToRef(s,o),e.subtractToRef(r,a);var h,l,c,u,f=M.e.Dot(n,n),d=M.e.Dot(n,s),p=M.e.Dot(s,s),_=M.e.Dot(n,a),g=M.e.Dot(s,a),m=f*p-d*d,v=m,b=m;m<E.smallnum?(l=0,v=1,u=g,b=p):(u=f*g-d*_,(l=d*g-p*_)<0?(l=0,u=g,b=p):v<l&&(l=v,u=g+d,b=p)),u<0?-_<(u=0)?l=0:f<-_?l=v:(l=-_,v=f):b<u&&(u=b,-_+d<0?l=0:f<-_+d?l=v:(l=-_+d,v=f)),h=Math.abs(l)<E.smallnum?0:l/v,c=Math.abs(u)<E.smallnum?0:u/b;var y=M.c.Vector3[4];s.scaleToRef(c,y);var x=M.c.Vector3[5];n.scaleToRef(h,x),x.addInPlace(a);var T=M.c.Vector3[6];return x.subtractToRef(y,T),0<c&&c<=this.length&&T.lengthSquared()<i*i?x.length():-1},E.prototype.update=function(e,t,i,r,n,o,s){return this.unprojectRayToRef(e,t,i,r,n,o,s),this},E.Zero=function(){return new E(M.e.Zero(),M.e.Zero())},E.CreateNew=function(e,t,i,r,n,o,s){return E.Zero().update(e,t,i,r,n,o,s)},E.CreateNewFromTo=function(e,t,i){void 0===i&&(i=M.a.IdentityReadOnly);var r=t.subtract(e),n=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),E.Transform(new E(e,r,n),i)},E.Transform=function(e,t){var i=new E(new M.e(0,0,0),new M.e(0,0,0));return E.TransformToRef(e,t,i),i},E.TransformToRef=function(e,t,i){M.e.TransformCoordinatesToRef(e.origin,t,i.origin),M.e.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length;var r=i.direction,n=r.length();if(0!==n&&1!==n){var o=1/n;r.x*=o,r.y*=o,r.z*=o,i.length*=n}},E.prototype.unprojectRayToRef=function(e,t,i,r,n,o,s){var a=M.c.Matrix[0];n.multiplyToRef(o,a),a.multiplyToRef(s,a),a.invert();var h=M.c.Vector3[0];h.x=e/i*2-1,h.y=-(t/r*2-1),h.z=-1;var l=M.c.Vector3[1].copyFromFloats(h.x,h.y,1),c=M.c.Vector3[2],u=M.c.Vector3[3];M.e._UnprojectFromInvertedMatrixToRef(h,a,c),M.e._UnprojectFromInvertedMatrixToRef(l,a,u),this.origin.copyFrom(c),u.subtractToRef(c,this.direction),this.direction.normalize()},E.TmpVector3=n.a.BuildArray(6,M.e.Zero),E.smallnum=1e-8,E.rayl=1e9,E);function E(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}s.Scene.prototype.createPickingRay=function(e,t,i,r,n){void 0===n&&(n=!1);var o=c.Zero();return this.createPickingRayToRef(e,t,i,o,r,n),o},s.Scene.prototype.createPickingRayToRef=function(e,t,i,r,n,o){void 0===o&&(o=!1);var s=this.getEngine();if(!n){if(!this.activeCamera)return this;n=this.activeCamera}var a=n.viewport.toGlobal(s.getRenderWidth(),s.getRenderHeight());return e=e/s.getHardwareScalingLevel()-a.x,t=t/s.getHardwareScalingLevel()-(s.getRenderHeight()-a.y-a.height),r.update(e,t,a.width,a.height,i||M.a.IdentityReadOnly,o?M.a.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix()),this},s.Scene.prototype.createPickingRayInCameraSpace=function(e,t,i){var r=c.Zero();return this.createPickingRayInCameraSpaceToRef(e,t,r,i),r},s.Scene.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,r){if(!l.a)return this;var n=this.getEngine();if(!r){if(!this.activeCamera)throw new Error("Active camera not set");r=this.activeCamera}var o=r.viewport.toGlobal(n.getRenderWidth(),n.getRenderHeight()),s=M.a.Identity();return e=e/n.getHardwareScalingLevel()-o.x,t=t/n.getHardwareScalingLevel()-(n.getRenderHeight()-o.y-o.height),i.update(e,t,o.width,o.height,s,s,r.getProjectionMatrix()),this},s.Scene.prototype._internalPick=function(e,t,i,r){if(!l.a)return null;for(var n=null,o=0;o<this.meshes.length;o++){var s=this.meshes[o];if(t){if(!t(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=e(s.getWorldMatrix()),h=s.intersects(a,i,r);if(h&&h.hit&&((i||null==n||!(h.distance>=n.distance))&&(n=h,i)))break}return n||new l.a},s.Scene.prototype._internalMultiPick=function(e,t,i){if(!l.a)return null;for(var r=new Array,n=0;n<this.meshes.length;n++){var o=this.meshes[n];if(t){if(!t(o))continue}else if(!o.isEnabled()||!o.isVisible||!o.isPickable)continue;var s=e(o.getWorldMatrix()),a=o.intersects(s,!1,i);a&&a.hit&&r.push(a)}return r},s.Scene.prototype.pick=function(t,i,e,r,n,o){var s=this;if(!l.a)return null;var a=this._internalPick(function(e){return s._tempPickingRay||(s._tempPickingRay=c.Zero()),s.createPickingRayToRef(t,i,e,s._tempPickingRay,n||null),s._tempPickingRay},e,r,o);return a&&(a.ray=this.createPickingRay(t,i,M.a.Identity(),n||null)),a},s.Scene.prototype.pickWithRay=function(t,e,i,r){var n=this,o=this._internalPick(function(e){return n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=M.a.Identity()),e.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=c.Zero()),c.TransformToRef(t,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform},e,i,r);return o&&(o.ray=t),o},s.Scene.prototype.multiPick=function(t,i,e,r,n){var o=this;return this._internalMultiPick(function(e){return o.createPickingRay(t,i,e,r||null)},e,n)},s.Scene.prototype.multiPickWithRay=function(t,e,i){var r=this;return this._internalMultiPick(function(e){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=M.a.Identity()),e.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=c.Zero()),c.TransformToRef(t,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform},e,i)},h.a.prototype.getForwardRay=function(e,t,i){void 0===e&&(e=100),t=t||this.getWorldMatrix(),i=i||this.position;var r=this._scene.useRightHandedSystem?new M.e(0,0,-1):new M.e(0,0,1),n=M.e.TransformNormal(r,t),o=M.e.Normalize(n);return new c(i,o,e)};var u=(f._RemoveAndStorePivotPoint=function(e){e&&0===f._PivotCached&&(e.getPivotPointToRef(f._OldPivotPoint),f._OldPivotPoint.equalsToFloats(0,0,0)||(e.setPivotMatrix(M.a.IdentityReadOnly),f._OldPivotPoint.subtractToRef(e.getPivotPoint(),f._PivotTranslation),f._PivotTmpVector.copyFromFloats(1,1,1),f._PivotTmpVector.subtractInPlace(e.scaling),f._PivotTmpVector.multiplyInPlace(f._PivotTranslation),e.position.addInPlace(f._PivotTmpVector))),f._PivotCached++},f._RestorePivotPoint=function(e){e&&!f._OldPivotPoint.equalsToFloats(0,0,0)&&1===f._PivotCached&&(e.setPivotPoint(f._OldPivotPoint),f._PivotTmpVector.copyFromFloats(1,1,1),f._PivotTmpVector.subtractInPlace(e.scaling),f._PivotTmpVector.multiplyInPlace(f._PivotTranslation),e.position.subtractInPlace(f._PivotTmpVector)),this._PivotCached--},f._PivotCached=0,f._OldPivotPoint=new M.e,f._PivotTranslation=new M.e,f._PivotTmpVector=new M.e,f);function f(){}i(77);var p=(Object.defineProperty(_.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),_.prototype.init=function(){},_.prototype.attach=function(e,t){var r=this;this._scene=e.getScene(),this.attachedNode=e,_._planeScene||(this._debugMode?_._planeScene=this._scene:((_._planeScene=new s.Scene(this._scene.getEngine(),{virtual:!0})).detachControl(),this._scene.onDisposeObservable.addOnce(function(){_._planeScene.dispose(),_._planeScene=null}))),this._dragPlane=o.Mesh.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,_._planeScene,!1,o.Mesh.DOUBLESIDE),this.lastDragPosition=new M.e(0,0,0);var n=t||function(e){return r.attachedNode==e||e.isDescendantOf(r.attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add(function(e,t){if(r.enabled)if(e.type==a.a.POINTERDOWN)r.startAndReleaseDragOnPointerEvents&&!r.dragging&&e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh&&e.pickInfo.pickedPoint&&e.pickInfo.ray&&n(e.pickInfo.pickedMesh)&&r._startDrag(e.event.pointerId,e.pickInfo.ray,e.pickInfo.pickedPoint);else if(e.type==a.a.POINTERUP)r.startAndReleaseDragOnPointerEvents&&r.currentDraggingPointerID==e.event.pointerId&&r.releaseDrag();else if(e.type==a.a.POINTERMOVE){var i=e.event.pointerId;r.currentDraggingPointerID===_._AnyMouseID&&i!==_._AnyMouseID&&"mouse"==e.event.pointerType&&(r._lastPointerRay[r.currentDraggingPointerID]&&(r._lastPointerRay[i]=r._lastPointerRay[r.currentDraggingPointerID],delete r._lastPointerRay[r.currentDraggingPointerID]),r.currentDraggingPointerID=i),r._lastPointerRay[i]||(r._lastPointerRay[i]=new c(new M.e,new M.e)),e.pickInfo&&e.pickInfo.ray&&(r._lastPointerRay[i].origin.copyFrom(e.pickInfo.ray.origin),r._lastPointerRay[i].direction.copyFrom(e.pickInfo.ray.direction),r.currentDraggingPointerID==i&&r.dragging&&r._moveDrag(e.pickInfo.ray))}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){r._moving&&r.moveAttached&&(u._RemoveAndStorePivotPoint(r.attachedNode),r._targetPosition.subtractToRef(r.attachedNode.absolutePosition,r._tmpVector),r._tmpVector.scaleInPlace(r.dragDeltaRatio),r.attachedNode.getAbsolutePosition().addToRef(r._tmpVector,r._tmpVector),r.validateDrag(r._tmpVector)&&r.attachedNode.setAbsolutePosition(r._tmpVector),u._RestorePivotPoint(r.attachedNode))})},_.prototype.releaseDrag=function(){this.dragging&&(this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.dragging=!1),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!this._scene.activeCamera.inputs||this._scene.activeCamera.inputs.noPreventDefault)},_.prototype.startDrag=function(e,t,i){void 0===e&&(e=_._AnyMouseID),this._startDrag(e,t,i);var r=this._lastPointerRay[e];e===_._AnyMouseID&&(r=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),r&&this._moveDrag(r)},_.prototype._startDrag=function(e,t,i){if(this._scene.activeCamera&&!this.dragging&&this.attachedNode){u._RemoveAndStorePivotPoint(this.attachedNode),t?(this._startDragRay.direction.copyFrom(t.direction),this._startDragRay.origin.copyFrom(t.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,i||this._tmpVector);var r=this._pickWithRayOnDragPlane(this._startDragRay);r&&(this.dragging=!0,this.currentDraggingPointerID=e,this.lastDragPosition.copyFrom(r),this.onDragStartObservable.notifyObservers({dragPlanePoint:r,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this.attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),u._RestorePivotPoint(this.attachedNode)}},_.prototype._moveDrag=function(e){this._moving=!0;var t=this._pickWithRayOnDragPlane(e);if(t){this.updateDragPlane&&this._updateDragPlanePosition(e,t);var i=0;this._options.dragAxis?(this.useObjectOrientationForDragging?M.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),t.subtractToRef(this.lastDragPosition,this._tmpVector),i=M.e.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(i,this._dragDelta)):(i=this._dragDelta.length(),t.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:i,delta:this._dragDelta,dragPlanePoint:t,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(t)}},_.prototype._pickWithRayOnDragPlane=function(e){var t=this;if(!e)return null;var i=Math.acos(M.e.Dot(this._dragPlane.forward,e.direction));if(i>Math.PI/2&&(i=Math.PI-i),0<this.maxDragAngle&&i>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(e.direction),this.attachedNode.absolutePosition.subtractToRef(e.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*M.e.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var r=M.e.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-r,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}return null}var n=_._planeScene.pickWithRay(e,function(e){return e==t._dragPlane});return n&&n.hit&&n.pickedMesh&&n.pickedPoint?n.pickedPoint:null},_.prototype._updateDragPlanePosition=function(e,t){this._pointA.copyFrom(t),this._options.dragAxis?(this.useObjectOrientationForDragging?M.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),e.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),M.e.CrossToRef(this._lineA,this._lineB,this._lookAt),M.e.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?M.e.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(e.origin)),this._dragPlane.position.copyFrom(this.attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},_.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},_._AnyMouseID=-2,_);function _(e){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new r.a,this.onDragStartObservable=new r.a,this.onDragEndObservable=new r.a,this.moveAttached=!0,this.enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=function(e){return!0},this._tmpVector=new M.e(0,0,0),this._alternatePickedPoint=new M.e(0,0,0),this._worldDragAxis=new M.e(0,0,0),this._targetPosition=new M.e(0,0,0),this._attachedElement=null,this._startDragRay=new c(new M.e,new M.e),this._lastPointerRay={},this._dragDelta=new M.e,this._pointA=new M.e(0,0,0),this._pointB=new M.e(0,0,0),this._pointC=new M.e(0,0,0),this._lineA=new M.e(0,0,0),this._lineB=new M.e(0,0,0),this._localAxis=new M.e(0,0,0),this._lookAt=new M.e(0,0,0),this._options=e||{};var t=0;if(this._options.dragAxis&&t++,this._options.dragPlaneNormal&&t++,1<t)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}}]);

return Baby;
})